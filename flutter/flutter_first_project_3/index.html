<!--
  Copyright (c) 2016-2020 Martin Donath <martin.donath@squidfunk.com>
  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:
  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.
  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
--> <!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=description content="An Android Developer."><link href=https://blog.yorek.xyz/about-me/flutter/flutter_first_project_3/ rel=canonical><meta name=author content="Yorek Liu"><meta name=lang:clipboard.copy content=复制><meta name=lang:clipboard.copied content=已复制><meta name=lang:search.language content=ja><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content=没有找到符合条件的结果><meta name=lang:search.result.one content="找到 1 个符合条件的结果"><meta name=lang:search.result.other content="# 个符合条件的结果"><meta name=lang:search.tokenizer content=[\uff0c\u3002]+><link rel="shortcut icon" href=../../assets/images/favicon.ico><meta name=generator content="mkdocs-1.0.4, mkdocs-material-4.6.0"><title>年轻人的第一个Flutter程序(3)</title><link rel=stylesheet href=../../assets/stylesheets/application.1b62728e.css><link rel=stylesheet href=../../assets/stylesheets/application-palette.a8b3c06d.css><meta name=theme-color content><script src=../../assets/javascripts/modernizr.268332fc.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel=stylesheet href=../../assets/fonts/material-icons.css><link rel=manifest href=../../manifest.webmanifest><script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-155096376-1", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script><script async src=https://www.google-analytics.com/analytics.js></script><!-- Determine title --><!-- The image needs to have an absolute URL --><!-- Open graph meta tags --><meta property=og:type content=website><meta property=og:title content="Yorek's - 年轻人的第一个Flutter程序(3)"><meta property=og:description content="An Android Developer."><meta content=https://blog.yorek.xyz/about-me/flutter/flutter_first_project_3/ property=og:url><meta property=og:image content=https://blog.yorek.xyz/about-meassets/images/banner.png><meta property=og:image:type content=image/png><meta property=og:image:width content=1200><meta property=og:image:height content=630><!-- Twitter meta tags --><meta name=twitter:card content=summary_large_image><meta name=twitter:site content=@squidfunk><meta name=twitter:creator content=@squidfunk><meta name=twitter:title content="Yorek's - 年轻人的第一个Flutter程序(3)"><meta name=twitter:description content="An Android Developer."><meta name=twitter:image content=https://blog.yorek.xyz/about-meassets/images/banner.png></head> <body dir=ltr data-md-color-primary=white data-md-color-accent=blue> <svg class=md-svg> <defs> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#1 tabindex=1 class=md-skip> 跳转至 </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=https://blog.yorek.xyz/about-me title="Yorek's" class="md-header-nav__button md-logo"> <img src=../../assets/images/favicon.ico width=24 height=24> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> Yorek's </span> <span class=md-header-nav__topic> 年轻人的第一个Flutter程序(3) </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> 键入以开始搜索 </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container> <nav class="md-tabs md-tabs--active" data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../android/3rd-library/3rd-library-source-code/ class=md-tabs__link> Android </a> </li> <li class=md-tabs__item> <a href=../flutter_first_project_1/ class="md-tabs__link md-tabs__link--active"> Flutter </a> </li> <li class=md-tabs__item> <a href=../../leetcode/ class=md-tabs__link> LeetCode </a> </li> <li class=md-tabs__item> <a href=../../design-pattern/design-pattern/ class=md-tabs__link> Books </a> </li> </ul> </div> </nav> <main class=md-main role=main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=https://blog.yorek.xyz/about-me title="Yorek's" class="md-nav__button md-logo"> <img src=../../assets/images/favicon.ico width=48 height=48> </a> Yorek's </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. title=Home class=md-nav__link> Home </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2 type=checkbox id=nav-2> <label class=md-nav__link for=nav-2> Android </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-2> Android </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-1 type=checkbox id=nav-2-1> <label class=md-nav__link for=nav-2-1> 三方库源码解析 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-1> 三方库源码解析 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../android/3rd-library/3rd-library-source-code/ title=Android三方库源码分析 class=md-nav__link> Android三方库源码分析 </a> </li> <li class=md-nav__item> <a href=../../android/3rd-library/matrix/ title="微信APM Matrix解析" class=md-nav__link> 微信APM Matrix解析 </a> </li> <li class=md-nav__item> <a href=../../android/3rd-library/matrix-trace/ title=Matrix-TraceCanary解析 class=md-nav__link> Matrix-TraceCanary解析 </a> </li> <li class=md-nav__item> <a href=../../android/3rd-library/matrix-io/ title=Matrix-IOCanary解析 class=md-nav__link> Matrix-IOCanary解析 </a> </li> <li class=md-nav__item> <a href=../../android/3rd-library/matrix-resource/ title=Matrix-ResourceCanary解析 class=md-nav__link> Matrix-ResourceCanary解析 </a> </li> <li class=md-nav__item> <a href=../../android/3rd-library/matrix-sqlitelint/ title=Matrix-SQLiteLint解析 class=md-nav__link> Matrix-SQLiteLint解析 </a> </li> <li class=md-nav__item> <a href=../../android/3rd-library/okhttp/ title=OkHttp3源码解析 class=md-nav__link> OkHttp3源码解析 </a> </li> <li class=md-nav__item> <a href=../../android/3rd-library/retrofit/ title=Retrofit2源码解析 class=md-nav__link> Retrofit2源码解析 </a> </li> <li class=md-nav__item> <a href=../../android/3rd-library/rxjava&rxandroid/ title=RxJava源码解析及使用实例 class=md-nav__link> RxJava源码解析及使用实例 </a> </li> <li class=md-nav__item> <a href=../../android/other/RxJava/ title=RxJava操作符大全 class=md-nav__link> RxJava操作符大全 </a> </li> <li class=md-nav__item> <a href=../../android/3rd-library/glide1/ title="Glide v4 源码解析（一）" class=md-nav__link> Glide v4 源码解析（一） </a> </li> <li class=md-nav__item> <a href=../../android/3rd-library/glide2/ title="Glide v4 源码解析（二）" class=md-nav__link> Glide v4 源码解析（二） </a> </li> <li class=md-nav__item> <a href=../../android/3rd-library/glide3/ title="Glide v4 源码解析（三）" class=md-nav__link> Glide v4 源码解析（三） </a> </li> <li class=md-nav__item> <a href=../../android/3rd-library/glide4/ title="Glide v4 源码解析（四）" class=md-nav__link> Glide v4 源码解析（四） </a> </li> <li class=md-nav__item> <a href=../../android/3rd-library/glide5/ title="Glide v4 源码解析（五）" class=md-nav__link> Glide v4 源码解析（五） </a> </li> <li class=md-nav__item> <a href=../../android/3rd-library/glide6/ title="Glide v4 源码解析（六）" class=md-nav__link> Glide v4 源码解析（六） </a> </li> <li class=md-nav__item> <a href=../../android/3rd-library/glide7/ title="Glide v4 源码解析（七）" class=md-nav__link> Glide v4 源码解析（七） </a> </li> <li class=md-nav__item> <a href=../../android/3rd-library/migrate-to-glide/ title=杂记：从Picasso迁移至Glide class=md-nav__link> 杂记：从Picasso迁移至Glide </a> </li> <li class=md-nav__item> <a href=../../android/3rd-library/eventbus/ title=EventBus源码解析 class=md-nav__link> EventBus源码解析 </a> </li> <li class=md-nav__item> <a href=../../android/3rd-library/leakcanary/ title=LeakCanary2源码解析 class=md-nav__link> LeakCanary2源码解析 </a> </li> <li class=md-nav__item> <a href=../../android/3rd-library/permissiondispatcher/ title=PermissionDispatcher源码解析 class=md-nav__link> PermissionDispatcher源码解析 </a> </li> <li class=md-nav__item> <a href=../../android/other/constraintlayout/ title=ConstraintLayout使用大全 class=md-nav__link> ConstraintLayout使用大全 </a> </li> <li class=md-nav__item> <a href=../../android/other/dagger2/ title=初学者的Dagger2教程 class=md-nav__link> 初学者的Dagger2教程 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-2 type=checkbox id=nav-2-2> <label class=md-nav__link for=nav-2-2> Android开发高手课 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-2> Android开发高手课 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../android/paid/master/ title=Android开发高手课 class=md-nav__link> Android开发高手课 </a> </li> <li class=md-nav__item> <a href=../../android/paid/master/crash_1/ title="01 | 崩溃优化（上）：关于“崩溃”那些事儿" class=md-nav__link> 01 | 崩溃优化（上）：关于“崩溃”那些事儿 </a> </li> <li class=md-nav__item> <a href=../../android/paid/master/crash_2/ title="02 | 崩溃优化（下）：应用崩溃了，你应该如何去分析？" class=md-nav__link> 02 | 崩溃优化（下）：应用崩溃了，你应该如何去分析？ </a> </li> <li class=md-nav__item> <a href=../../android/paid/master/memory_1/ title="03 | 内存优化（上）：4GB内存时代，再谈内存优化" class=md-nav__link> 03 | 内存优化（上）：4GB内存时代，再谈内存优化 </a> </li> <li class=md-nav__item> <a href=../../android/paid/master/memory_2/ title="04 | 内存优化（下）：内存优化这件事，应该从哪里着手？" class=md-nav__link> 04 | 内存优化（下）：内存优化这件事，应该从哪里着手？ </a> </li> <li class=md-nav__item> <a href=../../android/paid/master/stuck_1/ title="05 | 卡顿优化（上）：你要掌握的卡顿分析方法" class=md-nav__link> 05 | 卡顿优化（上）：你要掌握的卡顿分析方法 </a> </li> <li class=md-nav__item> <a href=../../android/paid/master/stuck_2/ title="06 | 卡顿优化（下）：如何监控应用卡顿？" class=md-nav__link> 06 | 卡顿优化（下）：如何监控应用卡顿？ </a> </li> <li class=md-nav__item> <a href=../../android/paid/master/stuck_3/ title="06补充篇 | 卡顿优化：卡顿现场与卡顿分析" class=md-nav__link> 06补充篇 | 卡顿优化：卡顿现场与卡顿分析 </a> </li> <li class=md-nav__item> <a href=../../android/paid/master/start_1/ title="07 | 启动优化（上）：从启动过程看启动速度优化" class=md-nav__link> 07 | 启动优化（上）：从启动过程看启动速度优化 </a> </li> <li class=md-nav__item> <a href=../../android/paid/master/start_2/ title="08 | 启动优化（下）：优化启动速度的进阶方法" class=md-nav__link> 08 | 启动优化（下）：优化启动速度的进阶方法 </a> </li> <li class=md-nav__item> <a href=../../android/paid/master/io_1/ title="09 | I/O优化（上）：开发工程师必备的I/O优化知识" class=md-nav__link> 09 | I/O优化（上）：开发工程师必备的I/O优化知识 </a> </li> <li class=md-nav__item> <a href=../../android/paid/master/io_2/ title="10 | I/O优化（中）：不同I/O方式的使用场景是什么？" class=md-nav__link> 10 | I/O优化（中）：不同I/O方式的使用场景是什么？ </a> </li> <li class=md-nav__item> <a href=../../android/paid/master/io_3/ title="11 | I/O优化（下）：如何监控线上I/O操作？" class=md-nav__link> 11 | I/O优化（下）：如何监控线上I/O操作？ </a> </li> <li class=md-nav__item> <a href=../../android/paid/master/storage_1/ title="12 | 存储优化（上）：常见的数据存储方法有哪些？" class=md-nav__link> 12 | 存储优化（上）：常见的数据存储方法有哪些？ </a> </li> <li class=md-nav__item> <a href=../../android/paid/master/storage_2/ title="13 | 存储优化（中）：如何优化数据存储？" class=md-nav__link> 13 | 存储优化（中）：如何优化数据存储？ </a> </li> <li class=md-nav__item> <a href=../../android/paid/master/storage_3/ title="14 | 存储优化（下）：数据库SQLite的使用和优化" class=md-nav__link> 14 | 存储优化（下）：数据库SQLite的使用和优化 </a> </li> <li class=md-nav__item> <a href=../../android/paid/master/network_1/ title="15 | 网络优化（上）：移动开发工程师必备的网络优化知识" class=md-nav__link> 15 | 网络优化（上）：移动开发工程师必备的网络优化知识 </a> </li> <li class=md-nav__item> <a href=../../android/paid/master/network_2/ title="16 | 网络优化（中）：复杂多变的移动网络该如何优化？" class=md-nav__link> 16 | 网络优化（中）：复杂多变的移动网络该如何优化？ </a> </li> <li class=md-nav__item> <a href=../../android/paid/master/network_3/ title="17 | 网络优化（下）：大数据下网络该如何监控？" class=md-nav__link> 17 | 网络优化（下）：大数据下网络该如何监控？ </a> </li> <li class=md-nav__item> <a href=../../android/paid/master/battery_1/ title="18 | 耗电优化（上）：从电量优化的演进看耗电分析" class=md-nav__link> 18 | 耗电优化（上）：从电量优化的演进看耗电分析 </a> </li> <li class=md-nav__item> <a href=../../android/paid/master/battery_2/ title="19 | 耗电优化（下）：耗电的优化方法与线上监控" class=md-nav__link> 19 | 耗电优化（下）：耗电的优化方法与线上监控 </a> </li> <li class=md-nav__item> <a href=../../android/paid/master/ui_1/ title="20 | UI 优化（上）：UI 渲染的几个关键概念" class=md-nav__link> 20 | UI 优化（上）：UI 渲染的几个关键概念 </a> </li> <li class=md-nav__item> <a href=../../android/paid/master/ui_2/ title="21 | UI 优化（下）：如何优化 UI 渲染？" class=md-nav__link> 21 | UI 优化（下）：如何优化 UI 渲染？ </a> </li> <li class=md-nav__item> <a href=../../android/paid/master/package_1/ title="22 | 包体积优化（上）：如何减少安装包大小？" class=md-nav__link> 22 | 包体积优化（上）：如何减少安装包大小？ </a> </li> <li class=md-nav__item> <a href=../../android/paid/master/package_2/ title="23 | 包体积优化（下）：资源优化的进阶实践" class=md-nav__link> 23 | 包体积优化（下）：资源优化的进阶实践 </a> </li> <li class=md-nav__item> <a href=../../android/paid/master/compile/ title="26 | 关于编译，你需要了解什么？" class=md-nav__link> 26 | 关于编译，你需要了解什么？ </a> </li> <li class=md-nav__item> <a href=../../android/paid/master/bytecode/ title="27 | 编译插桩的三种方法：AspectJ、ASM、ReDex" class=md-nav__link> 27 | 编译插桩的三种方法：AspectJ、ASM、ReDex </a> </li> <li class=md-nav__item> <a href=../../android/paid/master/native_hook/ title="35 | Native Hook 技术，天使还是魔鬼？" class=md-nav__link> 35 | Native Hook 技术，天使还是魔鬼？ </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-3 type=checkbox id=nav-2-3> <label class=md-nav__link for=nav-2-3> Framework系列 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-3> Framework系列 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../android/framework/Android四大组件(1)/ title=Activity class=md-nav__link> Activity </a> </li> <li class=md-nav__item> <a href=../../android/framework/Android四大组件(2)/ title=Service class=md-nav__link> Service </a> </li> <li class=md-nav__item> <a href=../../android/framework/Android四大组件(3)/ title=Broadcasts class=md-nav__link> Broadcasts </a> </li> <li class=md-nav__item> <a href=../../android/framework/Android四大组件(4)/ title="Content Providers与Fragment" class=md-nav__link> Content Providers与Fragment </a> </li> <li class=md-nav__item> <a href=../../android/framework/IPC机制/ title=IPC机制 class=md-nav__link> IPC机制 </a> </li> <li class=md-nav__item> <a href=../../android/framework/View的事件体系/ title=View的事件体系 class=md-nav__link> View的事件体系 </a> </li> <li class=md-nav__item> <a href=../../android/framework/View的绘制原理/ title=View的绘制原理 class=md-nav__link> View的绘制原理 </a> </li> <li class=md-nav__item> <a href=../../android/framework/RemoteViews/ title=RemoteViews class=md-nav__link> RemoteViews </a> </li> <li class=md-nav__item> <a href=../../android/framework/Drawable/ title=Android中的Drawable资源 class=md-nav__link> Android中的Drawable资源 </a> </li> <li class=md-nav__item> <a href=../../android/framework/Android动画/ title=Android动画 class=md-nav__link> Android动画 </a> </li> <li class=md-nav__item> <a href=../../android/framework/Window与WindowManager/ title=Window与WindowManager class=md-nav__link> Window与WindowManager </a> </li> <li class=md-nav__item> <a href=../../android/framework/四大组件启动过程/ title=四大组件启动过程 class=md-nav__link> 四大组件启动过程 </a> </li> <li class=md-nav__item> <a href=../../android/framework/Android消息机制/ title=Android消息机制 class=md-nav__link> Android消息机制 </a> </li> <li class=md-nav__item> <a href=../../android/framework/Android线程与线程池/ title=Android线程与线程池 class=md-nav__link> Android线程与线程池 </a> </li> <li class=md-nav__item> <a href=../../android/framework/Bitmap的缓存与加载/ title=Bitmap的缓存与加载 class=md-nav__link> Bitmap的缓存与加载 </a> </li> <li class=md-nav__item> <a href=../../android/framework/JNI与NDK/ title=JNI与NDK编程简介 class=md-nav__link> JNI与NDK编程简介 </a> </li> <li class=md-nav__item> <a href=../../android/framework/性能优化/ title=Android性能优化 class=md-nav__link> Android性能优化 </a> </li> <li class=md-nav__item> <a href=../../android/framework/binder1-mediaservice/ title=Binder深入理解——以MediaService为例 class=md-nav__link> Binder深入理解——以MediaService为例 </a> </li> <li class=md-nav__item> <a href=../../android/framework/binder2/ title=Binder深入理解——罗老师系列 class=md-nav__link> Binder深入理解——罗老师系列 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-4 type=checkbox id=nav-2-4> <label class=md-nav__link for=nav-2-4> 付费知识归档 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-4> 付费知识归档 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-4-1 type=checkbox id=nav-2-4-1> <label class=md-nav__link for=nav-2-4-1> 某圈问题索引 </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-2-4-1> 某圈问题索引 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../android/paid/zsxq/zsxq_index/ title=某圈问题索引 class=md-nav__link> 某圈问题索引 </a> </li> <li class=md-nav__item> <a href=../../android/paid/zsxq/week1-synchronized/ title=理解Java中synchronized关键词 class=md-nav__link> 理解Java中synchronized关键词 </a> </li> <li class=md-nav__item> <a href=../../android/paid/zsxq/week2-service/ title=理解Service class=md-nav__link> 理解Service </a> </li> <li class=md-nav__item> <a href=../../android/paid/zsxq/week3-activity/ title=理解Activity的启动模式 class=md-nav__link> 理解Activity的启动模式 </a> </li> <li class=md-nav__item> <a href=../../android/paid/zsxq/week4-startActivityForResult/ title=关于startActivityForResult class=md-nav__link> 关于startActivityForResult </a> </li> <li class=md-nav__item> <a href=../../android/paid/zsxq/week5-view/ title=关于View的知识 class=md-nav__link> 关于View的知识 </a> </li> <li class=md-nav__item> <a href=../../android/paid/zsxq/week6-gradle/ title=关于Gradle的知识 class=md-nav__link> 关于Gradle的知识 </a> </li> <li class=md-nav__item> <a href=../../android/paid/zsxq/week7-serialization/ title=关于序列化的知识 class=md-nav__link> 关于序列化的知识 </a> </li> <li class=md-nav__item> <a href=../../android/paid/zsxq/week10-classloader/ title=Android中的ClassLoader class=md-nav__link> Android中的ClassLoader </a> </li> <li class=md-nav__item> <a href=../../android/paid/zsxq/week11-binder/ title=Binder简介 class=md-nav__link> Binder简介 </a> </li> <li class=md-nav__item> <a href=../../android/paid/zsxq/week12-retrofit-okhttp/ title=OkHttp和Retrofit的作用以及两者之间的联系 class=md-nav__link> OkHttp和Retrofit的作用以及两者之间的联系 </a> </li> <li class=md-nav__item> <a href=../../android/paid/zsxq/week14-jvm-gc/ title=JVM中垃圾回收策略 class=md-nav__link> JVM中垃圾回收策略 </a> </li> <li class=md-nav__item> <a href=../../android/paid/zsxq/week16-keep-app-alive/ title=进程保活 class=md-nav__link> 进程保活 </a> </li> <li class=md-nav__item> <a href=../../android/paid/zsxq/week17-android-components/ title=四大组件的作用以及多进程 class=md-nav__link> 四大组件的作用以及多进程 </a> </li> <li class=md-nav__item> <a href=../../android/paid/zsxq/week20-network-protocol/ title=网络协议 class=md-nav__link> 网络协议 </a> </li> <li class=md-nav__item> <a href=../../android/paid/zsxq/week21-mvc&amp;mvp&mvvm/ title=MVC、MVP和MVVM class=md-nav__link> MVC、MVP和MVVM </a> </li> <li class=md-nav__item> <a href=../../android/paid/zsxq/week22-android-studio-build/ title="Android Studio build过程" class=md-nav__link> Android Studio build过程 </a> </li> <li class=md-nav__item> <a href=../../android/paid/zsxq/week23-load-large-bitmap/ title=大尺寸图片加载问题 class=md-nav__link> 大尺寸图片加载问题 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-5 type=checkbox id=nav-2-5> <label class=md-nav__link for=nav-2-5> 日常记录 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-5> 日常记录 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../android/other/annotation/ title=注解的定义及解析 class=md-nav__link> 注解的定义及解析 </a> </li> <li class=md-nav__item> <a href=../../android/other/best_throttle_in_mvvm/ title=这可能是MVVM中最优雅的按键防抖方案 class=md-nav__link> 这可能是MVVM中最优雅的按键防抖方案 </a> </li> <li class=md-nav__item> <a href=../../android/other/android-jenkins/ title="Jenkins for android" class=md-nav__link> Jenkins for android </a> </li> <li class=md-nav__item> <a href=../../android/other/SystemProrities/ title=普通Android程序使用SystemProrities class=md-nav__link> 普通Android程序使用SystemProrities </a> </li> <li class=md-nav__item> <a href=../../android/other/recyclerview-cache/ title=ListView、RecyclerView缓存策略解析 class=md-nav__link> ListView、RecyclerView缓存策略解析 </a> </li> <li class=md-nav__item> <a href=../../android/other/recyclerview-item-docoration/ title=RecyclerView高级特性——ItemDecoration class=md-nav__link> RecyclerView高级特性——ItemDecoration </a> </li> <li class=md-nav__item> <a href=../../android/other/recyclerview-others/ title=RecyclerView的一些使用细节 class=md-nav__link> RecyclerView的一些使用细节 </a> </li> <li class=md-nav__item> <a href=../../android/other/RecyclerView-Sort&Delete/ title=RecyclerView高级特性——拖拽排序以及滑动删除 class=md-nav__link> RecyclerView高级特性——拖拽排序以及滑动删除 </a> </li> <li class=md-nav__item> <a href=../../android/other/FAB-Behavior/ title=FloatingActionButton上滑隐藏下滑显示 class=md-nav__link> FloatingActionButton上滑隐藏下滑显示 </a> </li> <li class=md-nav__item> <a href=../../android/other/nestedscrolling/ title=NestedScrolling机制 class=md-nav__link> NestedScrolling机制 </a> </li> <li class=md-nav__item> <a href=../../android/other/porterduff/ title=使用Porter-Duff合成数字图像 class=md-nav__link> 使用Porter-Duff合成数字图像 </a> </li> <li class=md-nav__item> <a href=../../android/other/runtime/ title="Android Runtime" class=md-nav__link> Android Runtime </a> </li> <li class=md-nav__item> <a href=../../android/other/android_alias/ title=Android马甲包的那些事儿 class=md-nav__link> Android马甲包的那些事儿 </a> </li> <li class=md-nav__item> <a href=../../android/other/Android-Development-Tool/ title=Android神兵利器 class=md-nav__link> Android神兵利器 </a> </li> <li class=md-nav__item> <a href=../../android/other/FileProvider/ title=FileProvider class=md-nav__link> FileProvider </a> </li> <li class=md-nav__item> <a href=../../android/other/Android判断导航栏高度/ title=Android判断虚拟按键(导航栏)显示与否、高度以及获取屏幕实际高度 class=md-nav__link> Android判断虚拟按键(导航栏)显示与否、高度以及获取屏幕实际高度 </a> </li> <li class=md-nav__item> <a href=../../android/other/Android图片选择器/ title=Android图片选择器 class=md-nav__link> Android图片选择器 </a> </li> <li class=md-nav__item> <a href=../../android/other/Android底部导航栏框架/ title=Android原生底部导航栏 class=md-nav__link> Android原生底部导航栏 </a> </li> <li class=md-nav__item> <a href=../../android/other/Android搜索栏的实现/ title=Android搜索栏的实现 class=md-nav__link> Android搜索栏的实现 </a> </li> <li class=md-nav__item> <a href=../../android/other/Android暂停音乐播放器的播放/ title=Android暂停酷狗、网易云音乐等音乐播放器的播放 class=md-nav__link> Android暂停酷狗、网易云音乐等音乐播放器的播放 </a> </li> <li class=md-nav__item> <a href=../../android/other/Android滑动返回实践/ title=Android滑动返回实践 class=md-nav__link> Android滑动返回实践 </a> </li> <li class=md-nav__item> <a href=../../android/other/Android程序反编译/ title=MacOS下Android程序反编译 class=md-nav__link> MacOS下Android程序反编译 </a> </li> <li class=md-nav__item> <a href=../../android/other/Android通讯录快速读取/ title=Android通讯录快速读取 class=md-nav__link> Android通讯录快速读取 </a> </li> <li class=md-nav__item> <a href=../../android/other/soft-keyboard-in-app/ title=App内自定义软键盘 class=md-nav__link> App内自定义软键盘 </a> </li> <li class=md-nav__item> <a href=../../android/other/腾讯X5内核入坑指南/ title="腾讯TBS X5浏览器内核入坑指南" class=md-nav__link> 腾讯TBS X5浏览器内核入坑指南 </a> </li> <li class=md-nav__item> <a href=../../android/other/琐碎知识点/ title=琐碎知识点 class=md-nav__link> 琐碎知识点 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3 type=checkbox id=nav-3 checked> <label class=md-nav__link for=nav-3> Flutter </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-3> Flutter </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../flutter_first_project_1/ title=年轻人的第一个Flutter程序(1) class=md-nav__link> 年轻人的第一个Flutter程序(1) </a> </li> <li class=md-nav__item> <a href=../flutter_first_project_2/ title=年轻人的第一个Flutter程序(2) class=md-nav__link> 年轻人的第一个Flutter程序(2) </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-toggle md-nav__toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> 年轻人的第一个Flutter程序(3) </label> <a href=./ title=年轻人的第一个Flutter程序(3) class="md-nav__link md-nav__link--active"> 年轻人的第一个Flutter程序(3) </a> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>目录</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#1 class=md-nav__link> 1. 页面的跳转 </a> </li> <li class=md-nav__item> <a href=#2 class=md-nav__link> 2. 表单 </a> </li> <li class=md-nav__item> <a href=#3 class=md-nav__link> 3. 数据库以及其他存储方式 </a> </li> <li class=md-nav__item> <a href=#4-flutter class=md-nav__link> 4. Flutter中的异步操作 </a> </li> <li class=md-nav__item> <a href=#__comments class="md-nav__link md-nav__link--active"> 评论 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../flutter_first_project_4/ title=年轻人的第一个Flutter程序(4) class=md-nav__link> 年轻人的第一个Flutter程序(4) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4 type=checkbox id=nav-4> <label class=md-nav__link for=nav-4> LeetCode </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-4> LeetCode </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../leetcode/ title=算法目录 class=md-nav__link> 算法目录 </a> </li> <li class=md-nav__item> <a href=../../leetcode/code_interviews_1/ title=数据结构、算法和数据操作 class=md-nav__link> 数据结构、算法和数据操作 </a> </li> <li class=md-nav__item> <a href=../../leetcode/code_interviews_3/ title=高质量的代码 class=md-nav__link> 高质量的代码 </a> </li> <li class=md-nav__item> <a href=../../leetcode/code_interviews_4/ title=解决问题的思路 class=md-nav__link> 解决问题的思路 </a> </li> <li class=md-nav__item> <a href=../../leetcode/code_interviews_5/ title=优化时间和空间效率 class=md-nav__link> 优化时间和空间效率 </a> </li> <li class=md-nav__item> <a href=../../leetcode/code_interviews_6/ title=面试中的各项能力 class=md-nav__link> 面试中的各项能力 </a> </li> <li class=md-nav__item> <a href=../../leetcode/array/ title=Array class=md-nav__link> Array </a> </li> <li class=md-nav__item> <a href=../../leetcode/leetcode1-10/ title=LeetCode(1-10) class=md-nav__link> LeetCode(1-10) </a> </li> <li class=md-nav__item> <a href=../../leetcode/leetcode11-20/ title=LeetCode(11-20) class=md-nav__link> LeetCode(11-20) </a> </li> <li class=md-nav__item> <a href=../../leetcode/leetcode21-30/ title=LeetCode(21-30) class=md-nav__link> LeetCode(21-30) </a> </li> <li class=md-nav__item> <a href=../../leetcode/leetcode31-40/ title=LeetCode(31-40) class=md-nav__link> LeetCode(31-40) </a> </li> <li class=md-nav__item> <a href=../../leetcode/leetcode41-50/ title=LeetCode(41-50) class=md-nav__link> LeetCode(41-50) </a> </li> <li class=md-nav__item> <a href=../../leetcode/leetcode51-60/ title=LeetCode(51-60) class=md-nav__link> LeetCode(51-60) </a> </li> <li class=md-nav__item> <a href=../../leetcode/leetcode61-70/ title=LeetCode(61-70) class=md-nav__link> LeetCode(61-70) </a> </li> <li class=md-nav__item> <a href=../../leetcode/leetcode71-80/ title=LeetCode(71-80) class=md-nav__link> LeetCode(71-80) </a> </li> <li class=md-nav__item> <a href=../../leetcode/leetcode81-90/ title=LeetCode(81-90) class=md-nav__link> LeetCode(81-90) </a> </li> <li class=md-nav__item> <a href=../../leetcode/leetcode91-100/ title=LeetCode(91-100) class=md-nav__link> LeetCode(91-100) </a> </li> <li class=md-nav__item> <a href=../../leetcode/leetcode101-110/ title=LeetCode(101-110) class=md-nav__link> LeetCode(101-110) </a> </li> <li class=md-nav__item> <a href=../../leetcode/leetcode111-120/ title=LeetCode(111-120) class=md-nav__link> LeetCode(111-120) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5 type=checkbox id=nav-5> <label class=md-nav__link for=nav-5> Books </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-5> Books </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-1 type=checkbox id=nav-5-1> <label class=md-nav__link for=nav-5-1> Design Pattern </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-1> Design Pattern </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../design-pattern/design-pattern/ title=设计模式概述 class=md-nav__link> 设计模式概述 </a> </li> <li class=md-nav__item> <a href=../../design-pattern/design-principle/ title=面向对象的六大原则 class=md-nav__link> 面向对象的六大原则 </a> </li> <li class=md-nav__item> <a href=../../design-pattern/singleton/ title=单例模式(Singleton) class=md-nav__link> 单例模式(Singleton) </a> </li> <li class=md-nav__item> <a href=../../design-pattern/builder/ title=建造者模式(Builder) class=md-nav__link> 建造者模式(Builder) </a> </li> <li class=md-nav__item> <a href=../../design-pattern/prototype/ title=原型模式(Prototype) class=md-nav__link> 原型模式(Prototype) </a> </li> <li class=md-nav__item> <a href=../../design-pattern/factory-method/ title="工厂方法模式(Factory method)" class=md-nav__link> 工厂方法模式(Factory method) </a> </li> <li class=md-nav__item> <a href=../../design-pattern/abstract-factory/ title="抽象工厂模式(Abstract factory)" class=md-nav__link> 抽象工厂模式(Abstract factory) </a> </li> <li class=md-nav__item> <a href=../../design-pattern/proxy/ title=代理模式(Proxy) class=md-nav__link> 代理模式(Proxy) </a> </li> <li class=md-nav__item> <a href=../../design-pattern/composite/ title=组合模式(Composite) class=md-nav__link> 组合模式(Composite) </a> </li> <li class=md-nav__item> <a href=../../design-pattern/adapter/ title=适配器模式(Adapter) class=md-nav__link> 适配器模式(Adapter) </a> </li> <li class=md-nav__item> <a href=../../design-pattern/decorator/ title=装饰模式(Decorator) class=md-nav__link> 装饰模式(Decorator) </a> </li> <li class=md-nav__item> <a href=../../design-pattern/flyweight/ title=享元模式(Flyweight) class=md-nav__link> 享元模式(Flyweight) </a> </li> <li class=md-nav__item> <a href=../../design-pattern/facade/ title=外观模式(Facade) class=md-nav__link> 外观模式(Facade) </a> </li> <li class=md-nav__item> <a href=../../design-pattern/bridge/ title=桥接模式(Bridge) class=md-nav__link> 桥接模式(Bridge) </a> </li> <li class=md-nav__item> <a href=../../design-pattern/strategy/ title=策略模式(Strategy) class=md-nav__link> 策略模式(Strategy) </a> </li> <li class=md-nav__item> <a href=../../design-pattern/state/ title=状态模式(State) class=md-nav__link> 状态模式(State) </a> </li> <li class=md-nav__item> <a href=../../design-pattern/chain-of-responsibility/ title="责任链模式(Chain of responsibility)" class=md-nav__link> 责任链模式(Chain of responsibility) </a> </li> <li class=md-nav__item> <a href=../../design-pattern/interpreter/ title=解释器模式(Interpreter) class=md-nav__link> 解释器模式(Interpreter) </a> </li> <li class=md-nav__item> <a href=../../design-pattern/command/ title=命令模式(Command) class=md-nav__link> 命令模式(Command) </a> </li> <li class=md-nav__item> <a href=../../design-pattern/observer/ title=观察者模式(Observer) class=md-nav__link> 观察者模式(Observer) </a> </li> <li class=md-nav__item> <a href=../../design-pattern/memento/ title=备忘录模式(Memento) class=md-nav__link> 备忘录模式(Memento) </a> </li> <li class=md-nav__item> <a href=../../design-pattern/iterator/ title=迭代器模式(Iterator) class=md-nav__link> 迭代器模式(Iterator) </a> </li> <li class=md-nav__item> <a href=../../design-pattern/template-method/ title="模版方法模式(Template method)" class=md-nav__link> 模版方法模式(Template method) </a> </li> <li class=md-nav__item> <a href=../../design-pattern/visitor/ title=访问者模式(Visitor) class=md-nav__link> 访问者模式(Visitor) </a> </li> <li class=md-nav__item> <a href=../../design-pattern/mediator/ title=中介者模式(Mediator) class=md-nav__link> 中介者模式(Mediator) </a> </li> <li class=md-nav__item> <a href=../../design-pattern/confusing-design-pattern/ title=易混淆的设计模式 class=md-nav__link> 易混淆的设计模式 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2 type=checkbox id=nav-5-2> <label class=md-nav__link for=nav-5-2> Effective Java </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-2> Effective Java </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../effective-java/effective-java/ title="Effective Java概述" class=md-nav__link> Effective Java概述 </a> </li> <li class=md-nav__item> <a href=../../effective-java/chapter1/ title=创建和销毁对象 class=md-nav__link> 创建和销毁对象 </a> </li> <li class=md-nav__item> <a href=../../effective-java/chapter2/ title=对于所有对象都通用的方法 class=md-nav__link> 对于所有对象都通用的方法 </a> </li> <li class=md-nav__item> <a href=../../effective-java/chapter3/ title=类和接口 class=md-nav__link> 类和接口 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-3 type=checkbox id=nav-5-3> <label class=md-nav__link for=nav-5-3> JVM </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-3> JVM </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jvm/jvm-content/ title=深入理解Java虚拟机 class=md-nav__link> 深入理解Java虚拟机 </a> </li> <li class=md-nav__item> <a href=../../jvm/java-memory-area-oom/ title=Java内存区域与内存溢出异常 class=md-nav__link> Java内存区域与内存溢出异常 </a> </li> <li class=md-nav__item> <a href=../../jvm/java-gc/ title=垃圾收集器与内存分配策略 class=md-nav__link> 垃圾收集器与内存分配策略 </a> </li> <li class=md-nav__item> <a href=../../jvm/class-struct/ title=类文件结构 class=md-nav__link> 类文件结构 </a> </li> <li class=md-nav__item> <a href=../../jvm/load-class/ title=虚拟机类加载机制 class=md-nav__link> 虚拟机类加载机制 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-4 type=checkbox id=nav-5-4> <label class=md-nav__link for=nav-5-4> Java </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-4> Java </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../java/generics-java-kotlin/ title=Java&Kotlin在泛型方面的区别 class=md-nav__link> Java&Kotlin在泛型方面的区别 </a> </li> <li class=md-nav__item> <a href=../../java/java-collections/ title=Java集合总结 class=md-nav__link> Java集合总结 </a> </li> <li class=md-nav__item> <a href=../../java/java-foundation/ title=Java常见概念 class=md-nav__link> Java常见概念 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-5 type=checkbox id=nav-5-5> <label class=md-nav__link for=nav-5-5> Refactoring </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-5> Refactoring </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../refactoring/refactoring/ title=重构：改善既有代码的设计 class=md-nav__link> 重构：改善既有代码的设计 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>目录</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#1 class=md-nav__link> 1. 页面的跳转 </a> </li> <li class=md-nav__item> <a href=#2 class=md-nav__link> 2. 表单 </a> </li> <li class=md-nav__item> <a href=#3 class=md-nav__link> 3. 数据库以及其他存储方式 </a> </li> <li class=md-nav__item> <a href=#4-flutter class=md-nav__link> 4. Flutter中的异步操作 </a> </li> <li class=md-nav__item> <a href=#__comments class="md-nav__link md-nav__link--active"> 评论 </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <h1>年轻人的第一个Flutter程序(3)</h1> <p>本系列文章也会阶段性地release对应的apk供对照查看。apk都会发布在<a href=https://github.com/YorekLiu/YLFlutterReady/releases>release</a>上。此外配合源码对应的tag一起食用，效果更加。 <br> 本章代码tag为<code>chapter02</code>，配合<a href=https://github.com/YorekLiu/YLFlutterReady/releases/download/chapter02/chapter02.apk>chapter02.apk</a>。 </p> <p>本章的主要技术要点为</p> <ul> <li>页面的跳转</li> <li>表单的写法：<code>TextFormField</code>与<code>TextField</code>的差别</li> <li>Flutter中的数据库以及其他存储方式</li> <li>Flutter中的异步任务</li> </ul> <p>老规矩，我们先上UI效果图：</p> <p><img alt=新建、编辑Task时的UI src=/assets/images/flutter/flutter_demo_task_add_edit.png></p> <h2 id=1>1. 页面的跳转<a class=headerlink href=#1 title="Permanent link">&para;</a></h2> <p><a href=https://flutter.io/docs/cookbook#navigation>Navigation</a></p> <p>上面介绍了5个方面的内容：</p> <ol> <li>使用<code>Hero</code>完成共享元素动画</li> <li>使用<code>Navigator.push</code>和<code>Navigator.pop</code>进入、退出页面</li> <li>如何使用<code>Navigator.pushNamed</code>进入a named router</li> <li>接收页面返回的数据</li> <li>传递数据给新页面</li> </ol> <p>这里使用到了2、4、5。<br> 在tab1中，点击FAB会创建新的Task，点击List可以编辑Task。所以需要将Task传递给新建/编辑页面。在新建/编辑完成后，需要告诉tab1结果，让tab1刷新页面。</p> <p>我们看一下相关代码：</p> <p><strong>task_list.dart</strong> <div class=codehilite><pre><span></span><span class=c1>// 进入编辑页面的回调，就是_navigateDetailOrAdd方法</span>
<span class=kd>typedef</span> <span class=n>ShowDetailListener</span> <span class=o>=</span> <span class=kt>void</span> <span class=n>Function</span><span class=p>(</span><span class=n>BuildContext</span> <span class=n>context</span><span class=p>,</span> <span class=n>Task</span> <span class=n>task</span><span class=p>);</span>
<span class=c1>// 在ListItem中通知_TaskListPageState进行刷新的回调，就是_refresh方法</span>
<span class=kd>typedef</span> <span class=n>RefreshListener</span> <span class=o>=</span> <span class=kt>void</span> <span class=n>Function</span><span class=p>();</span>

<span class=kd>class</span> <span class=nc>_TaskListPageState</span> <span class=kd>extends</span> <span class=n>State</span><span class=o>&lt;</span><span class=n>TaskListPage</span><span class=o>&gt;</span> <span class=p>{</span>

  <span class=c1>// ShowDetailListener</span>
  <span class=c1>// 进入编辑页面，并接收编辑页面的返回结果</span>
  <span class=n>_navigateDetailOrAdd</span><span class=p>(</span><span class=n>BuildContext</span> <span class=n>context</span><span class=p>,</span> <span class=n>Task</span> <span class=n>task</span><span class=p>)</span> <span class=kd>async</span> <span class=p>{</span>
    <span class=kd>final</span> <span class=n>result</span> <span class=o>=</span> <span class=kd>await</span> <span class=n>Navigator</span><span class=p>.</span><span class=n>push</span><span class=p>(</span>
      <span class=n>context</span><span class=p>,</span>
      <span class=n>MaterialPageRoute</span><span class=p>(</span>
        <span class=c1>// 将task传入新页面</span>
        <span class=nl>builder:</span> <span class=p>(</span><span class=n>context</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=n>TaskDetailOrAddForm</span><span class=p>(</span><span class=nl>task:</span> <span class=n>task</span><span class=p>),</span>
      <span class=p>)</span>
    <span class=p>);</span>

    <span class=c1>// 返回结果为true，进行需要刷新</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>result</span> <span class=o>==</span> <span class=kc>true</span><span class=p>)</span> <span class=p>{</span>
      <span class=n>_refresh</span><span class=p>();</span>
    <span class=p>}</span>
  <span class=p>}</span>

  <span class=c1>// RefreshListener</span>
  <span class=n>_refresh</span><span class=p>()</span> <span class=p>{</span>
    <span class=n>setState</span><span class=p>(()</span> <span class=p>{});</span>
  <span class=p>}</span>

  <span class=nd>@override</span>
  <span class=n>Widget</span> <span class=n>build</span><span class=p>(</span><span class=n>BuildContext</span> <span class=n>context</span><span class=p>)</span> <span class=p>{</span>
    <span class=p>...</span>
    <span class=k>return</span> <span class=n>Scaffold</span><span class=p>(</span>
      <span class=p>...</span>
      <span class=nl>body:</span> <span class=p>...</span> <span class=c1>// _buildList,</span>
      <span class=nl>floatingActionButton:</span> <span class=n>FloatingActionButton</span><span class=p>(</span>
        <span class=c1>// task参数传null，认为是新建</span>
        <span class=nl>onPressed:</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=n>_navigateDetailOrAdd</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=kc>null</span><span class=p>),</span>
        <span class=p>...</span>
      <span class=p>),</span>
    <span class=p>);</span>
  <span class=p>}</span>

  <span class=n>Widget</span> <span class=n>_buildList</span><span class=p>(</span><span class=n>List</span><span class=o>&lt;</span><span class=n>Task</span><span class=o>&gt;</span> <span class=n>tasks</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>return</span> <span class=n>ListView</span><span class=p>.</span><span class=n>builder</span><span class=p>(</span>
      <span class=nl>itemCount:</span> <span class=n>tasks</span><span class=p>.</span><span class=n>length</span><span class=p>,</span>
      <span class=nl>itemBuilder:</span> <span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=n>index</span><span class=p>)</span> <span class=p>{</span>
        <span class=kd>final</span> <span class=n>task</span> <span class=o>=</span> <span class=n>tasks</span><span class=p>[</span><span class=n>index</span><span class=p>];</span>
        <span class=c1>// 将进入编辑页面的回调方法和刷新回调方法传入TaskListItem</span>
        <span class=k>return</span> <span class=n>TaskListItem</span><span class=p>(</span><span class=n>task</span><span class=p>,</span> <span class=n>_navigateDetailOrAdd</span><span class=p>,</span> <span class=n>_refresh</span><span class=p>);</span>
      <span class=p>},</span>
    <span class=p>);</span>
  <span class=p>}</span>
<span class=p>}</span>

<span class=kd>class</span> <span class=nc>TaskListItem</span> <span class=kd>extends</span> <span class=n>StatelessWidget</span> <span class=p>{</span>

  <span class=n>TaskListItem</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=n>task</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=n>navigateListener</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=n>refreshListener</span><span class=p>,</span> <span class=p>{</span><span class=n>Key</span> <span class=n>key</span><span class=p>})</span>
    <span class=o>:</span> <span class=k>super</span><span class=p>(</span><span class=nl>key:</span> <span class=n>key</span><span class=p>);</span>

  <span class=kd>final</span> <span class=n>ShowDetailListener</span> <span class=n>navigateListener</span><span class=p>;</span>
  <span class=kd>final</span> <span class=n>RefreshListener</span> <span class=n>refreshListener</span><span class=p>;</span>
  <span class=kd>final</span> <span class=n>Task</span> <span class=n>task</span><span class=p>;</span>

  <span class=nd>@override</span>
  <span class=n>Widget</span> <span class=n>build</span><span class=p>(</span><span class=n>BuildContext</span> <span class=n>context</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>return</span> <span class=n>Card</span><span class=p>(</span>
      <span class=p>...</span>
      <span class=nl>child:</span> <span class=n>Dismissible</span><span class=p>(</span>
        <span class=p>...</span>
        <span class=nl>child:</span> <span class=n>InkWell</span><span class=p>(</span>
          <span class=c1>// task参数不为空，认为是编辑</span>
          <span class=nl>onTap:</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=n>navigateListener</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=n>task</span><span class=p>),</span>
          <span class=p>...</span>
        <span class=p>),</span>
      <span class=p>)</span>
    <span class=p>);</span>
  <span class=p>}</span>
<span class=p>}</span>
</pre></div></p> <p>可以看出来，其实2、4、5核心代码就是这几行 <div class=codehilite><pre><span></span><span class=c1>// 进入下一页并等待返回值</span>
<span class=n>_navigateDetailOrAdd</span><span class=p>(</span><span class=n>BuildContext</span> <span class=n>context</span><span class=p>,</span> <span class=n>Task</span> <span class=n>task</span><span class=p>)</span> <span class=kd>async</span> <span class=p>{</span>
  <span class=kd>final</span> <span class=n>result</span> <span class=o>=</span> <span class=kd>await</span> <span class=n>Navigator</span><span class=p>.</span><span class=n>push</span><span class=p>(</span>
    <span class=n>context</span><span class=p>,</span>
    <span class=n>MaterialPageRoute</span><span class=p>(</span>
      <span class=nl>builder:</span> <span class=p>(</span><span class=n>context</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=n>TaskDetailOrAddForm</span><span class=p>(</span><span class=nl>task:</span> <span class=n>task</span><span class=p>),</span>
    <span class=p>)</span>
  <span class=p>);</span>
<span class=p>}</span>

<span class=c1>// 带返回值返回上一页</span>
<span class=n>Navigator</span><span class=p>.</span><span class=n>pop</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=kc>true</span><span class=p>);</span>
</pre></div> <code>MaterialPageRoute#build</code>返回的Widget就是要进入的Widget。<br> 需要传值给新页面，直接在new的时候传入就可以了。<br> 需要获取页面的返回值，<code>await</code>一下就有了，注意result可能为null。</p> <p><code>await</code>、<code>then</code>需要和<code>async</code>配合使用，具体说明见后文。</p> <h2 id=2>2. 表单<a class=headerlink href=#2 title="Permanent link">&para;</a></h2> <p><a href=https://flutter.io/docs/cookbook#forms>Forms</a></p> <p>上面介绍了5个方面的内容：</p> <ol> <li><strong>表单<code>Form</code>及其校验</strong><br> 依赖于<code>GlobalKey</code>，通过<code>GlobalKey.currentState.validate()</code>方法进行校验</li> <li><strong><code>TextField</code>、<code>TextFormField</code>的样式</strong><br> <code>TextField</code>是最通用的输入框控件；<code>TextFormField</code>封装了一个<code>TextField</code>，它提供了额外的功能比如校验等功能。<br> 可以通过<code>decoration</code>属性进行添加hint、label、icon以及错误提示文字<br> hint就是Android中的hint，label类似Android中的TextInputLayout</li> <li><strong>输入框的焦点：<code>autofocus</code>或<code>FocusNode</code></strong><br> 每一个可获得焦点的Widget都要分配一个<code>FocusNode</code><br> 通过<code>FocusScope.of(context).requestFocus(to)</code>移动焦点<br> 通过<code>FocusScope.of(context).autofocus(to)</code>设置是否自动获得焦点 </li> <li><strong>处理输入框文字变化：<code>onChanged</code>或<code>TextEditingController</code></strong><br> <code>TextField</code>才有<code>onChanged</code>方法<br> <code>TextEditingController</code>中<code>text</code>获取字符串，<code>addListener</code>可以添加文字变化监听器</li> <li><strong>获取输入框的值：<code>TextEditingController</code></strong></li> </ol> <p>我们这里使用到了<code>Form</code>、<code>TextFormField</code>、<code>autofocus</code>、<code>FocusNode</code>和<code>TextEditingController</code>。 </p> <p>具体使用请看 <strong>task_add_detail.dart</strong> <div class=codehilite><pre><span></span><span class=kd>class</span> <span class=nc>TaskDetailOrAddForm</span> <span class=kd>extends</span> <span class=n>StatefulWidget</span> <span class=p>{</span>

  <span class=kd>final</span> <span class=n>Task</span> <span class=n>task</span><span class=p>;</span>

  <span class=n>TaskDetailOrAddForm</span><span class=p>({</span><span class=n>Key</span> <span class=n>key</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=n>task</span><span class=p>})</span> <span class=o>:</span> <span class=k>super</span><span class=p>(</span><span class=nl>key:</span> <span class=n>key</span><span class=p>);</span>

  <span class=nd>@override</span>
  <span class=n>createState</span><span class=p>()</span> <span class=o>=&gt;</span> <span class=n>_TaskDetailOrAddFormState</span><span class=p>();</span>
<span class=p>}</span>

<span class=kd>class</span> <span class=nc>_TaskDetailOrAddFormState</span> <span class=kd>extends</span> <span class=n>State</span><span class=o>&lt;</span><span class=n>TaskDetailOrAddForm</span><span class=o>&gt;</span> <span class=p>{</span>

  <span class=c1>// GlobalKey是Form的唯一标识，我们可以通过它进行表单的校验</span>
  <span class=kd>final</span> <span class=n>_formKey</span> <span class=o>=</span> <span class=n>GlobalKey</span><span class=o>&lt;</span><span class=n>FormState</span><span class=o>&gt;</span><span class=p>();</span>

  <span class=c1>// TextEditingController可以为TextFormField提供初始值</span>
  <span class=c1>// 获取TextField/TextFormField值</span>
  <span class=c1>// 以及监听TextField/TextFormField的改变</span>
  <span class=n>TextEditingController</span> <span class=n>titleController</span><span class=p>;</span>
  <span class=n>TextEditingController</span> <span class=n>currentCountController</span><span class=p>;</span>
  <span class=n>TextEditingController</span> <span class=n>totalCountController</span><span class=p>;</span>
  <span class=n>TextEditingController</span> <span class=n>messageController</span><span class=p>;</span>

  <span class=kt>int</span> <span class=n>deadline</span><span class=p>;</span>

  <span class=c1>// FocusNode可以用来获取焦点</span>
  <span class=n>FocusNode</span> <span class=n>currentFocusNode</span><span class=p>;</span>
  <span class=n>FocusNode</span> <span class=n>totalFocusNode</span><span class=p>;</span>
  <span class=n>FocusNode</span> <span class=n>messageFocusNode</span><span class=p>;</span>

  <span class=nd>@override</span>
  <span class=kt>void</span> <span class=n>initState</span><span class=p>()</span> <span class=p>{</span>
    <span class=k>super</span><span class=p>.</span><span class=n>initState</span><span class=p>();</span>
    <span class=c1>// 初始化TextEditingController并提供初始值</span>
    <span class=n>titleController</span> <span class=o>=</span> <span class=n>TextEditingController</span><span class=p>(</span><span class=nl>text:</span> <span class=n>widget</span><span class=p>.</span><span class=n>task</span><span class=o>?</span><span class=p>.</span><span class=n>title</span> <span class=o>??</span> <span class=s2>&quot;&quot;</span><span class=p>);</span>
    <span class=n>currentCountController</span> <span class=o>=</span> <span class=n>TextEditingController</span><span class=p>(</span><span class=nl>text:</span> <span class=n>widget</span><span class=p>.</span><span class=n>task</span><span class=o>?</span><span class=p>.</span><span class=n>currentCount</span><span class=o>?</span><span class=p>.</span><span class=n>toString</span><span class=p>()</span> <span class=o>??</span> <span class=s2>&quot;0&quot;</span><span class=p>);</span>
    <span class=n>totalCountController</span> <span class=o>=</span> <span class=n>TextEditingController</span><span class=p>(</span><span class=nl>text:</span> <span class=n>widget</span><span class=p>.</span><span class=n>task</span><span class=o>?</span><span class=p>.</span><span class=n>totalCount</span><span class=o>?</span><span class=p>.</span><span class=n>toString</span><span class=p>()</span> <span class=o>??</span> <span class=s2>&quot;&quot;</span><span class=p>);</span>
    <span class=n>messageController</span> <span class=o>=</span> <span class=n>TextEditingController</span><span class=p>(</span><span class=nl>text:</span> <span class=n>widget</span><span class=p>.</span><span class=n>task</span><span class=o>?</span><span class=p>.</span><span class=n>message</span> <span class=o>??</span> <span class=s2>&quot;&quot;</span><span class=p>);</span>

    <span class=c1>// 如果传入的task没有deadline，那么默认为当前时间加七天的值</span>
    <span class=n>deadline</span> <span class=o>=</span> <span class=n>widget</span><span class=p>.</span><span class=n>task</span><span class=o>?</span><span class=p>.</span><span class=n>deadline</span> <span class=o>??</span> <span class=n>DateTime</span><span class=p>.</span><span class=n>now</span><span class=p>().</span><span class=n>add</span><span class=p>(</span><span class=n>Duration</span><span class=p>(</span><span class=nl>days:</span> <span class=m>7</span><span class=p>)).</span><span class=n>millisecondsSinceEpoch</span><span class=p>;</span>

    <span class=c1>// 初始化FocusNode</span>
    <span class=n>currentFocusNode</span> <span class=o>=</span> <span class=n>FocusNode</span><span class=p>();</span>
    <span class=n>totalFocusNode</span> <span class=o>=</span> <span class=n>FocusNode</span><span class=p>();</span>
    <span class=n>messageFocusNode</span> <span class=o>=</span> <span class=n>FocusNode</span><span class=p>();</span>
  <span class=p>}</span>

  <span class=nd>@override</span>
  <span class=kt>void</span> <span class=n>dispose</span><span class=p>()</span> <span class=p>{</span>
    <span class=c1>// 释放TextEditingController</span>
    <span class=n>titleController</span><span class=p>.</span><span class=n>dispose</span><span class=p>();</span>
    <span class=n>currentCountController</span><span class=p>.</span><span class=n>dispose</span><span class=p>();</span>
    <span class=n>totalCountController</span><span class=p>.</span><span class=n>dispose</span><span class=p>();</span>
    <span class=n>messageController</span><span class=p>.</span><span class=n>dispose</span><span class=p>();</span>

    <span class=c1>// 释放FocusNode</span>
    <span class=n>currentFocusNode</span><span class=p>.</span><span class=n>dispose</span><span class=p>();</span>
    <span class=n>totalFocusNode</span><span class=p>.</span><span class=n>dispose</span><span class=p>();</span>
    <span class=n>messageFocusNode</span><span class=p>.</span><span class=n>dispose</span><span class=p>();</span>

    <span class=k>super</span><span class=p>.</span><span class=n>dispose</span><span class=p>();</span>
  <span class=p>}</span>

  <span class=c1>// 焦点转移</span>
  <span class=n>_fieldFocusChange</span><span class=p>(</span><span class=n>BuildContext</span> <span class=n>context</span><span class=p>,</span> <span class=n>FocusNode</span> <span class=n>from</span><span class=p>,</span> <span class=n>FocusNode</span> <span class=n>to</span><span class=p>)</span> <span class=p>{</span>
    <span class=c1>// 将焦点转移到to所在的Widget上</span>
    <span class=n>FocusScope</span><span class=p>.</span><span class=n>of</span><span class=p>(</span><span class=n>context</span><span class=p>).</span><span class=n>requestFocus</span><span class=p>(</span><span class=n>to</span><span class=p>);</span>
  <span class=p>}</span>

  <span class=nd>@override</span>
  <span class=n>Widget</span> <span class=n>build</span><span class=p>(</span><span class=n>BuildContext</span> <span class=n>context</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>return</span> <span class=n>Scaffold</span><span class=p>(</span>
      <span class=nl>appBar:</span> <span class=n>AppBar</span><span class=p>(</span>
        <span class=c1>// 设置title</span>
        <span class=nl>title:</span> <span class=n>Text</span><span class=p>(</span><span class=n>widget</span><span class=p>.</span><span class=n>task</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>?</span> <span class=s1>&#39;New Task&#39;</span> <span class=o>:</span> <span class=s1>&#39;&#39;</span><span class=p>),</span>
        <span class=c1>// AppBar右边放置一个保存按钮</span>
        <span class=nl>actions:</span> <span class=o>&lt;</span><span class=n>Widget</span><span class=o>&gt;</span><span class=p>[</span>
          <span class=n>IconButton</span><span class=p>(</span>
            <span class=nl>icon:</span> <span class=kd>const</span> <span class=n>Icon</span><span class=p>(</span><span class=n>Icons</span><span class=p>.</span><span class=n>save</span><span class=p>),</span>
            <span class=nl>tooltip:</span> <span class=s1>&#39;保存Task&#39;</span><span class=p>,</span>
            <span class=nl>onPressed:</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=n>_saveTaskAndPop</span><span class=p>(</span><span class=n>context</span><span class=p>),</span>
          <span class=p>)</span>
        <span class=p>],</span>
      <span class=p>),</span>
      <span class=nl>body:</span> <span class=n>_buildForm</span><span class=p>(</span><span class=n>context</span><span class=p>)</span>
    <span class=p>);</span>
  <span class=p>}</span>

  <span class=c1>// 表单部分的构建</span>
  <span class=n>Widget</span> <span class=n>_buildForm</span><span class=p>(</span><span class=n>BuildContext</span> <span class=n>context</span><span class=p>)</span> <span class=p>{</span>
    <span class=c1>// 由于Form本身不带滚动特点，所以包裹一个SingleChildScrollView</span>
    <span class=k>return</span> <span class=n>SingleChildScrollView</span><span class=p>(</span>
      <span class=nl>child:</span> <span class=n>Form</span><span class=p>(</span>
        <span class=nl>key:</span> <span class=n>_formKey</span><span class=p>,</span>   <span class=c1>// 指定Form的key</span>
        <span class=nl>child:</span> <span class=n>Center</span><span class=p>(</span>
          <span class=nl>child:</span> <span class=n>Column</span><span class=p>(</span>
            <span class=nl>crossAxisAlignment:</span> <span class=n>CrossAxisAlignment</span><span class=p>.</span><span class=n>start</span><span class=p>,</span>
            <span class=nl>children:</span> <span class=o>&lt;</span><span class=n>Widget</span><span class=o>&gt;</span><span class=p>[</span>
              <span class=n>_buildTitleForm</span><span class=p>(</span><span class=n>context</span><span class=p>),</span>   <span class=c1>// 标题部分</span>
              <span class=n>Divider</span><span class=p>(</span>
                <span class=nl>height:</span> <span class=m>1.0</span><span class=p>,</span>
                <span class=nl>color:</span> <span class=n>Colors</span><span class=p>.</span><span class=n>black26</span><span class=p>,</span>
              <span class=p>),</span>                          <span class=c1>// 分割线</span>
              <span class=n>_buildCountForm</span><span class=p>(</span><span class=n>context</span><span class=p>),</span>   <span class=c1>// 已完成次数和总次数</span>
              <span class=n>Divider</span><span class=p>(</span>
                <span class=nl>height:</span> <span class=m>1.0</span><span class=p>,</span>
                <span class=nl>color:</span> <span class=n>Colors</span><span class=p>.</span><span class=n>black26</span><span class=p>,</span>
              <span class=p>),</span>
              <span class=n>_buildDeadlineForm</span><span class=p>(</span><span class=n>context</span><span class=p>),</span><span class=c1>// 截止日期</span>
              <span class=n>Divider</span><span class=p>(</span>
                <span class=nl>height:</span> <span class=m>1.0</span><span class=p>,</span>
                <span class=nl>color:</span> <span class=n>Colors</span><span class=p>.</span><span class=n>black26</span><span class=p>,</span>
              <span class=p>),</span>
              <span class=n>_buildMessageForm</span><span class=p>(</span><span class=n>context</span><span class=p>),</span> <span class=c1>// 描述部分</span>
            <span class=p>],</span>
          <span class=p>),</span>
        <span class=p>),</span>
      <span class=p>),</span>
    <span class=p>);</span>
  <span class=p>}</span>

  <span class=c1>// 构建表单的标题</span>
  <span class=n>Widget</span> <span class=n>_buildTitleForm</span><span class=p>(</span><span class=n>BuildContext</span> <span class=n>context</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>return</span> <span class=n>TextFormField</span><span class=p>(</span>
      <span class=c1>// 指定controller，其text值是TextFormField的默认值</span>
      <span class=nl>controller:</span> <span class=n>titleController</span><span class=p>,</span>
      <span class=nl>style:</span> <span class=n>Theme</span><span class=p>.</span><span class=n>of</span><span class=p>(</span><span class=n>context</span><span class=p>).</span><span class=n>textTheme</span><span class=p>.</span><span class=n>headline</span><span class=p>,</span>
      <span class=c1>// Form校验时，该部分如何进行检验</span>
      <span class=c1>// 如果校验不通过，返回一个提示字符串；否则不应该返回任何东西</span>
      <span class=nl>validator:</span> <span class=p>(</span><span class=n>value</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>value</span><span class=p>.</span><span class=n>isEmpty</span><span class=p>)</span> <span class=p>{</span>
          <span class=k>return</span> <span class=s1>&#39;请输入标题&#39;</span><span class=p>;</span>
        <span class=p>}</span>
      <span class=p>},</span>
      <span class=c1>// 是否自动获取焦点</span>
      <span class=nl>autofocus:</span> <span class=n>widget</span><span class=p>.</span><span class=n>task</span> <span class=o>==</span> <span class=kc>null</span><span class=p>,</span>
      <span class=c1>// 软键盘右下角按钮的类型</span>
      <span class=nl>textInputAction:</span> <span class=n>TextInputAction</span><span class=p>.</span><span class=n>next</span><span class=p>,</span>
      <span class=c1>// 软键盘右下角按钮的点击事件，在这里我们进行焦点的切换</span>
      <span class=nl>onFieldSubmitted:</span> <span class=p>(</span><span class=n>text</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=n>_fieldFocusChange</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=kc>null</span><span class=p>,</span> <span class=n>currentFocusNode</span><span class=p>),</span>
      <span class=c1>// decoration可以让我们添加hint、label、icon以及错误提示文字</span>
      <span class=c1>// hint就是Android中的hint，label就是Android中的TextInputLayout</span>
      <span class=nl>decoration:</span> <span class=n>InputDecoration</span><span class=p>(</span>
        <span class=nl>border:</span> <span class=n>InputBorder</span><span class=p>.</span><span class=n>none</span><span class=p>,</span>
        <span class=nl>hintText:</span> <span class=s1>&#39;输入标题&#39;</span><span class=p>,</span>
        <span class=nl>hintStyle:</span> <span class=n>Theme</span><span class=p>.</span><span class=n>of</span><span class=p>(</span><span class=n>context</span><span class=p>).</span><span class=n>textTheme</span><span class=p>.</span><span class=n>headline</span><span class=p>.</span><span class=n>copyWith</span><span class=p>(</span><span class=nl>color:</span> <span class=n>Colors</span><span class=p>.</span><span class=n>grey</span><span class=p>),</span>
        <span class=nl>contentPadding:</span> <span class=kd>const</span> <span class=n>EdgeInsets</span><span class=p>.</span><span class=n>symmetric</span><span class=p>(</span><span class=nl>horizontal:</span> <span class=m>56.0</span><span class=p>,</span> <span class=nl>vertical:</span> <span class=m>16.0</span><span class=p>),</span>
      <span class=p>),</span>
    <span class=p>);</span>
  <span class=p>}</span>

  <span class=c1>// 构建已完成次数、总次数</span>
  <span class=n>Widget</span> <span class=n>_buildCountForm</span><span class=p>(</span><span class=n>BuildContext</span> <span class=n>context</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>return</span> <span class=n>Row</span><span class=p>(</span>
      <span class=p>...</span>
      <span class=nl>children:</span> <span class=o>&lt;</span><span class=n>Widget</span><span class=o>&gt;</span><span class=p>[</span>
        <span class=p>...</span>
        <span class=c1>// Expanded相当于Android中的weight=1，继承至Flexible</span>
        <span class=c1>// 该控件只能在Row、Column、Flex中使用</span>
        <span class=n>Expanded</span><span class=p>(</span>
          <span class=nl>child:</span> <span class=n>TextFormField</span><span class=p>(</span>
            <span class=nl>controller:</span> <span class=n>currentCountController</span><span class=p>,</span>
            <span class=p>...,</span>
            <span class=c1>// keyboardType用于指定软键盘的类型</span>
            <span class=nl>keyboardType:</span> <span class=n>TextInputType</span><span class=p>.</span><span class=n>number</span><span class=p>,</span>
            <span class=p>...</span>
            <span class=nl>decoration:</span> <span class=n>InputDecoration</span><span class=p>(</span>
              <span class=p>...</span>
              <span class=c1>// label就是Android中的TextInputLayout效果</span>
              <span class=nl>labelText:</span> <span class=s1>&#39;已完成次数&#39;</span><span class=p>,</span>
              <span class=p>...</span>
            <span class=p>),</span>
          <span class=p>),</span>
        <span class=p>),</span>
        <span class=n>Expanded</span><span class=p>(</span>
          <span class=p>...</span>
        <span class=p>),</span>
      <span class=p>],</span>
    <span class=p>);</span>
  <span class=p>}</span>

  <span class=c1>// 构建截止日期部分，点击可以弹出时间选择器，长按会弹出提示文字</span>
  <span class=n>Widget</span> <span class=n>_buildDeadlineForm</span><span class=p>(</span><span class=n>BuildContext</span> <span class=n>context</span><span class=p>)</span> <span class=p>{</span>
    <span class=c1>// Tooltip可以在长按的时候弹出提示文字</span>
    <span class=k>return</span> <span class=n>Tooltip</span><span class=p>(</span>
      <span class=nl>message:</span> <span class=s1>&#39;设置Task截止时间&#39;</span><span class=p>,</span>
      <span class=nl>child:</span> <span class=n>InkWell</span><span class=p>(</span>
        <span class=nl>onTap:</span> <span class=p>()</span> <span class=p>{</span>
          <span class=c1>// 弹出时间选择器，获得时间后刷新UI</span>
          <span class=c1>// 注意这个位置的then操作，在后面的异步部分会谈到</span>
          <span class=n>showDatePicker</span><span class=p>(</span>
            <span class=nl>context:</span> <span class=n>context</span><span class=p>,</span>
            <span class=nl>initialDate:</span> <span class=n>DateTime</span><span class=p>.</span><span class=n>fromMillisecondsSinceEpoch</span><span class=p>(</span><span class=n>deadline</span><span class=p>),</span>
            <span class=nl>firstDate:</span> <span class=n>DateTime</span><span class=p>(</span><span class=m>2016</span><span class=p>),</span>
            <span class=nl>lastDate:</span> <span class=n>DateTime</span><span class=p>(</span><span class=m>2050</span><span class=p>)</span>
          <span class=p>).</span><span class=n>then</span><span class=p>((</span><span class=n>DateTime</span> <span class=n>value</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>setState</span><span class=p>(()</span> <span class=p>{</span>
              <span class=n>deadline</span> <span class=o>=</span> <span class=n>value</span><span class=p>.</span><span class=n>millisecondsSinceEpoch</span><span class=p>;</span>
            <span class=p>});</span>
          <span class=p>});</span>
        <span class=p>},</span>
        <span class=c1>// UI上显示一个小icon以及一个格式化后的Text</span>
        <span class=nl>child:</span> <span class=n>Container</span><span class=p>(</span>
          <span class=nl>height:</span> <span class=m>56.0</span><span class=p>,</span>
          <span class=nl>child:</span> <span class=n>Row</span><span class=p>(</span>
            <span class=nl>crossAxisAlignment:</span> <span class=n>CrossAxisAlignment</span><span class=p>.</span><span class=n>center</span><span class=p>,</span>
            <span class=nl>children:</span> <span class=o>&lt;</span><span class=n>Widget</span><span class=o>&gt;</span><span class=p>[</span>
              <span class=n>Container</span><span class=p>(</span>
                <span class=nl>margin:</span> <span class=kd>const</span> <span class=n>EdgeInsets</span><span class=p>.</span><span class=n>symmetric</span><span class=p>(</span><span class=nl>horizontal:</span> <span class=m>16.0</span><span class=p>),</span>
                <span class=nl>child:</span> <span class=n>Icon</span><span class=p>(</span><span class=n>Icons</span><span class=p>.</span><span class=n>timer_off</span><span class=p>,</span> <span class=nl>color:</span> <span class=n>Colors</span><span class=p>.</span><span class=n>grey</span><span class=p>,),</span>
              <span class=p>),</span>
              <span class=n>Text</span><span class=p>(</span>
                <span class=n>formatDate</span><span class=p>(</span><span class=n>DateTime</span><span class=p>.</span><span class=n>fromMillisecondsSinceEpoch</span><span class=p>(</span><span class=n>deadline</span><span class=p>)),</span>
                <span class=nl>textAlign:</span> <span class=n>TextAlign</span><span class=p>.</span><span class=n>start</span><span class=p>,</span>
              <span class=p>),</span>
            <span class=p>],</span>
          <span class=p>),</span>
        <span class=p>)</span>
      <span class=p>),</span>
    <span class=p>);</span>
  <span class=p>}</span>

  <span class=c1>// 构建描述部分</span>
  <span class=n>Widget</span> <span class=n>_buildMessageForm</span><span class=p>(</span><span class=n>BuildContext</span> <span class=n>context</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>return</span> <span class=n>Container</span><span class=p>(</span>
      <span class=nl>child:</span> <span class=n>Row</span><span class=p>(</span>
        <span class=nl>crossAxisAlignment:</span> <span class=n>CrossAxisAlignment</span><span class=p>.</span><span class=n>start</span><span class=p>,</span>
        <span class=nl>children:</span> <span class=o>&lt;</span><span class=n>Widget</span><span class=o>&gt;</span><span class=p>[</span>
          <span class=n>Container</span><span class=p>(</span>
            <span class=nl>margin:</span> <span class=kd>const</span> <span class=n>EdgeInsets</span><span class=p>.</span><span class=n>all</span><span class=p>(</span><span class=m>16.0</span><span class=p>),</span>
            <span class=nl>child:</span> <span class=n>Icon</span><span class=p>(</span><span class=n>Icons</span><span class=p>.</span><span class=n>event_note</span><span class=p>,</span> <span class=nl>color:</span> <span class=n>Colors</span><span class=p>.</span><span class=n>grey</span><span class=p>,),</span>
          <span class=p>),</span>
          <span class=n>Expanded</span><span class=p>(</span>
            <span class=nl>child:</span> <span class=n>TextFormField</span><span class=p>(</span>
              <span class=p>...</span>
              <span class=c1>// 最多显示10行</span>
              <span class=nl>maxLines:</span> <span class=m>10</span><span class=p>,</span>
              <span class=c1>// 软键盘右下角的按钮为done</span>
              <span class=nl>textInputAction:</span> <span class=n>TextInputAction</span><span class=p>.</span><span class=n>done</span><span class=p>,</span>
              <span class=p>...</span>
              <span class=c1>// 点击软键盘上的done，调用保存方法</span>
              <span class=nl>onFieldSubmitted:</span> <span class=p>(</span><span class=n>text</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=n>_saveTaskAndPop</span><span class=p>(</span><span class=n>context</span><span class=p>),</span>
              <span class=p>...,</span>
            <span class=p>),</span>
          <span class=p>)</span>
        <span class=p>],</span>
      <span class=p>),</span>
    <span class=p>);</span>
  <span class=p>}</span>

  <span class=c1>// 保存方法</span>
  <span class=n>_saveTaskAndPop</span><span class=p>(</span><span class=n>BuildContext</span> <span class=n>context</span><span class=p>)</span> <span class=p>{</span>
    <span class=c1>// 如果Form校验成功，保存task到数据库，然后返回上一页，并传入result为true</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>_formKey</span><span class=p>.</span><span class=n>currentState</span><span class=p>.</span><span class=n>validate</span><span class=p>())</span> <span class=p>{</span>
      <span class=n>_saveTask</span><span class=p>(</span><span class=n>context</span><span class=p>);</span>
      <span class=n>Navigator</span><span class=p>.</span><span class=n>pop</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=kc>true</span><span class=p>);</span>
    <span class=p>}</span>
  <span class=p>}</span>

  <span class=n>_saveTask</span><span class=p>(</span><span class=n>BuildContext</span> <span class=n>context</span><span class=p>)</span> <span class=kd>async</span> <span class=p>{</span>
    <span class=p>...</span>
  <span class=p>}</span>
<span class=p>}</span>
</pre></div></p> <h2 id=3>3. 数据库以及其他存储方式<a class=headerlink href=#3 title="Permanent link">&para;</a></h2> <p>Flutter中数据库以及其他存储方式和Android非常像：也有<code>File</code>、<code>SharedPreferences</code>以及<code>SQLite</code>。 </p> <p><a href=https://flutter.io/docs/cookbook#persistence>Persistence</a></p> <p>上面包含了<code>File</code>、<code>SharedPreferences</code>两种方式。 </p> <p>本节内容重点在<code>SQLite</code>。<br> <code>SQLite</code>和<code>SharedPreferences</code>一样，也需要引入库，库名为<a href=https://pub.dartlang.org/packages/sqflite>SQFlite</a>。 </p> <p>它有以下特点：</p> <ul> <li>支持事务和批处理</li> <li>open时自动版本管理</li> <li>insert/query/update/delete操作助手</li> <li>DB操作发生在后台</li> </ul> <p>我们从Task的定义开始，看一下<code>SQFlite</code>的实际应用。 </p> <p>首先，定义一些数据库公共的字段<br> <strong>common_field.dart</strong> <div class=codehilite><pre><span></span><span class=kd>final</span> <span class=kt>String</span> <span class=n>columnId</span> <span class=o>=</span> <span class=s1>&#39;_id&#39;</span><span class=p>;</span>
<span class=kd>final</span> <span class=kt>String</span> <span class=n>columnCreated</span> <span class=o>=</span> <span class=s1>&#39;created&#39;</span><span class=p>;</span>
<span class=kd>final</span> <span class=kt>String</span> <span class=n>columnUpdated</span> <span class=o>=</span> <span class=s1>&#39;updated&#39;</span><span class=p>;</span>
<span class=kd>final</span> <span class=kt>String</span> <span class=n>columnDeleted</span> <span class=o>=</span> <span class=s1>&#39;deleted&#39;</span><span class=p>;</span>
</pre></div></p> <p>然后，定义task表的字段<br> <strong>task.dart</strong> <div class=codehilite><pre><span></span><span class=k>import</span> <span class=s1>&#39;provider/common_field.dart&#39;</span><span class=p>;</span>

<span class=kd>final</span> <span class=kt>String</span> <span class=n>tableTask</span> <span class=o>=</span> <span class=s1>&#39;task&#39;</span><span class=p>;</span>
<span class=kd>final</span> <span class=kt>String</span> <span class=n>columnTitle</span> <span class=o>=</span> <span class=s1>&#39;title&#39;</span><span class=p>;</span>
<span class=kd>final</span> <span class=kt>String</span> <span class=n>columnMessage</span> <span class=o>=</span> <span class=s1>&#39;message&#39;</span><span class=p>;</span>
<span class=kd>final</span> <span class=kt>String</span> <span class=n>columnTotalCount</span> <span class=o>=</span> <span class=s1>&#39;total_count&#39;</span><span class=p>;</span>      <span class=c1>//  总次数</span>
<span class=kd>final</span> <span class=kt>String</span> <span class=n>columnCurrentCount</span> <span class=o>=</span> <span class=s1>&#39;current_count&#39;</span><span class=p>;</span>  <span class=c1>//  已完成次数</span>
<span class=kd>final</span> <span class=kt>String</span> <span class=n>columnDeadline</span> <span class=o>=</span> <span class=s1>&#39;deadline&#39;</span><span class=p>;</span>


<span class=kd>class</span> <span class=nc>Task</span><span class=p>{</span>
  <span class=n>Task</span><span class=p>({</span><span class=k>this</span><span class=p>.</span><span class=n>title</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=n>message</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=n>totalCount</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=n>currentCount</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=n>deadline</span><span class=p>});</span>

  <span class=c1>// 将Task实例转换为Map类型，供insert/update时使用</span>
  <span class=n>Map</span><span class=o>&lt;</span><span class=kt>String</span><span class=p>,</span> <span class=kt>dynamic</span><span class=o>&gt;</span> <span class=n>toMap</span><span class=p>()</span> <span class=p>{</span>
    <span class=kd>var</span> <span class=n>map</span> <span class=o>=</span> <span class=o>&lt;</span><span class=kt>String</span><span class=p>,</span> <span class=kt>dynamic</span><span class=o>&gt;</span> <span class=p>{</span>
      <span class=n>columnCreated</span> <span class=o>:</span> <span class=n>created</span><span class=p>,</span>
      <span class=n>columnUpdated</span> <span class=o>:</span> <span class=n>updated</span><span class=p>,</span>
      <span class=n>columnDeleted</span> <span class=o>:</span> <span class=n>deleted</span><span class=p>,</span>
      <span class=nl>columnTitle:</span> <span class=n>title</span><span class=p>,</span>
      <span class=n>columnMessage</span> <span class=o>:</span> <span class=n>message</span><span class=p>,</span>
      <span class=n>columnTotalCount</span> <span class=o>:</span> <span class=n>totalCount</span><span class=p>,</span>
      <span class=n>columnCurrentCount</span> <span class=o>:</span> <span class=n>currentCount</span><span class=p>,</span>
      <span class=n>columnDeadline</span> <span class=o>:</span> <span class=n>deadline</span>
    <span class=p>};</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>id</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
      <span class=n>map</span><span class=p>[</span><span class=n>columnId</span><span class=p>]</span> <span class=o>=</span> <span class=n>id</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=k>return</span> <span class=n>map</span><span class=p>;</span>
  <span class=p>}</span>

  <span class=c1>// Task的静态构造方法，用于将query的结果转换为Task实例</span>
  <span class=n>Task</span><span class=p>.</span><span class=n>fromMap</span><span class=p>(</span><span class=n>Map</span><span class=o>&lt;</span><span class=kt>String</span><span class=p>,</span> <span class=kt>dynamic</span><span class=o>&gt;</span> <span class=n>map</span><span class=p>)</span> <span class=p>{</span>
    <span class=n>id</span> <span class=o>=</span> <span class=n>map</span><span class=p>[</span><span class=n>columnId</span><span class=p>];</span>
    <span class=n>created</span> <span class=o>=</span> <span class=n>map</span><span class=p>[</span><span class=n>columnCreated</span><span class=p>];</span>
    <span class=n>updated</span> <span class=o>=</span> <span class=n>map</span><span class=p>[</span><span class=n>columnUpdated</span><span class=p>];</span>
    <span class=n>deleted</span> <span class=o>=</span> <span class=n>map</span><span class=p>[</span><span class=n>columnDeleted</span><span class=p>];</span>
    <span class=n>title</span> <span class=o>=</span> <span class=n>map</span><span class=p>[</span><span class=n>columnTitle</span><span class=p>];</span>
    <span class=n>message</span> <span class=o>=</span> <span class=n>map</span><span class=p>[</span><span class=n>columnMessage</span><span class=p>];</span>
    <span class=n>totalCount</span> <span class=o>=</span> <span class=n>map</span><span class=p>[</span><span class=n>columnTotalCount</span><span class=p>];</span>
    <span class=n>currentCount</span> <span class=o>=</span> <span class=n>map</span><span class=p>[</span><span class=n>columnCurrentCount</span><span class=p>];</span>
    <span class=n>deadline</span> <span class=o>=</span> <span class=n>map</span><span class=p>[</span><span class=n>columnDeadline</span><span class=p>];</span>
  <span class=p>}</span>

  <span class=c1>// Task的全部字段</span>
  <span class=kt>int</span> <span class=n>id</span><span class=p>;</span>
  <span class=kt>int</span> <span class=n>created</span><span class=p>;</span>
  <span class=kt>int</span> <span class=n>updated</span><span class=p>;</span>
  <span class=kt>int</span> <span class=n>deleted</span><span class=p>;</span>
  <span class=kt>String</span> <span class=n>title</span><span class=p>;</span>
  <span class=kt>String</span> <span class=n>message</span><span class=p>;</span>
  <span class=kt>int</span> <span class=n>totalCount</span><span class=p>;</span>      <span class=c1>//  总次数</span>
  <span class=kt>int</span> <span class=n>currentCount</span><span class=p>;</span>    <span class=c1>//  已完成次数</span>
  <span class=kt>int</span> <span class=n>deadline</span><span class=p>;</span>
<span class=p>}</span>
</pre></div></p> <p>接着，为Task提供一些数据库操作的方法<br> <strong>task_provider.dart</strong> <div class=codehilite><pre><span></span><span class=k>import</span> <span class=s1>&#39;package:sqflite/sqflite.dart&#39;</span><span class=p>;</span>

<span class=k>import</span> <span class=s1>&#39;common_field.dart&#39;</span><span class=p>;</span>
<span class=k>import</span> <span class=s1>&#39;record_provider.dart&#39;</span><span class=p>;</span>
<span class=k>import</span> <span class=s1>&#39;../task.dart&#39;</span><span class=p>;</span>
<span class=k>import</span> <span class=s1>&#39;../record.dart&#39;</span><span class=p>;</span>

<span class=kd>class</span> <span class=nc>TaskProvider</span> <span class=p>{</span>
  <span class=c1>// 建表语句</span>
  <span class=kd>static</span> <span class=kd>final</span> <span class=kt>String</span> <span class=n>createTable</span> <span class=o>=</span> <span class=s1>&#39;&#39;&#39;</span>
<span class=s1>          create table </span><span class=si>$</span><span class=n>tableTask</span><span class=s1> (</span>
<span class=s1>            </span><span class=si>$</span><span class=n>columnId</span><span class=s1> integer primary key autoincrement,</span>
<span class=s1>            </span><span class=si>$</span><span class=n>columnCreated</span><span class=s1> integer not null,</span>
<span class=s1>            </span><span class=si>$</span><span class=n>columnUpdated</span><span class=s1> integer,</span>
<span class=s1>            </span><span class=si>$</span><span class=n>columnDeleted</span><span class=s1> integer,</span>
<span class=s1>            </span><span class=si>$</span><span class=n>columnTitle</span><span class=s1> text not null,</span>
<span class=s1>            </span><span class=si>$</span><span class=n>columnMessage</span><span class=s1> text,</span>
<span class=s1>            </span><span class=si>$</span><span class=n>columnTotalCount</span><span class=s1> integer not null,</span>
<span class=s1>            </span><span class=si>$</span><span class=n>columnCurrentCount</span><span class=s1> integer not null,</span>
<span class=s1>            </span><span class=si>$</span><span class=n>columnDeadline</span><span class=s1> integer not null)</span>
<span class=s1>          &#39;&#39;&#39;</span><span class=p>;</span>

  <span class=c1>// 新建Task，顺便插入Record，采用了事务</span>
  <span class=kd>static</span> <span class=n>Future</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span> <span class=n>insert</span><span class=p>(</span><span class=n>Database</span> <span class=n>db</span><span class=p>,</span> <span class=n>Task</span> <span class=n>task</span><span class=p>)</span> <span class=kd>async</span> <span class=p>{</span>
    <span class=c1>// 记录Task的创建时间</span>
    <span class=n>task</span><span class=p>.</span><span class=n>created</span> <span class=o>=</span> <span class=n>DateTime</span><span class=p>.</span><span class=n>now</span><span class=p>().</span><span class=n>millisecondsSinceEpoch</span><span class=p>;</span>

    <span class=kt>int</span> <span class=n>taskId</span><span class=p>;</span>
    <span class=c1>// 开启事务</span>
    <span class=kd>await</span> <span class=n>db</span><span class=p>.</span><span class=n>transaction</span><span class=p>((</span><span class=n>txn</span><span class=p>)</span> <span class=kd>async</span> <span class=p>{</span>
      <span class=c1>// 先插入task</span>
      <span class=n>taskId</span> <span class=o>=</span> <span class=kd>await</span> <span class=n>txn</span><span class=p>.</span><span class=n>insert</span><span class=p>(</span><span class=n>tableTask</span><span class=p>,</span> <span class=n>task</span><span class=p>.</span><span class=n>toMap</span><span class=p>());</span>
      <span class=c1>// 再创建Record并插入</span>
      <span class=n>Record</span> <span class=n>record</span> <span class=o>=</span> <span class=n>Record</span><span class=p>(</span>
        <span class=nl>taskId:</span> <span class=n>taskId</span><span class=p>,</span>
        <span class=nl>delta:</span> <span class=m>0</span><span class=p>,</span>
        <span class=nl>fromValue:</span> <span class=n>task</span><span class=p>.</span><span class=n>currentCount</span><span class=p>,</span>
        <span class=nl>toValue:</span> <span class=n>task</span><span class=p>.</span><span class=n>currentCount</span><span class=p>,</span>
      <span class=p>);</span>
      <span class=kd>await</span> <span class=n>RecordProvider</span><span class=p>.</span><span class=n>insert</span><span class=p>(</span><span class=n>txn</span><span class=p>,</span> <span class=n>record</span><span class=p>);</span>
    <span class=p>});</span>

    <span class=k>return</span> <span class=n>taskId</span><span class=p>;</span>
  <span class=p>}</span>

  <span class=c1>// 获取所有Task</span>
  <span class=kd>static</span> <span class=n>Future</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&lt;</span><span class=n>Task</span><span class=o>&gt;&gt;</span> <span class=n>getTasks</span><span class=p>(</span><span class=kt>dynamic</span> <span class=n>dbOrTnx</span><span class=p>)</span> <span class=kd>async</span> <span class=p>{</span>
    <span class=n>List</span><span class=o>&lt;</span><span class=n>Map</span><span class=o>&gt;</span> <span class=n>maps</span> <span class=o>=</span> <span class=kd>await</span> <span class=n>dbOrTnx</span><span class=p>.</span><span class=n>query</span><span class=p>(</span><span class=n>tableTask</span><span class=p>,</span>
      <span class=nl>where:</span> <span class=s2>&quot;</span><span class=si>$</span><span class=n>columnDeleted</span><span class=s2> is null&quot;</span><span class=p>);</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>maps</span><span class=p>.</span><span class=n>length</span> <span class=o>&gt;</span> <span class=m>0</span><span class=p>)</span> <span class=p>{</span>
      <span class=k>return</span> <span class=n>maps</span><span class=p>.</span><span class=n>map</span><span class=p>((</span><span class=n>map</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=n>Task</span><span class=p>.</span><span class=n>fromMap</span><span class=p>(</span><span class=n>map</span><span class=p>)).</span><span class=n>toList</span><span class=p>();</span>
    <span class=p>}</span>
    <span class=k>return</span> <span class=n>List</span><span class=p>();</span>
  <span class=p>}</span>

  <span class=c1>// 获取所有Task，以及每条Task的所有Record</span>
  <span class=kd>static</span> <span class=n>Future</span><span class=o>&lt;</span><span class=n>Map</span><span class=o>&lt;</span><span class=n>Task</span><span class=p>,</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>Record</span><span class=o>&gt;&gt;&gt;</span> <span class=n>getTaskRecordsMap</span><span class=p>(</span><span class=n>Database</span> <span class=n>db</span><span class=p>)</span> <span class=kd>async</span> <span class=p>{</span>
    <span class=n>Map</span><span class=o>&lt;</span><span class=n>Task</span><span class=p>,</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>Record</span><span class=o>&gt;&gt;</span> <span class=n>result</span> <span class=o>=</span> <span class=n>Map</span><span class=p>();</span>

    <span class=kd>await</span> <span class=n>db</span><span class=p>.</span><span class=n>transaction</span><span class=p>((</span><span class=n>txn</span><span class=p>)</span> <span class=kd>async</span> <span class=p>{</span>
      <span class=c1>// 获取所有Task</span>
      <span class=kd>await</span> <span class=n>TaskProvider</span><span class=p>.</span><span class=n>getTasks</span><span class=p>(</span><span class=n>txn</span><span class=p>).</span><span class=n>then</span><span class=p>((</span><span class=n>tasks</span><span class=p>)</span> <span class=p>{</span>
        <span class=c1>// 对每条Task，获取对应的Record</span>
        <span class=n>tasks</span><span class=p>.</span><span class=n>forEach</span><span class=p>((</span><span class=n>task</span><span class=p>)</span> <span class=kd>async</span> <span class=p>{</span>
          <span class=kd>await</span> <span class=n>RecordProvider</span><span class=p>.</span><span class=n>getRecordsByTaskId</span><span class=p>(</span><span class=n>txn</span><span class=p>,</span> <span class=n>task</span><span class=p>.</span><span class=n>id</span><span class=p>).</span><span class=n>then</span><span class=p>((</span><span class=n>records</span><span class=p>)</span> <span class=p>{</span>
            <span class=c1>// 保存到Map中</span>
            <span class=n>result</span><span class=p>[</span><span class=n>task</span><span class=p>]</span> <span class=o>=</span> <span class=n>records</span><span class=p>;</span>
          <span class=p>});</span>
        <span class=p>});</span>
      <span class=p>});</span>
    <span class=p>});</span>

    <span class=k>return</span> <span class=n>result</span><span class=p>;</span>
  <span class=p>}</span>

  <span class=c1>/// 更新Task，顺便插入Record</span>
  <span class=kd>static</span> <span class=n>Future</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span> <span class=n>update</span><span class=p>(</span><span class=n>Database</span> <span class=n>db</span><span class=p>,</span> <span class=n>Task</span> <span class=n>task</span><span class=p>,</span> <span class=kt>int</span> <span class=n>oldValue</span><span class=p>)</span> <span class=kd>async</span> <span class=p>{</span>
    <span class=n>task</span><span class=p>.</span><span class=n>updated</span> <span class=o>=</span> <span class=n>DateTime</span><span class=p>.</span><span class=n>now</span><span class=p>().</span><span class=n>millisecondsSinceEpoch</span><span class=p>;</span>

    <span class=kt>int</span> <span class=n>taskId</span><span class=p>;</span>
    <span class=c1>// 开启事务</span>
    <span class=kd>await</span> <span class=n>db</span><span class=p>.</span><span class=n>transaction</span><span class=p>((</span><span class=n>txn</span><span class=p>)</span> <span class=kd>async</span> <span class=p>{</span>
      <span class=c1>// 先创建Record并插入</span>
      <span class=n>Record</span> <span class=n>record</span> <span class=o>=</span> <span class=n>Record</span><span class=p>(</span>
        <span class=nl>taskId:</span> <span class=n>task</span><span class=p>.</span><span class=n>id</span><span class=p>,</span>
        <span class=nl>delta:</span> <span class=n>task</span><span class=p>.</span><span class=n>currentCount</span> <span class=o>-</span> <span class=n>oldValue</span><span class=p>,</span>
        <span class=nl>fromValue:</span> <span class=n>oldValue</span><span class=p>,</span>
        <span class=nl>toValue:</span> <span class=n>task</span><span class=p>.</span><span class=n>currentCount</span><span class=p>,</span>
      <span class=p>);</span>
      <span class=kd>await</span> <span class=n>RecordProvider</span><span class=p>.</span><span class=n>insert</span><span class=p>(</span><span class=n>txn</span><span class=p>,</span> <span class=n>record</span><span class=p>);</span>
      <span class=c1>// 再更新task</span>
      <span class=n>taskId</span> <span class=o>=</span> <span class=kd>await</span> <span class=n>txn</span><span class=p>.</span><span class=n>update</span><span class=p>(</span><span class=n>tableTask</span><span class=p>,</span> <span class=n>task</span><span class=p>.</span><span class=n>toMap</span><span class=p>(),</span>
        <span class=nl>where:</span> <span class=s2>&quot;</span><span class=si>$</span><span class=n>columnId</span><span class=s2> = ?&quot;</span><span class=p>,</span> <span class=nl>whereArgs:</span> <span class=p>[</span><span class=n>task</span><span class=p>.</span><span class=n>id</span><span class=p>]);</span>
    <span class=p>});</span>
    <span class=k>return</span> <span class=n>taskId</span><span class=p>;</span>
  <span class=p>}</span>
  <span class=p>...</span>
<span class=p>}</span>
</pre></div></p> <p>上面这部分代码出现了很多<code>dynamic</code>类型。<br> <code>dynamic</code>类型在编译时可以认为它有任何属性、任何方法，但会在运行时会进行类型检查。如果调用的方法、属性运行时不能调到，才出错。<br> 拿上面的例子说，有一个获取所有Task的方法： <div class=codehilite><pre><span></span><span class=c1>/// 获取所有Task</span>
<span class=kd>static</span> <span class=n>Future</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&lt;</span><span class=n>Task</span><span class=o>&gt;&gt;</span> <span class=n>getTasks</span><span class=p>(</span><span class=kt>dynamic</span> <span class=n>dbOrTnx</span><span class=p>)</span> <span class=kd>async</span> <span class=p>{</span>
  <span class=kd>await</span> <span class=n>dbOrTnx</span><span class=p>.</span><span class=n>query</span><span class=p>(</span><span class=n>tableTask</span><span class=p>,</span> <span class=nl>where:</span> <span class=s2>&quot;</span><span class=si>$</span><span class=n>columnDeleted</span><span class=s2> is null&quot;</span><span class=p>);</span>
  <span class=p>...</span>
<span class=p>}</span>
</pre></div> dbOrTnx就是一个<code>dynamic</code>类型，这里调用了其<code>query</code>方法。这就要保证我们传入的dbOrTnx都要有<code>query</code>方法，且参数签名也要保持一致。<br> 幸运的是，在我们的程序中确实是这样。我们在下面两处位置调用了此方法： <div class=codehilite><pre><span></span><span class=c1>// 1 在task_provider.dart的getTaskRecordsMap方法中，传入的参数是一个Transaction</span>
<span class=kd>static</span> <span class=n>Future</span><span class=o>&lt;</span><span class=n>Map</span><span class=o>&lt;</span><span class=n>Task</span><span class=p>,</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>Record</span><span class=o>&gt;&gt;&gt;</span> <span class=n>getTaskRecordsMap</span><span class=p>(</span><span class=n>Database</span> <span class=n>db</span><span class=p>)</span> <span class=kd>async</span> <span class=p>{</span>
  <span class=kd>await</span> <span class=n>db</span><span class=p>.</span><span class=n>transaction</span><span class=p>((</span><span class=n>txn</span><span class=p>)</span> <span class=kd>async</span> <span class=p>{</span>
    <span class=c1>// 获取所有Task</span>
    <span class=kd>await</span> <span class=n>TaskProvider</span><span class=p>.</span><span class=n>getTasks</span><span class=p>(</span><span class=n>txn</span><span class=p>).</span><span class=n>then</span><span class=p>((</span><span class=n>tasks</span><span class=p>)</span> <span class=p>{</span>
      <span class=p>...</span>
    <span class=p>});</span>
  <span class=p>});</span>

  <span class=k>return</span> <span class=n>result</span><span class=p>;</span>
<span class=p>}</span>

<span class=c1>// 2 在task_list.dart中 传入的参数是Database</span>
<span class=n>Future</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&lt;</span><span class=n>Task</span><span class=o>&gt;&gt;</span> <span class=n>getTasks</span><span class=p>()</span> <span class=kd>async</span> <span class=p>{</span>
  <span class=kd>var</span> <span class=n>db</span> <span class=o>=</span> <span class=kd>await</span> <span class=n>DBManager</span><span class=p>().</span><span class=n>db</span><span class=p>;</span>
  <span class=k>return</span> <span class=kd>await</span> <span class=n>TaskProvider</span><span class=p>.</span><span class=n>getTasks</span><span class=p>(</span><span class=n>db</span><span class=p>);</span>
<span class=p>}</span>
</pre></div> 也就是说<code>Database</code>和<code>Transaction</code>都要有相同的<code>query</code>方法。<br> <em>事实上，确实是这样。因为这两个类都实现了<code>DatabaseExecutor</code>类，而<code>query</code>是抽象类<code>DatabaseExecutor</code>中的方法😈</em>。</p> <p>最后，我们看一下数据库的操作代码<br> <strong>dbmanager.dart</strong> <div class=codehilite><pre><span></span><span class=k>import</span> <span class=s1>&#39;package:sqflite/sqflite.dart&#39;</span><span class=p>;</span>
<span class=k>import</span> <span class=s1>&#39;package:path/path.dart&#39;</span><span class=p>;</span>

<span class=k>import</span> <span class=s1>&#39;../provider/task_provider.dart&#39;</span><span class=p>;</span>
<span class=k>import</span> <span class=s1>&#39;../provider/record_provider.dart&#39;</span><span class=p>;</span>

<span class=kd>class</span> <span class=nc>DBManager</span> <span class=p>{</span>
  <span class=kd>static</span> <span class=kd>final</span> <span class=n>DBManager</span> <span class=n>_instance</span> <span class=o>=</span> <span class=n>DBManager</span><span class=p>.</span><span class=n>_internal</span><span class=p>();</span>

  <span class=kd>static</span> <span class=n>Database</span> <span class=n>_db</span><span class=p>;</span>

  <span class=kd>factory</span> <span class=n>DBManager</span><span class=p>()</span> <span class=o>=&gt;</span> <span class=n>_instance</span><span class=p>;</span>

  <span class=n>DBManager</span><span class=p>.</span><span class=n>_internal</span><span class=p>();</span>

  <span class=n>Future</span><span class=o>&lt;</span><span class=n>Database</span><span class=o>&gt;</span> <span class=kd>get</span> <span class=n>db</span> <span class=kd>async</span> <span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>_db</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
      <span class=k>return</span> <span class=n>_db</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=n>_db</span> <span class=o>=</span> <span class=kd>await</span> <span class=n>initDb</span><span class=p>();</span>

    <span class=k>return</span> <span class=n>_db</span><span class=p>;</span>
  <span class=p>}</span>

  <span class=n>initDb</span><span class=p>()</span> <span class=kd>async</span> <span class=p>{</span>
    <span class=c1>// Get a location using getDatabasesPath</span>
    <span class=kt>String</span> <span class=n>databasesPath</span> <span class=o>=</span> <span class=kd>await</span> <span class=n>getDatabasesPath</span><span class=p>();</span>
    <span class=kt>String</span> <span class=n>path</span> <span class=o>=</span> <span class=n>join</span><span class=p>(</span><span class=n>databasesPath</span><span class=p>,</span> <span class=s1>&#39;ready.db&#39;</span><span class=p>);</span>

    <span class=c1>// just for testing</span>
<span class=c1>//    await deleteDatabase(path);</span>

    <span class=c1>// open the database</span>
    <span class=kd>var</span> <span class=n>db</span> <span class=o>=</span> <span class=kd>await</span> <span class=n>openDatabase</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=nl>version:</span> <span class=m>1</span><span class=p>,</span> <span class=nl>onCreate:</span> <span class=n>_onCreate</span><span class=p>);</span>
    <span class=k>return</span> <span class=n>db</span><span class=p>;</span>
  <span class=p>}</span>

  <span class=kt>void</span> <span class=n>_onCreate</span><span class=p>(</span><span class=n>Database</span> <span class=n>db</span><span class=p>,</span> <span class=kt>int</span> <span class=n>newVersion</span><span class=p>)</span> <span class=kd>async</span> <span class=p>{</span>
    <span class=kd>await</span> <span class=n>db</span><span class=p>.</span><span class=n>transaction</span><span class=p>((</span><span class=n>txn</span><span class=p>)</span> <span class=kd>async</span> <span class=p>{</span>
      <span class=c1>// create table</span>
      <span class=kd>await</span> <span class=n>txn</span><span class=p>.</span><span class=n>execute</span><span class=p>(</span><span class=n>TaskProvider</span><span class=p>.</span><span class=n>createTable</span><span class=p>);</span>
      <span class=kd>await</span> <span class=n>txn</span><span class=p>.</span><span class=n>execute</span><span class=p>(</span><span class=n>RecordProvider</span><span class=p>.</span><span class=n>createTable</span><span class=p>);</span>
    <span class=p>});</span>
  <span class=p>}</span>

  <span class=c1>// Close the database</span>
  <span class=n>Future</span> <span class=n>close</span><span class=p>()</span> <span class=kd>async</span> <span class=p>{</span>
    <span class=kd>var</span> <span class=n>dbClient</span> <span class=o>=</span> <span class=kd>await</span> <span class=n>db</span><span class=p>;</span>
    <span class=k>return</span> <span class=n>dbClient</span><span class=p>.</span><span class=n>close</span><span class=p>();</span>
  <span class=p>}</span>
<span class=p>}</span>
</pre></div> DBManager使用单例模式实现，关于dart中单例模式的实现：<a href=https://stackoverflow.com/a/12649574/7440866>https://stackoverflow.com/a/12649574/7440866</a><br> 首先通过<code>getDatabasesPath</code>获取数据库路径，然后使用<code>Path.join</code>拼接数据库文件得到一个具体数据库文件的路径。<br> 接着使用<code>openDatabase</code>打开数据库得到一个<code>Database</code>，最后通过这个<code>Database</code>就能进行各种数据库操作了。</p> <p>另外，从数据库中加载到了数据之后如何展示出来呢，这就需要用到<code>FutureBuilder</code>了。<br> <code>FutureBuilder</code>接收一个Future对象，当Future执行完毕后会调用builder的回调。如下面例子所示 </p> <div class=codehilite><pre><span></span><span class=kd>class</span> <span class=nc>_TaskListPageState</span> <span class=kd>extends</span> <span class=n>State</span><span class=o>&lt;</span><span class=n>TaskListPage</span><span class=o>&gt;</span> <span class=p>{</span>

  <span class=c1>// 获取数据的Future</span>
  <span class=n>Future</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&lt;</span><span class=n>Task</span><span class=o>&gt;&gt;</span> <span class=n>getTasks</span><span class=p>()</span> <span class=kd>async</span> <span class=p>{</span>
    <span class=kd>var</span> <span class=n>db</span> <span class=o>=</span> <span class=kd>await</span> <span class=n>DBManager</span><span class=p>().</span><span class=n>db</span><span class=p>;</span>
    <span class=k>return</span> <span class=kd>await</span> <span class=n>TaskProvider</span><span class=p>.</span><span class=n>getTasks</span><span class=p>(</span><span class=n>db</span><span class=p>);</span>
  <span class=p>}</span>

  <span class=nd>@override</span>
  <span class=n>Widget</span> <span class=n>build</span><span class=p>(</span><span class=n>BuildContext</span> <span class=n>context</span><span class=p>)</span> <span class=p>{</span>
    <span class=kd>final</span> <span class=n>Widget</span> <span class=n>body</span> <span class=o>=</span> <span class=n>FutureBuilder</span><span class=p>(</span>
      <span class=nl>future:</span> <span class=n>getTasks</span><span class=p>(),</span>
      <span class=nl>builder:</span> <span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=n>snapshot</span><span class=p>)</span> <span class=p>{</span>
        <span class=c1>// getTasks执行完毕，可以解析数据或处理异常</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>snapshot</span><span class=p>.</span><span class=n>hasError</span><span class=p>)</span> <span class=p>{</span>
          <span class=k>return</span> <span class=n>Center</span><span class=p>(</span><span class=nl>child:</span> <span class=n>Text</span><span class=p>(</span><span class=n>snapshot</span><span class=p>.</span><span class=n>error</span><span class=p>.</span><span class=n>toString</span><span class=p>()),);</span>
        <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>snapshot</span><span class=p>.</span><span class=n>data</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>||</span> <span class=n>snapshot</span><span class=p>.</span><span class=n>data</span><span class=p>.</span><span class=n>isEmpty</span><span class=p>)</span> <span class=p>{</span>
          <span class=k>return</span> <span class=n>Center</span><span class=p>(</span><span class=nl>child:</span> <span class=n>Text</span><span class=p>(</span><span class=s2>&quot;Are you Ready?&quot;</span><span class=p>),);</span>
        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
          <span class=k>return</span> <span class=n>_buildList</span><span class=p>(</span><span class=n>snapshot</span><span class=p>.</span><span class=n>data</span><span class=p>);</span>
        <span class=p>}</span>
      <span class=p>},</span>
    <span class=p>);</span>

    <span class=k>return</span> <span class=n>Scaffold</span><span class=p>(</span>
      <span class=nl>appBar:</span> <span class=n>AppBar</span><span class=p>(</span>
        <span class=nl>brightness:</span> <span class=n>Brightness</span><span class=p>.</span><span class=n>dark</span><span class=p>,</span>
        <span class=nl>title:</span> <span class=n>Text</span><span class=p>(</span><span class=s1>&#39;Ready&#39;</span><span class=p>),</span>
      <span class=p>),</span>
      <span class=nl>body:</span> <span class=n>body</span><span class=p>,</span>
    <span class=p>);</span>
  <span class=p>}</span>

  <span class=n>Widget</span> <span class=n>_buildList</span><span class=p>(</span><span class=n>List</span><span class=o>&lt;</span><span class=n>Task</span><span class=o>&gt;</span> <span class=n>tasks</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>return</span> <span class=n>ListView</span><span class=p>.</span><span class=n>builder</span><span class=p>(</span>
      <span class=nl>itemCount:</span> <span class=n>tasks</span><span class=p>.</span><span class=n>length</span><span class=p>,</span>
      <span class=nl>itemBuilder:</span> <span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=n>index</span><span class=p>)</span> <span class=p>{</span>
        <span class=kd>final</span> <span class=n>task</span> <span class=o>=</span> <span class=n>tasks</span><span class=p>[</span><span class=n>index</span><span class=p>];</span>
        <span class=k>return</span> <span class=n>TaskListItem</span><span class=p>(</span><span class=n>task</span><span class=p>,</span> <span class=n>_navigateDetailOrAdd</span><span class=p>,</span> <span class=n>_refresh</span><span class=p>);</span>
      <span class=p>},</span>
    <span class=p>);</span>
  <span class=p>}</span>
<span class=p>}</span>
</pre></div> <h2 id=4-flutter>4. Flutter中的异步操作<a class=headerlink href=#4-flutter title="Permanent link">&para;</a></h2> <blockquote> <p>By default, Dart apps do all of their work on a single thread. In many cases, this model simplifies coding and is fast enough that it does not result in poor app performance or stuttering animations, often called “jank.”</p> <p>However, we may need to perform an expensive computation, such as parsing a very large JSON document. If this work takes more than 16 milliseconds, our users will experience jank.</p> <p>To avoid jank, we need to perform expensive computations like this in the background. On Android, this would mean scheduling work on a different thread. In Flutter, we can use a separate <a href=https://docs.flutter.io/flutter/dart-isolate/Isolate-class.html>Isolate</a>.</p> <p><a href=https://flutter.io/docs/cookbook/networking/background-parsing>https://flutter.io/docs/cookbook/networking/background-parsing</a></p> </blockquote> <p><a href=https://www.dartlang.org/guides/language/language-tour#asynchrony-support>Asynchrony support</a><br> <a href=https://www.dartlang.org/guides/libraries/library-tour#dartasync---asynchronous-programming>dart:async - asynchronous programming</a> </p> <p>本节只讨论<code>Future</code>。与<code>Future</code>有关的有三个关键词<code>async</code>、<code>await</code>、<code>then</code>。</p> <p><code>Future</code>通常作为异步方法的返回值。当<code>Future</code>完成后，它的值就可以使用了。 </p> <p><code>await</code>被用来等待异步方法的结果，此时，代码所在的方法必须使用<code>async</code>修饰。 <div class=codehilite><pre><span></span><span class=n>Future</span> <span class=n>checkVersion</span><span class=p>()</span> <span class=kd>async</span> <span class=p>{</span>
  <span class=kd>var</span> <span class=n>version</span> <span class=o>=</span> <span class=kd>await</span> <span class=n>lookUpVersion</span><span class=p>();</span>
  <span class=c1>// Do something with version</span>
<span class=p>}</span>
</pre></div> 还可以使用<code>try</code>、<code>catch</code>和<code>finally</code>来处理错误、完成清理工作。 <div class=codehilite><pre><span></span><span class=k>try</span> <span class=p>{</span>
  <span class=n>version</span> <span class=o>=</span> <span class=kd>await</span> <span class=n>lookUpVersion</span><span class=p>();</span>
<span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>e</span><span class=p>)</span> <span class=p>{</span>
  <span class=c1>// React to inability to look up the version</span>
<span class=p>}</span> <span class=k>finally</span> <span class=p>{</span>
  <span class=c1>// cleanup</span>
<span class=p>}</span>
</pre></div> 在一个异步方法中可以多次使用<code>await</code> <div class=codehilite><pre><span></span><span class=kd>var</span> <span class=n>entrypoint</span> <span class=o>=</span> <span class=kd>await</span> <span class=n>findEntrypoint</span><span class=p>();</span>
<span class=kd>var</span> <span class=n>exitCode</span> <span class=o>=</span> <span class=kd>await</span> <span class=n>runExecutable</span><span class=p>(</span><span class=n>entrypoint</span><span class=p>,</span> <span class=n>args</span><span class=p>);</span>
<span class=kd>await</span> <span class=n>flushThenExit</span><span class=p>(</span><span class=n>exitCode</span><span class=p>);</span>
</pre></div> 在<code>await</code>表达式中，表达式的结果通常是一个<code>Future</code>；如果不是，结果会自动包装成为一个<code>Future</code>。<code>Future</code>对象表示了返回一个对象的承诺。<code>await</code>表达式的值就是返回的对象。<code>await</code>表达式将会停止执行直到对象可以使用为止。 </p> <p><strong>如果在使用await时编译报错，确保await是在async方法中</strong>。如果<code>async</code>方法不会返回有用的值，那就返回<code>Future&lt;void&gt;</code>。</p> <p><code>then</code>可以使接下来的代码在<code>Future</code>完成后调用。和<code>await</code>起类似的效果。<br> 比如下面的<code>then</code>方法会串行执行三个异步方法，一个完成之后再执行下一个： <div class=codehilite><pre><span></span><span class=n>runUsingFuture</span><span class=p>()</span> <span class=p>{</span>
  <span class=c1>// ...</span>
  <span class=n>findEntryPoint</span><span class=p>().</span><span class=n>then</span><span class=p>((</span><span class=n>entryPoint</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>return</span> <span class=n>runExecutable</span><span class=p>(</span><span class=n>entryPoint</span><span class=p>,</span> <span class=n>args</span><span class=p>);</span>
  <span class=p>}).</span><span class=n>then</span><span class=p>(</span><span class=n>flushThenExit</span><span class=p>);</span>
<span class=p>}</span>
</pre></div> 这等价于下面的<code>await</code>代码： <div class=codehilite><pre><span></span><span class=n>runUsingAsyncAwait</span><span class=p>()</span> <span class=kd>async</span> <span class=p>{</span>
  <span class=c1>// ...</span>
  <span class=kd>var</span> <span class=n>entryPoint</span> <span class=o>=</span> <span class=kd>await</span> <span class=n>findEntryPoint</span><span class=p>();</span>
  <span class=kd>var</span> <span class=n>exitCode</span> <span class=o>=</span> <span class=kd>await</span> <span class=n>runExecutable</span><span class=p>(</span><span class=n>entryPoint</span><span class=p>,</span> <span class=n>args</span><span class=p>);</span>
  <span class=kd>await</span> <span class=n>flushThenExit</span><span class=p>(</span><span class=n>exitCode</span><span class=p>);</span>
<span class=p>}</span>
</pre></div></p> <p>可以使用<code>then().catchError()</code>处理<code>Future</code>对象可能抛出的异常。这是<code>try-catch</code>的异步版本。 <div class=codehilite><pre><span></span><span class=n>HttpRequest</span><span class=p>.</span><span class=n>getString</span><span class=p>(</span><span class=n>url</span><span class=p>).</span><span class=n>then</span><span class=p>((</span><span class=kt>String</span> <span class=n>result</span><span class=p>)</span> <span class=p>{</span>
  <span class=n>print</span><span class=p>(</span><span class=n>result</span><span class=p>);</span>
<span class=p>}).</span><span class=n>catchError</span><span class=p>((</span><span class=n>e</span><span class=p>)</span> <span class=p>{</span>
  <span class=c1>// Handle or ignore the error.</span>
<span class=p>});</span>
</pre></div></p> <p>Important: Be sure to invoke <code>catchError()</code> on the result of <code>then()</code>—not on the result of the original Future. Otherwise, the <code>catchError()</code> can handle errors only from the original Future’s computation, but not from the handler registered by <code>then()</code>.</p> <p><code>then</code>方法返回一个<code>Future</code>，它可以执行多个异步任务以特定的顺序。如果使用<code>then</code>注册的回调返回一个<code>Future</code>，那么<code>then</code>会返回等效的<code>Future</code>。如果回到哦返回其他类型的值，<code>then</code>会用该值创建一个新的<code>Future</code>。 <div class=codehilite><pre><span></span><span class=n>Future</span> <span class=n>result</span> <span class=o>=</span> <span class=n>costlyQuery</span><span class=p>(</span><span class=n>url</span><span class=p>);</span>
<span class=n>result</span>
    <span class=p>.</span><span class=n>then</span><span class=p>((</span><span class=n>value</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=n>expensiveWork</span><span class=p>(</span><span class=n>value</span><span class=p>))</span>
    <span class=p>.</span><span class=n>then</span><span class=p>((</span><span class=n>_</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=n>lengthyComputation</span><span class=p>())</span>
    <span class=p>.</span><span class=n>then</span><span class=p>((</span><span class=n>_</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=n>print</span><span class=p>(</span><span class=s1>&#39;Done!&#39;</span><span class=p>))</span>
    <span class=p>.</span><span class=n>catchError</span><span class=p>((</span><span class=n>exception</span><span class=p>)</span> <span class=p>{</span>
  <span class=cm>/* Handle exception... */</span>
<span class=p>});</span>
</pre></div> 在上面的例子中，方法会以下面的顺序执行：</p> <ol> <li><code>costlyQuery()</code></li> <li><code>expensiveWork()</code></li> <li><code>lengthyComputation()</code></li> </ol> <p>上面是使用<code>await</code>实现的等价代码； <div class=codehilite><pre><span></span><span class=k>try</span> <span class=p>{</span>
  <span class=kd>final</span> <span class=n>value</span> <span class=o>=</span> <span class=kd>await</span> <span class=n>costlyQuery</span><span class=p>(</span><span class=n>url</span><span class=p>);</span>
  <span class=kd>await</span> <span class=n>expensiveWork</span><span class=p>(</span><span class=n>value</span><span class=p>);</span>
  <span class=kd>await</span> <span class=n>lengthyComputation</span><span class=p>();</span>
  <span class=n>print</span><span class=p>(</span><span class=s1>&#39;Done!&#39;</span><span class=p>);</span>
<span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>e</span><span class=p>)</span> <span class=p>{</span>
  <span class=cm>/* Handle exception... */</span>
<span class=p>}</span>
</pre></div></p> <p>有时候我们的代码需要在一些异步任务全部执行完才能执行。这时我们可以使用<code>Future.wait()</code>静态方法实现。 <div class=codehilite><pre><span></span><span class=n>Future</span> <span class=n>deleteLotsOfFiles</span><span class=p>()</span> <span class=kd>async</span> <span class=o>=&gt;</span>  <span class=p>...</span>
<span class=n>Future</span> <span class=n>copyLotsOfFiles</span><span class=p>()</span> <span class=kd>async</span> <span class=o>=&gt;</span>  <span class=p>...</span>
<span class=n>Future</span> <span class=n>checksumLotsOfOtherFiles</span><span class=p>()</span> <span class=kd>async</span> <span class=o>=&gt;</span>  <span class=p>...</span>

<span class=kd>await</span> <span class=n>Future</span><span class=p>.</span><span class=n>wait</span><span class=p>([</span>
  <span class=n>deleteLotsOfFiles</span><span class=p>(),</span>
  <span class=n>copyLotsOfFiles</span><span class=p>(),</span>
  <span class=n>checksumLotsOfOtherFiles</span><span class=p>(),</span>
<span class=p>]);</span>
<span class=n>print</span><span class=p>(</span><span class=s1>&#39;Done with all the long steps!&#39;</span><span class=p>);</span>
</pre></div></p> <hr> <div class=md-source-date> <small> 最后更新: 2020年1月15日 </small> </div> <h2 id=__comments>评论</h2> <div id=disqus_thread></div> <script>
    var disqus_config = function () {
      this.page.url = "https://blog.yorek.xyz/about-me/flutter/flutter_first_project_3/";
      this.page.identifier =
        "/flutter/flutter_first_project_3/";
    };
    (function() {
      var d = document, s = d.createElement("script");
      s.src = "//yorekliu.disqus.com/embed.js";
      s.setAttribute("data-timestamp", +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid"> <a href=../flutter_first_project_2/ title=年轻人的第一个Flutter程序(2) class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> 上一页 </span> 年轻人的第一个Flutter程序(2) </span> </div> </a> <a href=../flutter_first_project_4/ title=年轻人的第一个Flutter程序(4) class="md-flex md-footer-nav__link md-footer-nav__link--next" rel=next> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> 下一页 </span> 年轻人的第一个Flutter程序(4) </span> </div> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> &copy; 2020 Yorek </div> powered by <a href=https://www.mkdocs.org>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ > Material for MkDocs</a> </div> <div class=md-footer-social> <link rel=stylesheet href=../../assets/fonts/font-awesome.css> <a href=https://github.com/YorekLiu class="md-footer-social__link fa fa-github"></a> <a href=lyytogether@gmail.com class="md-footer-social__link fa fa-email"></a> </div> </div> </div> </footer> </div> <script src=../../assets/javascripts/application.808e90bb.js></script> <script src=../../assets/javascripts/lunr/lunr.stemmer.support.js></script> <script src=../../assets/javascripts/lunr/tinyseg.js></script> <script src=../../assets/javascripts/lunr/lunr.ja.js></script> <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script> <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script> </body> </html>
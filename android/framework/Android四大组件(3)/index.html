<!--
  Copyright (c) 2016-2020 Martin Donath <martin.donath@squidfunk.com>
  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:
  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.
  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
--> <!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=description content="An Android Developer."><link href=https://blog.yorek.xyz/about-me/android/framework/Android四大组件(3)/ rel=canonical><meta name=author content="Yorek Liu"><meta name=lang:clipboard.copy content=复制><meta name=lang:clipboard.copied content=已复制><meta name=lang:search.language content=ja><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content=没有找到符合条件的结果><meta name=lang:search.result.one content="找到 1 个符合条件的结果"><meta name=lang:search.result.other content="# 个符合条件的结果"><meta name=lang:search.tokenizer content=[\uff0c\u3002]+><link rel="shortcut icon" href=../../../assets/images/favicon.ico><meta name=generator content="mkdocs-1.0.4, mkdocs-material-4.6.0"><title>Broadcasts</title><link rel=stylesheet href=../../../assets/stylesheets/application.1b62728e.css><link rel=stylesheet href=../../../assets/stylesheets/application-palette.a8b3c06d.css><meta name=theme-color content><script src=../../../assets/javascripts/modernizr.268332fc.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel=stylesheet href=../../../assets/fonts/material-icons.css><link rel=manifest href=../../../manifest.webmanifest><script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-155096376-1", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script><script async src=https://www.google-analytics.com/analytics.js></script><!-- Determine title --><!-- The image needs to have an absolute URL --><!-- Open graph meta tags --><meta property=og:type content=website><meta property=og:title content="Yorek's - Broadcasts"><meta property=og:description content="An Android Developer."><meta content=https://blog.yorek.xyz/about-me/android/framework/Android四大组件(3)/ property=og:url><meta property=og:image content=https://blog.yorek.xyz/about-meassets/images/banner.png><meta property=og:image:type content=image/png><meta property=og:image:width content=1200><meta property=og:image:height content=630><!-- Twitter meta tags --><meta name=twitter:card content=summary_large_image><meta name=twitter:site content=@squidfunk><meta name=twitter:creator content=@squidfunk><meta name=twitter:title content="Yorek's - Broadcasts"><meta name=twitter:description content="An Android Developer."><meta name=twitter:image content=https://blog.yorek.xyz/about-meassets/images/banner.png></head> <body dir=ltr data-md-color-primary=white data-md-color-accent=blue> <svg class=md-svg> <defs> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#1 tabindex=1 class=md-skip> 跳转至 </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=https://blog.yorek.xyz/about-me title="Yorek's" class="md-header-nav__button md-logo"> <img src=../../../assets/images/favicon.ico width=24 height=24> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> Yorek's </span> <span class=md-header-nav__topic> Broadcasts </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> 键入以开始搜索 </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container> <nav class="md-tabs md-tabs--active" data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../3rd-library/3rd-library-source-code/ class=md-tabs__link> Android </a> </li> <li class=md-tabs__item> <a href=../../../flutter/flutter_first_project_1/ class=md-tabs__link> Flutter </a> </li> <li class=md-tabs__item> <a href=../../../leetcode/ class=md-tabs__link> LeetCode </a> </li> <li class=md-tabs__item> <a href=../../../design-pattern/design-pattern/ class=md-tabs__link> Books </a> </li> </ul> </div> </nav> <main class=md-main role=main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=https://blog.yorek.xyz/about-me title="Yorek's" class="md-nav__button md-logo"> <img src=../../../assets/images/favicon.ico width=48 height=48> </a> Yorek's </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. title=Home class=md-nav__link> Home </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2 type=checkbox id=nav-2 checked> <label class=md-nav__link for=nav-2> Android </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-2> Android </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-1 type=checkbox id=nav-2-1> <label class=md-nav__link for=nav-2-1> 三方库源码解析 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-1> 三方库源码解析 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../3rd-library/3rd-library-source-code/ title=Android三方库源码分析 class=md-nav__link> Android三方库源码分析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/matrix/ title="微信APM Matrix解析" class=md-nav__link> 微信APM Matrix解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/matrix-trace/ title=Matrix-TraceCanary解析 class=md-nav__link> Matrix-TraceCanary解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/matrix-io/ title=Matrix-IOCanary解析 class=md-nav__link> Matrix-IOCanary解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/matrix-resource/ title=Matrix-ResourceCanary解析 class=md-nav__link> Matrix-ResourceCanary解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/matrix-sqlitelint/ title=Matrix-SQLiteLint解析 class=md-nav__link> Matrix-SQLiteLint解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/okhttp/ title=OkHttp3源码解析 class=md-nav__link> OkHttp3源码解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/retrofit/ title=Retrofit2源码解析 class=md-nav__link> Retrofit2源码解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/rxjava&rxandroid/ title=RxJava源码解析及使用实例 class=md-nav__link> RxJava源码解析及使用实例 </a> </li> <li class=md-nav__item> <a href=../../other/RxJava/ title=RxJava操作符大全 class=md-nav__link> RxJava操作符大全 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide1/ title="Glide v4 源码解析（一）" class=md-nav__link> Glide v4 源码解析（一） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide2/ title="Glide v4 源码解析（二）" class=md-nav__link> Glide v4 源码解析（二） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide3/ title="Glide v4 源码解析（三）" class=md-nav__link> Glide v4 源码解析（三） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide4/ title="Glide v4 源码解析（四）" class=md-nav__link> Glide v4 源码解析（四） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide5/ title="Glide v4 源码解析（五）" class=md-nav__link> Glide v4 源码解析（五） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide6/ title="Glide v4 源码解析（六）" class=md-nav__link> Glide v4 源码解析（六） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide7/ title="Glide v4 源码解析（七）" class=md-nav__link> Glide v4 源码解析（七） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/migrate-to-glide/ title=杂记：从Picasso迁移至Glide class=md-nav__link> 杂记：从Picasso迁移至Glide </a> </li> <li class=md-nav__item> <a href=../../3rd-library/eventbus/ title=EventBus源码解析 class=md-nav__link> EventBus源码解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/leakcanary/ title=LeakCanary2源码解析 class=md-nav__link> LeakCanary2源码解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/permissiondispatcher/ title=PermissionDispatcher源码解析 class=md-nav__link> PermissionDispatcher源码解析 </a> </li> <li class=md-nav__item> <a href=../../other/constraintlayout/ title=ConstraintLayout使用大全 class=md-nav__link> ConstraintLayout使用大全 </a> </li> <li class=md-nav__item> <a href=../../other/dagger2/ title=初学者的Dagger2教程 class=md-nav__link> 初学者的Dagger2教程 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-2 type=checkbox id=nav-2-2> <label class=md-nav__link for=nav-2-2> Android开发高手课 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-2> Android开发高手课 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../paid/master/ title=Android开发高手课 class=md-nav__link> Android开发高手课 </a> </li> <li class=md-nav__item> <a href=../../paid/master/crash_1/ title="01 | 崩溃优化（上）：关于“崩溃”那些事儿" class=md-nav__link> 01 | 崩溃优化（上）：关于“崩溃”那些事儿 </a> </li> <li class=md-nav__item> <a href=../../paid/master/crash_2/ title="02 | 崩溃优化（下）：应用崩溃了，你应该如何去分析？" class=md-nav__link> 02 | 崩溃优化（下）：应用崩溃了，你应该如何去分析？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/memory_1/ title="03 | 内存优化（上）：4GB内存时代，再谈内存优化" class=md-nav__link> 03 | 内存优化（上）：4GB内存时代，再谈内存优化 </a> </li> <li class=md-nav__item> <a href=../../paid/master/memory_2/ title="04 | 内存优化（下）：内存优化这件事，应该从哪里着手？" class=md-nav__link> 04 | 内存优化（下）：内存优化这件事，应该从哪里着手？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/stuck_1/ title="05 | 卡顿优化（上）：你要掌握的卡顿分析方法" class=md-nav__link> 05 | 卡顿优化（上）：你要掌握的卡顿分析方法 </a> </li> <li class=md-nav__item> <a href=../../paid/master/stuck_2/ title="06 | 卡顿优化（下）：如何监控应用卡顿？" class=md-nav__link> 06 | 卡顿优化（下）：如何监控应用卡顿？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/stuck_3/ title="06补充篇 | 卡顿优化：卡顿现场与卡顿分析" class=md-nav__link> 06补充篇 | 卡顿优化：卡顿现场与卡顿分析 </a> </li> <li class=md-nav__item> <a href=../../paid/master/start_1/ title="07 | 启动优化（上）：从启动过程看启动速度优化" class=md-nav__link> 07 | 启动优化（上）：从启动过程看启动速度优化 </a> </li> <li class=md-nav__item> <a href=../../paid/master/start_2/ title="08 | 启动优化（下）：优化启动速度的进阶方法" class=md-nav__link> 08 | 启动优化（下）：优化启动速度的进阶方法 </a> </li> <li class=md-nav__item> <a href=../../paid/master/io_1/ title="09 | I/O优化（上）：开发工程师必备的I/O优化知识" class=md-nav__link> 09 | I/O优化（上）：开发工程师必备的I/O优化知识 </a> </li> <li class=md-nav__item> <a href=../../paid/master/io_2/ title="10 | I/O优化（中）：不同I/O方式的使用场景是什么？" class=md-nav__link> 10 | I/O优化（中）：不同I/O方式的使用场景是什么？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/io_3/ title="11 | I/O优化（下）：如何监控线上I/O操作？" class=md-nav__link> 11 | I/O优化（下）：如何监控线上I/O操作？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/storage_1/ title="12 | 存储优化（上）：常见的数据存储方法有哪些？" class=md-nav__link> 12 | 存储优化（上）：常见的数据存储方法有哪些？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/storage_2/ title="13 | 存储优化（中）：如何优化数据存储？" class=md-nav__link> 13 | 存储优化（中）：如何优化数据存储？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/storage_3/ title="14 | 存储优化（下）：数据库SQLite的使用和优化" class=md-nav__link> 14 | 存储优化（下）：数据库SQLite的使用和优化 </a> </li> <li class=md-nav__item> <a href=../../paid/master/network_1/ title="15 | 网络优化（上）：移动开发工程师必备的网络优化知识" class=md-nav__link> 15 | 网络优化（上）：移动开发工程师必备的网络优化知识 </a> </li> <li class=md-nav__item> <a href=../../paid/master/network_2/ title="16 | 网络优化（中）：复杂多变的移动网络该如何优化？" class=md-nav__link> 16 | 网络优化（中）：复杂多变的移动网络该如何优化？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/network_3/ title="17 | 网络优化（下）：大数据下网络该如何监控？" class=md-nav__link> 17 | 网络优化（下）：大数据下网络该如何监控？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/battery_1/ title="18 | 耗电优化（上）：从电量优化的演进看耗电分析" class=md-nav__link> 18 | 耗电优化（上）：从电量优化的演进看耗电分析 </a> </li> <li class=md-nav__item> <a href=../../paid/master/battery_2/ title="19 | 耗电优化（下）：耗电的优化方法与线上监控" class=md-nav__link> 19 | 耗电优化（下）：耗电的优化方法与线上监控 </a> </li> <li class=md-nav__item> <a href=../../paid/master/ui_1/ title="20 | UI 优化（上）：UI 渲染的几个关键概念" class=md-nav__link> 20 | UI 优化（上）：UI 渲染的几个关键概念 </a> </li> <li class=md-nav__item> <a href=../../paid/master/ui_2/ title="21 | UI 优化（下）：如何优化 UI 渲染？" class=md-nav__link> 21 | UI 优化（下）：如何优化 UI 渲染？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/package_1/ title="22 | 包体积优化（上）：如何减少安装包大小？" class=md-nav__link> 22 | 包体积优化（上）：如何减少安装包大小？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/package_2/ title="23 | 包体积优化（下）：资源优化的进阶实践" class=md-nav__link> 23 | 包体积优化（下）：资源优化的进阶实践 </a> </li> <li class=md-nav__item> <a href=../../paid/master/compile/ title="26 | 关于编译，你需要了解什么？" class=md-nav__link> 26 | 关于编译，你需要了解什么？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/bytecode/ title="27 | 编译插桩的三种方法：AspectJ、ASM、ReDex" class=md-nav__link> 27 | 编译插桩的三种方法：AspectJ、ASM、ReDex </a> </li> <li class=md-nav__item> <a href=../../paid/master/native_hook/ title="35 | Native Hook 技术，天使还是魔鬼？" class=md-nav__link> 35 | Native Hook 技术，天使还是魔鬼？ </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-3 type=checkbox id=nav-2-3 checked> <label class=md-nav__link for=nav-2-3> Framework系列 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-3> Framework系列 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Android四大组件(1)/ title=Activity class=md-nav__link> Activity </a> </li> <li class=md-nav__item> <a href=../Android四大组件(2)/ title=Service class=md-nav__link> Service </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-toggle md-nav__toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Broadcasts </label> <a href=./ title=Broadcasts class="md-nav__link md-nav__link--active"> Broadcasts </a> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>目录</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#1 class=md-nav__link> 1 系统广播 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#11 class=md-nav__link> 1.1 系统广播的变更 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2 class=md-nav__link> 2 广播的注册 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#21 class=md-nav__link> 2.1 静态注册 </a> </li> <li class=md-nav__item> <a href=#22 class=md-nav__link> 2.2 动态注册 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3 class=md-nav__link> 3 广播的发送 </a> </li> <li class=md-nav__item> <a href=#4 class=md-nav__link> 4 使用权限限制广播 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#41 class=md-nav__link> 4.1 带权限发送 </a> </li> <li class=md-nav__item> <a href=#42 class=md-nav__link> 4.2 带权限接收 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#5-localbroadcastmanager class=md-nav__link> 5. LocalBroadcastManager </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#51-localbroadcastmanager class=md-nav__link> 5.1 LocalBroadcastManager的使用 </a> </li> <li class=md-nav__item> <a href=#52 class=md-nav__link> 5.2 源码解析 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#__comments class="md-nav__link md-nav__link--active"> 评论 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../Android四大组件(4)/ title="Content Providers与Fragment" class=md-nav__link> Content Providers与Fragment </a> </li> <li class=md-nav__item> <a href=../IPC机制/ title=IPC机制 class=md-nav__link> IPC机制 </a> </li> <li class=md-nav__item> <a href=../View的事件体系/ title=View的事件体系 class=md-nav__link> View的事件体系 </a> </li> <li class=md-nav__item> <a href=../View的绘制原理/ title=View的绘制原理 class=md-nav__link> View的绘制原理 </a> </li> <li class=md-nav__item> <a href=../RemoteViews/ title=RemoteViews class=md-nav__link> RemoteViews </a> </li> <li class=md-nav__item> <a href=../Drawable/ title=Android中的Drawable资源 class=md-nav__link> Android中的Drawable资源 </a> </li> <li class=md-nav__item> <a href=../Android动画/ title=Android动画 class=md-nav__link> Android动画 </a> </li> <li class=md-nav__item> <a href=../Window与WindowManager/ title=Window与WindowManager class=md-nav__link> Window与WindowManager </a> </li> <li class=md-nav__item> <a href=../四大组件启动过程/ title=四大组件启动过程 class=md-nav__link> 四大组件启动过程 </a> </li> <li class=md-nav__item> <a href=../Android消息机制/ title=Android消息机制 class=md-nav__link> Android消息机制 </a> </li> <li class=md-nav__item> <a href=../Android线程与线程池/ title=Android线程与线程池 class=md-nav__link> Android线程与线程池 </a> </li> <li class=md-nav__item> <a href=../Bitmap的缓存与加载/ title=Bitmap的缓存与加载 class=md-nav__link> Bitmap的缓存与加载 </a> </li> <li class=md-nav__item> <a href=../JNI与NDK/ title=JNI与NDK编程简介 class=md-nav__link> JNI与NDK编程简介 </a> </li> <li class=md-nav__item> <a href=../性能优化/ title=Android性能优化 class=md-nav__link> Android性能优化 </a> </li> <li class=md-nav__item> <a href=../binder1-mediaservice/ title=Binder深入理解——以MediaService为例 class=md-nav__link> Binder深入理解——以MediaService为例 </a> </li> <li class=md-nav__item> <a href=../binder2/ title=Binder深入理解——罗老师系列 class=md-nav__link> Binder深入理解——罗老师系列 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-4 type=checkbox id=nav-2-4> <label class=md-nav__link for=nav-2-4> 付费知识归档 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-4> 付费知识归档 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-4-1 type=checkbox id=nav-2-4-1> <label class=md-nav__link for=nav-2-4-1> 某圈问题索引 </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-2-4-1> 某圈问题索引 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../paid/zsxq/zsxq_index/ title=某圈问题索引 class=md-nav__link> 某圈问题索引 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week1-synchronized/ title=理解Java中synchronized关键词 class=md-nav__link> 理解Java中synchronized关键词 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week2-service/ title=理解Service class=md-nav__link> 理解Service </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week3-activity/ title=理解Activity的启动模式 class=md-nav__link> 理解Activity的启动模式 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week4-startActivityForResult/ title=关于startActivityForResult class=md-nav__link> 关于startActivityForResult </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week5-view/ title=关于View的知识 class=md-nav__link> 关于View的知识 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week6-gradle/ title=关于Gradle的知识 class=md-nav__link> 关于Gradle的知识 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week7-serialization/ title=关于序列化的知识 class=md-nav__link> 关于序列化的知识 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week10-classloader/ title=Android中的ClassLoader class=md-nav__link> Android中的ClassLoader </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week11-binder/ title=Binder简介 class=md-nav__link> Binder简介 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week12-retrofit-okhttp/ title=OkHttp和Retrofit的作用以及两者之间的联系 class=md-nav__link> OkHttp和Retrofit的作用以及两者之间的联系 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week14-jvm-gc/ title=JVM中垃圾回收策略 class=md-nav__link> JVM中垃圾回收策略 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week16-keep-app-alive/ title=进程保活 class=md-nav__link> 进程保活 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week17-android-components/ title=四大组件的作用以及多进程 class=md-nav__link> 四大组件的作用以及多进程 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week20-network-protocol/ title=网络协议 class=md-nav__link> 网络协议 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week21-mvc&amp;mvp&mvvm/ title=MVC、MVP和MVVM class=md-nav__link> MVC、MVP和MVVM </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week22-android-studio-build/ title="Android Studio build过程" class=md-nav__link> Android Studio build过程 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week23-load-large-bitmap/ title=大尺寸图片加载问题 class=md-nav__link> 大尺寸图片加载问题 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-5 type=checkbox id=nav-2-5> <label class=md-nav__link for=nav-2-5> 日常记录 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-5> 日常记录 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../other/annotation/ title=注解的定义及解析 class=md-nav__link> 注解的定义及解析 </a> </li> <li class=md-nav__item> <a href=../../other/best_throttle_in_mvvm/ title=这可能是MVVM中最优雅的按键防抖方案 class=md-nav__link> 这可能是MVVM中最优雅的按键防抖方案 </a> </li> <li class=md-nav__item> <a href=../../other/android-jenkins/ title="Jenkins for android" class=md-nav__link> Jenkins for android </a> </li> <li class=md-nav__item> <a href=../../other/SystemProrities/ title=普通Android程序使用SystemProrities class=md-nav__link> 普通Android程序使用SystemProrities </a> </li> <li class=md-nav__item> <a href=../../other/recyclerview-cache/ title=ListView、RecyclerView缓存策略解析 class=md-nav__link> ListView、RecyclerView缓存策略解析 </a> </li> <li class=md-nav__item> <a href=../../other/recyclerview-item-docoration/ title=RecyclerView高级特性——ItemDecoration class=md-nav__link> RecyclerView高级特性——ItemDecoration </a> </li> <li class=md-nav__item> <a href=../../other/recyclerview-others/ title=RecyclerView的一些使用细节 class=md-nav__link> RecyclerView的一些使用细节 </a> </li> <li class=md-nav__item> <a href=../../other/RecyclerView-Sort&Delete/ title=RecyclerView高级特性——拖拽排序以及滑动删除 class=md-nav__link> RecyclerView高级特性——拖拽排序以及滑动删除 </a> </li> <li class=md-nav__item> <a href=../../other/FAB-Behavior/ title=FloatingActionButton上滑隐藏下滑显示 class=md-nav__link> FloatingActionButton上滑隐藏下滑显示 </a> </li> <li class=md-nav__item> <a href=../../other/nestedscrolling/ title=NestedScrolling机制 class=md-nav__link> NestedScrolling机制 </a> </li> <li class=md-nav__item> <a href=../../other/porterduff/ title=使用Porter-Duff合成数字图像 class=md-nav__link> 使用Porter-Duff合成数字图像 </a> </li> <li class=md-nav__item> <a href=../../other/runtime/ title="Android Runtime" class=md-nav__link> Android Runtime </a> </li> <li class=md-nav__item> <a href=../../other/android_alias/ title=Android马甲包的那些事儿 class=md-nav__link> Android马甲包的那些事儿 </a> </li> <li class=md-nav__item> <a href=../../other/Android-Development-Tool/ title=Android神兵利器 class=md-nav__link> Android神兵利器 </a> </li> <li class=md-nav__item> <a href=../../other/FileProvider/ title=FileProvider class=md-nav__link> FileProvider </a> </li> <li class=md-nav__item> <a href=../../other/Android判断导航栏高度/ title=Android判断虚拟按键(导航栏)显示与否、高度以及获取屏幕实际高度 class=md-nav__link> Android判断虚拟按键(导航栏)显示与否、高度以及获取屏幕实际高度 </a> </li> <li class=md-nav__item> <a href=../../other/Android图片选择器/ title=Android图片选择器 class=md-nav__link> Android图片选择器 </a> </li> <li class=md-nav__item> <a href=../../other/Android底部导航栏框架/ title=Android原生底部导航栏 class=md-nav__link> Android原生底部导航栏 </a> </li> <li class=md-nav__item> <a href=../../other/Android搜索栏的实现/ title=Android搜索栏的实现 class=md-nav__link> Android搜索栏的实现 </a> </li> <li class=md-nav__item> <a href=../../other/Android暂停音乐播放器的播放/ title=Android暂停酷狗、网易云音乐等音乐播放器的播放 class=md-nav__link> Android暂停酷狗、网易云音乐等音乐播放器的播放 </a> </li> <li class=md-nav__item> <a href=../../other/Android滑动返回实践/ title=Android滑动返回实践 class=md-nav__link> Android滑动返回实践 </a> </li> <li class=md-nav__item> <a href=../../other/Android程序反编译/ title=MacOS下Android程序反编译 class=md-nav__link> MacOS下Android程序反编译 </a> </li> <li class=md-nav__item> <a href=../../other/Android通讯录快速读取/ title=Android通讯录快速读取 class=md-nav__link> Android通讯录快速读取 </a> </li> <li class=md-nav__item> <a href=../../other/soft-keyboard-in-app/ title=App内自定义软键盘 class=md-nav__link> App内自定义软键盘 </a> </li> <li class=md-nav__item> <a href=../../other/腾讯X5内核入坑指南/ title="腾讯TBS X5浏览器内核入坑指南" class=md-nav__link> 腾讯TBS X5浏览器内核入坑指南 </a> </li> <li class=md-nav__item> <a href=../../other/琐碎知识点/ title=琐碎知识点 class=md-nav__link> 琐碎知识点 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3 type=checkbox id=nav-3> <label class=md-nav__link for=nav-3> Flutter </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-3> Flutter </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../flutter/flutter_first_project_1/ title=年轻人的第一个Flutter程序(1) class=md-nav__link> 年轻人的第一个Flutter程序(1) </a> </li> <li class=md-nav__item> <a href=../../../flutter/flutter_first_project_2/ title=年轻人的第一个Flutter程序(2) class=md-nav__link> 年轻人的第一个Flutter程序(2) </a> </li> <li class=md-nav__item> <a href=../../../flutter/flutter_first_project_3/ title=年轻人的第一个Flutter程序(3) class=md-nav__link> 年轻人的第一个Flutter程序(3) </a> </li> <li class=md-nav__item> <a href=../../../flutter/flutter_first_project_4/ title=年轻人的第一个Flutter程序(4) class=md-nav__link> 年轻人的第一个Flutter程序(4) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4 type=checkbox id=nav-4> <label class=md-nav__link for=nav-4> LeetCode </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-4> LeetCode </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../leetcode/ title=算法目录 class=md-nav__link> 算法目录 </a> </li> <li class=md-nav__item> <a href=../../../leetcode/code_interviews_1/ title=数据结构、算法和数据操作 class=md-nav__link> 数据结构、算法和数据操作 </a> </li> <li class=md-nav__item> <a href=../../../leetcode/code_interviews_3/ title=高质量的代码 class=md-nav__link> 高质量的代码 </a> </li> <li class=md-nav__item> <a href=../../../leetcode/code_interviews_4/ title=解决问题的思路 class=md-nav__link> 解决问题的思路 </a> </li> <li class=md-nav__item> <a href=../../../leetcode/code_interviews_5/ title=优化时间和空间效率 class=md-nav__link> 优化时间和空间效率 </a> </li> <li class=md-nav__item> <a href=../../../leetcode/code_interviews_6/ title=面试中的各项能力 class=md-nav__link> 面试中的各项能力 </a> </li> <li class=md-nav__item> <a href=../../../leetcode/array/ title=Array class=md-nav__link> Array </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode1-10/ title=LeetCode(1-10) class=md-nav__link> LeetCode(1-10) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode11-20/ title=LeetCode(11-20) class=md-nav__link> LeetCode(11-20) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode21-30/ title=LeetCode(21-30) class=md-nav__link> LeetCode(21-30) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode31-40/ title=LeetCode(31-40) class=md-nav__link> LeetCode(31-40) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode41-50/ title=LeetCode(41-50) class=md-nav__link> LeetCode(41-50) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode51-60/ title=LeetCode(51-60) class=md-nav__link> LeetCode(51-60) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode61-70/ title=LeetCode(61-70) class=md-nav__link> LeetCode(61-70) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode71-80/ title=LeetCode(71-80) class=md-nav__link> LeetCode(71-80) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode81-90/ title=LeetCode(81-90) class=md-nav__link> LeetCode(81-90) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode91-100/ title=LeetCode(91-100) class=md-nav__link> LeetCode(91-100) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode101-110/ title=LeetCode(101-110) class=md-nav__link> LeetCode(101-110) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode111-120/ title=LeetCode(111-120) class=md-nav__link> LeetCode(111-120) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5 type=checkbox id=nav-5> <label class=md-nav__link for=nav-5> Books </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-5> Books </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-1 type=checkbox id=nav-5-1> <label class=md-nav__link for=nav-5-1> Design Pattern </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-1> Design Pattern </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../design-pattern/design-pattern/ title=设计模式概述 class=md-nav__link> 设计模式概述 </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/design-principle/ title=面向对象的六大原则 class=md-nav__link> 面向对象的六大原则 </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/singleton/ title=单例模式(Singleton) class=md-nav__link> 单例模式(Singleton) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/builder/ title=建造者模式(Builder) class=md-nav__link> 建造者模式(Builder) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/prototype/ title=原型模式(Prototype) class=md-nav__link> 原型模式(Prototype) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/factory-method/ title="工厂方法模式(Factory method)" class=md-nav__link> 工厂方法模式(Factory method) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/abstract-factory/ title="抽象工厂模式(Abstract factory)" class=md-nav__link> 抽象工厂模式(Abstract factory) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/proxy/ title=代理模式(Proxy) class=md-nav__link> 代理模式(Proxy) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/composite/ title=组合模式(Composite) class=md-nav__link> 组合模式(Composite) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/adapter/ title=适配器模式(Adapter) class=md-nav__link> 适配器模式(Adapter) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/decorator/ title=装饰模式(Decorator) class=md-nav__link> 装饰模式(Decorator) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/flyweight/ title=享元模式(Flyweight) class=md-nav__link> 享元模式(Flyweight) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/facade/ title=外观模式(Facade) class=md-nav__link> 外观模式(Facade) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/bridge/ title=桥接模式(Bridge) class=md-nav__link> 桥接模式(Bridge) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/strategy/ title=策略模式(Strategy) class=md-nav__link> 策略模式(Strategy) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/state/ title=状态模式(State) class=md-nav__link> 状态模式(State) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/chain-of-responsibility/ title="责任链模式(Chain of responsibility)" class=md-nav__link> 责任链模式(Chain of responsibility) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/interpreter/ title=解释器模式(Interpreter) class=md-nav__link> 解释器模式(Interpreter) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/command/ title=命令模式(Command) class=md-nav__link> 命令模式(Command) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/observer/ title=观察者模式(Observer) class=md-nav__link> 观察者模式(Observer) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/memento/ title=备忘录模式(Memento) class=md-nav__link> 备忘录模式(Memento) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/iterator/ title=迭代器模式(Iterator) class=md-nav__link> 迭代器模式(Iterator) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/template-method/ title="模版方法模式(Template method)" class=md-nav__link> 模版方法模式(Template method) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/visitor/ title=访问者模式(Visitor) class=md-nav__link> 访问者模式(Visitor) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/mediator/ title=中介者模式(Mediator) class=md-nav__link> 中介者模式(Mediator) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/confusing-design-pattern/ title=易混淆的设计模式 class=md-nav__link> 易混淆的设计模式 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2 type=checkbox id=nav-5-2> <label class=md-nav__link for=nav-5-2> Effective Java </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-2> Effective Java </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../effective-java/effective-java/ title="Effective Java概述" class=md-nav__link> Effective Java概述 </a> </li> <li class=md-nav__item> <a href=../../../effective-java/chapter1/ title=创建和销毁对象 class=md-nav__link> 创建和销毁对象 </a> </li> <li class=md-nav__item> <a href=../../../effective-java/chapter2/ title=对于所有对象都通用的方法 class=md-nav__link> 对于所有对象都通用的方法 </a> </li> <li class=md-nav__item> <a href=../../../effective-java/chapter3/ title=类和接口 class=md-nav__link> 类和接口 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-3 type=checkbox id=nav-5-3> <label class=md-nav__link for=nav-5-3> JVM </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-3> JVM </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../jvm/jvm-content/ title=深入理解Java虚拟机 class=md-nav__link> 深入理解Java虚拟机 </a> </li> <li class=md-nav__item> <a href=../../../jvm/java-memory-area-oom/ title=Java内存区域与内存溢出异常 class=md-nav__link> Java内存区域与内存溢出异常 </a> </li> <li class=md-nav__item> <a href=../../../jvm/java-gc/ title=垃圾收集器与内存分配策略 class=md-nav__link> 垃圾收集器与内存分配策略 </a> </li> <li class=md-nav__item> <a href=../../../jvm/class-struct/ title=类文件结构 class=md-nav__link> 类文件结构 </a> </li> <li class=md-nav__item> <a href=../../../jvm/load-class/ title=虚拟机类加载机制 class=md-nav__link> 虚拟机类加载机制 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-4 type=checkbox id=nav-5-4> <label class=md-nav__link for=nav-5-4> Java </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-4> Java </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../java/generics-java-kotlin/ title=Java&Kotlin在泛型方面的区别 class=md-nav__link> Java&Kotlin在泛型方面的区别 </a> </li> <li class=md-nav__item> <a href=../../../java/java-collections/ title=Java集合总结 class=md-nav__link> Java集合总结 </a> </li> <li class=md-nav__item> <a href=../../../java/java-foundation/ title=Java常见概念 class=md-nav__link> Java常见概念 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-5 type=checkbox id=nav-5-5> <label class=md-nav__link for=nav-5-5> Refactoring </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-5> Refactoring </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../refactoring/refactoring/ title=重构：改善既有代码的设计 class=md-nav__link> 重构：改善既有代码的设计 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>目录</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#1 class=md-nav__link> 1 系统广播 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#11 class=md-nav__link> 1.1 系统广播的变更 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2 class=md-nav__link> 2 广播的注册 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#21 class=md-nav__link> 2.1 静态注册 </a> </li> <li class=md-nav__item> <a href=#22 class=md-nav__link> 2.2 动态注册 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3 class=md-nav__link> 3 广播的发送 </a> </li> <li class=md-nav__item> <a href=#4 class=md-nav__link> 4 使用权限限制广播 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#41 class=md-nav__link> 4.1 带权限发送 </a> </li> <li class=md-nav__item> <a href=#42 class=md-nav__link> 4.2 带权限接收 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#5-localbroadcastmanager class=md-nav__link> 5. LocalBroadcastManager </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#51-localbroadcastmanager class=md-nav__link> 5.1 LocalBroadcastManager的使用 </a> </li> <li class=md-nav__item> <a href=#52 class=md-nav__link> 5.2 源码解析 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#__comments class="md-nav__link md-nav__link--active"> 评论 </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <h1>Broadcasts</h1> <p>本章的主要内容是<a href=https://developer.android.com/guide/components/broadcasts.html>Broadcasts</a></p> <p>Broadcasts是一种通讯组件，Android应用程序可以发送或接收来自Android系统和其他Android应用程序的广播消息，类似于观察者设计模式。当感兴趣的事件发生时，这些广播被发送。例如，当各种系统事件（例如系统启动或设备开始充电）发生时，Android系统会发送广播。应用程序还可以发送自定义广播，例如，通知其他应用程序可能感兴趣的内容（例如，一些新数据已被下载）。</p> <h2 id=1>1 系统广播<a class=headerlink href=#1 title="Permanent link">&para;</a></h2> <p>系统广播的action的列表，可以在SDK中找到，目录是<code>platforms/android-25/data/broadcast_actions.txt</code></p> <h3 id=11>1.1 系统广播的变更<a class=headerlink href=#11 title="Permanent link">&para;</a></h3> <p>Android 7.0及以上平台不可以发送以下系统广播，该项优化影响所有的应用，不仅仅是目标为Android 7.0的应用： </p> <ul> <li>ACTION_NEW_PICTURE </li> <li>ACTION_NEW_VIDEO</li> </ul> <p>应用目标为Android 7.0 (API level 24)及更高平台必须动态注册以下广播，静态注册无效：</p> <ul> <li>CONNECTIVITY_ACTION</li> </ul> <h2 id=2>2 广播的注册<a class=headerlink href=#2 title="Permanent link">&para;</a></h2> <p>应用可以有两种方式注册BroadcastReceiver，第一种为在manifest中注册的静态注册，第二种为通过context在代码中注册的动态注册。</p> <h3 id=21>2.1 静态注册<a class=headerlink href=#21 title="Permanent link">&para;</a></h3> <p>通过静态注册的receiver，在应用安装时系统包管理器会注册此receiver。此receiver会变成应用的一个独立入口点，这意味着如果应用没有正在运行，系统可以启动应用然后在传递广播。 系统会创建新的BroadcastReceiver组件处理每一个接收到的广播。该对象仅仅在调用<code>onReceive(Context, Intent)</code>方法期间才是合法的，一旦该方法返回了，系统会认为此组件不再是active状态。</p> <h3 id=22>2.2 动态注册<a class=headerlink href=#22 title="Permanent link">&para;</a></h3> <p>动态注册时需要注意，不再需要该接受者或者context不再合法时<code>unregisterReceiver</code>。 动态注册的广播接收者只要它们注册的上下文有效就一直接收广播。例如，如果用Activity的context注册，主要Activity不被销毁，你就可以接收广播。如果使用Application的context，应用在运行时都可以接收广播。</p> <blockquote> <ol> <li>在<code>onReceive</code>中不易进行耗时操作，其最长只有10s的周期。如果需要多一点点时间执行作业的话，可以使用<code>goAsync()</code>或者启动<code>JobSchedule</code></li> <li>如果只需要应用内广播，可以使用本地广播<code>LocalBroadcastManager.registerReceiver(BroadcastReceiver, IntentFilter)</code>来替代。</li> </ol> </blockquote> <h2 id=3>3 广播的发送<a class=headerlink href=#3 title="Permanent link">&para;</a></h2> <p>Android提供了四种广播的发送方式：</p> <ol> <li><code>sendOrderedBroadcast(Intent, String)</code>发送有序广播<br> 该广播一次发送给一个接受者，每个接受者轮流执行，该广播可以携带结果给下一个接受者，或者被接受者丢弃，这样就不会传递给下一个接受者了。接受者的顺序按照<code>android:priority</code>排列，同一优先级的广播接收者将会无序执行。</li> <li><code>sendBroadcast(Intent)</code>发送普通广播 </li> <li><code>sendStickyBroadcast</code> or <code>sendStickyOrderedBroadcast</code>发送粘性广播，不过此类广播由于不安全（都能访问）、没有保护（都能修改）以及其他的问题，已经被弃用了。</li> <li><code>LocalBroadcastManager.sendBroadcast</code>发送本地广播<br> 在不需要发送跨app广播时，发送本地广播是最佳的选择。第一，其效率比较高(因为不用考虑IPC)；第二，也不用当心其他应用接收或者发送该广播而导致的安全性问题。</li> </ol> <blockquote> <p>如果想要只发送广播给特定的应用，可以使用Intent的<code>setPackage(String)</code>方法</p> </blockquote> <h2 id=4>4 使用权限限制广播<a class=headerlink href=#4 title="Permanent link">&para;</a></h2> <h3 id=41>4.1 带权限发送<a class=headerlink href=#41 title="Permanent link">&para;</a></h3> <p>调用<code>sendBroadcast(Intent, String)</code>或<code>sendOrderedBroadcast(Intent, String, BroadcastReceiver，Handler, int, String, Bundle)</code>时，可以指定权限参数。 只有已经请求了标签中的权限标签（或者因为是危险权限后面被运行时授予的权限）的接收者才可以接收广播。 例如，下面代码发送广播： <div class=codehilite><pre><span></span><span class=n>sendBroadcast</span><span class=p>(</span><span class=k>new</span> <span class=n>Intent</span><span class=p>(</span><span class=s>&quot;com.example.NOTIFY&quot;</span><span class=p>),</span> <span class=n>Manifest</span><span class=p>.</span><span class=na>permission</span><span class=p>.</span><span class=na>SEND_SMS</span><span class=p>);</span>
</pre></div> 要接收广播，接收应用程序必须如下所示请求权限： <div class=codehilite><pre><span></span><span class=nt>&lt;uses-permission</span> <span class=err>android：</span><span class=na>name =</span><span class=s>“android.permission.SEND_SMS”/</span><span class=nt>&gt;</span>
</pre></div> 可以指定现有的系统权限，如SEND_SMS或定义一个自定义权限 <permission>元素。</p> <h3 id=42>4.2 带权限接收<a class=headerlink href=#42 title="Permanent link">&para;</a></h3> <p>当注册广播接收者(无论是通过<code>registerReceiver(BroadcastReceiver, IntentFilter, String, Handler)</code>注册还是通过在manifest文件<receiver>标签中)，特别申明一个权限参数时，只有已经请求了标签中的权限标签（或者因为是危险权限后面被运行时授予的权限）的接收者才可以发送广播。 例如，假设接收广播的应用已经在manifest文件中声明了如下receiver： <div class=codehilite><pre><span></span><span class=nt>&lt;receiver</span> <span class=na>android:name=</span><span class=s>&quot;.MyBroadcastReceiver&quot;</span> <span class=na>android:permission=</span><span class=s>&quot;android.permission.SEND_SMS&quot;</span><span class=nt>&gt;</span>
    <span class=nt>&lt;intent-filter&gt;</span>
        <span class=nt>&lt;action</span> <span class=na>android:name=</span><span class=s>&quot;android.intent.action.AIRPLANE_MODE&quot;</span><span class=nt>/&gt;</span>   
    <span class=nt>&lt;/intent-filter&gt;</span>
<span class=nt>&lt;/receiver&gt;</span>
</pre></div> 或者通过动态注册的receiver有如下代码： <div class=codehilite><pre><span></span><span class=n>IntentFilter</span> <span class=n>filter</span> <span class=o>=</span> <span class=k>new</span> <span class=n>IntentFilter</span><span class=p>(</span><span class=n>Intent</span><span class=p>.</span><span class=na>ACTION_AIRPLANE_MODE_CHANGED</span><span class=p>);</span>
<span class=n>registerReceiver</span><span class=p>(</span><span class=n>receiver</span><span class=p>,</span> <span class=n>filter</span><span class=p>,</span> <span class=n>Manifest</span><span class=p>.</span><span class=na>permission</span><span class=p>.</span><span class=na>SEND_SMS</span><span class=p>,</span> <span class=kc>null</span> <span class=p>);</span>
</pre></div> 为了能够发射广播到这些receivers，发射应用必须请求下面的权限： <div class=codehilite><pre><span></span><span class=nt>&lt;uses-permission</span> <span class=na>android:name=</span><span class=s>&quot;android.permission.SEND_SMS&quot;</span><span class=nt>/&gt;</span>
</pre></div></p> <h2 id=5-localbroadcastmanager>5. LocalBroadcastManager<a class=headerlink href=#5-localbroadcastmanager title="Permanent link">&para;</a></h2> <p><code>LocalBroadcastManager</code>可以用来发送App内广播，它具有以下特点：</p> <ol> <li>本地广播只能在自身App内传播，不必担心泄漏隐私数据</li> <li>本地广播不允许其他App对你的App发送该广播，不必担心安全漏洞被利用</li> <li>本地广播比全局广播更高效</li> </ol> <p><code>LocalBroadcastManager</code>的特点来源于其实现方式：</p> <ul> <li>由于动态注册广播、发送广播需要通过<code>LocalBroadcastManager</code>实例，该实例是单例模式实现，其他App无法获取到自身App中的实例，因此，第1、2点是成立的。 </li> <li>最后，由于<code>LocalBroadcastManager</code>不需要经过AMS，这样就少了两个IPC过程，显然更高效，第3点成立。</li> </ul> <h3 id=51-localbroadcastmanager>5.1 LocalBroadcastManager的使用<a class=headerlink href=#51-localbroadcastmanager title="Permanent link">&para;</a></h3> <p><code>LocalBroadcastManager</code>的使用非常简单，代码如下：</p> <p>注册广播：</p> <div class=codehilite><pre><span></span><span class=k>private</span> <span class=k>val</span> <span class=py>mBroadcastReceiver</span> <span class=p>=</span> <span class=k>object</span> <span class=p>:</span> <span class=nc>BroadcastReceiver</span><span class=p>()</span> <span class=p>{</span>
    <span class=k>override</span> <span class=k>fun</span> <span class=nf>onReceive</span><span class=p>(</span><span class=n>context</span><span class=p>:</span> <span class=n>Context</span><span class=p>?,</span> <span class=n>intent</span><span class=p>:</span> <span class=n>Intent</span><span class=p>?)</span> <span class=p>{</span>
        <span class=n>Log</span><span class=p>.</span><span class=n>e</span><span class=p>(</span><span class=n>TAG</span><span class=p>,</span> <span class=s>&quot;onReceive action=${intent?.action}&quot;</span><span class=p>)</span>
    <span class=p>}</span>
<span class=p>}</span>

<span class=k>val</span> <span class=py>intentFilter</span> <span class=p>=</span> <span class=n>IntentFilter</span><span class=p>(</span><span class=n>ACTION_TEST</span><span class=p>)</span>
<span class=n>LocalBroadcastManager</span><span class=p>.</span><span class=n>getInstance</span><span class=p>(</span><span class=k>this</span><span class=p>).</span><span class=n>registerReceiver</span><span class=p>(</span><span class=n>mBroadcastReceiver</span><span class=p>,</span> <span class=n>intentFilter</span><span class=p>)</span>
</pre></div> <p>发送广播：</p> <div class=codehilite><pre><span></span><span class=k>val</span> <span class=py>intent</span> <span class=p>=</span> <span class=n>Intent</span><span class=p>(</span><span class=n>ACTION_TEST</span><span class=p>)</span>
<span class=n>LocalBroadcastManager</span><span class=p>.</span><span class=n>getInstance</span><span class=p>(</span><span class=k>this</span><span class=p>).</span><span class=n>sendBroadcast</span><span class=p>(</span><span class=n>intent</span><span class=p>)</span>
</pre></div> <h3 id=52>5.2 源码解析<a class=headerlink href=#52 title="Permanent link">&para;</a></h3> <p>先看看<code>LocalBroadcastManager</code>的单例方法：</p> <div class=codehilite><pre><span></span><span class=nd>@NonNull</span>
<span class=kd>public</span> <span class=kd>static</span> <span class=n>LocalBroadcastManager</span> <span class=nf>getInstance</span><span class=p>(</span><span class=nd>@NonNull</span> <span class=n>Context</span> <span class=n>context</span><span class=p>)</span> <span class=p>{</span>
    <span class=kd>synchronized</span> <span class=p>(</span><span class=n>mLock</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>mInstance</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>mInstance</span> <span class=o>=</span> <span class=k>new</span> <span class=n>LocalBroadcastManager</span><span class=p>(</span><span class=n>context</span><span class=p>.</span><span class=na>getApplicationContext</span><span class=p>());</span>
        <span class=p>}</span>
        <span class=k>return</span> <span class=n>mInstance</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>}</span>

<span class=kd>private</span> <span class=nf>LocalBroadcastManager</span><span class=p>(</span><span class=n>Context</span> <span class=n>context</span><span class=p>)</span> <span class=p>{</span>
    <span class=n>mAppContext</span> <span class=o>=</span> <span class=n>context</span><span class=p>;</span>
    <span class=n>mHandler</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Handler</span><span class=p>(</span><span class=n>context</span><span class=p>.</span><span class=na>getMainLooper</span><span class=p>())</span> <span class=p>{</span>

        <span class=nd>@Override</span>
        <span class=kd>public</span> <span class=kt>void</span> <span class=nf>handleMessage</span><span class=p>(</span><span class=n>Message</span> <span class=n>msg</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>switch</span> <span class=p>(</span><span class=n>msg</span><span class=p>.</span><span class=na>what</span><span class=p>)</span> <span class=p>{</span>
                <span class=k>case</span> <span class=n>MSG_EXEC_PENDING_BROADCASTS</span><span class=p>:</span>
                    <span class=n>executePendingBroadcasts</span><span class=p>();</span>
                    <span class=k>break</span><span class=p>;</span>
                <span class=k>default</span><span class=p>:</span>
                    <span class=kd>super</span><span class=p>.</span><span class=na>handleMessage</span><span class=p>(</span><span class=n>msg</span><span class=p>);</span>
            <span class=p>}</span>
        <span class=p>}</span>
    <span class=p>};</span>
<span class=p>}</span>
</pre></div> <p>这里<code>LocalBroadcastManager</code>采用了单例模式，在构造器中保存了一个ApplicationContext，同时初始化了一个主线程的<code>mHandler</code>。该Handler的作用就是在主线程中执行各个<code>BroadcastReceiver</code>的<code>onReceiver</code>方法，这符合我们对<code>BroadcastReceiver</code>的认知。</p> <p>在看注册方法之前，我们先看一下<code>LocalBroadcastManager</code>里面的保存BroadcastReceiver的数据结构：</p> <div class=codehilite><pre><span></span><span class=kd>private</span> <span class=kd>final</span> <span class=n>HashMap</span><span class=o>&lt;</span><span class=n>BroadcastReceiver</span><span class=p>,</span> <span class=n>ArrayList</span><span class=o>&lt;</span><span class=n>ReceiverRecord</span><span class=o>&gt;&gt;</span> <span class=n>mReceivers</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashMap</span><span class=o>&lt;&gt;</span><span class=p>();</span>
<span class=kd>private</span> <span class=kd>final</span> <span class=n>HashMap</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span> <span class=n>ArrayList</span><span class=o>&lt;</span><span class=n>ReceiverRecord</span><span class=o>&gt;&gt;</span> <span class=n>mActions</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashMap</span><span class=o>&lt;&gt;</span><span class=p>();</span>

<span class=c1>// register的两个参数会封装成为该类型</span>
<span class=kd>private</span> <span class=kd>static</span> <span class=kd>final</span> <span class=kd>class</span> <span class=nc>ReceiverRecord</span> <span class=p>{</span>
    <span class=kd>final</span> <span class=n>IntentFilter</span> <span class=n>filter</span><span class=p>;</span>
    <span class=kd>final</span> <span class=n>BroadcastReceiver</span> <span class=n>receiver</span><span class=p>;</span>
    <span class=kt>boolean</span> <span class=n>broadcasting</span><span class=p>;</span>
    <span class=kt>boolean</span> <span class=n>dead</span><span class=p>;</span>

    <span class=n>ReceiverRecord</span><span class=p>(</span><span class=n>IntentFilter</span> <span class=n>_filter</span><span class=p>,</span> <span class=n>BroadcastReceiver</span> <span class=n>_receiver</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>filter</span> <span class=o>=</span> <span class=n>_filter</span><span class=p>;</span>
        <span class=n>receiver</span> <span class=o>=</span> <span class=n>_receiver</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=p>...</span>
<span class=p>}</span>
</pre></div> <p><code>ReceiverRecord</code>就是register方法中传入的两个参数包装而成的。<br> <code>mReceivers</code>里面存放是<code>BroadcastReceiver</code>到<code>ArrayList&lt;ReceiverRecord&gt;</code>的映射，方便在注册、注销的时候使用；而<code>mActions</code>里面存放是<code>Action</code>到<code>ArrayList&lt;ReceiverRecord&gt;</code>的映射，方便发送广播时找到可以响应的<code>BroadcastReceiver</code>。</p> <p>下面继续看看注册广播的代码，代码比较简单，解释在注释中：</p> <div class=codehilite><pre><span></span><span class=kd>public</span> <span class=kt>void</span> <span class=nf>registerReceiver</span><span class=p>(</span><span class=nd>@NonNull</span> <span class=n>BroadcastReceiver</span> <span class=n>receiver</span><span class=p>,</span>
        <span class=nd>@NonNull</span> <span class=n>IntentFilter</span> <span class=n>filter</span><span class=p>)</span> <span class=p>{</span>
    <span class=kd>synchronized</span> <span class=p>(</span><span class=n>mReceivers</span><span class=p>)</span> <span class=p>{</span>
        <span class=c1>// 将入参包装为ReceiverRecord对象</span>
        <span class=n>ReceiverRecord</span> <span class=n>entry</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ReceiverRecord</span><span class=p>(</span><span class=n>filter</span><span class=p>,</span> <span class=n>receiver</span><span class=p>);</span>
        <span class=c1>// 1. receiver对应的value还没有初始化，则初始化</span>
        <span class=c1>// 2. 向receiver对应的value中添加ReceiverRecord对象</span>
        <span class=n>ArrayList</span><span class=o>&lt;</span><span class=n>ReceiverRecord</span><span class=o>&gt;</span> <span class=n>filters</span> <span class=o>=</span> <span class=n>mReceivers</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>receiver</span><span class=p>);</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>filters</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>filters</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
            <span class=n>mReceivers</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>receiver</span><span class=p>,</span> <span class=n>filters</span><span class=p>);</span>
        <span class=p>}</span>
        <span class=n>filters</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>entry</span><span class=p>);</span>
        <span class=c1>// 遍历入参filter中的actions，对于每个action</span>
        <span class=c1>// 1. action对应的value还没有初始化，则初始化</span>
        <span class=c1>// 2. 向action对应的value中添加ReceiverRecord对象</span>
        <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=n>i</span><span class=o>&lt;</span><span class=n>filter</span><span class=p>.</span><span class=na>countActions</span><span class=p>();</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>String</span> <span class=n>action</span> <span class=o>=</span> <span class=n>filter</span><span class=p>.</span><span class=na>getAction</span><span class=p>(</span><span class=n>i</span><span class=p>);</span>
            <span class=n>ArrayList</span><span class=o>&lt;</span><span class=n>ReceiverRecord</span><span class=o>&gt;</span> <span class=n>entries</span> <span class=o>=</span> <span class=n>mActions</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>action</span><span class=p>);</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>entries</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
                <span class=n>entries</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;</span><span class=n>ReceiverRecord</span><span class=o>&gt;</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
                <span class=n>mActions</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>action</span><span class=p>,</span> <span class=n>entries</span><span class=p>);</span>
            <span class=p>}</span>
            <span class=n>entries</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>entry</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>
</pre></div> <p>注销的代码也类似，这里不细说。下面看看发送广播的代码：</p> <div class=codehilite><pre><span></span><span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>sendBroadcast</span><span class=p>(</span><span class=nd>@NonNull</span> <span class=n>Intent</span> <span class=n>intent</span><span class=p>)</span> <span class=p>{</span>
    <span class=kd>synchronized</span> <span class=p>(</span><span class=n>mReceivers</span><span class=p>)</span> <span class=p>{</span>
        <span class=c1>// 获取intent中各个数据，稍后用来与IntentFilter进行匹配</span>
        <span class=kd>final</span> <span class=n>String</span> <span class=n>action</span> <span class=o>=</span> <span class=n>intent</span><span class=p>.</span><span class=na>getAction</span><span class=p>();</span>
        <span class=kd>final</span> <span class=n>String</span> <span class=n>type</span> <span class=o>=</span> <span class=n>intent</span><span class=p>.</span><span class=na>resolveTypeIfNeeded</span><span class=p>(</span>
                <span class=n>mAppContext</span><span class=p>.</span><span class=na>getContentResolver</span><span class=p>());</span>
        <span class=kd>final</span> <span class=n>Uri</span> <span class=n>data</span> <span class=o>=</span> <span class=n>intent</span><span class=p>.</span><span class=na>getData</span><span class=p>();</span>
        <span class=kd>final</span> <span class=n>String</span> <span class=n>scheme</span> <span class=o>=</span> <span class=n>intent</span><span class=p>.</span><span class=na>getScheme</span><span class=p>();</span>
        <span class=kd>final</span> <span class=n>Set</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>categories</span> <span class=o>=</span> <span class=n>intent</span><span class=p>.</span><span class=na>getCategories</span><span class=p>();</span>

        <span class=c1>// 获取action对应的ArrayList&lt;ReceiverRecord&gt;，准备进行遍历</span>
        <span class=n>ArrayList</span><span class=o>&lt;</span><span class=n>ReceiverRecord</span><span class=o>&gt;</span> <span class=n>entries</span> <span class=o>=</span> <span class=n>mActions</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>intent</span><span class=p>.</span><span class=na>getAction</span><span class=p>());</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>entries</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
            <span class=c1>// 匹配成功的结果将会保存到这里</span>
            <span class=n>ArrayList</span><span class=o>&lt;</span><span class=n>ReceiverRecord</span><span class=o>&gt;</span> <span class=n>receivers</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
            <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=n>i</span><span class=o>&lt;</span><span class=n>entries</span><span class=p>.</span><span class=na>size</span><span class=p>();</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
                <span class=n>ReceiverRecord</span> <span class=n>receiver</span> <span class=o>=</span> <span class=n>entries</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>i</span><span class=p>);</span>

                <span class=c1>// 防止一个BroadcastReceiver响应多次</span>
                <span class=k>if</span> <span class=p>(</span><span class=n>receiver</span><span class=p>.</span><span class=na>broadcasting</span><span class=p>)</span> <span class=p>{</span>
                    <span class=k>continue</span><span class=p>;</span>
                <span class=p>}</span>

                <span class=c1>// 如果匹配成功，添加到receivers数组中</span>
                <span class=c1>// 且将其broadcasting置为true，防止同一个BroadcastReceiver响应多次</span>
                <span class=kt>int</span> <span class=n>match</span> <span class=o>=</span> <span class=n>receiver</span><span class=p>.</span><span class=na>filter</span><span class=p>.</span><span class=na>match</span><span class=p>(</span><span class=n>action</span><span class=p>,</span> <span class=n>type</span><span class=p>,</span> <span class=n>scheme</span><span class=p>,</span> <span class=n>data</span><span class=p>,</span>
                        <span class=n>categories</span><span class=p>,</span> <span class=s>&quot;LocalBroadcastManager&quot;</span><span class=p>);</span>
                <span class=k>if</span> <span class=p>(</span><span class=n>match</span> <span class=o>&gt;=</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
                    <span class=k>if</span> <span class=p>(</span><span class=n>receivers</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
                        <span class=n>receivers</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;</span><span class=n>ReceiverRecord</span><span class=o>&gt;</span><span class=p>();</span>
                    <span class=p>}</span>
                    <span class=n>receivers</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>receiver</span><span class=p>);</span>
                    <span class=n>receiver</span><span class=p>.</span><span class=na>broadcasting</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
                <span class=p>}</span>
            <span class=p>}</span>

            <span class=c1>// 最后将匹配的结果里面的标志位复位，以待后面发送广播时还能接受</span>
            <span class=c1>// 同时将intent-receivers包装成为一个BroadcastRecord对象，这就是一个二元组</span>
            <span class=c1>// 最后给mHandler发送一个消息，mHandler收到消息后就会在主线程执行广播的onReceiver方法了</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>receivers</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
                <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=n>i</span><span class=o>&lt;</span><span class=n>receivers</span><span class=p>.</span><span class=na>size</span><span class=p>();</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
                    <span class=n>receivers</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>i</span><span class=p>).</span><span class=na>broadcasting</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
                <span class=p>}</span>
                <span class=c1>// mPendingBroadcasts保存的是每次发送广播后，匹配成功的广播接收者</span>
                <span class=n>mPendingBroadcasts</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=k>new</span> <span class=n>BroadcastRecord</span><span class=p>(</span><span class=n>intent</span><span class=p>,</span> <span class=n>receivers</span><span class=p>));</span>
                <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>mHandler</span><span class=p>.</span><span class=na>hasMessages</span><span class=p>(</span><span class=n>MSG_EXEC_PENDING_BROADCASTS</span><span class=p>))</span> <span class=p>{</span>
                    <span class=n>mHandler</span><span class=p>.</span><span class=na>sendEmptyMessage</span><span class=p>(</span><span class=n>MSG_EXEC_PENDING_BROADCASTS</span><span class=p>);</span>
                <span class=p>}</span>
                <span class=k>return</span> <span class=kc>true</span><span class=p>;</span>
            <span class=p>}</span>
        <span class=p>}</span>
    <span class=p>}</span>
    <span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
<span class=p>}</span>
</pre></div> <p>在上面代码的最后一段注释中，我们说到了<code>MSG_EXEC_PENDING_BROADCASTS</code>消息的作用就是让广播的<code>onReceiver</code>方法在主线程进行触发，那么我们看看是不是这么回事。<br> <code>mHandler</code>的代码在本节开头提到了，该msg会在主线程中执行<code>executePendingBroadcasts()</code>方法。我们看看是怎么进行触发的：</p> <div class=codehilite><pre><span></span><span class=kd>private</span> <span class=kt>void</span> <span class=nf>executePendingBroadcasts</span><span class=p>()</span> <span class=p>{</span>
    <span class=k>while</span> <span class=p>(</span><span class=kc>true</span><span class=p>)</span> <span class=p>{</span>
        <span class=kd>final</span> <span class=n>BroadcastRecord</span><span class=o>[]</span> <span class=n>brs</span><span class=p>;</span>
        <span class=c1>// 将mPendingBroadcasts复制到brs数组中</span>
        <span class=c1>// 注意这里加了锁，防止在复制的过程中，有新的广播发送，然后丢失新的结果</span>
        <span class=kd>synchronized</span> <span class=p>(</span><span class=n>mReceivers</span><span class=p>)</span> <span class=p>{</span>
            <span class=kd>final</span> <span class=kt>int</span> <span class=n>N</span> <span class=o>=</span> <span class=n>mPendingBroadcasts</span><span class=p>.</span><span class=na>size</span><span class=p>();</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>N</span> <span class=o>&lt;=</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
                <span class=k>return</span><span class=p>;</span>
            <span class=p>}</span>
            <span class=n>brs</span> <span class=o>=</span> <span class=k>new</span> <span class=n>BroadcastRecord</span><span class=o>[</span><span class=n>N</span><span class=o>]</span><span class=p>;</span>
            <span class=n>mPendingBroadcasts</span><span class=p>.</span><span class=na>toArray</span><span class=p>(</span><span class=n>brs</span><span class=p>);</span>
            <span class=n>mPendingBroadcasts</span><span class=p>.</span><span class=na>clear</span><span class=p>();</span>
        <span class=p>}</span>
        <span class=c1>// 遍历brs，brs中的每一项都是一次广播发送后匹配的结果</span>
        <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=n>i</span><span class=o>&lt;</span><span class=n>brs</span><span class=p>.</span><span class=na>length</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
            <span class=kd>final</span> <span class=n>BroadcastRecord</span> <span class=n>br</span> <span class=o>=</span> <span class=n>brs</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>;</span>
            <span class=c1>// 取出receivers中每一个receiver</span>
            <span class=kd>final</span> <span class=kt>int</span> <span class=n>nbr</span> <span class=o>=</span> <span class=n>br</span><span class=p>.</span><span class=na>receivers</span><span class=p>.</span><span class=na>size</span><span class=p>();</span>
            <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=n>j</span><span class=o>&lt;</span><span class=n>nbr</span><span class=p>;</span> <span class=n>j</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
                <span class=kd>final</span> <span class=n>ReceiverRecord</span> <span class=n>rec</span> <span class=o>=</span> <span class=n>br</span><span class=p>.</span><span class=na>receivers</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>j</span><span class=p>);</span>
                <span class=c1>// 如果receiver没有退订</span>
                <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>rec</span><span class=p>.</span><span class=na>dead</span><span class=p>)</span> <span class=p>{</span>
                    <span class=c1>// 调用其onReceive方法</span>
                    <span class=n>rec</span><span class=p>.</span><span class=na>receiver</span><span class=p>.</span><span class=na>onReceive</span><span class=p>(</span><span class=n>mAppContext</span><span class=p>,</span> <span class=n>br</span><span class=p>.</span><span class=na>intent</span><span class=p>);</span>
                <span class=p>}</span>
            <span class=p>}</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>
</pre></div> <p>最后注意一下，<code>LocalBroadcastManager</code>还有另外一个同步发送广播的方法 <code>sendBroadcastSync</code>：</p> <div class=codehilite><pre><span></span><span class=cm>/**</span>
<span class=cm>  * Like {@link #sendBroadcast(Intent)}, but if there are any receivers for</span>
<span class=cm>  * the Intent this function will block and immediately dispatch them before</span>
<span class=cm>  * returning.</span>
<span class=cm>  */</span>
<span class=kd>public</span> <span class=kt>void</span> <span class=nf>sendBroadcastSync</span><span class=p>(</span><span class=nd>@NonNull</span> <span class=n>Intent</span> <span class=n>intent</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>sendBroadcast</span><span class=p>(</span><span class=n>intent</span><span class=p>))</span> <span class=p>{</span>
        <span class=n>executePendingBroadcasts</span><span class=p>();</span>
    <span class=p>}</span>
<span class=p>}</span>
</pre></div> <p>我们知道<code>executePendingBroadcasts()</code>方法里面会执行<code>BroadcastReceiver.onReceive</code>方法，如果我们在子线程中调用<code>sendBroadcastSync</code>方法，那么<code>BroadcastReceiver.onReceive</code>方法也会回调在子线程中。<br> 同时，由于Handler是一个异步过程，如果前面有<code>sendBroadcast</code>方法的结果还没有来得及执行，这时调用同步<code>sendBroadcastSync</code>方法，会导致前面的结果也在子线程中进行回调了。</p> <hr> <p>下面是一个例子：</p> <div class=codehilite><pre><span></span><span class=n>Thread</span><span class=p>(</span><span class=n>Runnable</span> <span class=p>{</span>
    <span class=n>LocalBroadcastManager</span><span class=p>.</span><span class=n>getInstance</span><span class=p>(</span><span class=k>this</span><span class=p>).</span><span class=n>let</span> <span class=p>{</span>
        <span class=n>Log</span><span class=p>.</span><span class=n>e</span><span class=p>(</span><span class=n>TAG</span><span class=p>,</span> <span class=s>&quot;sendBroadcast 11111 &quot;</span><span class=p>)</span>
        <span class=n>it</span><span class=p>.</span><span class=n>sendBroadcast</span><span class=p>(</span><span class=n>intent</span><span class=p>)</span>
        <span class=n>Log</span><span class=p>.</span><span class=n>e</span><span class=p>(</span><span class=n>TAG</span><span class=p>,</span> <span class=s>&quot;sendBroadcast 22222 &quot;</span><span class=p>)</span>
        <span class=n>it</span><span class=p>.</span><span class=n>sendBroadcastSync</span><span class=p>(</span><span class=n>intent</span><span class=p>)</span>
        <span class=n>Log</span><span class=p>.</span><span class=n>e</span><span class=p>(</span><span class=n>TAG</span><span class=p>,</span> <span class=s>&quot;sendBroadcast 33333 &quot;</span><span class=p>)</span>
        <span class=n>it</span><span class=p>.</span><span class=n>sendBroadcast</span><span class=p>(</span><span class=n>intent</span><span class=p>)</span>
        <span class=n>Log</span><span class=p>.</span><span class=n>e</span><span class=p>(</span><span class=n>TAG</span><span class=p>,</span> <span class=s>&quot;sendBroadcast 44444 &quot;</span><span class=p>)</span>
        <span class=n>it</span><span class=p>.</span><span class=n>sendBroadcastSync</span><span class=p>(</span><span class=n>intent</span><span class=p>)</span>
        <span class=n>Log</span><span class=p>.</span><span class=n>e</span><span class=p>(</span><span class=n>TAG</span><span class=p>,</span> <span class=s>&quot;sendBroadcast 55555 &quot;</span><span class=p>)</span>
        <span class=n>it</span><span class=p>.</span><span class=n>sendBroadcast</span><span class=p>(</span><span class=n>intent</span><span class=p>)</span>
        <span class=n>Log</span><span class=p>.</span><span class=n>e</span><span class=p>(</span><span class=n>TAG</span><span class=p>,</span> <span class=s>&quot;sendBroadcast 66666 &quot;</span><span class=p>)</span>
    <span class=p>}</span>
<span class=p>}).</span><span class=n>start</span><span class=p>()</span>
</pre></div> <p>我们在一个子线程中按照这样的顺序发送广播：异步、同步、异步、同步、异步。操作结果如下：</p> <div class=codehilite><pre><span></span>E/ScreenOActity: sendBroadcast 11111 
E/ScreenOActity: sendBroadcast 22222 
E/ScreenOActity: onReceive action=yorek.demoandtest.screenchange.ACTION_TEST thread=Thread-5
E/ScreenOActity: onReceive action=yorek.demoandtest.screenchange.ACTION_TEST thread=Thread-5
E/ScreenOActity: sendBroadcast 33333 
E/ScreenOActity: sendBroadcast 44444 
E/ScreenOActity: onReceive action=yorek.demoandtest.screenchange.ACTION_TEST thread=Thread-5
E/ScreenOActity: onReceive action=yorek.demoandtest.screenchange.ACTION_TEST thread=Thread-5
E/ScreenOActity: sendBroadcast 55555 
E/ScreenOActity: sendBroadcast 66666 
E/ScreenOActity: onReceive action=yorek.demoandtest.screenchange.ACTION_TEST thread=main
</pre></div> <p>从结果可以看出</p> <ol> <li>异步广播的结果如果没来得及执行，会在同步广播的调用下进行执行，此时异步广播的结果也会在该线程下</li> <li>异步广播会堵塞住，直到执行完毕才会执行后面的代码</li> </ol> <hr> <div class=md-source-date> <small> 最后更新: 2020年1月14日 </small> </div> <h2 id=__comments>评论</h2> <div id=disqus_thread></div> <script>
    var disqus_config = function () {
      this.page.url = "https://blog.yorek.xyz/about-me/android/framework/Android四大组件(3)/";
      this.page.identifier =
        "/android/framework/Android四大组件(3)/";
    };
    (function() {
      var d = document, s = d.createElement("script");
      s.src = "//yorekliu.disqus.com/embed.js";
      s.setAttribute("data-timestamp", +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid"> <a href=../Android四大组件(2)/ title=Service class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> 上一页 </span> Service </span> </div> </a> <a href=../Android四大组件(4)/ title="Content Providers与Fragment" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel=next> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> 下一页 </span> Content Providers与Fragment </span> </div> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> &copy; 2020 Yorek </div> powered by <a href=https://www.mkdocs.org>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ > Material for MkDocs</a> </div> <div class=md-footer-social> <link rel=stylesheet href=../../../assets/fonts/font-awesome.css> <a href=https://github.com/YorekLiu class="md-footer-social__link fa fa-github"></a> <a href=lyytogether@gmail.com class="md-footer-social__link fa fa-email"></a> </div> </div> </div> </footer> </div> <script src=../../../assets/javascripts/application.808e90bb.js></script> <script src=../../../assets/javascripts/lunr/lunr.stemmer.support.js></script> <script src=../../../assets/javascripts/lunr/tinyseg.js></script> <script src=../../../assets/javascripts/lunr/lunr.ja.js></script> <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script> <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script> </body> </html>
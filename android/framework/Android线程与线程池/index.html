<!--
  Copyright (c) 2016-2020 Martin Donath <martin.donath@squidfunk.com>
  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:
  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.
  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
--> <!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=description content="An Android Developer."><link href=https://blog.yorek.xyz/about-me/android/framework/Android线程与线程池/ rel=canonical><meta name=author content="Yorek Liu"><meta name=lang:clipboard.copy content=复制><meta name=lang:clipboard.copied content=已复制><meta name=lang:search.language content=ja><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content=没有找到符合条件的结果><meta name=lang:search.result.one content="找到 1 个符合条件的结果"><meta name=lang:search.result.other content="# 个符合条件的结果"><meta name=lang:search.tokenizer content=[\uff0c\u3002]+><link rel="shortcut icon" href=../../../assets/images/favicon.ico><meta name=generator content="mkdocs-1.0.4, mkdocs-material-4.6.0"><title>Android线程与线程池</title><link rel=stylesheet href=../../../assets/stylesheets/application.1b62728e.css><link rel=stylesheet href=../../../assets/stylesheets/application-palette.a8b3c06d.css><meta name=theme-color content><script src=../../../assets/javascripts/modernizr.268332fc.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel=stylesheet href=../../../assets/fonts/material-icons.css><link rel=manifest href=../../../manifest.webmanifest><script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-155096376-1", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script><script async src=https://www.google-analytics.com/analytics.js></script><!-- Determine title --><!-- The image needs to have an absolute URL --><!-- Open graph meta tags --><meta property=og:type content=website><meta property=og:title content="Yorek's - Android线程与线程池"><meta property=og:description content="An Android Developer."><meta content=https://blog.yorek.xyz/about-me/android/framework/Android线程与线程池/ property=og:url><meta property=og:image content=https://blog.yorek.xyz/about-meassets/images/banner.png><meta property=og:image:type content=image/png><meta property=og:image:width content=1200><meta property=og:image:height content=630><!-- Twitter meta tags --><meta name=twitter:card content=summary_large_image><meta name=twitter:site content=@squidfunk><meta name=twitter:creator content=@squidfunk><meta name=twitter:title content="Yorek's - Android线程与线程池"><meta name=twitter:description content="An Android Developer."><meta name=twitter:image content=https://blog.yorek.xyz/about-meassets/images/banner.png></head> <body dir=ltr data-md-color-primary=white data-md-color-accent=blue> <svg class=md-svg> <defs> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#1 tabindex=1 class=md-skip> 跳转至 </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=https://blog.yorek.xyz/about-me title="Yorek's" class="md-header-nav__button md-logo"> <img src=../../../assets/images/favicon.ico width=24 height=24> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> Yorek's </span> <span class=md-header-nav__topic> Android线程与线程池 </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> 键入以开始搜索 </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container> <nav class="md-tabs md-tabs--active" data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../3rd-library/3rd-library-source-code/ class=md-tabs__link> Android </a> </li> <li class=md-tabs__item> <a href=../../../flutter/flutter_first_project_1/ class=md-tabs__link> Flutter </a> </li> <li class=md-tabs__item> <a href=../../../leetcode/ class=md-tabs__link> LeetCode </a> </li> <li class=md-tabs__item> <a href=../../../design-pattern/design-pattern/ class=md-tabs__link> Books </a> </li> </ul> </div> </nav> <main class=md-main role=main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=https://blog.yorek.xyz/about-me title="Yorek's" class="md-nav__button md-logo"> <img src=../../../assets/images/favicon.ico width=48 height=48> </a> Yorek's </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. title=Home class=md-nav__link> Home </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2 type=checkbox id=nav-2 checked> <label class=md-nav__link for=nav-2> Android </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-2> Android </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-1 type=checkbox id=nav-2-1> <label class=md-nav__link for=nav-2-1> 三方库源码解析 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-1> 三方库源码解析 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../3rd-library/3rd-library-source-code/ title=Android三方库源码分析 class=md-nav__link> Android三方库源码分析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/matrix/ title="微信APM Matrix解析" class=md-nav__link> 微信APM Matrix解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/matrix-trace/ title=Matrix-TraceCanary解析 class=md-nav__link> Matrix-TraceCanary解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/matrix-io/ title=Matrix-IOCanary解析 class=md-nav__link> Matrix-IOCanary解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/matrix-resource/ title=Matrix-ResourceCanary解析 class=md-nav__link> Matrix-ResourceCanary解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/matrix-sqlitelint/ title=Matrix-SQLiteLint解析 class=md-nav__link> Matrix-SQLiteLint解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/okhttp/ title=OkHttp3源码解析 class=md-nav__link> OkHttp3源码解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/retrofit/ title=Retrofit2源码解析 class=md-nav__link> Retrofit2源码解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/rxjava&rxandroid/ title=RxJava源码解析及使用实例 class=md-nav__link> RxJava源码解析及使用实例 </a> </li> <li class=md-nav__item> <a href=../../other/RxJava/ title=RxJava操作符大全 class=md-nav__link> RxJava操作符大全 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide1/ title="Glide v4 源码解析（一）" class=md-nav__link> Glide v4 源码解析（一） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide2/ title="Glide v4 源码解析（二）" class=md-nav__link> Glide v4 源码解析（二） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide3/ title="Glide v4 源码解析（三）" class=md-nav__link> Glide v4 源码解析（三） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide4/ title="Glide v4 源码解析（四）" class=md-nav__link> Glide v4 源码解析（四） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide5/ title="Glide v4 源码解析（五）" class=md-nav__link> Glide v4 源码解析（五） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide6/ title="Glide v4 源码解析（六）" class=md-nav__link> Glide v4 源码解析（六） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide7/ title="Glide v4 源码解析（七）" class=md-nav__link> Glide v4 源码解析（七） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/migrate-to-glide/ title=杂记：从Picasso迁移至Glide class=md-nav__link> 杂记：从Picasso迁移至Glide </a> </li> <li class=md-nav__item> <a href=../../3rd-library/eventbus/ title=EventBus源码解析 class=md-nav__link> EventBus源码解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/leakcanary/ title=LeakCanary2源码解析 class=md-nav__link> LeakCanary2源码解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/permissiondispatcher/ title=PermissionDispatcher源码解析 class=md-nav__link> PermissionDispatcher源码解析 </a> </li> <li class=md-nav__item> <a href=../../other/constraintlayout/ title=ConstraintLayout使用大全 class=md-nav__link> ConstraintLayout使用大全 </a> </li> <li class=md-nav__item> <a href=../../other/dagger2/ title=初学者的Dagger2教程 class=md-nav__link> 初学者的Dagger2教程 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-2 type=checkbox id=nav-2-2> <label class=md-nav__link for=nav-2-2> Android开发高手课 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-2> Android开发高手课 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../paid/master/ title=Android开发高手课 class=md-nav__link> Android开发高手课 </a> </li> <li class=md-nav__item> <a href=../../paid/master/crash_1/ title="01 | 崩溃优化（上）：关于“崩溃”那些事儿" class=md-nav__link> 01 | 崩溃优化（上）：关于“崩溃”那些事儿 </a> </li> <li class=md-nav__item> <a href=../../paid/master/crash_2/ title="02 | 崩溃优化（下）：应用崩溃了，你应该如何去分析？" class=md-nav__link> 02 | 崩溃优化（下）：应用崩溃了，你应该如何去分析？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/memory_1/ title="03 | 内存优化（上）：4GB内存时代，再谈内存优化" class=md-nav__link> 03 | 内存优化（上）：4GB内存时代，再谈内存优化 </a> </li> <li class=md-nav__item> <a href=../../paid/master/memory_2/ title="04 | 内存优化（下）：内存优化这件事，应该从哪里着手？" class=md-nav__link> 04 | 内存优化（下）：内存优化这件事，应该从哪里着手？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/stuck_1/ title="05 | 卡顿优化（上）：你要掌握的卡顿分析方法" class=md-nav__link> 05 | 卡顿优化（上）：你要掌握的卡顿分析方法 </a> </li> <li class=md-nav__item> <a href=../../paid/master/stuck_2/ title="06 | 卡顿优化（下）：如何监控应用卡顿？" class=md-nav__link> 06 | 卡顿优化（下）：如何监控应用卡顿？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/stuck_3/ title="06补充篇 | 卡顿优化：卡顿现场与卡顿分析" class=md-nav__link> 06补充篇 | 卡顿优化：卡顿现场与卡顿分析 </a> </li> <li class=md-nav__item> <a href=../../paid/master/start_1/ title="07 | 启动优化（上）：从启动过程看启动速度优化" class=md-nav__link> 07 | 启动优化（上）：从启动过程看启动速度优化 </a> </li> <li class=md-nav__item> <a href=../../paid/master/start_2/ title="08 | 启动优化（下）：优化启动速度的进阶方法" class=md-nav__link> 08 | 启动优化（下）：优化启动速度的进阶方法 </a> </li> <li class=md-nav__item> <a href=../../paid/master/io_1/ title="09 | I/O优化（上）：开发工程师必备的I/O优化知识" class=md-nav__link> 09 | I/O优化（上）：开发工程师必备的I/O优化知识 </a> </li> <li class=md-nav__item> <a href=../../paid/master/io_2/ title="10 | I/O优化（中）：不同I/O方式的使用场景是什么？" class=md-nav__link> 10 | I/O优化（中）：不同I/O方式的使用场景是什么？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/io_3/ title="11 | I/O优化（下）：如何监控线上I/O操作？" class=md-nav__link> 11 | I/O优化（下）：如何监控线上I/O操作？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/storage_1/ title="12 | 存储优化（上）：常见的数据存储方法有哪些？" class=md-nav__link> 12 | 存储优化（上）：常见的数据存储方法有哪些？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/storage_2/ title="13 | 存储优化（中）：如何优化数据存储？" class=md-nav__link> 13 | 存储优化（中）：如何优化数据存储？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/storage_3/ title="14 | 存储优化（下）：数据库SQLite的使用和优化" class=md-nav__link> 14 | 存储优化（下）：数据库SQLite的使用和优化 </a> </li> <li class=md-nav__item> <a href=../../paid/master/network_1/ title="15 | 网络优化（上）：移动开发工程师必备的网络优化知识" class=md-nav__link> 15 | 网络优化（上）：移动开发工程师必备的网络优化知识 </a> </li> <li class=md-nav__item> <a href=../../paid/master/network_2/ title="16 | 网络优化（中）：复杂多变的移动网络该如何优化？" class=md-nav__link> 16 | 网络优化（中）：复杂多变的移动网络该如何优化？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/network_3/ title="17 | 网络优化（下）：大数据下网络该如何监控？" class=md-nav__link> 17 | 网络优化（下）：大数据下网络该如何监控？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/battery_1/ title="18 | 耗电优化（上）：从电量优化的演进看耗电分析" class=md-nav__link> 18 | 耗电优化（上）：从电量优化的演进看耗电分析 </a> </li> <li class=md-nav__item> <a href=../../paid/master/battery_2/ title="19 | 耗电优化（下）：耗电的优化方法与线上监控" class=md-nav__link> 19 | 耗电优化（下）：耗电的优化方法与线上监控 </a> </li> <li class=md-nav__item> <a href=../../paid/master/ui_1/ title="20 | UI 优化（上）：UI 渲染的几个关键概念" class=md-nav__link> 20 | UI 优化（上）：UI 渲染的几个关键概念 </a> </li> <li class=md-nav__item> <a href=../../paid/master/ui_2/ title="21 | UI 优化（下）：如何优化 UI 渲染？" class=md-nav__link> 21 | UI 优化（下）：如何优化 UI 渲染？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/package_1/ title="22 | 包体积优化（上）：如何减少安装包大小？" class=md-nav__link> 22 | 包体积优化（上）：如何减少安装包大小？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/package_2/ title="23 | 包体积优化（下）：资源优化的进阶实践" class=md-nav__link> 23 | 包体积优化（下）：资源优化的进阶实践 </a> </li> <li class=md-nav__item> <a href=../../paid/master/compile/ title="26 | 关于编译，你需要了解什么？" class=md-nav__link> 26 | 关于编译，你需要了解什么？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/bytecode/ title="27 | 编译插桩的三种方法：AspectJ、ASM、ReDex" class=md-nav__link> 27 | 编译插桩的三种方法：AspectJ、ASM、ReDex </a> </li> <li class=md-nav__item> <a href=../../paid/master/native_hook/ title="35 | Native Hook 技术，天使还是魔鬼？" class=md-nav__link> 35 | Native Hook 技术，天使还是魔鬼？ </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-3 type=checkbox id=nav-2-3 checked> <label class=md-nav__link for=nav-2-3> Framework系列 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-3> Framework系列 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Android四大组件(1)/ title=Activity class=md-nav__link> Activity </a> </li> <li class=md-nav__item> <a href=../Android四大组件(2)/ title=Service class=md-nav__link> Service </a> </li> <li class=md-nav__item> <a href=../Android四大组件(3)/ title=Broadcasts class=md-nav__link> Broadcasts </a> </li> <li class=md-nav__item> <a href=../Android四大组件(4)/ title="Content Providers与Fragment" class=md-nav__link> Content Providers与Fragment </a> </li> <li class=md-nav__item> <a href=../IPC机制/ title=IPC机制 class=md-nav__link> IPC机制 </a> </li> <li class=md-nav__item> <a href=../View的事件体系/ title=View的事件体系 class=md-nav__link> View的事件体系 </a> </li> <li class=md-nav__item> <a href=../View的绘制原理/ title=View的绘制原理 class=md-nav__link> View的绘制原理 </a> </li> <li class=md-nav__item> <a href=../RemoteViews/ title=RemoteViews class=md-nav__link> RemoteViews </a> </li> <li class=md-nav__item> <a href=../Drawable/ title=Android中的Drawable资源 class=md-nav__link> Android中的Drawable资源 </a> </li> <li class=md-nav__item> <a href=../Android动画/ title=Android动画 class=md-nav__link> Android动画 </a> </li> <li class=md-nav__item> <a href=../Window与WindowManager/ title=Window与WindowManager class=md-nav__link> Window与WindowManager </a> </li> <li class=md-nav__item> <a href=../四大组件启动过程/ title=四大组件启动过程 class=md-nav__link> 四大组件启动过程 </a> </li> <li class=md-nav__item> <a href=../Android消息机制/ title=Android消息机制 class=md-nav__link> Android消息机制 </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-toggle md-nav__toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Android线程与线程池 </label> <a href=./ title=Android线程与线程池 class="md-nav__link md-nav__link--active"> Android线程与线程池 </a> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>目录</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#1 class=md-nav__link> 1 线程、线程池概述 </a> </li> <li class=md-nav__item> <a href=#2-android class=md-nav__link> 2 Android中线程存在形态 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#21-asynctask class=md-nav__link> 2.1 AsyncTask </a> </li> <li class=md-nav__item> <a href=#22-asynctask class=md-nav__link> 2.2 AsyncTask的工作原理 </a> </li> <li class=md-nav__item> <a href=#23-intentservice class=md-nav__link> 2.3 IntentService </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#231-handlerthread class=md-nav__link> 2.3.1 HandlerThread </a> </li> <li class=md-nav__item> <a href=#232-intentservice class=md-nav__link> 2.3.2 IntentService </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3-android class=md-nav__link> 3 Android中的线程池 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#31-threadpoolexecutor class=md-nav__link> 3.1 ThreadPoolExecutor </a> </li> <li class=md-nav__item> <a href=#32 class=md-nav__link> 3.2 线程池的分类 </a> </li> <li class=md-nav__item> <a href=#33 class=md-nav__link> 3.3 线程池线程复用原理 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#__comments class="md-nav__link md-nav__link--active"> 评论 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../Bitmap的缓存与加载/ title=Bitmap的缓存与加载 class=md-nav__link> Bitmap的缓存与加载 </a> </li> <li class=md-nav__item> <a href=../JNI与NDK/ title=JNI与NDK编程简介 class=md-nav__link> JNI与NDK编程简介 </a> </li> <li class=md-nav__item> <a href=../性能优化/ title=Android性能优化 class=md-nav__link> Android性能优化 </a> </li> <li class=md-nav__item> <a href=../binder1-mediaservice/ title=Binder深入理解——以MediaService为例 class=md-nav__link> Binder深入理解——以MediaService为例 </a> </li> <li class=md-nav__item> <a href=../binder2/ title=Binder深入理解——罗老师系列 class=md-nav__link> Binder深入理解——罗老师系列 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-4 type=checkbox id=nav-2-4> <label class=md-nav__link for=nav-2-4> 付费知识归档 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-4> 付费知识归档 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-4-1 type=checkbox id=nav-2-4-1> <label class=md-nav__link for=nav-2-4-1> 某圈问题索引 </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-2-4-1> 某圈问题索引 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../paid/zsxq/zsxq_index/ title=某圈问题索引 class=md-nav__link> 某圈问题索引 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week1-synchronized/ title=理解Java中synchronized关键词 class=md-nav__link> 理解Java中synchronized关键词 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week2-service/ title=理解Service class=md-nav__link> 理解Service </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week3-activity/ title=理解Activity的启动模式 class=md-nav__link> 理解Activity的启动模式 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week4-startActivityForResult/ title=关于startActivityForResult class=md-nav__link> 关于startActivityForResult </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week5-view/ title=关于View的知识 class=md-nav__link> 关于View的知识 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week6-gradle/ title=关于Gradle的知识 class=md-nav__link> 关于Gradle的知识 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week7-serialization/ title=关于序列化的知识 class=md-nav__link> 关于序列化的知识 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week10-classloader/ title=Android中的ClassLoader class=md-nav__link> Android中的ClassLoader </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week11-binder/ title=Binder简介 class=md-nav__link> Binder简介 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week12-retrofit-okhttp/ title=OkHttp和Retrofit的作用以及两者之间的联系 class=md-nav__link> OkHttp和Retrofit的作用以及两者之间的联系 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week14-jvm-gc/ title=JVM中垃圾回收策略 class=md-nav__link> JVM中垃圾回收策略 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week16-keep-app-alive/ title=进程保活 class=md-nav__link> 进程保活 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week17-android-components/ title=四大组件的作用以及多进程 class=md-nav__link> 四大组件的作用以及多进程 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week20-network-protocol/ title=网络协议 class=md-nav__link> 网络协议 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week21-mvc&amp;mvp&mvvm/ title=MVC、MVP和MVVM class=md-nav__link> MVC、MVP和MVVM </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week22-android-studio-build/ title="Android Studio build过程" class=md-nav__link> Android Studio build过程 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week23-load-large-bitmap/ title=大尺寸图片加载问题 class=md-nav__link> 大尺寸图片加载问题 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-5 type=checkbox id=nav-2-5> <label class=md-nav__link for=nav-2-5> 日常记录 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-5> 日常记录 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../other/annotation/ title=注解的定义及解析 class=md-nav__link> 注解的定义及解析 </a> </li> <li class=md-nav__item> <a href=../../other/best_throttle_in_mvvm/ title=这可能是MVVM中最优雅的按键防抖方案 class=md-nav__link> 这可能是MVVM中最优雅的按键防抖方案 </a> </li> <li class=md-nav__item> <a href=../../other/android-jenkins/ title="Jenkins for android" class=md-nav__link> Jenkins for android </a> </li> <li class=md-nav__item> <a href=../../other/SystemProrities/ title=普通Android程序使用SystemProrities class=md-nav__link> 普通Android程序使用SystemProrities </a> </li> <li class=md-nav__item> <a href=../../other/recyclerview-cache/ title=ListView、RecyclerView缓存策略解析 class=md-nav__link> ListView、RecyclerView缓存策略解析 </a> </li> <li class=md-nav__item> <a href=../../other/recyclerview-item-docoration/ title=RecyclerView高级特性——ItemDecoration class=md-nav__link> RecyclerView高级特性——ItemDecoration </a> </li> <li class=md-nav__item> <a href=../../other/recyclerview-others/ title=RecyclerView的一些使用细节 class=md-nav__link> RecyclerView的一些使用细节 </a> </li> <li class=md-nav__item> <a href=../../other/RecyclerView-Sort&Delete/ title=RecyclerView高级特性——拖拽排序以及滑动删除 class=md-nav__link> RecyclerView高级特性——拖拽排序以及滑动删除 </a> </li> <li class=md-nav__item> <a href=../../other/FAB-Behavior/ title=FloatingActionButton上滑隐藏下滑显示 class=md-nav__link> FloatingActionButton上滑隐藏下滑显示 </a> </li> <li class=md-nav__item> <a href=../../other/nestedscrolling/ title=NestedScrolling机制 class=md-nav__link> NestedScrolling机制 </a> </li> <li class=md-nav__item> <a href=../../other/porterduff/ title=使用Porter-Duff合成数字图像 class=md-nav__link> 使用Porter-Duff合成数字图像 </a> </li> <li class=md-nav__item> <a href=../../other/runtime/ title="Android Runtime" class=md-nav__link> Android Runtime </a> </li> <li class=md-nav__item> <a href=../../other/android_alias/ title=Android马甲包的那些事儿 class=md-nav__link> Android马甲包的那些事儿 </a> </li> <li class=md-nav__item> <a href=../../other/Android-Development-Tool/ title=Android神兵利器 class=md-nav__link> Android神兵利器 </a> </li> <li class=md-nav__item> <a href=../../other/FileProvider/ title=FileProvider class=md-nav__link> FileProvider </a> </li> <li class=md-nav__item> <a href=../../other/Android判断导航栏高度/ title=Android判断虚拟按键(导航栏)显示与否、高度以及获取屏幕实际高度 class=md-nav__link> Android判断虚拟按键(导航栏)显示与否、高度以及获取屏幕实际高度 </a> </li> <li class=md-nav__item> <a href=../../other/Android图片选择器/ title=Android图片选择器 class=md-nav__link> Android图片选择器 </a> </li> <li class=md-nav__item> <a href=../../other/Android底部导航栏框架/ title=Android原生底部导航栏 class=md-nav__link> Android原生底部导航栏 </a> </li> <li class=md-nav__item> <a href=../../other/Android搜索栏的实现/ title=Android搜索栏的实现 class=md-nav__link> Android搜索栏的实现 </a> </li> <li class=md-nav__item> <a href=../../other/Android暂停音乐播放器的播放/ title=Android暂停酷狗、网易云音乐等音乐播放器的播放 class=md-nav__link> Android暂停酷狗、网易云音乐等音乐播放器的播放 </a> </li> <li class=md-nav__item> <a href=../../other/Android滑动返回实践/ title=Android滑动返回实践 class=md-nav__link> Android滑动返回实践 </a> </li> <li class=md-nav__item> <a href=../../other/Android程序反编译/ title=MacOS下Android程序反编译 class=md-nav__link> MacOS下Android程序反编译 </a> </li> <li class=md-nav__item> <a href=../../other/Android通讯录快速读取/ title=Android通讯录快速读取 class=md-nav__link> Android通讯录快速读取 </a> </li> <li class=md-nav__item> <a href=../../other/soft-keyboard-in-app/ title=App内自定义软键盘 class=md-nav__link> App内自定义软键盘 </a> </li> <li class=md-nav__item> <a href=../../other/腾讯X5内核入坑指南/ title="腾讯TBS X5浏览器内核入坑指南" class=md-nav__link> 腾讯TBS X5浏览器内核入坑指南 </a> </li> <li class=md-nav__item> <a href=../../other/琐碎知识点/ title=琐碎知识点 class=md-nav__link> 琐碎知识点 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3 type=checkbox id=nav-3> <label class=md-nav__link for=nav-3> Flutter </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-3> Flutter </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../flutter/flutter_first_project_1/ title=年轻人的第一个Flutter程序(1) class=md-nav__link> 年轻人的第一个Flutter程序(1) </a> </li> <li class=md-nav__item> <a href=../../../flutter/flutter_first_project_2/ title=年轻人的第一个Flutter程序(2) class=md-nav__link> 年轻人的第一个Flutter程序(2) </a> </li> <li class=md-nav__item> <a href=../../../flutter/flutter_first_project_3/ title=年轻人的第一个Flutter程序(3) class=md-nav__link> 年轻人的第一个Flutter程序(3) </a> </li> <li class=md-nav__item> <a href=../../../flutter/flutter_first_project_4/ title=年轻人的第一个Flutter程序(4) class=md-nav__link> 年轻人的第一个Flutter程序(4) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4 type=checkbox id=nav-4> <label class=md-nav__link for=nav-4> LeetCode </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-4> LeetCode </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../leetcode/ title=算法目录 class=md-nav__link> 算法目录 </a> </li> <li class=md-nav__item> <a href=../../../leetcode/code_interviews_1/ title=数据结构、算法和数据操作 class=md-nav__link> 数据结构、算法和数据操作 </a> </li> <li class=md-nav__item> <a href=../../../leetcode/code_interviews_3/ title=高质量的代码 class=md-nav__link> 高质量的代码 </a> </li> <li class=md-nav__item> <a href=../../../leetcode/code_interviews_4/ title=解决问题的思路 class=md-nav__link> 解决问题的思路 </a> </li> <li class=md-nav__item> <a href=../../../leetcode/code_interviews_5/ title=优化时间和空间效率 class=md-nav__link> 优化时间和空间效率 </a> </li> <li class=md-nav__item> <a href=../../../leetcode/code_interviews_6/ title=面试中的各项能力 class=md-nav__link> 面试中的各项能力 </a> </li> <li class=md-nav__item> <a href=../../../leetcode/array/ title=Array class=md-nav__link> Array </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode1-10/ title=LeetCode(1-10) class=md-nav__link> LeetCode(1-10) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode11-20/ title=LeetCode(11-20) class=md-nav__link> LeetCode(11-20) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode21-30/ title=LeetCode(21-30) class=md-nav__link> LeetCode(21-30) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode31-40/ title=LeetCode(31-40) class=md-nav__link> LeetCode(31-40) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode41-50/ title=LeetCode(41-50) class=md-nav__link> LeetCode(41-50) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode51-60/ title=LeetCode(51-60) class=md-nav__link> LeetCode(51-60) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode61-70/ title=LeetCode(61-70) class=md-nav__link> LeetCode(61-70) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode71-80/ title=LeetCode(71-80) class=md-nav__link> LeetCode(71-80) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode81-90/ title=LeetCode(81-90) class=md-nav__link> LeetCode(81-90) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode91-100/ title=LeetCode(91-100) class=md-nav__link> LeetCode(91-100) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode101-110/ title=LeetCode(101-110) class=md-nav__link> LeetCode(101-110) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode111-120/ title=LeetCode(111-120) class=md-nav__link> LeetCode(111-120) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5 type=checkbox id=nav-5> <label class=md-nav__link for=nav-5> Books </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-5> Books </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-1 type=checkbox id=nav-5-1> <label class=md-nav__link for=nav-5-1> Design Pattern </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-1> Design Pattern </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../design-pattern/design-pattern/ title=设计模式概述 class=md-nav__link> 设计模式概述 </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/design-principle/ title=面向对象的六大原则 class=md-nav__link> 面向对象的六大原则 </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/singleton/ title=单例模式(Singleton) class=md-nav__link> 单例模式(Singleton) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/builder/ title=建造者模式(Builder) class=md-nav__link> 建造者模式(Builder) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/prototype/ title=原型模式(Prototype) class=md-nav__link> 原型模式(Prototype) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/factory-method/ title="工厂方法模式(Factory method)" class=md-nav__link> 工厂方法模式(Factory method) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/abstract-factory/ title="抽象工厂模式(Abstract factory)" class=md-nav__link> 抽象工厂模式(Abstract factory) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/proxy/ title=代理模式(Proxy) class=md-nav__link> 代理模式(Proxy) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/composite/ title=组合模式(Composite) class=md-nav__link> 组合模式(Composite) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/adapter/ title=适配器模式(Adapter) class=md-nav__link> 适配器模式(Adapter) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/decorator/ title=装饰模式(Decorator) class=md-nav__link> 装饰模式(Decorator) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/flyweight/ title=享元模式(Flyweight) class=md-nav__link> 享元模式(Flyweight) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/facade/ title=外观模式(Facade) class=md-nav__link> 外观模式(Facade) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/bridge/ title=桥接模式(Bridge) class=md-nav__link> 桥接模式(Bridge) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/strategy/ title=策略模式(Strategy) class=md-nav__link> 策略模式(Strategy) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/state/ title=状态模式(State) class=md-nav__link> 状态模式(State) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/chain-of-responsibility/ title="责任链模式(Chain of responsibility)" class=md-nav__link> 责任链模式(Chain of responsibility) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/interpreter/ title=解释器模式(Interpreter) class=md-nav__link> 解释器模式(Interpreter) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/command/ title=命令模式(Command) class=md-nav__link> 命令模式(Command) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/observer/ title=观察者模式(Observer) class=md-nav__link> 观察者模式(Observer) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/memento/ title=备忘录模式(Memento) class=md-nav__link> 备忘录模式(Memento) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/iterator/ title=迭代器模式(Iterator) class=md-nav__link> 迭代器模式(Iterator) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/template-method/ title="模版方法模式(Template method)" class=md-nav__link> 模版方法模式(Template method) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/visitor/ title=访问者模式(Visitor) class=md-nav__link> 访问者模式(Visitor) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/mediator/ title=中介者模式(Mediator) class=md-nav__link> 中介者模式(Mediator) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/confusing-design-pattern/ title=易混淆的设计模式 class=md-nav__link> 易混淆的设计模式 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2 type=checkbox id=nav-5-2> <label class=md-nav__link for=nav-5-2> Effective Java </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-2> Effective Java </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../effective-java/effective-java/ title="Effective Java概述" class=md-nav__link> Effective Java概述 </a> </li> <li class=md-nav__item> <a href=../../../effective-java/chapter1/ title=创建和销毁对象 class=md-nav__link> 创建和销毁对象 </a> </li> <li class=md-nav__item> <a href=../../../effective-java/chapter2/ title=对于所有对象都通用的方法 class=md-nav__link> 对于所有对象都通用的方法 </a> </li> <li class=md-nav__item> <a href=../../../effective-java/chapter3/ title=类和接口 class=md-nav__link> 类和接口 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-3 type=checkbox id=nav-5-3> <label class=md-nav__link for=nav-5-3> JVM </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-3> JVM </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../jvm/jvm-content/ title=深入理解Java虚拟机 class=md-nav__link> 深入理解Java虚拟机 </a> </li> <li class=md-nav__item> <a href=../../../jvm/java-memory-area-oom/ title=Java内存区域与内存溢出异常 class=md-nav__link> Java内存区域与内存溢出异常 </a> </li> <li class=md-nav__item> <a href=../../../jvm/java-gc/ title=垃圾收集器与内存分配策略 class=md-nav__link> 垃圾收集器与内存分配策略 </a> </li> <li class=md-nav__item> <a href=../../../jvm/class-struct/ title=类文件结构 class=md-nav__link> 类文件结构 </a> </li> <li class=md-nav__item> <a href=../../../jvm/load-class/ title=虚拟机类加载机制 class=md-nav__link> 虚拟机类加载机制 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-4 type=checkbox id=nav-5-4> <label class=md-nav__link for=nav-5-4> Java </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-4> Java </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../java/generics-java-kotlin/ title=Java&Kotlin在泛型方面的区别 class=md-nav__link> Java&Kotlin在泛型方面的区别 </a> </li> <li class=md-nav__item> <a href=../../../java/java-collections/ title=Java集合总结 class=md-nav__link> Java集合总结 </a> </li> <li class=md-nav__item> <a href=../../../java/java-foundation/ title=Java常见概念 class=md-nav__link> Java常见概念 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-5 type=checkbox id=nav-5-5> <label class=md-nav__link for=nav-5-5> Refactoring </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-5> Refactoring </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../refactoring/refactoring/ title=重构：改善既有代码的设计 class=md-nav__link> 重构：改善既有代码的设计 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>目录</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#1 class=md-nav__link> 1 线程、线程池概述 </a> </li> <li class=md-nav__item> <a href=#2-android class=md-nav__link> 2 Android中线程存在形态 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#21-asynctask class=md-nav__link> 2.1 AsyncTask </a> </li> <li class=md-nav__item> <a href=#22-asynctask class=md-nav__link> 2.2 AsyncTask的工作原理 </a> </li> <li class=md-nav__item> <a href=#23-intentservice class=md-nav__link> 2.3 IntentService </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#231-handlerthread class=md-nav__link> 2.3.1 HandlerThread </a> </li> <li class=md-nav__item> <a href=#232-intentservice class=md-nav__link> 2.3.2 IntentService </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3-android class=md-nav__link> 3 Android中的线程池 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#31-threadpoolexecutor class=md-nav__link> 3.1 ThreadPoolExecutor </a> </li> <li class=md-nav__item> <a href=#32 class=md-nav__link> 3.2 线程池的分类 </a> </li> <li class=md-nav__item> <a href=#33 class=md-nav__link> 3.3 线程池线程复用原理 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#__comments class="md-nav__link md-nav__link--active"> 评论 </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <h1>Android线程与线程池</h1> <p>本章代码基于Android 7.1。</p> <h2 id=1>1 线程、线程池概述<a class=headerlink href=#1 title="Permanent link">&para;</a></h2> <p>在Android中，线程分为主线程和子线程，主线程主要处理UI操作，耗时任务必须放在子线程中。</p> <p>除了Thread外，Android中扮演线程角色的还有很多，比如<code>AsyncTask</code>、<code>IntentService</code>，同时<code>HandlerThread</code>也是一种特殊的线程。对于<code>AsyncTask</code>，其底部用到了线程池，对于<code>IntentService</code>和<code>HandlerThread</code>来说，它们的底部直接使用了子线程。</p> <p>不同形式的线程虽然都是线程，但是它们具有不用的特点：</p> <ul> <li><code>AsyncTask</code>封装了线程池和Handler，它主要是为了开发者在子线程中更新UI。</li> <li><code>IntentService</code>是一个Service，系统使用了HandlerThread封装，这样可以方便的执行后台任务。当任务执行完成后，<code>IntentService</code>会自动退出。<code>IntentService</code>作用很像一个后台线程，但又因为它是一个Service，因此**不容易被系统杀死**从而尽量保证任务的执行；如果执行使用后台线程，由于这个时候没有活动的四大组件，那么这个进程的优先级会非常低，容易被系统杀死，这就是<code>IntentService</code>的特点。</li> </ul> <p>线程池会缓存一定数量的线程，通过线程池就可以避免因为频繁创建和销毁线程所带来的系统开销。Android中线程池来源于Java，主要是通过<code>Executor</code>来派生特定类型的线程池，不同类型的线程池又具有各自的特性。</p> <h2 id=2-android>2 Android中线程存在形态<a class=headerlink href=#2-android title="Permanent link">&para;</a></h2> <p>Android中的线程除了传统的<code>Thread</code>外，还包含<code>AsyncTask</code>、<code>HandlerThread</code>、<code>IntentService</code>。</p> <p>AsyncTask简化了在子线程中访问UI的过程，但是AsyncTask经过了几次修改，导致了不同API版本AsyncTask具有不同的表现，尤其在多任务的并发执行上。</p> <h3 id=21-asynctask>2.1 AsyncTask<a class=headerlink href=#21-asynctask title="Permanent link">&para;</a></h3> <p>AsyncTask是一种轻量级的异步执行任务类，它可以在线程池中执行后台任务，然后把执行的进度和最终结果传递给主线程并在主线程中更新UI。<br> <strong>AsyncTask封装了Thread和Handler，这使得它可以更加方便的执行后台任务以及在主线程中访问UI。</strong><br> 但是AsyncTask不适合进行特别耗时的后台任务，对于特别耗时的后台任务，建议使用线程池。 </p> <p>AsyncTask是一个抽象泛型类，它有三个泛型参数，Params表示传入参数类型，Progress表示后台任务执行进度的类型，Result表示后台任务的返回结果的类型。如果AsyncTask不需要传递具体的参数，可以使用Void代替。</p> <div class=codehilite><pre><span></span><span class=kd>public</span> <span class=kd>abstract</span> <span class=kd>class</span> <span class=nc>AsyncTask</span><span class=o>&lt;</span><span class=n>Params</span><span class=p>,</span> <span class=n>Progress</span><span class=p>,</span> <span class=n>Result</span><span class=o>&gt;</span>
</pre></div> <p>AsyncTask提供了4个核心方法，它们的含义如下所示：</p> <div class=codehilite><pre><span></span><span class=nd>@WorkerThread</span>
<span class=kd>protected</span> <span class=kd>abstract</span> <span class=n>Result</span> <span class=nf>doInBackground</span><span class=p>(</span><span class=n>Params</span><span class=p>...</span> <span class=n>params</span><span class=p>);</span>

<span class=nd>@MainThread</span>
<span class=kd>protected</span> <span class=kt>void</span> <span class=nf>onPreExecute</span><span class=p>()</span> <span class=p>{}</span>

<span class=nd>@MainThread</span>
<span class=kd>protected</span> <span class=kt>void</span> <span class=nf>onPostExecute</span><span class=p>(</span><span class=n>Result</span> <span class=n>result</span><span class=p>)</span> <span class=p>{}</span>

<span class=nd>@MainThread</span>
<span class=kd>protected</span> <span class=kt>void</span> <span class=nf>onProgressUpdate</span><span class=p>(</span><span class=n>Progress</span><span class=p>...</span> <span class=n>values</span><span class=p>)</span> <span class=p>{}</span>
</pre></div> <ul> <li><code>onPreExecute</code><br> 在主线程执行，在异步任务执行之前，此方法会被调用，一般做些准备工作。</li> <li><code>doInBackground</code><br> 在工作线程中执行，此方法用于执行异步任务。在此方法中可以使用<code>publishProgress</code>来更新任务的进度，<code>publishProgress</code>会调用<code>onProgressUpdate</code>方法。此方法的返回结果会传递给<code>onPostExecute</code>方法，当然如果异步任务被取消，那么结果会返回给<code>onCancelled(Result)</code>。</li> <li><code>onProgressUpdate</code><br> 在主线程中执行，当后台任务的执行进度发生改变时，此方法会被调用</li> <li><code>onPostExecute</code><br> 在主线程中执行，在异步任务完成后，该方法会被调用。</li> </ul> <p>下面是一个典型的例子： <div class=codehilite><pre><span></span> <span class=kd>private</span> <span class=kd>class</span> <span class=nc>DownloadFilesTask</span> <span class=kd>extends</span> <span class=n>AsyncTask</span><span class=o>&lt;</span><span class=n>URL</span><span class=p>,</span> <span class=n>Integer</span><span class=p>,</span> <span class=n>Long</span><span class=o>&gt;</span> <span class=p>{</span>
     <span class=kd>protected</span> <span class=n>Long</span> <span class=nf>doInBackground</span><span class=p>(</span><span class=n>URL</span><span class=p>...</span> <span class=n>urls</span><span class=p>)</span> <span class=p>{</span>
         <span class=kt>int</span> <span class=n>count</span> <span class=o>=</span> <span class=n>urls</span><span class=p>.</span><span class=na>length</span><span class=p>;</span>
         <span class=kt>long</span> <span class=n>totalSize</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
         <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>count</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
             <span class=n>totalSize</span> <span class=o>+=</span> <span class=n>Downloader</span><span class=p>.</span><span class=na>downloadFile</span><span class=p>(</span><span class=n>urls</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>);</span>
             <span class=n>publishProgress</span><span class=p>((</span><span class=kt>int</span><span class=p>)</span> <span class=p>((</span><span class=n>i</span> <span class=o>/</span> <span class=p>(</span><span class=kt>float</span><span class=p>)</span> <span class=n>count</span><span class=p>)</span> <span class=o>*</span> <span class=mi>100</span><span class=p>));</span>
             <span class=c1>// Escape early if cancel() is called</span>
             <span class=k>if</span> <span class=p>(</span><span class=n>isCancelled</span><span class=p>())</span> <span class=k>break</span><span class=p>;</span>
         <span class=p>}</span>
         <span class=k>return</span> <span class=n>totalSize</span><span class=p>;</span>
     <span class=p>}</span>

     <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>onProgressUpdate</span><span class=p>(</span><span class=n>Integer</span><span class=p>...</span> <span class=n>progress</span><span class=p>)</span> <span class=p>{</span>
         <span class=n>setProgressPercent</span><span class=p>(</span><span class=n>progress</span><span class=o>[</span><span class=mi>0</span><span class=o>]</span><span class=p>);</span>
     <span class=p>}</span>

     <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>onPostExecute</span><span class=p>(</span><span class=n>Long</span> <span class=n>result</span><span class=p>)</span> <span class=p>{</span>
         <span class=n>showDialog</span><span class=p>(</span><span class=s>&quot;Downloaded &quot;</span> <span class=o>+</span> <span class=n>result</span> <span class=o>+</span> <span class=s>&quot; bytes&quot;</span><span class=p>);</span>
     <span class=p>}</span>
 <span class=p>}</span>
</pre></div> 执行该任务也非常简单： <div class=codehilite><pre><span></span><span class=k>new</span> <span class=n>DownloadFilesTask</span><span class=p>().</span><span class=na>execute</span><span class=p>(</span><span class=n>url1</span><span class=p>,</span> <span class=n>url2</span><span class=p>,</span> <span class=n>url3</span><span class=p>);</span>
</pre></div></p> <p>AsyncTask有一些使用注意事项：</p> <ol> <li>AsyncTask必须在主线程中加载，这在JB(Android 4.1)中已经自动完成了 <a href=http://androidxref.com/4.0.4/xref/frameworks/base/core/java/android/app/ActivityThread.java#4401>ICS</a> <a href=http://androidxref.com/4.1.1/xref/frameworks/base/core/java/android/app/ActivityThread.java#4720>JB</a> 。在JB之后的ActivityThread的<code>main</code>方法中，会调用<code>AsyncTask.init();</code>。</li> <li>AsyncTask对象实例必须在UI线程中创建。</li> <li><code>execute</code>方法必须在UI线程调用。</li> <li>不要手动调用<code>onPreExecute</code>、<code>onPostExecute</code>、<code>doInBackground</code>、<code>onProgressUpdate</code>方法；但有需要，可以手动调用<code>publishProgress</code>方法</li> <li>一个AsyncTask只能执行一次</li> <li><strong>刚开始引入时</strong>，AsyncTask是单一后台线程**串行**执行的。从**Android 1.6(DONUT)**开始，AsyncTask采用了线程池**并行**处理任务。从**Android 3.0(HONEYCOMB)**开始，又变回了采用一个线程来**串行**处理任务。</li> </ol> <blockquote> <p>如果想要并行执行，我们可以通过调用<code>executeOnExecutor</code>来使用THREAD_POOL_EXECUTOR执行任务。</p> </blockquote> <p><code>THREAD_POOL_EXECUTOR</code>是一个核心线程clamp在[2, 4]之间的允许核心线程超时的线程池，对应的初始化代码如下：</p> <div class=codehilite><pre><span></span><span class=kd>private</span> <span class=kd>static</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>CPU_COUNT</span> <span class=o>=</span> <span class=n>Runtime</span><span class=p>.</span><span class=na>getRuntime</span><span class=p>().</span><span class=na>availableProcessors</span><span class=p>();</span>
<span class=c1>// We want at least 2 threads and at most 4 threads in the core pool,</span>
<span class=c1>// preferring to have 1 less than the CPU count to avoid saturating</span>
<span class=c1>// the CPU with background work</span>
<span class=kd>private</span> <span class=kd>static</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>CORE_POOL_SIZE</span> <span class=o>=</span> <span class=n>Math</span><span class=p>.</span><span class=na>max</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=n>Math</span><span class=p>.</span><span class=na>min</span><span class=p>(</span><span class=n>CPU_COUNT</span> <span class=o>-</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>4</span><span class=p>));</span>
<span class=kd>private</span> <span class=kd>static</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>MAXIMUM_POOL_SIZE</span> <span class=o>=</span> <span class=n>CPU_COUNT</span> <span class=o>*</span> <span class=mi>2</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>
<span class=kd>private</span> <span class=kd>static</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>KEEP_ALIVE_SECONDS</span> <span class=o>=</span> <span class=mi>30</span><span class=p>;</span>

<span class=kd>private</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>BlockingQueue</span><span class=o>&lt;</span><span class=n>Runnable</span><span class=o>&gt;</span> <span class=n>sPoolWorkQueue</span> <span class=o>=</span>
            <span class=k>new</span> <span class=n>LinkedBlockingQueue</span><span class=o>&lt;</span><span class=n>Runnable</span><span class=o>&gt;</span><span class=p>(</span><span class=mi>128</span><span class=p>);</span>

<span class=kd>public</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>Executor</span> <span class=n>THREAD_POOL_EXECUTOR</span><span class=p>;</span>

<span class=kd>static</span> <span class=p>{</span>
    <span class=n>ThreadPoolExecutor</span> <span class=n>threadPoolExecutor</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ThreadPoolExecutor</span><span class=p>(</span>
            <span class=n>CORE_POOL_SIZE</span><span class=p>,</span> <span class=n>MAXIMUM_POOL_SIZE</span><span class=p>,</span> <span class=n>KEEP_ALIVE_SECONDS</span><span class=p>,</span> <span class=n>TimeUnit</span><span class=p>.</span><span class=na>SECONDS</span><span class=p>,</span>
            <span class=n>sPoolWorkQueue</span><span class=p>,</span> <span class=n>sThreadFactory</span><span class=p>);</span>
    <span class=n>threadPoolExecutor</span><span class=p>.</span><span class=na>allowCoreThreadTimeOut</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span>
    <span class=n>THREAD_POOL_EXECUTOR</span> <span class=o>=</span> <span class=n>threadPoolExecutor</span><span class=p>;</span>
<span class=p>}</span>
</pre></div> <h3 id=22-asynctask>2.2 AsyncTask的工作原理<a class=headerlink href=#22-asynctask title="Permanent link">&para;</a></h3> <p>AsyncTask的工作原理还是从<code>execute</code>方法开始： <div class=codehilite><pre><span></span><span class=nd>@MainThread</span>
<span class=kd>public</span> <span class=kd>final</span> <span class=n>AsyncTask</span><span class=o>&lt;</span><span class=n>Params</span><span class=p>,</span> <span class=n>Progress</span><span class=p>,</span> <span class=n>Result</span><span class=o>&gt;</span> <span class=nf>execute</span><span class=p>(</span><span class=n>Params</span><span class=p>...</span> <span class=n>params</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>return</span> <span class=n>executeOnExecutor</span><span class=p>(</span><span class=n>sDefaultExecutor</span><span class=p>,</span> <span class=n>params</span><span class=p>);</span>
<span class=p>}</span>

<span class=nd>@MainThread</span>
<span class=kd>public</span> <span class=kd>final</span> <span class=n>AsyncTask</span><span class=o>&lt;</span><span class=n>Params</span><span class=p>,</span> <span class=n>Progress</span><span class=p>,</span> <span class=n>Result</span><span class=o>&gt;</span> <span class=nf>executeOnExecutor</span><span class=p>(</span><span class=n>Executor</span> <span class=n>exec</span><span class=p>,</span>
        <span class=n>Params</span><span class=p>...</span> <span class=n>params</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>mStatus</span> <span class=o>!=</span> <span class=n>Status</span><span class=p>.</span><span class=na>PENDING</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>switch</span> <span class=p>(</span><span class=n>mStatus</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>case</span> <span class=n>RUNNING</span><span class=p>:</span>
                <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalStateException</span><span class=p>(</span><span class=s>&quot;Cannot execute task:&quot;</span>
                        <span class=o>+</span> <span class=s>&quot; the task is already running.&quot;</span><span class=p>);</span>
            <span class=k>case</span> <span class=n>FINISHED</span><span class=p>:</span>
                <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalStateException</span><span class=p>(</span><span class=s>&quot;Cannot execute task:&quot;</span>
                        <span class=o>+</span> <span class=s>&quot; the task has already been executed &quot;</span>
                        <span class=o>+</span> <span class=s>&quot;(a task can be executed only once)&quot;</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>}</span>

    <span class=n>mStatus</span> <span class=o>=</span> <span class=n>Status</span><span class=p>.</span><span class=na>RUNNING</span><span class=p>;</span>

    <span class=n>onPreExecute</span><span class=p>();</span>

    <span class=n>mWorker</span><span class=p>.</span><span class=na>mParams</span> <span class=o>=</span> <span class=n>params</span><span class=p>;</span>
    <span class=n>exec</span><span class=p>.</span><span class=na>execute</span><span class=p>(</span><span class=n>mFuture</span><span class=p>);</span>

    <span class=k>return</span> <span class=k>this</span><span class=p>;</span>
<span class=p>}</span>
</pre></div> <code>execute</code>方法执行调用了<code>executeOnExecutor</code>，在<code>executeOnExecutor</code>方法中先调用了<code>onPreExecute</code>方法，然后在调用<code>exec.execute(mFuture)</code>开始执行任务。</p> <p>我们看一下sDefaultExecutor： <div class=codehilite><pre><span></span><span class=kd>private</span> <span class=kd>static</span> <span class=kd>volatile</span> <span class=n>Executor</span> <span class=n>sDefaultExecutor</span> <span class=o>=</span> <span class=n>SERIAL_EXECUTOR</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>Executor</span> <span class=n>SERIAL_EXECUTOR</span> <span class=o>=</span> <span class=k>new</span> <span class=n>SerialExecutor</span><span class=p>();</span>

<span class=kd>private</span> <span class=kd>static</span> <span class=kd>class</span> <span class=nc>SerialExecutor</span> <span class=kd>implements</span> <span class=n>Executor</span> <span class=p>{</span>
    <span class=kd>final</span> <span class=n>ArrayDeque</span><span class=o>&lt;</span><span class=n>Runnable</span><span class=o>&gt;</span> <span class=n>mTasks</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayDeque</span><span class=o>&lt;</span><span class=n>Runnable</span><span class=o>&gt;</span><span class=p>();</span>
    <span class=n>Runnable</span> <span class=n>mActive</span><span class=p>;</span>

    <span class=kd>public</span> <span class=kd>synchronized</span> <span class=kt>void</span> <span class=nf>execute</span><span class=p>(</span><span class=kd>final</span> <span class=n>Runnable</span> <span class=n>r</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>mTasks</span><span class=p>.</span><span class=na>offer</span><span class=p>(</span><span class=k>new</span> <span class=n>Runnable</span><span class=p>()</span> <span class=p>{</span>
            <span class=kd>public</span> <span class=kt>void</span> <span class=nf>run</span><span class=p>()</span> <span class=p>{</span>
                <span class=k>try</span> <span class=p>{</span>
                    <span class=n>r</span><span class=p>.</span><span class=na>run</span><span class=p>();</span>
                <span class=p>}</span> <span class=k>finally</span> <span class=p>{</span>
                    <span class=n>scheduleNext</span><span class=p>();</span>
                <span class=p>}</span>
            <span class=p>}</span>
        <span class=p>});</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>mActive</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>scheduleNext</span><span class=p>();</span>
        <span class=p>}</span>
    <span class=p>}</span>

    <span class=kd>protected</span> <span class=kd>synchronized</span> <span class=kt>void</span> <span class=nf>scheduleNext</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>if</span> <span class=p>((</span><span class=n>mActive</span> <span class=o>=</span> <span class=n>mTasks</span><span class=p>.</span><span class=na>poll</span><span class=p>())</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>THREAD_POOL_EXECUTOR</span><span class=p>.</span><span class=na>execute</span><span class=p>(</span><span class=n>mActive</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>
</pre></div> sDefaultExecutor就是一个串行线程池，一个进程中所有的<code>AsyncTask</code>全部在这个串行线程池中排队执行。</p> <p><code>FutureTask</code>继承至<code>Runnable</code>，它是一个并发类。AsyncTask的Params参数先被赋值给<code>mWorker.mParams</code>，<code>mWorker</code>会被封装成为一个<code>FutureTask</code>。在<code>SERIAL_EXECUTOR</code>的<code>execute</code>方法中会把对象<code>offer</code>到任务队列<code>mTasks</code>中，如果这时候没有活动的<code>AsyncTask</code>任务（<code>mActive == null</code>），那么会调用<code>scheduleNext</code>方法来执行下一个<code>AsyncTask</code>任务（<code>mActive = mTasks.poll()</code>）。因此，从这里可以看出，默认情况下<code>AsyncTask</code>是串行执行的。</p> <p><code>AsyncTask</code>任务有两个线程池（<code>SerialExecutor</code>和<code>THREAD_POOL_EXECUTOR</code>），其中前者用来任务的排队，后者用于真正的执行任务。<code>AsyncTask</code>里面还有一个InternalHandler，它用于将执行环境从线程池切换到主线程。</p> <p>接下来我们看一下<code>FutureTask</code>的<code>run</code>方法。此方法会调用<code>mWorker.call</code>，在AsyncTask的构造方法中，可以看到下面这段代码： <div class=codehilite><pre><span></span><span class=n>mWorker</span> <span class=o>=</span> <span class=k>new</span> <span class=n>WorkerRunnable</span><span class=o>&lt;</span><span class=n>Params</span><span class=p>,</span> <span class=n>Result</span><span class=o>&gt;</span><span class=p>()</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=n>Result</span> <span class=nf>call</span><span class=p>()</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=p>{</span>
        <span class=n>mTaskInvoked</span><span class=p>.</span><span class=na>set</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span>
        <span class=n>Result</span> <span class=n>result</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
        <span class=k>try</span> <span class=p>{</span>
            <span class=n>Process</span><span class=p>.</span><span class=na>setThreadPriority</span><span class=p>(</span><span class=n>Process</span><span class=p>.</span><span class=na>THREAD_PRIORITY_BACKGROUND</span><span class=p>);</span>
            <span class=c1>//noinspection unchecked</span>
            <span class=n>result</span> <span class=o>=</span> <span class=n>doInBackground</span><span class=p>(</span><span class=n>mParams</span><span class=p>);</span>
            <span class=n>Binder</span><span class=p>.</span><span class=na>flushPendingCommands</span><span class=p>();</span>
        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>Throwable</span> <span class=n>tr</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>mCancelled</span><span class=p>.</span><span class=na>set</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span>
            <span class=k>throw</span> <span class=n>tr</span><span class=p>;</span>
        <span class=p>}</span> <span class=k>finally</span> <span class=p>{</span>
            <span class=n>postResult</span><span class=p>(</span><span class=n>result</span><span class=p>);</span>
        <span class=p>}</span>
        <span class=k>return</span> <span class=n>result</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>};</span>
</pre></div> 在该方法中首先会将<code>mTaskInvoked</code>设置为true，这表示当前任务已经被调用过了。然后在执行AsyncTask的<code>doInBackground</code>方法，如果执行出现了异常，那么<code>mCancelled</code>设置为true，并且抛出异常。在最后调用<code>postResult</code>将计算结果传出去。我们看一下<code>postResult</code>方法： <div class=codehilite><pre><span></span><span class=kd>private</span> <span class=n>Result</span> <span class=nf>postResult</span><span class=p>(</span><span class=n>Result</span> <span class=n>result</span><span class=p>)</span> <span class=p>{</span>
    <span class=nd>@SuppressWarnings</span><span class=p>(</span><span class=s>&quot;unchecked&quot;</span><span class=p>)</span>
    <span class=n>Message</span> <span class=n>message</span> <span class=o>=</span> <span class=n>getHandler</span><span class=p>().</span><span class=na>obtainMessage</span><span class=p>(</span><span class=n>MESSAGE_POST_RESULT</span><span class=p>,</span>
            <span class=k>new</span> <span class=n>AsyncTaskResult</span><span class=o>&lt;</span><span class=n>Result</span><span class=o>&gt;</span><span class=p>(</span><span class=k>this</span><span class=p>,</span> <span class=n>result</span><span class=p>));</span>
    <span class=n>message</span><span class=p>.</span><span class=na>sendToTarget</span><span class=p>();</span>
    <span class=k>return</span> <span class=n>result</span><span class=p>;</span>
<span class=p>}</span>
</pre></div> 我们可以看到，该方法会通过<code>sHandler</code>发送一个MESSAGE_POST_RESULT消息。接着看<code>sHandler</code>的实现： <div class=codehilite><pre><span></span><span class=kd>private</span> <span class=kd>static</span> <span class=n>InternalHandler</span> <span class=n>sHandler</span><span class=p>;</span>

<span class=kd>private</span> <span class=kd>static</span> <span class=n>Handler</span> <span class=nf>getHandler</span><span class=p>()</span> <span class=p>{</span>
    <span class=kd>synchronized</span> <span class=p>(</span><span class=n>AsyncTask</span><span class=p>.</span><span class=na>class</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>sHandler</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>sHandler</span> <span class=o>=</span> <span class=k>new</span> <span class=n>InternalHandler</span><span class=p>();</span>
        <span class=p>}</span>
        <span class=k>return</span> <span class=n>sHandler</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>}</span>

<span class=kd>private</span> <span class=kd>static</span> <span class=kd>class</span> <span class=nc>InternalHandler</span> <span class=kd>extends</span> <span class=n>Handler</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=nf>InternalHandler</span><span class=p>()</span> <span class=p>{</span>
        <span class=kd>super</span><span class=p>(</span><span class=n>Looper</span><span class=p>.</span><span class=na>getMainLooper</span><span class=p>());</span>
    <span class=p>}</span>

    <span class=nd>@SuppressWarnings</span><span class=p>({</span><span class=s>&quot;unchecked&quot;</span><span class=p>,</span> <span class=s>&quot;RawUseOfParameterizedType&quot;</span><span class=p>})</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>handleMessage</span><span class=p>(</span><span class=n>Message</span> <span class=n>msg</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>AsyncTaskResult</span><span class=o>&lt;?&gt;</span> <span class=n>result</span> <span class=o>=</span> <span class=p>(</span><span class=n>AsyncTaskResult</span><span class=o>&lt;?&gt;</span><span class=p>)</span> <span class=n>msg</span><span class=p>.</span><span class=na>obj</span><span class=p>;</span>
        <span class=k>switch</span> <span class=p>(</span><span class=n>msg</span><span class=p>.</span><span class=na>what</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>case</span> <span class=n>MESSAGE_POST_RESULT</span><span class=p>:</span>
                <span class=c1>// There is only one result</span>
                <span class=n>result</span><span class=p>.</span><span class=na>mTask</span><span class=p>.</span><span class=na>finish</span><span class=p>(</span><span class=n>result</span><span class=p>.</span><span class=na>mData</span><span class=o>[</span><span class=mi>0</span><span class=o>]</span><span class=p>);</span>
                <span class=k>break</span><span class=p>;</span>
            <span class=k>case</span> <span class=n>MESSAGE_POST_PROGRESS</span><span class=p>:</span>
                <span class=n>result</span><span class=p>.</span><span class=na>mTask</span><span class=p>.</span><span class=na>onProgressUpdate</span><span class=p>(</span><span class=n>result</span><span class=p>.</span><span class=na>mData</span><span class=p>);</span>
                <span class=k>break</span><span class=p>;</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>
</pre></div> <strong><code>sHandler</code>是一个静态的Handler对象，为了能够切换执行线程，这就要求<code>sHandler</code>必须在主线程中进行创建。由于静态成员会在加载类的时候进行初始化，因此就这变相要求AsyncTask的类必须在主线程中进行加载。</strong><code>sHandler</code>在收到MESSAGE_POST_RESULT消息后，会调用<code>AsyncTask#finish</code>方法： <div class=codehilite><pre><span></span><span class=kd>private</span> <span class=kt>void</span> <span class=nf>finish</span><span class=p>(</span><span class=n>Result</span> <span class=n>result</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>isCancelled</span><span class=p>())</span> <span class=p>{</span>
        <span class=n>onCancelled</span><span class=p>(</span><span class=n>result</span><span class=p>);</span>
    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
        <span class=n>onPostExecute</span><span class=p>(</span><span class=n>result</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=n>mStatus</span> <span class=o>=</span> <span class=n>Status</span><span class=p>.</span><span class=na>FINISHED</span><span class=p>;</span>
<span class=p>}</span>
</pre></div> <code>AsyncTask</code>的<code>finish</code>方法逻辑比较简单，如果AsyncTask被取消执行了，那么会调用<code>onCancelled(Result)</code>方法；否则会调用<code>onPostExecute</code>方法。至此，AsyncTask的整个工作流程就分析完了。</p> <h3 id=23-intentservice>2.3 IntentService<a class=headerlink href=#23-intentservice title="Permanent link">&para;</a></h3> <p>说到<code>IntentService</code>，不得先说说<code>HandlerThread</code>。因此<code>IntentService</code>封装了一个<code>HandlerThread</code>以及一个<code>Handler</code>。</p> <h4 id=231-handlerthread>2.3.1 HandlerThread<a class=headerlink href=#231-handlerthread title="Permanent link">&para;</a></h4> <p><code>HandlerThread</code>继承了Thread，它是一种可以使用<code>Handler</code>的<code>Thread</code>。其实现非常简单，在其<code>run</code>方法中通过<code>Looper.prepare()</code>来创建消息队列，并通过<code>Looper.loop()</code>来开启消息循环。这样一旦有Message进来，就会在该线程中处理此Message。</p> <div class=codehilite><pre><span></span><span class=kd>public</span> <span class=kt>void</span> <span class=nf>run</span><span class=p>()</span> <span class=p>{</span>
    <span class=n>mTid</span> <span class=o>=</span> <span class=n>Process</span><span class=p>.</span><span class=na>myTid</span><span class=p>();</span>
    <span class=n>Looper</span><span class=p>.</span><span class=na>prepare</span><span class=p>();</span>
    <span class=kd>synchronized</span> <span class=p>(</span><span class=k>this</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>mLooper</span> <span class=o>=</span> <span class=n>Looper</span><span class=p>.</span><span class=na>myLooper</span><span class=p>();</span>
        <span class=n>notifyAll</span><span class=p>();</span>
    <span class=p>}</span>
    <span class=n>Process</span><span class=p>.</span><span class=na>setThreadPriority</span><span class=p>(</span><span class=n>mPriority</span><span class=p>);</span>
    <span class=n>onLooperPrepared</span><span class=p>();</span>
    <span class=n>Looper</span><span class=p>.</span><span class=na>loop</span><span class=p>();</span>
    <span class=n>mTid</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
<span class=p>}</span>
</pre></div> <p>基于以上原理的讨论，HanlderThread有如下显而易见的特点：</p> <ul> <li>HandlerThread本质上是一个线程，继承自Thread</li> <li>HandlerThread有自己的Looper对象，可以进行Looper循环，可以创建Handler</li> <li>HandlerThread可以在Handler的handlerMessage中执行异步方法</li> <li>HandlerThread优点是异步不会堵塞，减少对性能的消耗</li> <li>HandlerThread缺点是不能同时继续进行多任务处理，需要等待进行处理，处理效率较低</li> <li>HandlerThread与线程池不同，HandlerThread是一个串行队列，背后只有一个线程</li> </ul> <p>HandlerThread是一个常用的类，它在Android中一个具体的使用场景是IntentService。</p> <p>由于HandlerThread的run方法是一个无限循环，因此当明确不需要在使用HandlerThread时，可以通过它的<code>quit</code>或者<code>quitSafely</code>方法来终止线程的执行。</p> <h4 id=232-intentservice>2.3.2 IntentService<a class=headerlink href=#232-intentservice title="Permanent link">&para;</a></h4> <p>IntentService也是一种Service，它可用于执行后台耗时的任务，当任务执行完后会自动停止。同时IntentService是一种Service的原因，这导致它的优先级比单纯的线程要高，所以IntentService适合执行一些高优先级的后台任务。</p> <p>IntentService内部封装了HandlerThread以及一个Handler，我们可以从其<code>onCreate</code>方法中看出来： <div class=codehilite><pre><span></span><span class=kd>public</span> <span class=kt>void</span> <span class=nf>onCreate</span><span class=p>()</span> <span class=p>{</span>
    <span class=c1>// TODO: It would be nice to have an option to hold a partial wakelock</span>
    <span class=c1>// during processing, and to have a static startService(Context, Intent)</span>
    <span class=c1>// method that would launch the service &amp; hand off a wakelock.</span>

    <span class=kd>super</span><span class=p>.</span><span class=na>onCreate</span><span class=p>();</span>
    <span class=n>HandlerThread</span> <span class=n>thread</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HandlerThread</span><span class=p>(</span><span class=s>&quot;IntentService[&quot;</span> <span class=o>+</span> <span class=n>mName</span> <span class=o>+</span> <span class=s>&quot;]&quot;</span><span class=p>);</span>
    <span class=n>thread</span><span class=p>.</span><span class=na>start</span><span class=p>();</span>

    <span class=n>mServiceLooper</span> <span class=o>=</span> <span class=n>thread</span><span class=p>.</span><span class=na>getLooper</span><span class=p>();</span>
    <span class=n>mServiceHandler</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ServiceHandler</span><span class=p>(</span><span class=n>mServiceLooper</span><span class=p>);</span>
<span class=p>}</span>
</pre></div> 当IntentService被创建时，其<code>onCreate</code>方法会被调用，在方法中会创建一个<code>HandlerThread</code>，然后通过它的Looper构造一个Handler。每次启动IntentService，它的<code>onStartCommand</code>方法就会被调用，<code>onStartCommand</code>又会调用<code>onStart</code>方法。在此方法中会将Intent传递给Handler处理。</p> <div class=codehilite><pre><span></span><span class=kd>public</span> <span class=kt>void</span> <span class=nf>onStart</span><span class=p>(</span><span class=nd>@Nullable</span> <span class=n>Intent</span> <span class=n>intent</span><span class=p>,</span> <span class=kt>int</span> <span class=n>startId</span><span class=p>)</span> <span class=p>{</span>
    <span class=n>Message</span> <span class=n>msg</span> <span class=o>=</span> <span class=n>mServiceHandler</span><span class=p>.</span><span class=na>obtainMessage</span><span class=p>();</span>
    <span class=n>msg</span><span class=p>.</span><span class=na>arg1</span> <span class=o>=</span> <span class=n>startId</span><span class=p>;</span>
    <span class=n>msg</span><span class=p>.</span><span class=na>obj</span> <span class=o>=</span> <span class=n>intent</span><span class=p>;</span>
    <span class=n>mServiceHandler</span><span class=p>.</span><span class=na>sendMessage</span><span class=p>(</span><span class=n>msg</span><span class=p>);</span>
<span class=p>}</span>
</pre></div> <p>ServiceHandler在接收到消息时会调用<code>onHandleIntent</code>方法处理Intent。IntentService的<code>onHandleIntent</code>是一个抽象方法，我们需要自己实现它。当Intent处理完成后，会调用<code>stopSelf(int)</code>方法尝试停止Service。</p> <div class=codehilite><pre><span></span><span class=kd>private</span> <span class=kd>final</span> <span class=kd>class</span> <span class=nc>ServiceHandler</span> <span class=kd>extends</span> <span class=n>Handler</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=nf>ServiceHandler</span><span class=p>(</span><span class=n>Looper</span> <span class=n>looper</span><span class=p>)</span> <span class=p>{</span>
        <span class=kd>super</span><span class=p>(</span><span class=n>looper</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>handleMessage</span><span class=p>(</span><span class=n>Message</span> <span class=n>msg</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>onHandleIntent</span><span class=p>((</span><span class=n>Intent</span><span class=p>)</span><span class=n>msg</span><span class=p>.</span><span class=na>obj</span><span class=p>);</span>
        <span class=n>stopSelf</span><span class=p>(</span><span class=n>msg</span><span class=p>.</span><span class=na>arg1</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</pre></div> <p><code>stopSelf(int)</code>与<code>stopSelf()</code>的区别在于前者在尝试停止Service之前会判断最近启动Service的次数是否和startId相等；否者会立刻停止Service。<br> 如果目前只有一个后台任务，那么<code>onHandleIntent</code>方法处理完成后，<code>stopSelf(int)</code>方法会直接停止服务。如果存在多个任务，当<code>onHandleIntent</code>方法执行完最后一个时，<code>stopSelf(int)</code>才会直接停止服务。该特点源自于Service。</p> <p>因为IntentService是通过<code>mServiceHandler.sendMessage(msg)</code>的方式来请求执行任务的，那么意味着IntentService也是顺序执行后台任务的，当有多个后台任务存在时，这些后台任务就会按照外界发起的顺序排队执行。</p> <p>同时需要注意，因为HandlerThread的Looper是子线程的，所以导致IntentService的<code>onHandleIntent</code>方法是运行在子线程中的。因此如果需要在上述方法中访问UI，注意线程的切换。</p> <h2 id=3-android>3 Android中的线程池<a class=headerlink href=#3-android title="Permanent link">&para;</a></h2> <p>线程池的好处可以概括为一下三点：</p> <ul> <li>重用线程池中的线程，可以避免因为线程的创建和销毁带来的性能开销</li> <li>能有效控制线程池的最大并发数，避免大量的线程之间因为互相抢占系统资源而导致的阻塞现象</li> <li>能够对线程进行简单的管理，并提供定时执行以及指定间隔循环执行等功能</li> </ul> <p>Android中的线程池来源于Java中的Executor，Executor是一个接口，真正的线程池的实现为ThreadPoolExecutor。ThreadPoolExecutor提供了一系列参数用来配置线程池，通过不同的参数可以创建不同的线程池。</p> <h3 id=31-threadpoolexecutor>3.1 ThreadPoolExecutor<a class=headerlink href=#31-threadpoolexecutor title="Permanent link">&para;</a></h3> <p>ThreadPoolExecutor是线程池的真正实现，它的构造方法提供了一系列参数来配置线程池，下面这个参数是常用的： <div class=codehilite><pre><span></span><span class=kd>public</span> <span class=nf>ThreadPoolExecutor</span><span class=p>(</span><span class=kt>int</span> <span class=n>corePoolSize</span><span class=p>,</span>
                          <span class=kt>int</span> <span class=n>maximumPoolSize</span><span class=p>,</span>
                          <span class=kt>long</span> <span class=n>keepAliveTime</span><span class=p>,</span>
                          <span class=n>TimeUnit</span> <span class=n>unit</span><span class=p>,</span>
                          <span class=n>BlockingQueue</span><span class=o>&lt;</span><span class=n>Runnable</span><span class=o>&gt;</span> <span class=n>workQueue</span><span class=p>)</span>
</pre></div></p> <ul> <li>corePoolSize<br> 线程池的核心线程数。核心线程会一直存活，即使它们处于闲置状态，除非设置allowCoreThreadTimeOut</li> <li>maximumPoolSize<br> 线程池中允许存在的最大线程数</li> <li>keepAliveTime<br> 当线程数量超过核心线程数量时，允许闲置线程等待新任务的时长</li> <li>unit<br> keepAliveTime参数的时间单位。常用的有MILLISECONDS、SECONDS、MINUTES等</li> <li>workQueue<br> 线程池中任务队列。该队列将只保存通过<code>execute</code>方法提交的<code>Runnable</code>对象。</li> </ul> <p>ThreadPoolExecutor执行任务时大致遵循以下规则：</p> <ol> <li>如果线程池中的线程数量未达到核心线程的数量，那么会直接启动一个核心线程来执行任务。</li> <li>如果线程池中的线程数量已经达到或者超过了核心线程的数量，那么任务会被插入到队列中排队等待执行。</li> <li>如果无法插入到队列中，这说明任务队列已满。这时候如果线程未达到线程池规定的最大值，那么会立刻启动一个非核心线程来执行任务。</li> <li>如果步奏3中的线程数量已经达到了线程池规定的最大值，那么就会拒绝执行此任务，线程池会调用<code>RejectedExecutionHandler#rejectedExecution</code>来通知调用者。</li> </ol> <p>这段逻辑具体在<code>ThreadPoolExecutor#execute</code>方法中： <div class=codehilite><pre><span></span><span class=kd>public</span> <span class=kt>void</span> <span class=nf>execute</span><span class=p>(</span><span class=n>Runnable</span> <span class=n>command</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>command</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span>
        <span class=k>throw</span> <span class=k>new</span> <span class=n>NullPointerException</span><span class=p>();</span>
    <span class=cm>/*</span>
<span class=cm>     * Proceed in 3 steps:</span>
<span class=cm>     *</span>
<span class=cm>     * 1. If fewer than corePoolSize threads are running, try to</span>
<span class=cm>     * start a new thread with the given command as its first</span>
<span class=cm>     * task.  The call to addWorker atomically checks runState and</span>
<span class=cm>     * workerCount, and so prevents false alarms that would add</span>
<span class=cm>     * threads when it shouldn&#39;t, by returning false.</span>
<span class=cm>     *</span>
<span class=cm>     * 2. If a task can be successfully queued, then we still need</span>
<span class=cm>     * to double-check whether we should have added a thread</span>
<span class=cm>     * (because existing ones died since last checking) or that</span>
<span class=cm>     * the pool shut down since entry into this method. So we</span>
<span class=cm>     * recheck state and if necessary roll back the enqueuing if</span>
<span class=cm>     * stopped, or start a new thread if there are none.</span>
<span class=cm>     *</span>
<span class=cm>     * 3. If we cannot queue task, then we try to add a new</span>
<span class=cm>     * thread.  If it fails, we know we are shut down or saturated</span>
<span class=cm>     * and so reject the task.</span>
<span class=cm>     */</span>
    <span class=kt>int</span> <span class=n>c</span> <span class=o>=</span> <span class=n>ctl</span><span class=p>.</span><span class=na>get</span><span class=p>();</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>workerCountOf</span><span class=p>(</span><span class=n>c</span><span class=p>)</span> <span class=o>&lt;</span> <span class=n>corePoolSize</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>addWorker</span><span class=p>(</span><span class=n>command</span><span class=p>,</span> <span class=kc>true</span><span class=p>))</span>
            <span class=k>return</span><span class=p>;</span>
        <span class=n>c</span> <span class=o>=</span> <span class=n>ctl</span><span class=p>.</span><span class=na>get</span><span class=p>();</span>
    <span class=p>}</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>isRunning</span><span class=p>(</span><span class=n>c</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=n>workQueue</span><span class=p>.</span><span class=na>offer</span><span class=p>(</span><span class=n>command</span><span class=p>))</span> <span class=p>{</span>
        <span class=kt>int</span> <span class=n>recheck</span> <span class=o>=</span> <span class=n>ctl</span><span class=p>.</span><span class=na>get</span><span class=p>();</span>
        <span class=k>if</span> <span class=p>(</span><span class=o>!</span> <span class=n>isRunning</span><span class=p>(</span><span class=n>recheck</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=n>remove</span><span class=p>(</span><span class=n>command</span><span class=p>))</span>
            <span class=n>reject</span><span class=p>(</span><span class=n>command</span><span class=p>);</span>
        <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>workerCountOf</span><span class=p>(</span><span class=n>recheck</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span>
            <span class=n>addWorker</span><span class=p>(</span><span class=kc>null</span><span class=p>,</span> <span class=kc>false</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>addWorker</span><span class=p>(</span><span class=n>command</span><span class=p>,</span> <span class=kc>false</span><span class=p>))</span>
        <span class=n>reject</span><span class=p>(</span><span class=n>command</span><span class=p>);</span>
<span class=p>}</span>
</pre></div> 注释和代码很清晰明白，不累述。</p> <h3 id=32>3.2 线程池的分类<a class=headerlink href=#32 title="Permanent link">&para;</a></h3> <p>Android中常见四个线程池，它们分别是</p> <ol> <li>FixedThreadPool</li> <li>SingleThreadExecutor</li> <li>CachedThreadPool</li> <li>ScheduledThreadPool</li> </ol> <p>其创建方法在<code>Executors</code>里面。我们可以看一下它们的特点：</p> <ul> <li> <p>FixedThreadPool</p> <div class=codehilite><pre><span></span><span class=kd>public</span> <span class=kd>static</span> <span class=n>ExecutorService</span> <span class=nf>newFixedThreadPool</span><span class=p>(</span><span class=kt>int</span> <span class=n>nThreads</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>return</span> <span class=k>new</span> <span class=n>ThreadPoolExecutor</span><span class=p>(</span><span class=n>nThreads</span><span class=p>,</span> <span class=n>nThreads</span><span class=p>,</span>
                                  <span class=mi>0</span><span class=n>L</span><span class=p>,</span> <span class=n>TimeUnit</span><span class=p>.</span><span class=na>MILLISECONDS</span><span class=p>,</span>
                                  <span class=k>new</span> <span class=n>LinkedBlockingQueue</span><span class=o>&lt;</span><span class=n>Runnable</span><span class=o>&gt;</span><span class=p>());</span>
<span class=p>}</span>
</pre></div> <p>这是一个线程数量固定、队列大小没有限制的线程池。在任何时候，线程都将会被激活以处理任务。线程池中的线程不会停止直到调用<code>shutdown</code>。由于<code>FixedThreadPool</code>只有核心线程并且这些核心线程不会被回收，这意味着它能够更快速的响应外界的请求。</p> </li> <li> <p>SingleThreadExecutor</p> <div class=codehilite><pre><span></span><span class=kd>public</span> <span class=kd>static</span> <span class=n>ExecutorService</span> <span class=nf>newSingleThreadExecutor</span><span class=p>()</span> <span class=p>{</span>
    <span class=k>return</span> <span class=k>new</span> <span class=n>FinalizableDelegatedExecutorService</span>
        <span class=p>(</span><span class=k>new</span> <span class=n>ThreadPoolExecutor</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span>
                                <span class=mi>0</span><span class=n>L</span><span class=p>,</span> <span class=n>TimeUnit</span><span class=p>.</span><span class=na>MILLISECONDS</span><span class=p>,</span>
                                <span class=k>new</span> <span class=n>LinkedBlockingQueue</span><span class=o>&lt;</span><span class=n>Runnable</span><span class=o>&gt;</span><span class=p>()));</span>
<span class=p>}</span>
</pre></div> <p>这是一个单一线程、队列大小没有限制的线程池。其内部只有一个线程，可以确保所有任务都在同一个线程中按顺序执行。<code>SingleThreadExecutor</code>的意义在于统一外界任务到一个线程中，这使得这些任务之间不需要处理线程同步问题。</p> </li> <li> <p>CachedThreadPool</p> <div class=codehilite><pre><span></span><span class=kd>public</span> <span class=kd>static</span> <span class=n>ExecutorService</span> <span class=nf>newCachedThreadPool</span><span class=p>()</span> <span class=p>{</span>
    <span class=k>return</span> <span class=k>new</span> <span class=n>ThreadPoolExecutor</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>Integer</span><span class=p>.</span><span class=na>MAX_VALUE</span><span class=p>,</span>
                                  <span class=mi>60L</span><span class=p>,</span> <span class=n>TimeUnit</span><span class=p>.</span><span class=na>SECONDS</span><span class=p>,</span>
                                  <span class=k>new</span> <span class=n>SynchronousQueue</span><span class=o>&lt;</span><span class=n>Runnable</span><span class=o>&gt;</span><span class=p>());</span>
<span class=p>}</span>
</pre></div> <p>这是一个线程数量不定的线程池，他只有非核心线程，并且其最大线程数为<code>Integer.MAX_VALUE</code>。线程池中的空闲线程都有超时机制，这个超时时常为60s，超过这个时间的闲置线程就会被回收。<code>CachedThreadPool</code>的任务队列可以简单的理解为一个无法存储元素的队列，因此这将导致任何任务都会立刻执行。</p> <p>从其特性来看，这类线程池适合执行大量耗时较少的任务。当整个线程池处理闲置状态时，线程池中的线程都会因为超时而被停止，这个时候<code>CachedThreadPool</code>之中实际上是没有线程的，它几乎不占用任何系统资源。</p> </li> <li> <p>ScheduledThreadPool</p> <div class=codehilite><pre><span></span><span class=kd>private</span> <span class=kd>static</span> <span class=kd>final</span> <span class=kt>long</span> <span class=n>DEFAULT_KEEPALIVE_MILLIS</span> <span class=o>=</span> <span class=mi>10L</span><span class=p>;</span>

<span class=kd>public</span> <span class=kd>static</span> <span class=n>ScheduledExecutorService</span> <span class=nf>newScheduledThreadPool</span><span class=p>(</span><span class=kt>int</span> <span class=n>corePoolSize</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>return</span> <span class=k>new</span> <span class=n>ScheduledThreadPoolExecutor</span><span class=p>(</span><span class=n>corePoolSize</span><span class=p>);</span>
<span class=p>}</span>

<span class=kd>public</span> <span class=nf>ScheduledThreadPoolExecutor</span><span class=p>(</span><span class=kt>int</span> <span class=n>corePoolSize</span><span class=p>)</span> <span class=p>{</span>
    <span class=kd>super</span><span class=p>(</span><span class=n>corePoolSize</span><span class=p>,</span> <span class=n>Integer</span><span class=p>.</span><span class=na>MAX_VALUE</span><span class=p>,</span>
          <span class=n>DEFAULT_KEEPALIVE_MILLIS</span><span class=p>,</span> <span class=n>MILLISECONDS</span><span class=p>,</span>
          <span class=k>new</span> <span class=n>DelayedWorkQueue</span><span class=p>());</span>
<span class=p>}</span>
</pre></div> <p>这是一个核心线程数量固定、非核心线程数量没有限制、非核心线程闲置时间10s的线程池。此类线程池主要用于执行定时任务和具有固定周期的重复任务。</p> </li> </ul> <h3 id=33>3.3 线程池线程复用原理<a class=headerlink href=#33 title="Permanent link">&para;</a></h3> <p><img alt=线程复用原理 src=/assets/images/android/thread_reuse.png></p> <hr> <div class=md-source-date> <small> 最后更新: 2020年1月14日 </small> </div> <h2 id=__comments>评论</h2> <div id=disqus_thread></div> <script>
    var disqus_config = function () {
      this.page.url = "https://blog.yorek.xyz/about-me/android/framework/Android线程与线程池/";
      this.page.identifier =
        "/android/framework/Android线程与线程池/";
    };
    (function() {
      var d = document, s = d.createElement("script");
      s.src = "//yorekliu.disqus.com/embed.js";
      s.setAttribute("data-timestamp", +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid"> <a href=../Android消息机制/ title=Android消息机制 class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> 上一页 </span> Android消息机制 </span> </div> </a> <a href=../Bitmap的缓存与加载/ title=Bitmap的缓存与加载 class="md-flex md-footer-nav__link md-footer-nav__link--next" rel=next> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> 下一页 </span> Bitmap的缓存与加载 </span> </div> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> &copy; 2020 Yorek </div> powered by <a href=https://www.mkdocs.org>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ > Material for MkDocs</a> </div> <div class=md-footer-social> <link rel=stylesheet href=../../../assets/fonts/font-awesome.css> <a href=https://github.com/YorekLiu class="md-footer-social__link fa fa-github"></a> <a href=lyytogether@gmail.com class="md-footer-social__link fa fa-email"></a> </div> </div> </div> </footer> </div> <script src=../../../assets/javascripts/application.808e90bb.js></script> <script src=../../../assets/javascripts/lunr/lunr.stemmer.support.js></script> <script src=../../../assets/javascripts/lunr/tinyseg.js></script> <script src=../../../assets/javascripts/lunr/lunr.ja.js></script> <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script> <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script> </body> </html>
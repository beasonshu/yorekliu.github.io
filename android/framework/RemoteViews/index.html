<!--
  Copyright (c) 2016-2020 Martin Donath <martin.donath@squidfunk.com>
  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:
  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.
  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
--> <!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=description content="An Android Developer."><link href=https://blog.yorek.xyz/about-me/android/framework/RemoteViews/ rel=canonical><meta name=author content="Yorek Liu"><meta name=lang:clipboard.copy content=复制><meta name=lang:clipboard.copied content=已复制><meta name=lang:search.language content=ja><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content=没有找到符合条件的结果><meta name=lang:search.result.one content="找到 1 个符合条件的结果"><meta name=lang:search.result.other content="# 个符合条件的结果"><meta name=lang:search.tokenizer content=[\uff0c\u3002]+><link rel="shortcut icon" href=../../../assets/images/favicon.ico><meta name=generator content="mkdocs-1.0.4, mkdocs-material-4.6.0"><title>RemoteViews</title><link rel=stylesheet href=../../../assets/stylesheets/application.1b62728e.css><link rel=stylesheet href=../../../assets/stylesheets/application-palette.a8b3c06d.css><meta name=theme-color content><script src=../../../assets/javascripts/modernizr.268332fc.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel=stylesheet href=../../../assets/fonts/material-icons.css><link rel=manifest href=../../../manifest.webmanifest><script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-155096376-1", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script><script async src=https://www.google-analytics.com/analytics.js></script><!-- Determine title --><!-- The image needs to have an absolute URL --><!-- Open graph meta tags --><meta property=og:type content=website><meta property=og:title content="Yorek's - RemoteViews"><meta property=og:description content="An Android Developer."><meta content=https://blog.yorek.xyz/about-me/android/framework/RemoteViews/ property=og:url><meta property=og:image content=https://blog.yorek.xyz/about-meassets/images/banner.png><meta property=og:image:type content=image/png><meta property=og:image:width content=1200><meta property=og:image:height content=630><!-- Twitter meta tags --><meta name=twitter:card content=summary_large_image><meta name=twitter:site content=@squidfunk><meta name=twitter:creator content=@squidfunk><meta name=twitter:title content="Yorek's - RemoteViews"><meta name=twitter:description content="An Android Developer."><meta name=twitter:image content=https://blog.yorek.xyz/about-meassets/images/banner.png></head> <body dir=ltr data-md-color-primary=white data-md-color-accent=blue> <svg class=md-svg> <defs> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#1-remoteviews tabindex=1 class=md-skip> 跳转至 </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=https://blog.yorek.xyz/about-me title="Yorek's" class="md-header-nav__button md-logo"> <img src=../../../assets/images/favicon.ico width=24 height=24> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> Yorek's </span> <span class=md-header-nav__topic> RemoteViews </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> 键入以开始搜索 </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container> <nav class="md-tabs md-tabs--active" data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../3rd-library/3rd-library-source-code/ class=md-tabs__link> Android </a> </li> <li class=md-tabs__item> <a href=../../../flutter/flutter_first_project_1/ class=md-tabs__link> Flutter </a> </li> <li class=md-tabs__item> <a href=../../../leetcode/ class=md-tabs__link> LeetCode </a> </li> <li class=md-tabs__item> <a href=../../../design-pattern/design-pattern/ class=md-tabs__link> Books </a> </li> </ul> </div> </nav> <main class=md-main role=main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=https://blog.yorek.xyz/about-me title="Yorek's" class="md-nav__button md-logo"> <img src=../../../assets/images/favicon.ico width=48 height=48> </a> Yorek's </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. title=Home class=md-nav__link> Home </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2 type=checkbox id=nav-2 checked> <label class=md-nav__link for=nav-2> Android </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-2> Android </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-1 type=checkbox id=nav-2-1> <label class=md-nav__link for=nav-2-1> 三方库源码解析 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-1> 三方库源码解析 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../3rd-library/3rd-library-source-code/ title=Android三方库源码分析 class=md-nav__link> Android三方库源码分析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/matrix/ title="微信APM Matrix解析" class=md-nav__link> 微信APM Matrix解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/matrix-trace/ title=Matrix-TraceCanary解析 class=md-nav__link> Matrix-TraceCanary解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/matrix-io/ title=Matrix-IOCanary解析 class=md-nav__link> Matrix-IOCanary解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/matrix-resource/ title=Matrix-ResourceCanary解析 class=md-nav__link> Matrix-ResourceCanary解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/matrix-sqlitelint/ title=Matrix-SQLiteLint解析 class=md-nav__link> Matrix-SQLiteLint解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/okhttp/ title=OkHttp3源码解析 class=md-nav__link> OkHttp3源码解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/retrofit/ title=Retrofit2源码解析 class=md-nav__link> Retrofit2源码解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/rxjava&rxandroid/ title=RxJava源码解析及使用实例 class=md-nav__link> RxJava源码解析及使用实例 </a> </li> <li class=md-nav__item> <a href=../../other/RxJava/ title=RxJava操作符大全 class=md-nav__link> RxJava操作符大全 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide1/ title="Glide v4 源码解析（一）" class=md-nav__link> Glide v4 源码解析（一） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide2/ title="Glide v4 源码解析（二）" class=md-nav__link> Glide v4 源码解析（二） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide3/ title="Glide v4 源码解析（三）" class=md-nav__link> Glide v4 源码解析（三） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide4/ title="Glide v4 源码解析（四）" class=md-nav__link> Glide v4 源码解析（四） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide5/ title="Glide v4 源码解析（五）" class=md-nav__link> Glide v4 源码解析（五） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide6/ title="Glide v4 源码解析（六）" class=md-nav__link> Glide v4 源码解析（六） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide7/ title="Glide v4 源码解析（七）" class=md-nav__link> Glide v4 源码解析（七） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/migrate-to-glide/ title=杂记：从Picasso迁移至Glide class=md-nav__link> 杂记：从Picasso迁移至Glide </a> </li> <li class=md-nav__item> <a href=../../3rd-library/eventbus/ title=EventBus源码解析 class=md-nav__link> EventBus源码解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/leakcanary/ title=LeakCanary2源码解析 class=md-nav__link> LeakCanary2源码解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/permissiondispatcher/ title=PermissionDispatcher源码解析 class=md-nav__link> PermissionDispatcher源码解析 </a> </li> <li class=md-nav__item> <a href=../../other/constraintlayout/ title=ConstraintLayout使用大全 class=md-nav__link> ConstraintLayout使用大全 </a> </li> <li class=md-nav__item> <a href=../../other/dagger2/ title=初学者的Dagger2教程 class=md-nav__link> 初学者的Dagger2教程 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-2 type=checkbox id=nav-2-2> <label class=md-nav__link for=nav-2-2> Android开发高手课 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-2> Android开发高手课 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../paid/master/ title=Android开发高手课 class=md-nav__link> Android开发高手课 </a> </li> <li class=md-nav__item> <a href=../../paid/master/crash_1/ title="01 | 崩溃优化（上）：关于“崩溃”那些事儿" class=md-nav__link> 01 | 崩溃优化（上）：关于“崩溃”那些事儿 </a> </li> <li class=md-nav__item> <a href=../../paid/master/crash_2/ title="02 | 崩溃优化（下）：应用崩溃了，你应该如何去分析？" class=md-nav__link> 02 | 崩溃优化（下）：应用崩溃了，你应该如何去分析？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/memory_1/ title="03 | 内存优化（上）：4GB内存时代，再谈内存优化" class=md-nav__link> 03 | 内存优化（上）：4GB内存时代，再谈内存优化 </a> </li> <li class=md-nav__item> <a href=../../paid/master/memory_2/ title="04 | 内存优化（下）：内存优化这件事，应该从哪里着手？" class=md-nav__link> 04 | 内存优化（下）：内存优化这件事，应该从哪里着手？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/stuck_1/ title="05 | 卡顿优化（上）：你要掌握的卡顿分析方法" class=md-nav__link> 05 | 卡顿优化（上）：你要掌握的卡顿分析方法 </a> </li> <li class=md-nav__item> <a href=../../paid/master/stuck_2/ title="06 | 卡顿优化（下）：如何监控应用卡顿？" class=md-nav__link> 06 | 卡顿优化（下）：如何监控应用卡顿？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/stuck_3/ title="06补充篇 | 卡顿优化：卡顿现场与卡顿分析" class=md-nav__link> 06补充篇 | 卡顿优化：卡顿现场与卡顿分析 </a> </li> <li class=md-nav__item> <a href=../../paid/master/start_1/ title="07 | 启动优化（上）：从启动过程看启动速度优化" class=md-nav__link> 07 | 启动优化（上）：从启动过程看启动速度优化 </a> </li> <li class=md-nav__item> <a href=../../paid/master/start_2/ title="08 | 启动优化（下）：优化启动速度的进阶方法" class=md-nav__link> 08 | 启动优化（下）：优化启动速度的进阶方法 </a> </li> <li class=md-nav__item> <a href=../../paid/master/io_1/ title="09 | I/O优化（上）：开发工程师必备的I/O优化知识" class=md-nav__link> 09 | I/O优化（上）：开发工程师必备的I/O优化知识 </a> </li> <li class=md-nav__item> <a href=../../paid/master/io_2/ title="10 | I/O优化（中）：不同I/O方式的使用场景是什么？" class=md-nav__link> 10 | I/O优化（中）：不同I/O方式的使用场景是什么？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/io_3/ title="11 | I/O优化（下）：如何监控线上I/O操作？" class=md-nav__link> 11 | I/O优化（下）：如何监控线上I/O操作？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/storage_1/ title="12 | 存储优化（上）：常见的数据存储方法有哪些？" class=md-nav__link> 12 | 存储优化（上）：常见的数据存储方法有哪些？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/storage_2/ title="13 | 存储优化（中）：如何优化数据存储？" class=md-nav__link> 13 | 存储优化（中）：如何优化数据存储？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/storage_3/ title="14 | 存储优化（下）：数据库SQLite的使用和优化" class=md-nav__link> 14 | 存储优化（下）：数据库SQLite的使用和优化 </a> </li> <li class=md-nav__item> <a href=../../paid/master/network_1/ title="15 | 网络优化（上）：移动开发工程师必备的网络优化知识" class=md-nav__link> 15 | 网络优化（上）：移动开发工程师必备的网络优化知识 </a> </li> <li class=md-nav__item> <a href=../../paid/master/network_2/ title="16 | 网络优化（中）：复杂多变的移动网络该如何优化？" class=md-nav__link> 16 | 网络优化（中）：复杂多变的移动网络该如何优化？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/network_3/ title="17 | 网络优化（下）：大数据下网络该如何监控？" class=md-nav__link> 17 | 网络优化（下）：大数据下网络该如何监控？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/battery_1/ title="18 | 耗电优化（上）：从电量优化的演进看耗电分析" class=md-nav__link> 18 | 耗电优化（上）：从电量优化的演进看耗电分析 </a> </li> <li class=md-nav__item> <a href=../../paid/master/battery_2/ title="19 | 耗电优化（下）：耗电的优化方法与线上监控" class=md-nav__link> 19 | 耗电优化（下）：耗电的优化方法与线上监控 </a> </li> <li class=md-nav__item> <a href=../../paid/master/ui_1/ title="20 | UI 优化（上）：UI 渲染的几个关键概念" class=md-nav__link> 20 | UI 优化（上）：UI 渲染的几个关键概念 </a> </li> <li class=md-nav__item> <a href=../../paid/master/ui_2/ title="21 | UI 优化（下）：如何优化 UI 渲染？" class=md-nav__link> 21 | UI 优化（下）：如何优化 UI 渲染？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/package_1/ title="22 | 包体积优化（上）：如何减少安装包大小？" class=md-nav__link> 22 | 包体积优化（上）：如何减少安装包大小？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/package_2/ title="23 | 包体积优化（下）：资源优化的进阶实践" class=md-nav__link> 23 | 包体积优化（下）：资源优化的进阶实践 </a> </li> <li class=md-nav__item> <a href=../../paid/master/compile/ title="26 | 关于编译，你需要了解什么？" class=md-nav__link> 26 | 关于编译，你需要了解什么？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/bytecode/ title="27 | 编译插桩的三种方法：AspectJ、ASM、ReDex" class=md-nav__link> 27 | 编译插桩的三种方法：AspectJ、ASM、ReDex </a> </li> <li class=md-nav__item> <a href=../../paid/master/native_hook/ title="35 | Native Hook 技术，天使还是魔鬼？" class=md-nav__link> 35 | Native Hook 技术，天使还是魔鬼？ </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-3 type=checkbox id=nav-2-3 checked> <label class=md-nav__link for=nav-2-3> Framework系列 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-3> Framework系列 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Android四大组件(1)/ title=Activity class=md-nav__link> Activity </a> </li> <li class=md-nav__item> <a href=../Android四大组件(2)/ title=Service class=md-nav__link> Service </a> </li> <li class=md-nav__item> <a href=../Android四大组件(3)/ title=Broadcasts class=md-nav__link> Broadcasts </a> </li> <li class=md-nav__item> <a href=../Android四大组件(4)/ title="Content Providers与Fragment" class=md-nav__link> Content Providers与Fragment </a> </li> <li class=md-nav__item> <a href=../IPC机制/ title=IPC机制 class=md-nav__link> IPC机制 </a> </li> <li class=md-nav__item> <a href=../View的事件体系/ title=View的事件体系 class=md-nav__link> View的事件体系 </a> </li> <li class=md-nav__item> <a href=../View的绘制原理/ title=View的绘制原理 class=md-nav__link> View的绘制原理 </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-toggle md-nav__toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> RemoteViews </label> <a href=./ title=RemoteViews class="md-nav__link md-nav__link--active"> RemoteViews </a> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>目录</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#1-remoteviews class=md-nav__link> 1 RemoteViews的应用 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#11-remoteviews class=md-nav__link> 1.1 RemoteViews在通知栏上的应用 </a> </li> <li class=md-nav__item> <a href=#12-remoteviews class=md-nav__link> 1.2 RemoteViews在桌面小部件上的应用 </a> </li> <li class=md-nav__item> <a href=#13-pendingintent class=md-nav__link> 1.3 PendingIntent概述 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2-remoteviews class=md-nav__link> 2 RemoteViews的内部机制 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#21-remoteviews class=md-nav__link> 2.1 RemoteViews的创建 </a> </li> <li class=md-nav__item> <a href=#22-remoteviews class=md-nav__link> 2.2 RemoteViews的样式、点击事件设置 </a> </li> <li class=md-nav__item> <a href=#23-remoteviews class=md-nav__link> 2.3 RemoteViews的渲染 </a> </li> <li class=md-nav__item> <a href=#24-action class=md-nav__link> 2.4 Action子类的具体实现 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#__comments class="md-nav__link md-nav__link--active"> 评论 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../Drawable/ title=Android中的Drawable资源 class=md-nav__link> Android中的Drawable资源 </a> </li> <li class=md-nav__item> <a href=../Android动画/ title=Android动画 class=md-nav__link> Android动画 </a> </li> <li class=md-nav__item> <a href=../Window与WindowManager/ title=Window与WindowManager class=md-nav__link> Window与WindowManager </a> </li> <li class=md-nav__item> <a href=../四大组件启动过程/ title=四大组件启动过程 class=md-nav__link> 四大组件启动过程 </a> </li> <li class=md-nav__item> <a href=../Android消息机制/ title=Android消息机制 class=md-nav__link> Android消息机制 </a> </li> <li class=md-nav__item> <a href=../Android线程与线程池/ title=Android线程与线程池 class=md-nav__link> Android线程与线程池 </a> </li> <li class=md-nav__item> <a href=../Bitmap的缓存与加载/ title=Bitmap的缓存与加载 class=md-nav__link> Bitmap的缓存与加载 </a> </li> <li class=md-nav__item> <a href=../JNI与NDK/ title=JNI与NDK编程简介 class=md-nav__link> JNI与NDK编程简介 </a> </li> <li class=md-nav__item> <a href=../性能优化/ title=Android性能优化 class=md-nav__link> Android性能优化 </a> </li> <li class=md-nav__item> <a href=../binder1-mediaservice/ title=Binder深入理解——以MediaService为例 class=md-nav__link> Binder深入理解——以MediaService为例 </a> </li> <li class=md-nav__item> <a href=../binder2/ title=Binder深入理解——罗老师系列 class=md-nav__link> Binder深入理解——罗老师系列 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-4 type=checkbox id=nav-2-4> <label class=md-nav__link for=nav-2-4> 付费知识归档 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-4> 付费知识归档 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-4-1 type=checkbox id=nav-2-4-1> <label class=md-nav__link for=nav-2-4-1> 某圈问题索引 </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-2-4-1> 某圈问题索引 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../paid/zsxq/zsxq_index/ title=某圈问题索引 class=md-nav__link> 某圈问题索引 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week1-synchronized/ title=理解Java中synchronized关键词 class=md-nav__link> 理解Java中synchronized关键词 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week2-service/ title=理解Service class=md-nav__link> 理解Service </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week3-activity/ title=理解Activity的启动模式 class=md-nav__link> 理解Activity的启动模式 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week4-startActivityForResult/ title=关于startActivityForResult class=md-nav__link> 关于startActivityForResult </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week5-view/ title=关于View的知识 class=md-nav__link> 关于View的知识 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week6-gradle/ title=关于Gradle的知识 class=md-nav__link> 关于Gradle的知识 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week7-serialization/ title=关于序列化的知识 class=md-nav__link> 关于序列化的知识 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week10-classloader/ title=Android中的ClassLoader class=md-nav__link> Android中的ClassLoader </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week11-binder/ title=Binder简介 class=md-nav__link> Binder简介 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week12-retrofit-okhttp/ title=OkHttp和Retrofit的作用以及两者之间的联系 class=md-nav__link> OkHttp和Retrofit的作用以及两者之间的联系 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week14-jvm-gc/ title=JVM中垃圾回收策略 class=md-nav__link> JVM中垃圾回收策略 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week16-keep-app-alive/ title=进程保活 class=md-nav__link> 进程保活 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week17-android-components/ title=四大组件的作用以及多进程 class=md-nav__link> 四大组件的作用以及多进程 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week20-network-protocol/ title=网络协议 class=md-nav__link> 网络协议 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week21-mvc&amp;mvp&mvvm/ title=MVC、MVP和MVVM class=md-nav__link> MVC、MVP和MVVM </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week22-android-studio-build/ title="Android Studio build过程" class=md-nav__link> Android Studio build过程 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week23-load-large-bitmap/ title=大尺寸图片加载问题 class=md-nav__link> 大尺寸图片加载问题 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-5 type=checkbox id=nav-2-5> <label class=md-nav__link for=nav-2-5> 日常记录 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-5> 日常记录 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../other/annotation/ title=注解的定义及解析 class=md-nav__link> 注解的定义及解析 </a> </li> <li class=md-nav__item> <a href=../../other/best_throttle_in_mvvm/ title=这可能是MVVM中最优雅的按键防抖方案 class=md-nav__link> 这可能是MVVM中最优雅的按键防抖方案 </a> </li> <li class=md-nav__item> <a href=../../other/android-jenkins/ title="Jenkins for android" class=md-nav__link> Jenkins for android </a> </li> <li class=md-nav__item> <a href=../../other/SystemProrities/ title=普通Android程序使用SystemProrities class=md-nav__link> 普通Android程序使用SystemProrities </a> </li> <li class=md-nav__item> <a href=../../other/recyclerview-cache/ title=ListView、RecyclerView缓存策略解析 class=md-nav__link> ListView、RecyclerView缓存策略解析 </a> </li> <li class=md-nav__item> <a href=../../other/recyclerview-item-docoration/ title=RecyclerView高级特性——ItemDecoration class=md-nav__link> RecyclerView高级特性——ItemDecoration </a> </li> <li class=md-nav__item> <a href=../../other/recyclerview-others/ title=RecyclerView的一些使用细节 class=md-nav__link> RecyclerView的一些使用细节 </a> </li> <li class=md-nav__item> <a href=../../other/RecyclerView-Sort&Delete/ title=RecyclerView高级特性——拖拽排序以及滑动删除 class=md-nav__link> RecyclerView高级特性——拖拽排序以及滑动删除 </a> </li> <li class=md-nav__item> <a href=../../other/FAB-Behavior/ title=FloatingActionButton上滑隐藏下滑显示 class=md-nav__link> FloatingActionButton上滑隐藏下滑显示 </a> </li> <li class=md-nav__item> <a href=../../other/nestedscrolling/ title=NestedScrolling机制 class=md-nav__link> NestedScrolling机制 </a> </li> <li class=md-nav__item> <a href=../../other/porterduff/ title=使用Porter-Duff合成数字图像 class=md-nav__link> 使用Porter-Duff合成数字图像 </a> </li> <li class=md-nav__item> <a href=../../other/runtime/ title="Android Runtime" class=md-nav__link> Android Runtime </a> </li> <li class=md-nav__item> <a href=../../other/android_alias/ title=Android马甲包的那些事儿 class=md-nav__link> Android马甲包的那些事儿 </a> </li> <li class=md-nav__item> <a href=../../other/Android-Development-Tool/ title=Android神兵利器 class=md-nav__link> Android神兵利器 </a> </li> <li class=md-nav__item> <a href=../../other/FileProvider/ title=FileProvider class=md-nav__link> FileProvider </a> </li> <li class=md-nav__item> <a href=../../other/Android判断导航栏高度/ title=Android判断虚拟按键(导航栏)显示与否、高度以及获取屏幕实际高度 class=md-nav__link> Android判断虚拟按键(导航栏)显示与否、高度以及获取屏幕实际高度 </a> </li> <li class=md-nav__item> <a href=../../other/Android图片选择器/ title=Android图片选择器 class=md-nav__link> Android图片选择器 </a> </li> <li class=md-nav__item> <a href=../../other/Android底部导航栏框架/ title=Android原生底部导航栏 class=md-nav__link> Android原生底部导航栏 </a> </li> <li class=md-nav__item> <a href=../../other/Android搜索栏的实现/ title=Android搜索栏的实现 class=md-nav__link> Android搜索栏的实现 </a> </li> <li class=md-nav__item> <a href=../../other/Android暂停音乐播放器的播放/ title=Android暂停酷狗、网易云音乐等音乐播放器的播放 class=md-nav__link> Android暂停酷狗、网易云音乐等音乐播放器的播放 </a> </li> <li class=md-nav__item> <a href=../../other/Android滑动返回实践/ title=Android滑动返回实践 class=md-nav__link> Android滑动返回实践 </a> </li> <li class=md-nav__item> <a href=../../other/Android程序反编译/ title=MacOS下Android程序反编译 class=md-nav__link> MacOS下Android程序反编译 </a> </li> <li class=md-nav__item> <a href=../../other/Android通讯录快速读取/ title=Android通讯录快速读取 class=md-nav__link> Android通讯录快速读取 </a> </li> <li class=md-nav__item> <a href=../../other/soft-keyboard-in-app/ title=App内自定义软键盘 class=md-nav__link> App内自定义软键盘 </a> </li> <li class=md-nav__item> <a href=../../other/腾讯X5内核入坑指南/ title="腾讯TBS X5浏览器内核入坑指南" class=md-nav__link> 腾讯TBS X5浏览器内核入坑指南 </a> </li> <li class=md-nav__item> <a href=../../other/琐碎知识点/ title=琐碎知识点 class=md-nav__link> 琐碎知识点 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3 type=checkbox id=nav-3> <label class=md-nav__link for=nav-3> Flutter </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-3> Flutter </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../flutter/flutter_first_project_1/ title=年轻人的第一个Flutter程序(1) class=md-nav__link> 年轻人的第一个Flutter程序(1) </a> </li> <li class=md-nav__item> <a href=../../../flutter/flutter_first_project_2/ title=年轻人的第一个Flutter程序(2) class=md-nav__link> 年轻人的第一个Flutter程序(2) </a> </li> <li class=md-nav__item> <a href=../../../flutter/flutter_first_project_3/ title=年轻人的第一个Flutter程序(3) class=md-nav__link> 年轻人的第一个Flutter程序(3) </a> </li> <li class=md-nav__item> <a href=../../../flutter/flutter_first_project_4/ title=年轻人的第一个Flutter程序(4) class=md-nav__link> 年轻人的第一个Flutter程序(4) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4 type=checkbox id=nav-4> <label class=md-nav__link for=nav-4> LeetCode </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-4> LeetCode </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../leetcode/ title=算法目录 class=md-nav__link> 算法目录 </a> </li> <li class=md-nav__item> <a href=../../../leetcode/code_interviews_1/ title=数据结构、算法和数据操作 class=md-nav__link> 数据结构、算法和数据操作 </a> </li> <li class=md-nav__item> <a href=../../../leetcode/code_interviews_3/ title=高质量的代码 class=md-nav__link> 高质量的代码 </a> </li> <li class=md-nav__item> <a href=../../../leetcode/code_interviews_4/ title=解决问题的思路 class=md-nav__link> 解决问题的思路 </a> </li> <li class=md-nav__item> <a href=../../../leetcode/code_interviews_5/ title=优化时间和空间效率 class=md-nav__link> 优化时间和空间效率 </a> </li> <li class=md-nav__item> <a href=../../../leetcode/code_interviews_6/ title=面试中的各项能力 class=md-nav__link> 面试中的各项能力 </a> </li> <li class=md-nav__item> <a href=../../../leetcode/array/ title=Array class=md-nav__link> Array </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode1-10/ title=LeetCode(1-10) class=md-nav__link> LeetCode(1-10) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode11-20/ title=LeetCode(11-20) class=md-nav__link> LeetCode(11-20) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode21-30/ title=LeetCode(21-30) class=md-nav__link> LeetCode(21-30) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode31-40/ title=LeetCode(31-40) class=md-nav__link> LeetCode(31-40) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode41-50/ title=LeetCode(41-50) class=md-nav__link> LeetCode(41-50) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode51-60/ title=LeetCode(51-60) class=md-nav__link> LeetCode(51-60) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode61-70/ title=LeetCode(61-70) class=md-nav__link> LeetCode(61-70) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode71-80/ title=LeetCode(71-80) class=md-nav__link> LeetCode(71-80) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode81-90/ title=LeetCode(81-90) class=md-nav__link> LeetCode(81-90) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode91-100/ title=LeetCode(91-100) class=md-nav__link> LeetCode(91-100) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode101-110/ title=LeetCode(101-110) class=md-nav__link> LeetCode(101-110) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode111-120/ title=LeetCode(111-120) class=md-nav__link> LeetCode(111-120) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5 type=checkbox id=nav-5> <label class=md-nav__link for=nav-5> Books </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-5> Books </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-1 type=checkbox id=nav-5-1> <label class=md-nav__link for=nav-5-1> Design Pattern </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-1> Design Pattern </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../design-pattern/design-pattern/ title=设计模式概述 class=md-nav__link> 设计模式概述 </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/design-principle/ title=面向对象的六大原则 class=md-nav__link> 面向对象的六大原则 </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/singleton/ title=单例模式(Singleton) class=md-nav__link> 单例模式(Singleton) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/builder/ title=建造者模式(Builder) class=md-nav__link> 建造者模式(Builder) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/prototype/ title=原型模式(Prototype) class=md-nav__link> 原型模式(Prototype) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/factory-method/ title="工厂方法模式(Factory method)" class=md-nav__link> 工厂方法模式(Factory method) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/abstract-factory/ title="抽象工厂模式(Abstract factory)" class=md-nav__link> 抽象工厂模式(Abstract factory) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/proxy/ title=代理模式(Proxy) class=md-nav__link> 代理模式(Proxy) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/composite/ title=组合模式(Composite) class=md-nav__link> 组合模式(Composite) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/adapter/ title=适配器模式(Adapter) class=md-nav__link> 适配器模式(Adapter) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/decorator/ title=装饰模式(Decorator) class=md-nav__link> 装饰模式(Decorator) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/flyweight/ title=享元模式(Flyweight) class=md-nav__link> 享元模式(Flyweight) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/facade/ title=外观模式(Facade) class=md-nav__link> 外观模式(Facade) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/bridge/ title=桥接模式(Bridge) class=md-nav__link> 桥接模式(Bridge) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/strategy/ title=策略模式(Strategy) class=md-nav__link> 策略模式(Strategy) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/state/ title=状态模式(State) class=md-nav__link> 状态模式(State) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/chain-of-responsibility/ title="责任链模式(Chain of responsibility)" class=md-nav__link> 责任链模式(Chain of responsibility) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/interpreter/ title=解释器模式(Interpreter) class=md-nav__link> 解释器模式(Interpreter) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/command/ title=命令模式(Command) class=md-nav__link> 命令模式(Command) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/observer/ title=观察者模式(Observer) class=md-nav__link> 观察者模式(Observer) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/memento/ title=备忘录模式(Memento) class=md-nav__link> 备忘录模式(Memento) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/iterator/ title=迭代器模式(Iterator) class=md-nav__link> 迭代器模式(Iterator) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/template-method/ title="模版方法模式(Template method)" class=md-nav__link> 模版方法模式(Template method) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/visitor/ title=访问者模式(Visitor) class=md-nav__link> 访问者模式(Visitor) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/mediator/ title=中介者模式(Mediator) class=md-nav__link> 中介者模式(Mediator) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/confusing-design-pattern/ title=易混淆的设计模式 class=md-nav__link> 易混淆的设计模式 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2 type=checkbox id=nav-5-2> <label class=md-nav__link for=nav-5-2> Effective Java </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-2> Effective Java </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../effective-java/effective-java/ title="Effective Java概述" class=md-nav__link> Effective Java概述 </a> </li> <li class=md-nav__item> <a href=../../../effective-java/chapter1/ title=创建和销毁对象 class=md-nav__link> 创建和销毁对象 </a> </li> <li class=md-nav__item> <a href=../../../effective-java/chapter2/ title=对于所有对象都通用的方法 class=md-nav__link> 对于所有对象都通用的方法 </a> </li> <li class=md-nav__item> <a href=../../../effective-java/chapter3/ title=类和接口 class=md-nav__link> 类和接口 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-3 type=checkbox id=nav-5-3> <label class=md-nav__link for=nav-5-3> JVM </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-3> JVM </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../jvm/jvm-content/ title=深入理解Java虚拟机 class=md-nav__link> 深入理解Java虚拟机 </a> </li> <li class=md-nav__item> <a href=../../../jvm/java-memory-area-oom/ title=Java内存区域与内存溢出异常 class=md-nav__link> Java内存区域与内存溢出异常 </a> </li> <li class=md-nav__item> <a href=../../../jvm/java-gc/ title=垃圾收集器与内存分配策略 class=md-nav__link> 垃圾收集器与内存分配策略 </a> </li> <li class=md-nav__item> <a href=../../../jvm/class-struct/ title=类文件结构 class=md-nav__link> 类文件结构 </a> </li> <li class=md-nav__item> <a href=../../../jvm/load-class/ title=虚拟机类加载机制 class=md-nav__link> 虚拟机类加载机制 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-4 type=checkbox id=nav-5-4> <label class=md-nav__link for=nav-5-4> Java </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-4> Java </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../java/generics-java-kotlin/ title=Java&Kotlin在泛型方面的区别 class=md-nav__link> Java&Kotlin在泛型方面的区别 </a> </li> <li class=md-nav__item> <a href=../../../java/java-collections/ title=Java集合总结 class=md-nav__link> Java集合总结 </a> </li> <li class=md-nav__item> <a href=../../../java/java-foundation/ title=Java常见概念 class=md-nav__link> Java常见概念 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-5 type=checkbox id=nav-5-5> <label class=md-nav__link for=nav-5-5> Refactoring </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-5> Refactoring </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../refactoring/refactoring/ title=重构：改善既有代码的设计 class=md-nav__link> 重构：改善既有代码的设计 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>目录</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#1-remoteviews class=md-nav__link> 1 RemoteViews的应用 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#11-remoteviews class=md-nav__link> 1.1 RemoteViews在通知栏上的应用 </a> </li> <li class=md-nav__item> <a href=#12-remoteviews class=md-nav__link> 1.2 RemoteViews在桌面小部件上的应用 </a> </li> <li class=md-nav__item> <a href=#13-pendingintent class=md-nav__link> 1.3 PendingIntent概述 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2-remoteviews class=md-nav__link> 2 RemoteViews的内部机制 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#21-remoteviews class=md-nav__link> 2.1 RemoteViews的创建 </a> </li> <li class=md-nav__item> <a href=#22-remoteviews class=md-nav__link> 2.2 RemoteViews的样式、点击事件设置 </a> </li> <li class=md-nav__item> <a href=#23-remoteviews class=md-nav__link> 2.3 RemoteViews的渲染 </a> </li> <li class=md-nav__item> <a href=#24-action class=md-nav__link> 2.4 Action子类的具体实现 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#__comments class="md-nav__link md-nav__link--active"> 评论 </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <h1>RemoteViews</h1> <p>RemoteViews在Android中的使用场景有两种：通知栏和桌面小插件。为了更好的分析<code>RemoteViews</code>的内部机制，本章先介绍<code>RemoteViews</code>在通知栏和桌面小部件上的应用。</p> <h2 id=1-remoteviews>1 RemoteViews的应用<a class=headerlink href=#1-remoteviews title="Permanent link">&para;</a></h2> <p><code>RemoteViews</code>在实际开发中，主要是用在通知栏和桌面小部件的开发过程中。</p> <p>通知栏主要是通过<code>NotificationManager</code>的<code>notify</code>方法来实现的，它除了默认效果之外，还可以另外定义布局。<br> 桌面小部件是通过<code>AppWidgetProvider</code>来实现的，<code>AppWidgetProvider</code>本质上是一个广播。</p> <p>通知栏和桌面小部件的开发过程都会用到<code>RemoteViews</code>，因为它们在更新界面时无法想在Activity里面那样去直接更新View，这是因为二者的界面都运行在其他进程中，准确的说是系统的<code>SystemServer</code>进程。为了跨进程更新界面，<code>RemoteViews</code>提供了一系列<code>set</code>方法，并且这些方法只是View全部方法的子集，而且<code>RemoteViews</code>支持的View类型也是有限的。</p> <p>下面简单说说<code>RemoteViews</code>在通知栏和桌面小部件中的使用方法。</p> <h3 id=11-remoteviews>1.1 RemoteViews在通知栏上的应用<a class=headerlink href=#11-remoteviews title="Permanent link">&para;</a></h3> <p>我们知道，通知栏除了默认的效果外还支持自定义布局，下面分别说明这些情况。</p> <p><strong>1.系统默认的通知样式</strong> </p> <p>使用下面的代码可以弹出一个系统样式的通知栏：</p> <div class=codehilite><pre><span></span><span class=n>Intent</span> <span class=n>intent</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Intent</span><span class=p>(</span><span class=k>this</span><span class=p>,</span> <span class=n>NotificationActivity</span><span class=p>.</span><span class=na>class</span><span class=p>);</span>
<span class=n>PendingIntent</span> <span class=n>pendingIntent</span> <span class=o>=</span> <span class=n>PendingIntent</span><span class=p>.</span><span class=na>getActivity</span><span class=p>(</span><span class=k>this</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=n>intent</span><span class=p>,</span> <span class=n>PendingIntent</span><span class=p>.</span><span class=na>FLAG_UPDATE_CURRENT</span><span class=p>);</span>
<span class=n>NotificationCompat</span><span class=p>.</span><span class=na>Builder</span> <span class=n>builder</span> <span class=o>=</span> <span class=k>new</span> <span class=n>NotificationCompat</span><span class=p>.</span><span class=na>Builder</span><span class=p>(</span><span class=k>this</span><span class=p>);</span>
<span class=n>builder</span><span class=p>.</span><span class=na>setSmallIcon</span><span class=p>(</span><span class=n>R</span><span class=p>.</span><span class=na>mipmap</span><span class=p>.</span><span class=na>ic_launcher</span><span class=p>)</span>
        <span class=p>.</span><span class=na>setTicker</span><span class=p>(</span><span class=s>&quot;hello world&quot;</span><span class=p>)</span>
        <span class=p>.</span><span class=na>setWhen</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>currentTimeMillis</span><span class=p>())</span>
        <span class=p>.</span><span class=na>setContentTitle</span><span class=p>(</span><span class=s>&quot;notification test&quot;</span><span class=p>)</span>
        <span class=p>.</span><span class=na>setContentText</span><span class=p>(</span><span class=s>&quot;this is a notification&quot;</span><span class=p>)</span>
        <span class=p>.</span><span class=na>setContentIntent</span><span class=p>(</span><span class=n>pendingIntent</span><span class=p>);</span>
<span class=n>Notification</span> <span class=n>notification</span> <span class=o>=</span> <span class=n>builder</span><span class=p>.</span><span class=na>build</span><span class=p>();</span>
<span class=n>notification</span><span class=p>.</span><span class=na>flags</span> <span class=o>=</span> <span class=n>Notification</span><span class=p>.</span><span class=na>FLAG_AUTO_CANCEL</span><span class=p>;</span>

<span class=n>NotificationManager</span> <span class=n>notificationManager</span> <span class=o>=</span> <span class=p>(</span><span class=n>NotificationManager</span><span class=p>)</span> <span class=n>getSystemService</span><span class=p>(</span><span class=n>Context</span><span class=p>.</span><span class=na>NOTIFICATION_SERVICE</span><span class=p>);</span>
<span class=n>notificationManager</span><span class=p>.</span><span class=na>notify</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>notification</span><span class=p>);</span>
</pre></div> <p><img alt=系统默认的通知样式 src=/assets/images/android/remoteviews-system-notification.png></p> <p><strong>2.自定义通知样式</strong> </p> <p>自定义通知样式需要我们提供一个布局文件，然后通过<code>RemoteViews</code>来加载这个布局即可以改变通知的样式，代码如下所示：</p> <div class=codehilite><pre><span></span><span class=n>Intent</span> <span class=n>intent</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Intent</span><span class=p>(</span><span class=k>this</span><span class=p>,</span> <span class=n>NotificationActivity</span><span class=p>.</span><span class=na>class</span><span class=p>);</span>
<span class=n>PendingIntent</span> <span class=n>pendingIntent</span> <span class=o>=</span> <span class=n>PendingIntent</span><span class=p>.</span><span class=na>getActivity</span><span class=p>(</span><span class=k>this</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=n>intent</span><span class=p>,</span> <span class=n>PendingIntent</span><span class=p>.</span><span class=na>FLAG_UPDATE_CURRENT</span><span class=p>);</span>
<span class=n>NotificationCompat</span><span class=p>.</span><span class=na>Builder</span> <span class=n>builder</span> <span class=o>=</span> <span class=k>new</span> <span class=n>NotificationCompat</span><span class=p>.</span><span class=na>Builder</span><span class=p>(</span><span class=k>this</span><span class=p>);</span>

<span class=n>RemoteViews</span> <span class=n>remoteViews</span> <span class=o>=</span> <span class=k>new</span> <span class=n>RemoteViews</span><span class=p>(</span><span class=n>getPackageName</span><span class=p>(),</span> <span class=n>R</span><span class=p>.</span><span class=na>layout</span><span class=p>.</span><span class=na>item_search_result</span><span class=p>);</span>
<span class=n>remoteViews</span><span class=p>.</span><span class=na>setImageViewResource</span><span class=p>(</span><span class=n>R</span><span class=p>.</span><span class=na>id</span><span class=p>.</span><span class=na>iv_file</span><span class=p>,</span> <span class=n>R</span><span class=p>.</span><span class=na>mipmap</span><span class=p>.</span><span class=na>ic_launcher</span><span class=p>);</span>
<span class=n>remoteViews</span><span class=p>.</span><span class=na>setTextViewText</span><span class=p>(</span><span class=n>R</span><span class=p>.</span><span class=na>id</span><span class=p>.</span><span class=na>tv_title</span><span class=p>,</span> <span class=s>&quot;notification title&quot;</span><span class=p>);</span>
<span class=n>remoteViews</span><span class=p>.</span><span class=na>setTextViewText</span><span class=p>(</span><span class=n>R</span><span class=p>.</span><span class=na>id</span><span class=p>.</span><span class=na>tv_desc</span><span class=p>,</span> <span class=s>&quot;This is a notification&quot;</span><span class=p>);</span>
<span class=n>PendingIntent</span> <span class=n>pendingIntent1</span> <span class=o>=</span> <span class=n>PendingIntent</span><span class=p>.</span><span class=na>getActivity</span><span class=p>(</span><span class=k>this</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=k>new</span> <span class=n>Intent</span><span class=p>(</span><span class=k>this</span><span class=p>,</span> <span class=n>MainActivity</span><span class=p>.</span><span class=na>class</span><span class=p>),</span> <span class=n>PendingIntent</span><span class=p>.</span><span class=na>FLAG_UPDATE_CURRENT</span><span class=p>);</span>
<span class=n>remoteViews</span><span class=p>.</span><span class=na>setOnClickPendingIntent</span><span class=p>(</span><span class=n>R</span><span class=p>.</span><span class=na>id</span><span class=p>.</span><span class=na>iv_file</span><span class=p>,</span> <span class=n>pendingIntent1</span><span class=p>);</span>

<span class=n>builder</span><span class=p>.</span><span class=na>setSmallIcon</span><span class=p>(</span><span class=n>R</span><span class=p>.</span><span class=na>mipmap</span><span class=p>.</span><span class=na>ic_launcher</span><span class=p>)</span>
        <span class=p>.</span><span class=na>setTicker</span><span class=p>(</span><span class=s>&quot;hello world&quot;</span><span class=p>)</span>
        <span class=p>.</span><span class=na>setWhen</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>currentTimeMillis</span><span class=p>())</span>
        <span class=p>.</span><span class=na>setCustomContentView</span><span class=p>(</span><span class=n>remoteViews</span><span class=p>)</span>
        <span class=p>.</span><span class=na>setContentIntent</span><span class=p>(</span><span class=n>pendingIntent</span><span class=p>);</span>
<span class=n>Notification</span> <span class=n>notification</span> <span class=o>=</span> <span class=n>builder</span><span class=p>.</span><span class=na>build</span><span class=p>();</span>
<span class=n>notification</span><span class=p>.</span><span class=na>flags</span> <span class=o>=</span> <span class=n>Notification</span><span class=p>.</span><span class=na>FLAG_AUTO_CANCEL</span><span class=p>;</span>

<span class=n>NotificationManager</span> <span class=n>notificationManager</span> <span class=o>=</span> <span class=p>(</span><span class=n>NotificationManager</span><span class=p>)</span> <span class=n>getSystemService</span><span class=p>(</span><span class=n>Context</span><span class=p>.</span><span class=na>NOTIFICATION_SERVICE</span><span class=p>);</span>
<span class=n>notificationManager</span><span class=p>.</span><span class=na>notify</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=n>notification</span><span class=p>);</span>
</pre></div> <p><img alt=自定义通知样式 src=/assets/images/android/remoteviews-custom-notification.png></p> <p>我们只需要提供当前应用的包名和布局文件的资源id就可以创建一个<code>RemoteViews</code>。更新<code>RemoteViews</code>里面的View需要通过<code>RemoteViews</code>提供的一系列的方法来更新View。</p> <h3 id=12-remoteviews>1.2 RemoteViews在桌面小部件上的应用<a class=headerlink href=#12-remoteviews title="Permanent link">&para;</a></h3> <p><code>AppWidgetProvider</code>是Android中提供的用于实现桌面小部件的类，其本质是一个广播。</p> <p>桌面小部件的开发步骤可以分为以下几步： </p> <p><strong>1.定义小部件界面</strong><br> 在<code>res/layout</code>下面新建一个小部件的布局文件。　 <div class=codehilite><pre><span></span>// res/layout/widget.xml
<span class=cp>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class=nt>&lt;LinearLayout</span>
    <span class=na>xmlns:android=</span><span class=s>&quot;http://schemas.android.com/apk/res/android&quot;</span>
    <span class=na>android:layout_width=</span><span class=s>&quot;match_parent&quot;</span>
    <span class=na>android:layout_height=</span><span class=s>&quot;match_parent&quot;</span><span class=nt>&gt;</span>

    <span class=nt>&lt;ImageView</span>
        <span class=na>android:id=</span><span class=s>&quot;@+id/iv_app_widget&quot;</span>
        <span class=na>android:layout_width=</span><span class=s>&quot;match_parent&quot;</span>
        <span class=na>android:layout_height=</span><span class=s>&quot;match_parent&quot;</span>
        <span class=na>android:src=</span><span class=s>&quot;@mipmap/ic_launcher&quot;</span><span class=nt>/&gt;</span>

<span class=nt>&lt;/LinearLayout&gt;</span>
</pre></div></p> <p><strong>2.定义小部件配置信息</strong><br> 在<code>res/xml</code>下新建<code>appwidget_provider_info.xml</code>文件 <div class=codehilite><pre><span></span><span class=cp>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class=nt>&lt;appwidget-provider</span>
    <span class=na>xmlns:android=</span><span class=s>&quot;http://schemas.android.com/apk/res/android&quot;</span>
    <span class=na>android:initialLayout=</span><span class=s>&quot;@layout/widget&quot;</span>
    <span class=na>android:minHeight=</span><span class=s>&quot;80dp&quot;</span>
    <span class=na>android:minWidth=</span><span class=s>&quot;80dp&quot;</span>
    <span class=na>android:updatePeriodMillis=</span><span class=s>&quot;86400000&quot;</span><span class=nt>/&gt;</span>
</pre></div></p> <p><strong>3.定义小部件的实现类</strong><br> 这个类需要继承<code>AppWidgetProvider</code>，代码如下： <div class=codehilite><pre><span></span><span class=kd>public</span> <span class=kd>class</span> <span class=nc>MyAppWidgetProvider</span> <span class=kd>extends</span> <span class=n>AppWidgetProvider</span> <span class=p>{</span>

    <span class=kd>public</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>String</span> <span class=n>CLICK_ACTION</span> <span class=o>=</span> <span class=s>&quot;yorek.demoandtest.remoteview.action.CLICK&quot;</span><span class=p>;</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>onReceive</span><span class=p>(</span><span class=kd>final</span> <span class=n>Context</span> <span class=n>context</span><span class=p>,</span> <span class=kd>final</span> <span class=n>Intent</span> <span class=n>intent</span><span class=p>)</span> <span class=p>{</span>
        <span class=kd>super</span><span class=p>.</span><span class=na>onReceive</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=n>intent</span><span class=p>);</span>

        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>CLICK_ACTION</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>intent</span><span class=p>.</span><span class=na>getAction</span><span class=p>()))</span> <span class=p>{</span>
            <span class=k>return</span><span class=p>;</span>
        <span class=p>}</span>

        <span class=n>Toast</span><span class=p>.</span><span class=na>makeText</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=s>&quot;clicked it&quot;</span><span class=p>,</span> <span class=n>Toast</span><span class=p>.</span><span class=na>LENGTH_SHORT</span><span class=p>).</span><span class=na>show</span><span class=p>();</span>

        <span class=k>new</span> <span class=n>Thread</span><span class=p>(</span><span class=k>new</span> <span class=n>Runnable</span><span class=p>()</span> <span class=p>{</span>
            <span class=nd>@Override</span>
            <span class=kd>public</span> <span class=kt>void</span> <span class=nf>run</span><span class=p>()</span> <span class=p>{</span>
                <span class=n>Bitmap</span> <span class=n>srcbBitmap</span> <span class=o>=</span> <span class=n>BitmapFactory</span><span class=p>.</span><span class=na>decodeResource</span><span class=p>(</span><span class=n>context</span><span class=p>.</span><span class=na>getResources</span><span class=p>(),</span> <span class=n>R</span><span class=p>.</span><span class=na>mipmap</span><span class=p>.</span><span class=na>ic_launcher</span><span class=p>);</span>
                <span class=n>AppWidgetManager</span> <span class=n>appWidgetManager</span> <span class=o>=</span> <span class=n>AppWidgetManager</span><span class=p>.</span><span class=na>getInstance</span><span class=p>(</span><span class=n>context</span><span class=p>);</span>

                <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>37</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
                    <span class=kt>float</span> <span class=n>degree</span> <span class=o>=</span> <span class=p>(</span><span class=n>i</span> <span class=o>*</span> <span class=mi>10</span><span class=p>)</span> <span class=o>%</span> <span class=mi>360</span><span class=p>;</span>
                    <span class=n>RemoteViews</span> <span class=n>remoteViews</span> <span class=o>=</span> <span class=k>new</span> <span class=n>RemoteViews</span><span class=p>(</span><span class=n>context</span><span class=p>.</span><span class=na>getPackageName</span><span class=p>(),</span> <span class=n>R</span><span class=p>.</span><span class=na>layout</span><span class=p>.</span><span class=na>widget</span><span class=p>);</span>
                    <span class=n>remoteViews</span><span class=p>.</span><span class=na>setImageViewBitmap</span><span class=p>(</span><span class=n>R</span><span class=p>.</span><span class=na>id</span><span class=p>.</span><span class=na>iv_app_widget</span><span class=p>,</span> <span class=n>rotateBitmap</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=n>srcbBitmap</span><span class=p>,</span> <span class=n>degree</span><span class=p>));</span>

                    <span class=n>Intent</span> <span class=n>clickIntent</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Intent</span><span class=p>(</span><span class=n>CLICK_ACTION</span><span class=p>);</span>
                    <span class=n>PendingIntent</span> <span class=n>pendingIntent</span> <span class=o>=</span> <span class=n>PendingIntent</span><span class=p>.</span><span class=na>getBroadcast</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=n>clickIntent</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
                    <span class=n>remoteViews</span><span class=p>.</span><span class=na>setOnClickPendingIntent</span><span class=p>(</span><span class=n>R</span><span class=p>.</span><span class=na>id</span><span class=p>.</span><span class=na>iv_app_widget</span><span class=p>,</span> <span class=n>pendingIntent</span><span class=p>);</span>

                    <span class=n>appWidgetManager</span><span class=p>.</span><span class=na>updateAppWidget</span><span class=p>(</span><span class=k>new</span> <span class=n>ComponentName</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=n>MyAppWidgetProvider</span><span class=p>.</span><span class=na>class</span><span class=p>),</span> <span class=n>remoteViews</span><span class=p>);</span>
                    <span class=n>SystemClock</span><span class=p>.</span><span class=na>sleep</span><span class=p>(</span><span class=mi>30</span><span class=p>);</span>
                <span class=p>}</span>
            <span class=p>}</span>
        <span class=p>}).</span><span class=na>start</span><span class=p>();</span>
    <span class=p>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>onUpdate</span><span class=p>(</span><span class=n>Context</span> <span class=n>context</span><span class=p>,</span> <span class=n>AppWidgetManager</span> <span class=n>appWidgetManager</span><span class=p>,</span> <span class=kt>int</span><span class=o>[]</span> <span class=n>appWidgetIds</span><span class=p>)</span> <span class=p>{</span>
        <span class=kd>super</span><span class=p>.</span><span class=na>onUpdate</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=n>appWidgetManager</span><span class=p>,</span> <span class=n>appWidgetIds</span><span class=p>);</span>

        <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>appWidgetId</span> <span class=p>:</span> <span class=n>appWidgetIds</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>onWidgetUpdate</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=n>appWidgetManager</span><span class=p>,</span> <span class=n>appWidgetId</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>}</span>

    <span class=kd>private</span> <span class=n>Bitmap</span> <span class=nf>rotateBitmap</span><span class=p>(</span><span class=n>Context</span> <span class=n>context</span><span class=p>,</span> <span class=n>Bitmap</span> <span class=n>bitmap</span><span class=p>,</span> <span class=kt>float</span> <span class=n>degree</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>Matrix</span> <span class=n>matrix</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Matrix</span><span class=p>();</span>
        <span class=n>matrix</span><span class=p>.</span><span class=na>reset</span><span class=p>();</span>
        <span class=n>matrix</span><span class=p>.</span><span class=na>setRotate</span><span class=p>(</span><span class=n>degree</span><span class=p>);</span>
        <span class=k>return</span> <span class=n>Bitmap</span><span class=p>.</span><span class=na>createBitmap</span><span class=p>(</span><span class=n>bitmap</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=n>bitmap</span><span class=p>.</span><span class=na>getWidth</span><span class=p>(),</span> <span class=n>bitmap</span><span class=p>.</span><span class=na>getHeight</span><span class=p>(),</span> <span class=n>matrix</span><span class=p>,</span> <span class=kc>true</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>onWidgetUpdate</span><span class=p>(</span><span class=n>Context</span> <span class=n>context</span><span class=p>,</span> <span class=n>AppWidgetManager</span> <span class=n>appWidgetManager</span><span class=p>,</span> <span class=kt>int</span> <span class=n>appWidgetId</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>RemoteViews</span> <span class=n>remoteViews</span> <span class=o>=</span> <span class=k>new</span> <span class=n>RemoteViews</span><span class=p>(</span><span class=n>context</span><span class=p>.</span><span class=na>getPackageName</span><span class=p>(),</span> <span class=n>R</span><span class=p>.</span><span class=na>layout</span><span class=p>.</span><span class=na>widget</span><span class=p>);</span>

        <span class=n>Intent</span> <span class=n>intent</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Intent</span><span class=p>(</span><span class=n>CLICK_ACTION</span><span class=p>);</span>
        <span class=n>PendingIntent</span> <span class=n>pendingIntent</span> <span class=o>=</span> <span class=n>PendingIntent</span><span class=p>.</span><span class=na>getBroadcast</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=n>intent</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
        <span class=n>remoteViews</span><span class=p>.</span><span class=na>setOnClickPendingIntent</span><span class=p>(</span><span class=n>R</span><span class=p>.</span><span class=na>id</span><span class=p>.</span><span class=na>iv_app_widget</span><span class=p>,</span> <span class=n>pendingIntent</span><span class=p>);</span>

        <span class=n>appWidgetManager</span><span class=p>.</span><span class=na>updateAppWidget</span><span class=p>(</span><span class=n>appWidgetId</span><span class=p>,</span> <span class=n>remoteViews</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</pre></div> 上面的代码实现了一个简单的桌面小部件，在小部件上面显示一张图片，单击它后，这个图片就会旋转一周。<br> 当小部件添加到桌面后，会通过<code>RemoteViews</code>来加载布局文件，当小部件被单击后的旋转效果则是通过不断的更新<code>RemoteViews</code>来实现的。</p> <p>由此可见，桌面小部件不管是初始化界面还是后续的更新界面都必须使用<code>RemoteViews</code>来完成。</p> <p><strong>4.在AndroidManifest中声明小部件</strong><br> 桌面小插件本质上还是一个广播，因此必须进行注册。 <div class=codehilite><pre><span></span><span class=nt>&lt;receiver</span> <span class=na>android:name=</span><span class=s>&quot;.remoteview.MyAppWidgetProvider&quot;</span><span class=nt>&gt;</span>
   <span class=nt>&lt;meta-data</span>
       <span class=na>android:name=</span><span class=s>&quot;android.appwidget.provider&quot;</span>
       <span class=na>android:resource=</span><span class=s>&quot;@xml/appwidget_provider_info&quot;</span> <span class=nt>/&gt;</span>

   <span class=nt>&lt;intent-filter&gt;</span>
       <span class=nt>&lt;action</span> <span class=na>android:name=</span><span class=s>&quot;yorek.demoandtest.remoteview.action.CLICK&quot;</span> <span class=nt>/&gt;</span>
       <span class=nt>&lt;action</span> <span class=na>android:name=</span><span class=s>&quot;android.appwidget.action.APPWIDGET_UPDATE&quot;</span> <span class=nt>/&gt;</span>
   <span class=nt>&lt;/intent-filter&gt;</span>
<span class=nt>&lt;/receiver&gt;</span>
</pre></div> 第一个action用于识别小部件的单击行为，而第二个action作为桌面小插件的标识而存在，这是系统的规范。如果不加，那么这个receiver不会识别成为一个桌面小部件，从而无法出现在手机的小部件列表中。</p> <p><code>AppWidgetProvider</code>除了常用的<code>onUpdate</code>方法外，还有<code>onEnabled</code>、<code>onDisabled</code>、<code>onDeteled</code>、<code>onReceive</code>等方法。这些方法会被<code>onReceive</code>根据action进行分发。</p> <ul> <li><code>onEnabled</code><br> 当小部件第一次添加到桌面时调用该方法，可添加多次但只在第一次调用</li> <li><code>onUpdate</code><br> 当小部件被添加或者每次小部件更新时都会调用，小部件的更新时机由<code>updatePeriodMillis</code>来指定。每个周期小部件会自动更新一次</li> <li><code>onDeteled</code><br> 每删除一次桌面小部件就会调用一次</li> <li><code>onDisabled</code><br> 当 <strong>最后一个</strong> 该类型的小部件被删除时就会调用该方法</li> <li><code>onReceive</code><br> 这是基类的方法，在小部件中用于分发具体的事件给其他方法</li> </ul> <p>关于<code>AppWidgetProvider</code>中具体事件的分发过程，源码如下: <div class=codehilite><pre><span></span><span class=cm>/**</span>
<span class=cm> * Implements {@link BroadcastReceiver#onReceive} to dispatch calls to the various</span>
<span class=cm> * other methods on AppWidgetProvider.  </span>
<span class=cm> *</span>
<span class=cm> * @param context The Context in which the receiver is running.</span>
<span class=cm> * @param intent The Intent being received.</span>
<span class=cm> */</span>
<span class=c1>// BEGIN_INCLUDE(onReceive)</span>
<span class=kd>public</span> <span class=kt>void</span> <span class=nf>onReceive</span><span class=p>(</span><span class=n>Context</span> <span class=n>context</span><span class=p>,</span> <span class=n>Intent</span> <span class=n>intent</span><span class=p>)</span> <span class=p>{</span>
    <span class=c1>// Protect against rogue update broadcasts (not really a security issue,</span>
    <span class=c1>// just filter bad broacasts out so subclasses are less likely to crash).</span>
    <span class=n>String</span> <span class=n>action</span> <span class=o>=</span> <span class=n>intent</span><span class=p>.</span><span class=na>getAction</span><span class=p>();</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>AppWidgetManager</span><span class=p>.</span><span class=na>ACTION_APPWIDGET_UPDATE</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>action</span><span class=p>))</span> <span class=p>{</span>
        <span class=n>Bundle</span> <span class=n>extras</span> <span class=o>=</span> <span class=n>intent</span><span class=p>.</span><span class=na>getExtras</span><span class=p>();</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>extras</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
            <span class=kt>int</span><span class=o>[]</span> <span class=n>appWidgetIds</span> <span class=o>=</span> <span class=n>extras</span><span class=p>.</span><span class=na>getIntArray</span><span class=p>(</span><span class=n>AppWidgetManager</span><span class=p>.</span><span class=na>EXTRA_APPWIDGET_IDS</span><span class=p>);</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>appWidgetIds</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>appWidgetIds</span><span class=p>.</span><span class=na>length</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
                <span class=k>this</span><span class=p>.</span><span class=na>onUpdate</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=n>AppWidgetManager</span><span class=p>.</span><span class=na>getInstance</span><span class=p>(</span><span class=n>context</span><span class=p>),</span> <span class=n>appWidgetIds</span><span class=p>);</span>
            <span class=p>}</span>
        <span class=p>}</span>
    <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>AppWidgetManager</span><span class=p>.</span><span class=na>ACTION_APPWIDGET_DELETED</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>action</span><span class=p>))</span> <span class=p>{</span>
        <span class=n>Bundle</span> <span class=n>extras</span> <span class=o>=</span> <span class=n>intent</span><span class=p>.</span><span class=na>getExtras</span><span class=p>();</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>extras</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>extras</span><span class=p>.</span><span class=na>containsKey</span><span class=p>(</span><span class=n>AppWidgetManager</span><span class=p>.</span><span class=na>EXTRA_APPWIDGET_ID</span><span class=p>))</span> <span class=p>{</span>
            <span class=kd>final</span> <span class=kt>int</span> <span class=n>appWidgetId</span> <span class=o>=</span> <span class=n>extras</span><span class=p>.</span><span class=na>getInt</span><span class=p>(</span><span class=n>AppWidgetManager</span><span class=p>.</span><span class=na>EXTRA_APPWIDGET_ID</span><span class=p>);</span>
            <span class=k>this</span><span class=p>.</span><span class=na>onDeleted</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=k>new</span> <span class=kt>int</span><span class=o>[]</span> <span class=p>{</span> <span class=n>appWidgetId</span> <span class=p>});</span>
        <span class=p>}</span>
    <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>AppWidgetManager</span><span class=p>.</span><span class=na>ACTION_APPWIDGET_OPTIONS_CHANGED</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>action</span><span class=p>))</span> <span class=p>{</span>
        <span class=n>Bundle</span> <span class=n>extras</span> <span class=o>=</span> <span class=n>intent</span><span class=p>.</span><span class=na>getExtras</span><span class=p>();</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>extras</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>extras</span><span class=p>.</span><span class=na>containsKey</span><span class=p>(</span><span class=n>AppWidgetManager</span><span class=p>.</span><span class=na>EXTRA_APPWIDGET_ID</span><span class=p>)</span>
                <span class=o>&amp;&amp;</span> <span class=n>extras</span><span class=p>.</span><span class=na>containsKey</span><span class=p>(</span><span class=n>AppWidgetManager</span><span class=p>.</span><span class=na>EXTRA_APPWIDGET_OPTIONS</span><span class=p>))</span> <span class=p>{</span>
            <span class=kt>int</span> <span class=n>appWidgetId</span> <span class=o>=</span> <span class=n>extras</span><span class=p>.</span><span class=na>getInt</span><span class=p>(</span><span class=n>AppWidgetManager</span><span class=p>.</span><span class=na>EXTRA_APPWIDGET_ID</span><span class=p>);</span>
            <span class=n>Bundle</span> <span class=n>widgetExtras</span> <span class=o>=</span> <span class=n>extras</span><span class=p>.</span><span class=na>getBundle</span><span class=p>(</span><span class=n>AppWidgetManager</span><span class=p>.</span><span class=na>EXTRA_APPWIDGET_OPTIONS</span><span class=p>);</span>
            <span class=k>this</span><span class=p>.</span><span class=na>onAppWidgetOptionsChanged</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=n>AppWidgetManager</span><span class=p>.</span><span class=na>getInstance</span><span class=p>(</span><span class=n>context</span><span class=p>),</span>
                    <span class=n>appWidgetId</span><span class=p>,</span> <span class=n>widgetExtras</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>AppWidgetManager</span><span class=p>.</span><span class=na>ACTION_APPWIDGET_ENABLED</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>action</span><span class=p>))</span> <span class=p>{</span>
        <span class=k>this</span><span class=p>.</span><span class=na>onEnabled</span><span class=p>(</span><span class=n>context</span><span class=p>);</span>
    <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>AppWidgetManager</span><span class=p>.</span><span class=na>ACTION_APPWIDGET_DISABLED</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>action</span><span class=p>))</span> <span class=p>{</span>
        <span class=k>this</span><span class=p>.</span><span class=na>onDisabled</span><span class=p>(</span><span class=n>context</span><span class=p>);</span>
    <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>AppWidgetManager</span><span class=p>.</span><span class=na>ACTION_APPWIDGET_RESTORED</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>action</span><span class=p>))</span> <span class=p>{</span>
        <span class=n>Bundle</span> <span class=n>extras</span> <span class=o>=</span> <span class=n>intent</span><span class=p>.</span><span class=na>getExtras</span><span class=p>();</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>extras</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
            <span class=kt>int</span><span class=o>[]</span> <span class=n>oldIds</span> <span class=o>=</span> <span class=n>extras</span><span class=p>.</span><span class=na>getIntArray</span><span class=p>(</span><span class=n>AppWidgetManager</span><span class=p>.</span><span class=na>EXTRA_APPWIDGET_OLD_IDS</span><span class=p>);</span>
            <span class=kt>int</span><span class=o>[]</span> <span class=n>newIds</span> <span class=o>=</span> <span class=n>extras</span><span class=p>.</span><span class=na>getIntArray</span><span class=p>(</span><span class=n>AppWidgetManager</span><span class=p>.</span><span class=na>EXTRA_APPWIDGET_IDS</span><span class=p>);</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>oldIds</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>oldIds</span><span class=p>.</span><span class=na>length</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
                <span class=k>this</span><span class=p>.</span><span class=na>onRestored</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=n>oldIds</span><span class=p>,</span> <span class=n>newIds</span><span class=p>);</span>
                <span class=k>this</span><span class=p>.</span><span class=na>onUpdate</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=n>AppWidgetManager</span><span class=p>.</span><span class=na>getInstance</span><span class=p>(</span><span class=n>context</span><span class=p>),</span> <span class=n>newIds</span><span class=p>);</span>
            <span class=p>}</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>
<span class=c1>// END_INCLUDE(onReceive)</span>
</pre></div></p> <h3 id=13-pendingintent>1.3 PendingIntent概述<a class=headerlink href=#13-pendingintent title="Permanent link">&para;</a></h3> <p><code>PendingIntent</code>与<code>Intent</code>的区别在于，<code>PendingIntent</code>是将在某个不确定时刻发生，而<code>Intent</code>是立刻发生。想要给<code>RemoteViews</code>设置点击事件，必须使用<code>PendingIntent</code>，<code>PendingIntent</code>通过<code>send</code>和<code>cancel</code>方法来发送和取消特定的<code>PendingIntent</code>。</p> <p><code>PendingIntent</code>支持三种类型，启动<code>Activity</code>、启动<code>Service</code>、发送广播，对应三个方法：</p> <table> <thead> <tr> <th align=center>方法名</th> <th align=center>含义</th> </tr> </thead> <tbody> <tr> <td align=center>getActivity</td> <td align=center>获得一个可以启动Activity的PendingIntent</td> </tr> <tr> <td align=center>getService</td> <td align=center>获得一个可以启动Activity的PendingIntent</td> </tr> <tr> <td align=center>getBroadcast</td> <td align=center>获得一个可以发送广播的PendingIntent</td> </tr> </tbody> </table> <p>上面这三个方法的参数都是相同的<code>getActivity(Context context, int requestCode, Intent intent, int flags)</code> </p> <ul> <li>requestCode<br> 表示<code>PendingIntent</code>发送方的请求码，多数情况设置为0即可，另外requestCode会影响到flags的效果。</li> <li>flags<br> 类型有：<code>FLAG_ONE_SHOT</code>、<code>FLAG_NO_CREATE</code>、<code>FLAG_CANCEL_CURRENT</code>、<code>FLAG_UPDATE_CURRENT</code>等</li> </ul> <p>flags是用来标记<code>PendingIntent</code>效果的，这里面需要判断<code>PendingIntent</code>是否是相等的。因此，我们先需要了解<code>PendingIntent</code>的匹配规则。</p> <blockquote> <p>如果两个<code>PendingIntent</code>它们内部的<code>Intent</code>相同而且<code>requestCode</code>也相同，那么这两个<code>PendingIntent</code>就是相同的。<br> 如果两个<code>Intent</code>的<code>ComponentName</code>和<code>intent-filter</code>都相同，那么这两个<code>Intent</code>就是相等的。需要注意的是，Extras不参与Intent的匹配过程。</p> </blockquote> <p>flags的含义如下： </p> <ul> <li><code>FLAG_ONE_SHOT</code><br> <code>PendingIntent</code>只能使用一次，然后就会被自动取消，后续还有相同的<code>PendingIntent</code>的<code>send</code>就会调用失败。</li> <li><code>FLAG_NO_CREATE</code><br> <code>PendingIntent</code>不会主动创建，如果当前<code>PendingIntent</code>不存在，那么<code>getActivity</code>等方法会返回null，即获取<code>PendingIntent</code>失败。</li> <li><code>FLAG_CANCEL_CURRENT</code><br> 如果当前<code>PendingIntent</code>已经存在，那么它们会被cancel，然后系统会创建一个新的<code>PendingIntent</code>。</li> <li><code>FLAG_UPDATE_CURRENT</code><br> 当前<code>PendingIntent</code>已经存在，那么它们都会被更新，即它们的<code>Intent</code>中的extra data会被替换成新的。</li> </ul> <p>结合通知的发送，捋一下上面这些标记位：</p> <ol> <li>如果<code>NotificationManager.notify</code>的id是同一个值，那么不管<code>PendingIntent</code>是否匹配，后面的通知都会直接替换前面的通知。</li> <li>如果<code>notify</code>的id值不同，那么<code>PendingIntent</code>不匹配时，这些通知之间不会干扰；</li> <li>如果<code>notify</code>的id值不同且<code>PendingIntent</code>匹配时 <ol> <li>FLAG_ONE_SHOT<br> 后续通知中的<code>PendingIntent</code>会和第一条保持一致，包括其中的extra data；点击任何一条通知后，剩下的通知匀无法打开，当所有的通知都被清除后，会再次重复这个过程。</li> <li>FLAG_CANCEL_CURRENT<br> 只有最新的通知可以打开，之前弹出的通知均无法打开</li> <li>FLAG_UPDATE_CURRENT<br> 之前弹出的通知中的<code>PendingIntent</code>都会更新，最终它们和最新的一体通知保持完全一致，包括其中的extra data，并且这些通知都是可以打开的。</li> </ol> </li> </ol> <h2 id=2-remoteviews>2 RemoteViews的内部机制<a class=headerlink href=#2-remoteviews title="Permanent link">&para;</a></h2> <p><code>RemoteViews</code>的作用是 <strong>在其他进程中显示并更新View界面</strong>。</p> <blockquote> <p><code>RemoteViews</code>不能支持所有的View类型，它所支持的所有类型如下：<br> - FrameLayout、LinerLayout、RelativeLayout、GridLayout<br> - AnalogClock、Button、Chronometer、ImageButton、ImageView、ProgressBar、TextView、ViewFilpper、ListView、GridView、StackView、AdapterViewFlipper以及ViewStub </p> <p>From <a href=https://developer.android.com/guide/topics/appwidgets/index.html#CreatingLayout>Creating the App Widget Layout</a></p> </blockquote> <p>因为<code>RemoteViews</code>运行在系统进程中，所以没有提供一系列<code>findViewById</code>方法，无法直接访问里面的View元素，因此<code>RemoteViews</code>所提供的一系列set方法。下面是常见的方法：</p> <table> <thead> <tr> <th>方法名</th> <th>作用</th> </tr> </thead> <tbody> <tr> <td>setTextViewText(int viewId, CharSequence text)</td> <td>设置TextView的文本</td> </tr> <tr> <td>setTextViewTextSize(int viewId, int units, float size)</td> <td>设置TextView的文本大小</td> </tr> <tr> <td>setTextColor(int viewId, <a class="magiclink magiclink-github magiclink-mention" href=https://github.com/ColorInt title="GitHub User: ColorInt">@ColorInt</a> int color)</td> <td>设置TextView的文本颜色</td> </tr> <tr> <td>setImageViewResource(int viewId, int srcId)</td> <td>设置ImageView的图片资源</td> </tr> <tr> <td>setImageViewBitmap(int viewId, Bitmap bitmap)</td> <td>设置TextView的图片</td> </tr> <tr> <td>setInt(int viewId, String methodName, int value)</td> <td>反射调用View对象的参数类型为int的方法</td> </tr> <tr> <td>setLong(int viewId, String methodName, long value)</td> <td>反射调用View对象的参数类型为long的方法</td> </tr> <tr> <td>setOnClickPendingIntent(int viewId, PendingIntent pendingIntent)</td> <td>为view添加点击事件，事件类型只能为PendingIntent</td> </tr> </tbody> </table> <p><code>RemoteViews</code>的大部分set方法的确是通过反射来完成的。</p> <p>下面我们来分析一下<code>RemoteViews</code>的工作过程。<code>RemoteViews</code>会通过<code>Binder</code>传递到<code>SystemServer</code>进程，这是因为<code>RemoteViews</code>实现了<code>Parcelable</code>接口，因此它可以进行跨进程传输。系统会根据<code>RemoteViews</code>中的包名等信息去得到该应用的资源。然后通过<code>LayoutInflater</code>去加载<code>RemoteViews</code>中的布局文件。在<code>SystemServer</code>进程中加载后的布局文件是一个普通的<code>View</code>，只不过相对于我们的进程它是一个<code>RemoteViews</code>。接着系统会对<code>View</code>执行一系列界面更新任务，这些任务就是之前我们通过<code>set</code>方法来提交的。<code>set</code>方法对<code>View</code>所做的更新并不是立刻执行的，在<code>RemoteViews</code>内部会纪录所有的更新操作，具体的执行时机要等到<code>RemoteViews</code>被加载以后才能执行，这样<code>RemoteViews</code>就可以在<code>SystemServer</code>进程中显示了。</p> <p>系统并没有通过<code>Binder</code>去直接支持<code>View</code>的跨进程访问，而是提供了一个<code>Action</code>的概念，<code>Action</code>代表一个<code>View</code>操作，<code>Action</code>同样实现了<code>Parcelable</code>接口。首先系统会将<code>View</code>操作封装到<code>Action</code>对象并将这些对象跨进程传输到远程进程，接着在远程进程中执行<code>Action</code>的操作。在我们的应用中每调用一次set方法，<code>RemoteViews</code>中就会添加一个对应的<code>Action</code>对象，当我们通过<code>NotificationManager</code>和<code>AppWidgetManager</code>提交更新时，这些<code>Action</code>对象就会传输到远程进程中并在远程进程中依次执行。远程进程通过<code>RemoteViews</code>的<code>apply</code>方法进行View的更新操作，<code>RemoteViews#apply</code>方法内部会去遍历所有的<code>Action</code>对象并调用它们的<code>apply</code>方法，具体的View更新操作是由<code>Action</code>对象的<code>apply</code>方法来完成的。</p> <p><img alt=RemoteViews的内部机制 src=/assets/images/android/remoteviews.png></p> <h3 id=21-remoteviews>2.1 RemoteViews的创建<a class=headerlink href=#21-remoteviews title="Permanent link">&para;</a></h3> <p><code>RemoteViews</code>的创建比较简单，只是保存了创建<code>RemoteViews</code>的应用信息(<code>ApplicationInfo</code>)以及布局资源的id，并没有做实质性的工作：</p> <div class=codehilite><pre><span></span><span class=kd>public</span> <span class=nf>RemoteViews</span><span class=p>(</span><span class=n>String</span> <span class=n>packageName</span><span class=p>,</span> <span class=kt>int</span> <span class=n>layoutId</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>this</span><span class=p>(</span><span class=n>getApplicationInfo</span><span class=p>(</span><span class=n>packageName</span><span class=p>,</span> <span class=n>UserHandle</span><span class=p>.</span><span class=na>myUserId</span><span class=p>()),</span> <span class=n>layoutId</span><span class=p>);</span>
<span class=p>}</span>

<span class=kd>protected</span> <span class=nf>RemoteViews</span><span class=p>(</span><span class=n>ApplicationInfo</span> <span class=n>application</span><span class=p>,</span> <span class=kt>int</span> <span class=n>layoutId</span><span class=p>)</span> <span class=p>{</span>
    <span class=n>mApplication</span> <span class=o>=</span> <span class=n>application</span><span class=p>;</span>
    <span class=n>mLayoutId</span> <span class=o>=</span> <span class=n>layoutId</span><span class=p>;</span>
    <span class=n>mBitmapCache</span> <span class=o>=</span> <span class=k>new</span> <span class=n>BitmapCache</span><span class=p>();</span>
    <span class=c1>// setup the memory usage statistics</span>
    <span class=n>mMemoryUsageCounter</span> <span class=o>=</span> <span class=k>new</span> <span class=n>MemoryUsageCounter</span><span class=p>();</span>
    <span class=n>recalculateMemoryUsage</span><span class=p>();</span>
<span class=p>}</span>
</pre></div> <h3 id=22-remoteviews>2.2 RemoteViews的样式、点击事件设置<a class=headerlink href=#22-remoteviews title="Permanent link">&para;</a></h3> <p>我们只看看上面表格中列出的这些方法，首先从<code>setTextViewText</code>的方法执行顺序说起：</p> <div class=codehilite><pre><span></span><span class=kd>public</span> <span class=kt>void</span> <span class=nf>setTextViewText</span><span class=p>(</span><span class=kt>int</span> <span class=n>viewId</span><span class=p>,</span> <span class=n>CharSequence</span> <span class=n>text</span><span class=p>)</span> <span class=p>{</span>
    <span class=n>setCharSequence</span><span class=p>(</span><span class=n>viewId</span><span class=p>,</span> <span class=s>&quot;setText&quot;</span><span class=p>,</span> <span class=n>text</span><span class=p>);</span>
<span class=p>}</span>

<span class=kd>public</span> <span class=kt>void</span> <span class=nf>setCharSequence</span><span class=p>(</span><span class=kt>int</span> <span class=n>viewId</span><span class=p>,</span> <span class=n>String</span> <span class=n>methodName</span><span class=p>,</span> <span class=n>CharSequence</span> <span class=n>value</span><span class=p>)</span> <span class=p>{</span>
    <span class=n>addAction</span><span class=p>(</span><span class=k>new</span> <span class=n>ReflectionAction</span><span class=p>(</span><span class=n>viewId</span><span class=p>,</span> <span class=n>methodName</span><span class=p>,</span> <span class=n>ReflectionAction</span><span class=p>.</span><span class=na>CHAR_SEQUENCE</span><span class=p>,</span> <span class=n>value</span><span class=p>));</span>
<span class=p>}</span>
</pre></div> <p>我们看到，<code>setTextViewText</code>方法最后只是将参数包装成了一个<code>ReflectionAction</code>，然后调用了<code>addAction</code>方法。<br> <code>addAction</code>方法只是将<code>Action</code>加入到了<code>mActions</code>这个列表中，保存了起来。</p> <div class=codehilite><pre><span></span><span class=kd>private</span> <span class=kt>void</span> <span class=nf>addAction</span><span class=p>(</span><span class=n>Action</span> <span class=n>a</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>hasLandscapeAndPortraitLayouts</span><span class=p>())</span> <span class=p>{</span>
        <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=p>(</span><span class=s>&quot;RemoteViews specifying separate landscape and portrait&quot;</span> <span class=o>+</span>
                <span class=s>&quot; layouts cannot be modified. Instead, fully configure the landscape and&quot;</span> <span class=o>+</span>
                <span class=s>&quot; portrait layouts individually before constructing the combined layout.&quot;</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>mActions</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>mActions</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;</span><span class=n>Action</span><span class=o>&gt;</span><span class=p>();</span>
    <span class=p>}</span>
    <span class=n>mActions</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>a</span><span class=p>);</span>

    <span class=c1>// update the memory usage stats</span>
    <span class=n>a</span><span class=p>.</span><span class=na>updateMemoryUsageEstimate</span><span class=p>(</span><span class=n>mMemoryUsageCounter</span><span class=p>);</span>
<span class=p>}</span>
</pre></div> <p>这些<code>Action</code>会在<code>RemoteViews#apply</code>方法里面去执行：</p> <div class=codehilite><pre><span></span><span class=kd>public</span> <span class=n>View</span> <span class=nf>apply</span><span class=p>(</span><span class=n>Context</span> <span class=n>context</span><span class=p>,</span> <span class=n>ViewGroup</span> <span class=n>parent</span><span class=p>,</span> <span class=n>OnClickHandler</span> <span class=n>handler</span><span class=p>)</span> <span class=p>{</span>
   <span class=n>RemoteViews</span> <span class=n>rvToApply</span> <span class=o>=</span> <span class=n>getRemoteViewsToApply</span><span class=p>(</span><span class=n>context</span><span class=p>);</span>

   <span class=n>View</span> <span class=n>result</span> <span class=o>=</span> <span class=n>inflateView</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=n>rvToApply</span><span class=p>,</span> <span class=n>parent</span><span class=p>);</span>
   <span class=n>loadTransitionOverride</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=n>handler</span><span class=p>);</span>

   <span class=n>rvToApply</span><span class=p>.</span><span class=na>performApply</span><span class=p>(</span><span class=n>result</span><span class=p>,</span> <span class=n>parent</span><span class=p>,</span> <span class=n>handler</span><span class=p>);</span>

   <span class=k>return</span> <span class=n>result</span><span class=p>;</span>
<span class=p>}</span>

<span class=kd>private</span> <span class=n>View</span> <span class=nf>inflateView</span><span class=p>(</span><span class=n>Context</span> <span class=n>context</span><span class=p>,</span> <span class=n>RemoteViews</span> <span class=n>rv</span><span class=p>,</span> <span class=n>ViewGroup</span> <span class=n>parent</span><span class=p>)</span> <span class=p>{</span>
    <span class=c1>// RemoteViews may be built by an application installed in another</span>
    <span class=c1>// user. So build a context that loads resources from that user but</span>
    <span class=c1>// still returns the current users userId so settings like data / time formats</span>
    <span class=c1>// are loaded without requiring cross user persmissions.</span>
    <span class=kd>final</span> <span class=n>Context</span> <span class=n>contextForResources</span> <span class=o>=</span> <span class=n>getContextForResources</span><span class=p>(</span><span class=n>context</span><span class=p>);</span>
    <span class=n>Context</span> <span class=n>inflationContext</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ContextWrapper</span><span class=p>(</span><span class=n>context</span><span class=p>)</span> <span class=p>{</span>
        <span class=nd>@Override</span>
        <span class=kd>public</span> <span class=n>Resources</span> <span class=nf>getResources</span><span class=p>()</span> <span class=p>{</span>
            <span class=k>return</span> <span class=n>contextForResources</span><span class=p>.</span><span class=na>getResources</span><span class=p>();</span>
        <span class=p>}</span>
        <span class=nd>@Override</span>
        <span class=kd>public</span> <span class=n>Resources</span><span class=p>.</span><span class=na>Theme</span> <span class=nf>getTheme</span><span class=p>()</span> <span class=p>{</span>
            <span class=k>return</span> <span class=n>contextForResources</span><span class=p>.</span><span class=na>getTheme</span><span class=p>();</span>
        <span class=p>}</span>
        <span class=nd>@Override</span>
        <span class=kd>public</span> <span class=n>String</span> <span class=nf>getPackageName</span><span class=p>()</span> <span class=p>{</span>
            <span class=k>return</span> <span class=n>contextForResources</span><span class=p>.</span><span class=na>getPackageName</span><span class=p>();</span>
        <span class=p>}</span>
    <span class=p>};</span>

    <span class=n>LayoutInflater</span> <span class=n>inflater</span> <span class=o>=</span> <span class=p>(</span><span class=n>LayoutInflater</span><span class=p>)</span>
            <span class=n>context</span><span class=p>.</span><span class=na>getSystemService</span><span class=p>(</span><span class=n>Context</span><span class=p>.</span><span class=na>LAYOUT_INFLATER_SERVICE</span><span class=p>);</span>

    <span class=c1>// Clone inflater so we load resources from correct context and</span>
    <span class=c1>// we don&#39;t add a filter to the static version returned by getSystemService.</span>
    <span class=n>inflater</span> <span class=o>=</span> <span class=n>inflater</span><span class=p>.</span><span class=na>cloneInContext</span><span class=p>(</span><span class=n>inflationContext</span><span class=p>);</span>
    <span class=n>inflater</span><span class=p>.</span><span class=na>setFilter</span><span class=p>(</span><span class=k>this</span><span class=p>);</span>
    <span class=n>View</span> <span class=n>v</span> <span class=o>=</span> <span class=n>inflater</span><span class=p>.</span><span class=na>inflate</span><span class=p>(</span><span class=n>rv</span><span class=p>.</span><span class=na>getLayoutId</span><span class=p>(),</span> <span class=n>parent</span><span class=p>,</span> <span class=kc>false</span><span class=p>);</span>
    <span class=n>v</span><span class=p>.</span><span class=na>setTagInternal</span><span class=p>(</span><span class=n>R</span><span class=p>.</span><span class=na>id</span><span class=p>.</span><span class=na>widget_frame</span><span class=p>,</span> <span class=n>rv</span><span class=p>.</span><span class=na>getLayoutId</span><span class=p>());</span>
    <span class=k>return</span> <span class=n>v</span><span class=p>;</span>
<span class=p>}</span>
</pre></div> <p>从上面的代码可以看出，系统会通过<code>LayoutInflater</code>加载<code>RemoteViews</code>中的布局文件，<code>RemoteViews</code>中的布局文件可以通过<code>getLayoutId</code>方法获得，加载完成后会通过<code>performApply</code>去执行一些更新操作。该方法代码如下：</p> <div class=codehilite><pre><span></span><span class=kd>private</span> <span class=kt>void</span> <span class=nf>performApply</span><span class=p>(</span><span class=n>View</span> <span class=n>v</span><span class=p>,</span> <span class=n>ViewGroup</span> <span class=n>parent</span><span class=p>,</span> <span class=n>OnClickHandler</span> <span class=n>handler</span><span class=p>)</span> <span class=p>{</span>
   <span class=k>if</span> <span class=p>(</span><span class=n>mActions</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
       <span class=n>handler</span> <span class=o>=</span> <span class=n>handler</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>?</span> <span class=n>DEFAULT_ON_CLICK_HANDLER</span> <span class=p>:</span> <span class=n>handler</span><span class=p>;</span>
       <span class=kd>final</span> <span class=kt>int</span> <span class=n>count</span> <span class=o>=</span> <span class=n>mActions</span><span class=p>.</span><span class=na>size</span><span class=p>();</span>
       <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>count</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
           <span class=n>Action</span> <span class=n>a</span> <span class=o>=</span> <span class=n>mActions</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>i</span><span class=p>);</span>
           <span class=n>a</span><span class=p>.</span><span class=na>apply</span><span class=p>(</span><span class=n>v</span><span class=p>,</span> <span class=n>parent</span><span class=p>,</span> <span class=n>handler</span><span class=p>);</span>
       <span class=p>}</span>
   <span class=p>}</span>
<span class=p>}</span>
</pre></div> <p>这段代码的作用就是遍历<code>mActions</code>，并执行每个<code>Action</code>的<code>apply</code>方法。因此，<code>Action</code>的<code>apply</code>方法就是真正操作View的地方。</p> <h3 id=23-remoteviews>2.3 RemoteViews的渲染<a class=headerlink href=#23-remoteviews title="Permanent link">&para;</a></h3> <p>在<code>AppWidgetManager#upadteAppWidget</code>方法内部，它们确实是通过<code>RemoteViews</code>的<code>apply</code>和<code>reapply</code>方法来加载或者更新界面的，两者的区别在于前者会加载布局并更新界面，后者只会更新界面。Notification和AppWidget在初始化的时候会调用<code>apply</code>方法，而在后续更新界面时会调用<code>reapply</code>方法。</p> <p>我们看一下Notification中的<code>RemoteViews</code>更新问题，代码在<code>BaseStatusBar#updateNotificationViews</code>方法中： <div class=codehilite><pre><span></span><span class=kd>private</span> <span class=kt>void</span> <span class=nf>updateNotificationViews</span><span class=p>(</span><span class=n>Entry</span> <span class=n>entry</span><span class=p>,</span> <span class=n>StatusBarNotification</span> <span class=n>sbn</span><span class=p>)</span> <span class=p>{</span>
   <span class=kd>final</span> <span class=n>RemoteViews</span> <span class=n>contentView</span> <span class=o>=</span> <span class=n>entry</span><span class=p>.</span><span class=na>cachedContentView</span><span class=p>;</span>
   <span class=kd>final</span> <span class=n>RemoteViews</span> <span class=n>bigContentView</span> <span class=o>=</span> <span class=n>entry</span><span class=p>.</span><span class=na>cachedBigContentView</span><span class=p>;</span>
   <span class=kd>final</span> <span class=n>RemoteViews</span> <span class=n>headsUpContentView</span> <span class=o>=</span> <span class=n>entry</span><span class=p>.</span><span class=na>cachedHeadsUpContentView</span><span class=p>;</span>
   <span class=kd>final</span> <span class=n>RemoteViews</span> <span class=n>publicContentView</span> <span class=o>=</span> <span class=n>entry</span><span class=p>.</span><span class=na>cachedPublicContentView</span><span class=p>;</span>

   <span class=c1>// Reapply the RemoteViews</span>
   <span class=n>contentView</span><span class=p>.</span><span class=na>reapply</span><span class=p>(</span><span class=n>mContext</span><span class=p>,</span> <span class=n>entry</span><span class=p>.</span><span class=na>getContentView</span><span class=p>(),</span> <span class=n>mOnClickHandler</span><span class=p>);</span>
   <span class=k>if</span> <span class=p>(</span><span class=n>bigContentView</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>entry</span><span class=p>.</span><span class=na>getExpandedContentView</span><span class=p>()</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
       <span class=n>bigContentView</span><span class=p>.</span><span class=na>reapply</span><span class=p>(</span><span class=n>sbn</span><span class=p>.</span><span class=na>getPackageContext</span><span class=p>(</span><span class=n>mContext</span><span class=p>),</span>
               <span class=n>entry</span><span class=p>.</span><span class=na>getExpandedContentView</span><span class=p>(),</span>
               <span class=n>mOnClickHandler</span><span class=p>);</span>
   <span class=p>}</span>
   <span class=n>View</span> <span class=n>headsUpChild</span> <span class=o>=</span> <span class=n>entry</span><span class=p>.</span><span class=na>getHeadsUpContentView</span><span class=p>();</span>
   <span class=k>if</span> <span class=p>(</span><span class=n>headsUpContentView</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>headsUpChild</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
       <span class=n>headsUpContentView</span><span class=p>.</span><span class=na>reapply</span><span class=p>(</span><span class=n>sbn</span><span class=p>.</span><span class=na>getPackageContext</span><span class=p>(</span><span class=n>mContext</span><span class=p>),</span>
               <span class=n>headsUpChild</span><span class=p>,</span> <span class=n>mOnClickHandler</span><span class=p>);</span>
   <span class=p>}</span>
   <span class=k>if</span> <span class=p>(</span><span class=n>publicContentView</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>entry</span><span class=p>.</span><span class=na>getPublicContentView</span><span class=p>()</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
       <span class=n>publicContentView</span><span class=p>.</span><span class=na>reapply</span><span class=p>(</span><span class=n>sbn</span><span class=p>.</span><span class=na>getPackageContext</span><span class=p>(</span><span class=n>mContext</span><span class=p>),</span>
               <span class=n>entry</span><span class=p>.</span><span class=na>getPublicContentView</span><span class=p>(),</span> <span class=n>mOnClickHandler</span><span class=p>);</span>
   <span class=p>}</span>
   <span class=c1>// update the contentIntent</span>
   <span class=n>mNotificationClicker</span><span class=p>.</span><span class=na>register</span><span class=p>(</span><span class=n>entry</span><span class=p>.</span><span class=na>row</span><span class=p>,</span> <span class=n>sbn</span><span class=p>);</span>

   <span class=n>entry</span><span class=p>.</span><span class=na>row</span><span class=p>.</span><span class=na>onNotificationUpdated</span><span class=p>(</span><span class=n>entry</span><span class=p>);</span>
   <span class=n>entry</span><span class=p>.</span><span class=na>row</span><span class=p>.</span><span class=na>resetHeight</span><span class=p>();</span>
<span class=p>}</span>
</pre></div> 很显然，在通知栏界面需要更新时，会调用<code>RemoteViews</code>的<code>reapply</code>方法来更新界面。</p> <p>接着看一下AppWidget的更新，在<code>AppWidgetHostView#updateAppWidget</code>方法中： <div class=codehilite><pre><span></span><span class=c1>// Prepare a local reference to the remote Context so we&#39;re ready to</span>
<span class=c1>// inflate any requested LayoutParams.</span>
<span class=n>mRemoteContext</span> <span class=o>=</span> <span class=n>getRemoteContext</span><span class=p>();</span>
<span class=kt>int</span> <span class=n>layoutId</span> <span class=o>=</span> <span class=n>remoteViews</span><span class=p>.</span><span class=na>getLayoutId</span><span class=p>();</span>

<span class=c1>// If our stale view has been prepared to match active, and the new</span>
<span class=c1>// layout matches, try recycling it</span>
<span class=k>if</span> <span class=p>(</span><span class=n>content</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>layoutId</span> <span class=o>==</span> <span class=n>mLayoutId</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>try</span> <span class=p>{</span>
        <span class=n>remoteViews</span><span class=p>.</span><span class=na>reapply</span><span class=p>(</span><span class=n>mContext</span><span class=p>,</span> <span class=n>mView</span><span class=p>,</span> <span class=n>mOnClickHandler</span><span class=p>);</span>
        <span class=n>content</span> <span class=o>=</span> <span class=n>mView</span><span class=p>;</span>
        <span class=n>recycled</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>LOGD</span><span class=p>)</span> <span class=n>Log</span><span class=p>.</span><span class=na>d</span><span class=p>(</span><span class=n>TAG</span><span class=p>,</span> <span class=s>&quot;was able to recycle existing layout&quot;</span><span class=p>);</span>
    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>RuntimeException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>exception</span> <span class=o>=</span> <span class=n>e</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>}</span>

<span class=c1>// Try normal RemoteView inflation</span>
<span class=k>if</span> <span class=p>(</span><span class=n>content</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>try</span> <span class=p>{</span>
        <span class=n>content</span> <span class=o>=</span> <span class=n>remoteViews</span><span class=p>.</span><span class=na>apply</span><span class=p>(</span><span class=n>mContext</span><span class=p>,</span> <span class=k>this</span><span class=p>,</span> <span class=n>mOnClickHandler</span><span class=p>);</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>LOGD</span><span class=p>)</span> <span class=n>Log</span><span class=p>.</span><span class=na>d</span><span class=p>(</span><span class=n>TAG</span><span class=p>,</span> <span class=s>&quot;had to inflate new layout&quot;</span><span class=p>);</span>
    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>RuntimeException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>exception</span> <span class=o>=</span> <span class=n>e</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>}</span>
</pre></div> 从上面代码可以看出，AppWidget在更新界面时也是通过<code>RemoteViews</code>的<code>reapply</code>方法来实现的。</p> <h3 id=24-action>2.4 Action子类的具体实现<a class=headerlink href=#24-action title="Permanent link">&para;</a></h3> <p>在了解<code>RemoteViews</code>的作用机制后，我们回过头来看<code>Action</code>的子类的具体实现。</p> <p>在这之前，我们先看看<code>RemoteViews</code>常用方法对应哪些具体的<code>Action</code>:</p> <table> <thead> <tr> <th>RemoteViews支持的方法</th> <th>对应的Action</th> </tr> </thead> <tbody> <tr> <td>setTextViewText(int viewId, CharSequence text)</td> <td>ReflectionAction</td> </tr> <tr> <td>setTextViewTextSize(int viewId, int units, float size)</td> <td>TextViewSizeAction</td> </tr> <tr> <td>setTextColor(int viewId, <a class="magiclink magiclink-github magiclink-mention" href=https://github.com/ColorInt title="GitHub User: ColorInt">@ColorInt</a> int color)</td> <td>ReflectionAction</td> </tr> <tr> <td>setImageViewResource(int viewId, int srcId)</td> <td>ReflectionAction</td> </tr> <tr> <td>setImageViewBitmap(int viewId, Bitmap bitmap)</td> <td>BitmapReflectionAction</td> </tr> <tr> <td>setInt(int viewId, String methodName, int value)</td> <td>ReflectionAction</td> </tr> <tr> <td>setLong(int viewId, String methodName, long value)</td> <td>ReflectionAction</td> </tr> <tr> <td>setOnClickPendingIntent(int viewId, PendingIntent pendingIntent)</td> <td>SetOnClickPendingIntent</td> </tr> </tbody> </table> <p>我们首先看看<code>ReflectionAction</code>的具体实现。这些<code>Action</code>的实现都在<code>RemoteViews</code>的内部。</p> <div class=codehilite><pre><span></span><span class=kd>private</span> <span class=kd>final</span> <span class=kd>class</span> <span class=nc>ReflectionAction</span> <span class=kd>extends</span> <span class=n>Action</span> <span class=p>{</span>
    <span class=p>...</span>
    <span class=n>String</span> <span class=n>methodName</span><span class=p>;</span>
    <span class=kt>int</span> <span class=n>type</span><span class=p>;</span>
    <span class=n>Object</span> <span class=n>value</span><span class=p>;</span>

    <span class=n>ReflectionAction</span><span class=p>(</span><span class=kt>int</span> <span class=n>viewId</span><span class=p>,</span> <span class=n>String</span> <span class=n>methodName</span><span class=p>,</span> <span class=kt>int</span> <span class=n>type</span><span class=p>,</span> <span class=n>Object</span> <span class=n>value</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>this</span><span class=p>.</span><span class=na>viewId</span> <span class=o>=</span> <span class=n>viewId</span><span class=p>;</span>
        <span class=k>this</span><span class=p>.</span><span class=na>methodName</span> <span class=o>=</span> <span class=n>methodName</span><span class=p>;</span>
        <span class=k>this</span><span class=p>.</span><span class=na>type</span> <span class=o>=</span> <span class=n>type</span><span class=p>;</span>
        <span class=k>this</span><span class=p>.</span><span class=na>value</span> <span class=o>=</span> <span class=n>value</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=p>...</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>apply</span><span class=p>(</span><span class=n>View</span> <span class=n>root</span><span class=p>,</span> <span class=n>ViewGroup</span> <span class=n>rootParent</span><span class=p>,</span> <span class=n>OnClickHandler</span> <span class=n>handler</span><span class=p>)</span> <span class=p>{</span>
        <span class=kd>final</span> <span class=n>View</span> <span class=n>view</span> <span class=o>=</span> <span class=n>root</span><span class=p>.</span><span class=na>findViewById</span><span class=p>(</span><span class=n>viewId</span><span class=p>);</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>view</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=k>return</span><span class=p>;</span>

        <span class=n>Class</span><span class=o>&lt;?&gt;</span> <span class=n>param</span> <span class=o>=</span> <span class=n>getParameterType</span><span class=p>();</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>param</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>throw</span> <span class=k>new</span> <span class=n>ActionException</span><span class=p>(</span><span class=s>&quot;bad type: &quot;</span> <span class=o>+</span> <span class=k>this</span><span class=p>.</span><span class=na>type</span><span class=p>);</span>
        <span class=p>}</span>

        <span class=k>try</span> <span class=p>{</span>
            <span class=n>getMethod</span><span class=p>(</span><span class=n>view</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=na>methodName</span><span class=p>,</span> <span class=n>param</span><span class=p>).</span><span class=na>invoke</span><span class=p>(</span><span class=n>view</span><span class=p>,</span> <span class=n>wrapArg</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=na>value</span><span class=p>));</span>
        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>ActionException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>throw</span> <span class=n>e</span><span class=p>;</span>
        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>Exception</span> <span class=n>ex</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>throw</span> <span class=k>new</span> <span class=n>ActionException</span><span class=p>(</span><span class=n>ex</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>}</span>
    <span class=p>...</span>
<span class=p>}</span>
</pre></div> <p>很显然，这是通过反射调用<code>View</code>里面的API来完成更新<code>View</code>的操作的。</p> <p>接着，我们看一下<code>TextViewSizeAction</code>的实现：</p> <p><div class=codehilite><pre><span></span><span class=kd>private</span> <span class=kd>class</span> <span class=nc>TextViewSizeAction</span> <span class=kd>extends</span> <span class=n>Action</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=nf>TextViewSizeAction</span><span class=p>(</span><span class=kt>int</span> <span class=n>viewId</span><span class=p>,</span> <span class=kt>int</span> <span class=n>units</span><span class=p>,</span> <span class=kt>float</span> <span class=n>size</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>this</span><span class=p>.</span><span class=na>viewId</span> <span class=o>=</span> <span class=n>viewId</span><span class=p>;</span>
        <span class=k>this</span><span class=p>.</span><span class=na>units</span> <span class=o>=</span> <span class=n>units</span><span class=p>;</span>
        <span class=k>this</span><span class=p>.</span><span class=na>size</span> <span class=o>=</span> <span class=n>size</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=p>...</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>apply</span><span class=p>(</span><span class=n>View</span> <span class=n>root</span><span class=p>,</span> <span class=n>ViewGroup</span> <span class=n>rootParent</span><span class=p>,</span> <span class=n>OnClickHandler</span> <span class=n>handler</span><span class=p>)</span> <span class=p>{</span>
        <span class=kd>final</span> <span class=n>TextView</span> <span class=n>target</span> <span class=o>=</span> <span class=p>(</span><span class=n>TextView</span><span class=p>)</span> <span class=n>root</span><span class=p>.</span><span class=na>findViewById</span><span class=p>(</span><span class=n>viewId</span><span class=p>);</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>target</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=k>return</span><span class=p>;</span>
        <span class=n>target</span><span class=p>.</span><span class=na>setTextSize</span><span class=p>(</span><span class=n>units</span><span class=p>,</span> <span class=n>size</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=p>...</span>
    <span class=kt>int</span> <span class=n>units</span><span class=p>;</span>
    <span class=kt>float</span> <span class=n>size</span><span class=p>;</span>
<span class=p>}</span>
</pre></div> 我们可以看到，这里直接调用了<code>TextView#setTextSize(int, float)</code>方法来完成目的。这里不用反射的原因是，该方法有两个参数，所以无法复用<code>ReflectionAction</code>。</p> <blockquote> <p>既然可以直接调用View的对应方法，为什么不为大多数常用的方法提供一个Action呢？<br> 一个可能的原因是：为大多数常用方法单独提供Action，这实在是工作量太大了，既然大多数属性都可以反射调用，那就反射好了。</p> </blockquote> <p>然后是<code>BitmapReflectionAction</code>的实现：</p> <div class=codehilite><pre><span></span><span class=kd>private</span> <span class=kd>class</span> <span class=nc>BitmapReflectionAction</span> <span class=kd>extends</span> <span class=n>Action</span> <span class=p>{</span>
    <span class=kt>int</span> <span class=n>bitmapId</span><span class=p>;</span>
    <span class=n>Bitmap</span> <span class=n>bitmap</span><span class=p>;</span>
    <span class=n>String</span> <span class=n>methodName</span><span class=p>;</span>

    <span class=n>BitmapReflectionAction</span><span class=p>(</span><span class=kt>int</span> <span class=n>viewId</span><span class=p>,</span> <span class=n>String</span> <span class=n>methodName</span><span class=p>,</span> <span class=n>Bitmap</span> <span class=n>bitmap</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>this</span><span class=p>.</span><span class=na>bitmap</span> <span class=o>=</span> <span class=n>bitmap</span><span class=p>;</span>
        <span class=k>this</span><span class=p>.</span><span class=na>viewId</span> <span class=o>=</span> <span class=n>viewId</span><span class=p>;</span>
        <span class=k>this</span><span class=p>.</span><span class=na>methodName</span> <span class=o>=</span> <span class=n>methodName</span><span class=p>;</span>
        <span class=n>bitmapId</span> <span class=o>=</span> <span class=n>mBitmapCache</span><span class=p>.</span><span class=na>getBitmapId</span><span class=p>(</span><span class=n>bitmap</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=p>...</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>apply</span><span class=p>(</span><span class=n>View</span> <span class=n>root</span><span class=p>,</span> <span class=n>ViewGroup</span> <span class=n>rootParent</span><span class=p>,</span>
            <span class=n>OnClickHandler</span> <span class=n>handler</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>ActionException</span> <span class=p>{</span>
        <span class=n>ReflectionAction</span> <span class=n>ra</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ReflectionAction</span><span class=p>(</span><span class=n>viewId</span><span class=p>,</span> <span class=n>methodName</span><span class=p>,</span> <span class=n>ReflectionAction</span><span class=p>.</span><span class=na>BITMAP</span><span class=p>,</span>
                <span class=n>bitmap</span><span class=p>);</span>
        <span class=n>ra</span><span class=p>.</span><span class=na>apply</span><span class=p>(</span><span class=n>root</span><span class=p>,</span> <span class=n>rootParent</span><span class=p>,</span> <span class=n>handler</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=p>...</span>
<span class=p>}</span>
</pre></div> <p>我们发现，其只是对传入的bitmap进行了缓存处理，然后就调用了<code>ReflectionAction</code>的实现。</p> <p>最后看一下<code>SetOnClickPendingIntent</code>的实现：</p> <div class=codehilite><pre><span></span><span class=kd>private</span> <span class=kd>class</span> <span class=nc>SetOnClickPendingIntent</span> <span class=kd>extends</span> <span class=n>Action</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=nf>SetOnClickPendingIntent</span><span class=p>(</span><span class=kt>int</span> <span class=n>id</span><span class=p>,</span> <span class=n>PendingIntent</span> <span class=n>pendingIntent</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>this</span><span class=p>.</span><span class=na>viewId</span> <span class=o>=</span> <span class=n>id</span><span class=p>;</span>
        <span class=k>this</span><span class=p>.</span><span class=na>pendingIntent</span> <span class=o>=</span> <span class=n>pendingIntent</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=p>...</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>apply</span><span class=p>(</span><span class=n>View</span> <span class=n>root</span><span class=p>,</span> <span class=n>ViewGroup</span> <span class=n>rootParent</span><span class=p>,</span> <span class=kd>final</span> <span class=n>OnClickHandler</span> <span class=n>handler</span><span class=p>)</span> <span class=p>{</span>
        <span class=kd>final</span> <span class=n>View</span> <span class=n>target</span> <span class=o>=</span> <span class=n>root</span><span class=p>.</span><span class=na>findViewById</span><span class=p>(</span><span class=n>viewId</span><span class=p>);</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>target</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=k>return</span><span class=p>;</span>

        <span class=c1>// If the view is an AdapterView, setting a PendingIntent on click doesn&#39;t make much</span>
        <span class=c1>// sense, do they mean to set a PendingIntent template for the AdapterView&#39;s children?</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>mIsWidgetCollectionChild</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>Log</span><span class=p>.</span><span class=na>w</span><span class=p>(</span><span class=n>LOG_TAG</span><span class=p>,</span> <span class=s>&quot;Cannot setOnClickPendingIntent for collection item &quot;</span> <span class=o>+</span>
                    <span class=s>&quot;(id: &quot;</span> <span class=o>+</span> <span class=n>viewId</span> <span class=o>+</span> <span class=s>&quot;)&quot;</span><span class=p>);</span>
            <span class=n>ApplicationInfo</span> <span class=n>appInfo</span> <span class=o>=</span> <span class=n>root</span><span class=p>.</span><span class=na>getContext</span><span class=p>().</span><span class=na>getApplicationInfo</span><span class=p>();</span>

            <span class=c1>// We let this slide for HC and ICS so as to not break compatibility. It should have</span>
            <span class=c1>// been disabled from the outset, but was left open by accident.</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>appInfo</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span>
                    <span class=n>appInfo</span><span class=p>.</span><span class=na>targetSdkVersion</span> <span class=o>&gt;=</span> <span class=n>Build</span><span class=p>.</span><span class=na>VERSION_CODES</span><span class=p>.</span><span class=na>JELLY_BEAN</span><span class=p>)</span> <span class=p>{</span>
                <span class=k>return</span><span class=p>;</span>
            <span class=p>}</span>
        <span class=p>}</span>

        <span class=c1>// If the pendingIntent is null, we clear the onClickListener</span>
        <span class=n>OnClickListener</span> <span class=n>listener</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>pendingIntent</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>listener</span> <span class=o>=</span> <span class=k>new</span> <span class=n>OnClickListener</span><span class=p>()</span> <span class=p>{</span>
                <span class=kd>public</span> <span class=kt>void</span> <span class=nf>onClick</span><span class=p>(</span><span class=n>View</span> <span class=n>v</span><span class=p>)</span> <span class=p>{</span>
                    <span class=c1>// Find target view location in screen coordinates and</span>
                    <span class=c1>// fill into PendingIntent before sending.</span>
                    <span class=kd>final</span> <span class=n>Rect</span> <span class=n>rect</span> <span class=o>=</span> <span class=n>getSourceBounds</span><span class=p>(</span><span class=n>v</span><span class=p>);</span>

                    <span class=kd>final</span> <span class=n>Intent</span> <span class=n>intent</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Intent</span><span class=p>();</span>
                    <span class=n>intent</span><span class=p>.</span><span class=na>setSourceBounds</span><span class=p>(</span><span class=n>rect</span><span class=p>);</span>
                    <span class=n>handler</span><span class=p>.</span><span class=na>onClickHandler</span><span class=p>(</span><span class=n>v</span><span class=p>,</span> <span class=n>pendingIntent</span><span class=p>,</span> <span class=n>intent</span><span class=p>);</span>
                <span class=p>}</span>
            <span class=p>};</span>
        <span class=p>}</span>
        <span class=n>target</span><span class=p>.</span><span class=na>setOnClickListener</span><span class=p>(</span><span class=n>listener</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=kd>public</span> <span class=n>String</span> <span class=nf>getActionName</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=s>&quot;SetOnClickPendingIntent&quot;</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=n>PendingIntent</span> <span class=n>pendingIntent</span><span class=p>;</span>

    <span class=kd>public</span> <span class=kd>final</span> <span class=kd>static</span> <span class=kt>int</span> <span class=n>TAG</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
<span class=p>}</span>
</pre></div> <p>这段代码也比较简单，实际上就是对目标View设置了点击事件而已。关于点击事件，<code>RemoteViews</code>中只支持发起<code>PendingIntent</code>。</p> <p>此外，我们需要注意<code>setOnClickPendingIntent</code>、<code>setPendingIntentTemplate</code>以及<code>setOnClickFillInIntent</code>它们之间的区别和联系：</p> <ol> <li>首先，<code>setOnClickPendingIntent</code>用于给普通View设置单击事件，但是不能给集合(<code>ListView</code>和<code>StackView</code>)中的View设置单击事件。</li> <li>如果要给集合中的item设置点击事件，则必须将<code>setPendingIntentTemplate</code>和<code>setOnClickFillInIntent</code>组合使用才可以。</li> </ol> <blockquote> <p>RemoteViews在实际使用中的意义在于：可以用来在一个应用中更新另一个应用的某个界面。这样相比AIDL而言效率比较高，但是它仅支持一些常用View，还不支持自定义View。</p> </blockquote> <hr> <div class=md-source-date> <small> 最后更新: 2020年1月14日 </small> </div> <h2 id=__comments>评论</h2> <div id=disqus_thread></div> <script>
    var disqus_config = function () {
      this.page.url = "https://blog.yorek.xyz/about-me/android/framework/RemoteViews/";
      this.page.identifier =
        "/android/framework/RemoteViews/";
    };
    (function() {
      var d = document, s = d.createElement("script");
      s.src = "//yorekliu.disqus.com/embed.js";
      s.setAttribute("data-timestamp", +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid"> <a href=../View的绘制原理/ title=View的绘制原理 class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> 上一页 </span> View的绘制原理 </span> </div> </a> <a href=../Drawable/ title=Android中的Drawable资源 class="md-flex md-footer-nav__link md-footer-nav__link--next" rel=next> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> 下一页 </span> Android中的Drawable资源 </span> </div> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> &copy; 2020 Yorek </div> powered by <a href=https://www.mkdocs.org>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ > Material for MkDocs</a> </div> <div class=md-footer-social> <link rel=stylesheet href=../../../assets/fonts/font-awesome.css> <a href=https://github.com/YorekLiu class="md-footer-social__link fa fa-github"></a> <a href=lyytogether@gmail.com class="md-footer-social__link fa fa-email"></a> </div> </div> </div> </footer> </div> <script src=../../../assets/javascripts/application.808e90bb.js></script> <script src=../../../assets/javascripts/lunr/lunr.stemmer.support.js></script> <script src=../../../assets/javascripts/lunr/tinyseg.js></script> <script src=../../../assets/javascripts/lunr/lunr.ja.js></script> <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script> <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script> </body> </html>
<!--
  Copyright (c) 2016-2020 Martin Donath <martin.donath@squidfunk.com>
  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:
  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.
  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
--> <!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=description content="An Android Developer."><link href=https://blog.yorek.xyz/about-me/android/other/soft-keyboard-in-app/ rel=canonical><meta name=author content="Yorek Liu"><meta name=lang:clipboard.copy content=复制><meta name=lang:clipboard.copied content=已复制><meta name=lang:search.language content=ja><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content=没有找到符合条件的结果><meta name=lang:search.result.one content="找到 1 个符合条件的结果"><meta name=lang:search.result.other content="# 个符合条件的结果"><meta name=lang:search.tokenizer content=[\uff0c\u3002]+><link rel="shortcut icon" href=../../../assets/images/favicon.ico><meta name=generator content="mkdocs-1.0.4, mkdocs-material-4.6.0"><title>App内自定义软键盘</title><link rel=stylesheet href=../../../assets/stylesheets/application.1b62728e.css><link rel=stylesheet href=../../../assets/stylesheets/application-palette.a8b3c06d.css><meta name=theme-color content><script src=../../../assets/javascripts/modernizr.268332fc.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel=stylesheet href=../../../assets/fonts/material-icons.css><link rel=manifest href=../../../manifest.webmanifest><script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-155096376-1", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script><script async src=https://www.google-analytics.com/analytics.js></script><!-- Determine title --><!-- The image needs to have an absolute URL --><!-- Open graph meta tags --><meta property=og:type content=website><meta property=og:title content="Yorek's - App内自定义软键盘"><meta property=og:description content="An Android Developer."><meta content=https://blog.yorek.xyz/about-me/android/other/soft-keyboard-in-app/ property=og:url><meta property=og:image content=https://blog.yorek.xyz/about-meassets/images/banner.png><meta property=og:image:type content=image/png><meta property=og:image:width content=1200><meta property=og:image:height content=630><!-- Twitter meta tags --><meta name=twitter:card content=summary_large_image><meta name=twitter:site content=@squidfunk><meta name=twitter:creator content=@squidfunk><meta name=twitter:title content="Yorek's - App内自定义软键盘"><meta name=twitter:description content="An Android Developer."><meta name=twitter:image content=https://blog.yorek.xyz/about-meassets/images/banner.png></head> <body dir=ltr data-md-color-primary=white data-md-color-accent=blue> <svg class=md-svg> <defs> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#1 tabindex=1 class=md-skip> 跳转至 </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=https://blog.yorek.xyz/about-me title="Yorek's" class="md-header-nav__button md-logo"> <img src=../../../assets/images/favicon.ico width=24 height=24> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> Yorek's </span> <span class=md-header-nav__topic> App内自定义软键盘 </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> 键入以开始搜索 </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container> <nav class="md-tabs md-tabs--active" data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../3rd-library/3rd-library-source-code/ class=md-tabs__link> Android </a> </li> <li class=md-tabs__item> <a href=../../../flutter/flutter_first_project_1/ class=md-tabs__link> Flutter </a> </li> <li class=md-tabs__item> <a href=../../../leetcode/ class=md-tabs__link> LeetCode </a> </li> <li class=md-tabs__item> <a href=../../../design-pattern/design-pattern/ class=md-tabs__link> Books </a> </li> </ul> </div> </nav> <main class=md-main role=main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=https://blog.yorek.xyz/about-me title="Yorek's" class="md-nav__button md-logo"> <img src=../../../assets/images/favicon.ico width=48 height=48> </a> Yorek's </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. title=Home class=md-nav__link> Home </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2 type=checkbox id=nav-2 checked> <label class=md-nav__link for=nav-2> Android </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-2> Android </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-1 type=checkbox id=nav-2-1> <label class=md-nav__link for=nav-2-1> 三方库源码解析 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-1> 三方库源码解析 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../3rd-library/3rd-library-source-code/ title=Android三方库源码分析 class=md-nav__link> Android三方库源码分析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/matrix/ title="微信APM Matrix解析" class=md-nav__link> 微信APM Matrix解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/matrix-trace/ title=Matrix-TraceCanary解析 class=md-nav__link> Matrix-TraceCanary解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/matrix-io/ title=Matrix-IOCanary解析 class=md-nav__link> Matrix-IOCanary解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/matrix-resource/ title=Matrix-ResourceCanary解析 class=md-nav__link> Matrix-ResourceCanary解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/matrix-sqlitelint/ title=Matrix-SQLiteLint解析 class=md-nav__link> Matrix-SQLiteLint解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/okhttp/ title=OkHttp3源码解析 class=md-nav__link> OkHttp3源码解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/retrofit/ title=Retrofit2源码解析 class=md-nav__link> Retrofit2源码解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/rxjava&rxandroid/ title=RxJava源码解析及使用实例 class=md-nav__link> RxJava源码解析及使用实例 </a> </li> <li class=md-nav__item> <a href=../RxJava/ title=RxJava操作符大全 class=md-nav__link> RxJava操作符大全 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide1/ title="Glide v4 源码解析（一）" class=md-nav__link> Glide v4 源码解析（一） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide2/ title="Glide v4 源码解析（二）" class=md-nav__link> Glide v4 源码解析（二） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide3/ title="Glide v4 源码解析（三）" class=md-nav__link> Glide v4 源码解析（三） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide4/ title="Glide v4 源码解析（四）" class=md-nav__link> Glide v4 源码解析（四） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide5/ title="Glide v4 源码解析（五）" class=md-nav__link> Glide v4 源码解析（五） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide6/ title="Glide v4 源码解析（六）" class=md-nav__link> Glide v4 源码解析（六） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide7/ title="Glide v4 源码解析（七）" class=md-nav__link> Glide v4 源码解析（七） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/migrate-to-glide/ title=杂记：从Picasso迁移至Glide class=md-nav__link> 杂记：从Picasso迁移至Glide </a> </li> <li class=md-nav__item> <a href=../../3rd-library/eventbus/ title=EventBus源码解析 class=md-nav__link> EventBus源码解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/leakcanary/ title=LeakCanary2源码解析 class=md-nav__link> LeakCanary2源码解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/permissiondispatcher/ title=PermissionDispatcher源码解析 class=md-nav__link> PermissionDispatcher源码解析 </a> </li> <li class=md-nav__item> <a href=../constraintlayout/ title=ConstraintLayout使用大全 class=md-nav__link> ConstraintLayout使用大全 </a> </li> <li class=md-nav__item> <a href=../dagger2/ title=初学者的Dagger2教程 class=md-nav__link> 初学者的Dagger2教程 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-2 type=checkbox id=nav-2-2> <label class=md-nav__link for=nav-2-2> Android开发高手课 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-2> Android开发高手课 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../paid/master/ title=Android开发高手课 class=md-nav__link> Android开发高手课 </a> </li> <li class=md-nav__item> <a href=../../paid/master/crash_1/ title="01 | 崩溃优化（上）：关于“崩溃”那些事儿" class=md-nav__link> 01 | 崩溃优化（上）：关于“崩溃”那些事儿 </a> </li> <li class=md-nav__item> <a href=../../paid/master/crash_2/ title="02 | 崩溃优化（下）：应用崩溃了，你应该如何去分析？" class=md-nav__link> 02 | 崩溃优化（下）：应用崩溃了，你应该如何去分析？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/memory_1/ title="03 | 内存优化（上）：4GB内存时代，再谈内存优化" class=md-nav__link> 03 | 内存优化（上）：4GB内存时代，再谈内存优化 </a> </li> <li class=md-nav__item> <a href=../../paid/master/memory_2/ title="04 | 内存优化（下）：内存优化这件事，应该从哪里着手？" class=md-nav__link> 04 | 内存优化（下）：内存优化这件事，应该从哪里着手？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/stuck_1/ title="05 | 卡顿优化（上）：你要掌握的卡顿分析方法" class=md-nav__link> 05 | 卡顿优化（上）：你要掌握的卡顿分析方法 </a> </li> <li class=md-nav__item> <a href=../../paid/master/stuck_2/ title="06 | 卡顿优化（下）：如何监控应用卡顿？" class=md-nav__link> 06 | 卡顿优化（下）：如何监控应用卡顿？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/stuck_3/ title="06补充篇 | 卡顿优化：卡顿现场与卡顿分析" class=md-nav__link> 06补充篇 | 卡顿优化：卡顿现场与卡顿分析 </a> </li> <li class=md-nav__item> <a href=../../paid/master/start_1/ title="07 | 启动优化（上）：从启动过程看启动速度优化" class=md-nav__link> 07 | 启动优化（上）：从启动过程看启动速度优化 </a> </li> <li class=md-nav__item> <a href=../../paid/master/start_2/ title="08 | 启动优化（下）：优化启动速度的进阶方法" class=md-nav__link> 08 | 启动优化（下）：优化启动速度的进阶方法 </a> </li> <li class=md-nav__item> <a href=../../paid/master/io_1/ title="09 | I/O优化（上）：开发工程师必备的I/O优化知识" class=md-nav__link> 09 | I/O优化（上）：开发工程师必备的I/O优化知识 </a> </li> <li class=md-nav__item> <a href=../../paid/master/io_2/ title="10 | I/O优化（中）：不同I/O方式的使用场景是什么？" class=md-nav__link> 10 | I/O优化（中）：不同I/O方式的使用场景是什么？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/io_3/ title="11 | I/O优化（下）：如何监控线上I/O操作？" class=md-nav__link> 11 | I/O优化（下）：如何监控线上I/O操作？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/storage_1/ title="12 | 存储优化（上）：常见的数据存储方法有哪些？" class=md-nav__link> 12 | 存储优化（上）：常见的数据存储方法有哪些？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/storage_2/ title="13 | 存储优化（中）：如何优化数据存储？" class=md-nav__link> 13 | 存储优化（中）：如何优化数据存储？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/storage_3/ title="14 | 存储优化（下）：数据库SQLite的使用和优化" class=md-nav__link> 14 | 存储优化（下）：数据库SQLite的使用和优化 </a> </li> <li class=md-nav__item> <a href=../../paid/master/network_1/ title="15 | 网络优化（上）：移动开发工程师必备的网络优化知识" class=md-nav__link> 15 | 网络优化（上）：移动开发工程师必备的网络优化知识 </a> </li> <li class=md-nav__item> <a href=../../paid/master/network_2/ title="16 | 网络优化（中）：复杂多变的移动网络该如何优化？" class=md-nav__link> 16 | 网络优化（中）：复杂多变的移动网络该如何优化？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/network_3/ title="17 | 网络优化（下）：大数据下网络该如何监控？" class=md-nav__link> 17 | 网络优化（下）：大数据下网络该如何监控？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/battery_1/ title="18 | 耗电优化（上）：从电量优化的演进看耗电分析" class=md-nav__link> 18 | 耗电优化（上）：从电量优化的演进看耗电分析 </a> </li> <li class=md-nav__item> <a href=../../paid/master/battery_2/ title="19 | 耗电优化（下）：耗电的优化方法与线上监控" class=md-nav__link> 19 | 耗电优化（下）：耗电的优化方法与线上监控 </a> </li> <li class=md-nav__item> <a href=../../paid/master/ui_1/ title="20 | UI 优化（上）：UI 渲染的几个关键概念" class=md-nav__link> 20 | UI 优化（上）：UI 渲染的几个关键概念 </a> </li> <li class=md-nav__item> <a href=../../paid/master/ui_2/ title="21 | UI 优化（下）：如何优化 UI 渲染？" class=md-nav__link> 21 | UI 优化（下）：如何优化 UI 渲染？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/package_1/ title="22 | 包体积优化（上）：如何减少安装包大小？" class=md-nav__link> 22 | 包体积优化（上）：如何减少安装包大小？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/package_2/ title="23 | 包体积优化（下）：资源优化的进阶实践" class=md-nav__link> 23 | 包体积优化（下）：资源优化的进阶实践 </a> </li> <li class=md-nav__item> <a href=../../paid/master/compile/ title="26 | 关于编译，你需要了解什么？" class=md-nav__link> 26 | 关于编译，你需要了解什么？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/bytecode/ title="27 | 编译插桩的三种方法：AspectJ、ASM、ReDex" class=md-nav__link> 27 | 编译插桩的三种方法：AspectJ、ASM、ReDex </a> </li> <li class=md-nav__item> <a href=../../paid/master/native_hook/ title="35 | Native Hook 技术，天使还是魔鬼？" class=md-nav__link> 35 | Native Hook 技术，天使还是魔鬼？ </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-3 type=checkbox id=nav-2-3> <label class=md-nav__link for=nav-2-3> Framework系列 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-3> Framework系列 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../framework/Android四大组件(1)/ title=Activity class=md-nav__link> Activity </a> </li> <li class=md-nav__item> <a href=../../framework/Android四大组件(2)/ title=Service class=md-nav__link> Service </a> </li> <li class=md-nav__item> <a href=../../framework/Android四大组件(3)/ title=Broadcasts class=md-nav__link> Broadcasts </a> </li> <li class=md-nav__item> <a href=../../framework/Android四大组件(4)/ title="Content Providers与Fragment" class=md-nav__link> Content Providers与Fragment </a> </li> <li class=md-nav__item> <a href=../../framework/IPC机制/ title=IPC机制 class=md-nav__link> IPC机制 </a> </li> <li class=md-nav__item> <a href=../../framework/View的事件体系/ title=View的事件体系 class=md-nav__link> View的事件体系 </a> </li> <li class=md-nav__item> <a href=../../framework/View的绘制原理/ title=View的绘制原理 class=md-nav__link> View的绘制原理 </a> </li> <li class=md-nav__item> <a href=../../framework/RemoteViews/ title=RemoteViews class=md-nav__link> RemoteViews </a> </li> <li class=md-nav__item> <a href=../../framework/Drawable/ title=Android中的Drawable资源 class=md-nav__link> Android中的Drawable资源 </a> </li> <li class=md-nav__item> <a href=../../framework/Android动画/ title=Android动画 class=md-nav__link> Android动画 </a> </li> <li class=md-nav__item> <a href=../../framework/Window与WindowManager/ title=Window与WindowManager class=md-nav__link> Window与WindowManager </a> </li> <li class=md-nav__item> <a href=../../framework/四大组件启动过程/ title=四大组件启动过程 class=md-nav__link> 四大组件启动过程 </a> </li> <li class=md-nav__item> <a href=../../framework/Android消息机制/ title=Android消息机制 class=md-nav__link> Android消息机制 </a> </li> <li class=md-nav__item> <a href=../../framework/Android线程与线程池/ title=Android线程与线程池 class=md-nav__link> Android线程与线程池 </a> </li> <li class=md-nav__item> <a href=../../framework/Bitmap的缓存与加载/ title=Bitmap的缓存与加载 class=md-nav__link> Bitmap的缓存与加载 </a> </li> <li class=md-nav__item> <a href=../../framework/JNI与NDK/ title=JNI与NDK编程简介 class=md-nav__link> JNI与NDK编程简介 </a> </li> <li class=md-nav__item> <a href=../../framework/性能优化/ title=Android性能优化 class=md-nav__link> Android性能优化 </a> </li> <li class=md-nav__item> <a href=../../framework/binder1-mediaservice/ title=Binder深入理解——以MediaService为例 class=md-nav__link> Binder深入理解——以MediaService为例 </a> </li> <li class=md-nav__item> <a href=../../framework/binder2/ title=Binder深入理解——罗老师系列 class=md-nav__link> Binder深入理解——罗老师系列 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-4 type=checkbox id=nav-2-4> <label class=md-nav__link for=nav-2-4> 付费知识归档 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-4> 付费知识归档 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-4-1 type=checkbox id=nav-2-4-1> <label class=md-nav__link for=nav-2-4-1> 某圈问题索引 </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-2-4-1> 某圈问题索引 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../paid/zsxq/zsxq_index/ title=某圈问题索引 class=md-nav__link> 某圈问题索引 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week1-synchronized/ title=理解Java中synchronized关键词 class=md-nav__link> 理解Java中synchronized关键词 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week2-service/ title=理解Service class=md-nav__link> 理解Service </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week3-activity/ title=理解Activity的启动模式 class=md-nav__link> 理解Activity的启动模式 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week4-startActivityForResult/ title=关于startActivityForResult class=md-nav__link> 关于startActivityForResult </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week5-view/ title=关于View的知识 class=md-nav__link> 关于View的知识 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week6-gradle/ title=关于Gradle的知识 class=md-nav__link> 关于Gradle的知识 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week7-serialization/ title=关于序列化的知识 class=md-nav__link> 关于序列化的知识 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week10-classloader/ title=Android中的ClassLoader class=md-nav__link> Android中的ClassLoader </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week11-binder/ title=Binder简介 class=md-nav__link> Binder简介 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week12-retrofit-okhttp/ title=OkHttp和Retrofit的作用以及两者之间的联系 class=md-nav__link> OkHttp和Retrofit的作用以及两者之间的联系 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week14-jvm-gc/ title=JVM中垃圾回收策略 class=md-nav__link> JVM中垃圾回收策略 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week16-keep-app-alive/ title=进程保活 class=md-nav__link> 进程保活 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week17-android-components/ title=四大组件的作用以及多进程 class=md-nav__link> 四大组件的作用以及多进程 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week20-network-protocol/ title=网络协议 class=md-nav__link> 网络协议 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week21-mvc&amp;mvp&mvvm/ title=MVC、MVP和MVVM class=md-nav__link> MVC、MVP和MVVM </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week22-android-studio-build/ title="Android Studio build过程" class=md-nav__link> Android Studio build过程 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week23-load-large-bitmap/ title=大尺寸图片加载问题 class=md-nav__link> 大尺寸图片加载问题 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-5 type=checkbox id=nav-2-5 checked> <label class=md-nav__link for=nav-2-5> 日常记录 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-5> 日常记录 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../annotation/ title=注解的定义及解析 class=md-nav__link> 注解的定义及解析 </a> </li> <li class=md-nav__item> <a href=../best_throttle_in_mvvm/ title=这可能是MVVM中最优雅的按键防抖方案 class=md-nav__link> 这可能是MVVM中最优雅的按键防抖方案 </a> </li> <li class=md-nav__item> <a href=../android-jenkins/ title="Jenkins for android" class=md-nav__link> Jenkins for android </a> </li> <li class=md-nav__item> <a href=../SystemProrities/ title=普通Android程序使用SystemProrities class=md-nav__link> 普通Android程序使用SystemProrities </a> </li> <li class=md-nav__item> <a href=../recyclerview-cache/ title=ListView、RecyclerView缓存策略解析 class=md-nav__link> ListView、RecyclerView缓存策略解析 </a> </li> <li class=md-nav__item> <a href=../recyclerview-item-docoration/ title=RecyclerView高级特性——ItemDecoration class=md-nav__link> RecyclerView高级特性——ItemDecoration </a> </li> <li class=md-nav__item> <a href=../recyclerview-others/ title=RecyclerView的一些使用细节 class=md-nav__link> RecyclerView的一些使用细节 </a> </li> <li class=md-nav__item> <a href=../RecyclerView-Sort&Delete/ title=RecyclerView高级特性——拖拽排序以及滑动删除 class=md-nav__link> RecyclerView高级特性——拖拽排序以及滑动删除 </a> </li> <li class=md-nav__item> <a href=../FAB-Behavior/ title=FloatingActionButton上滑隐藏下滑显示 class=md-nav__link> FloatingActionButton上滑隐藏下滑显示 </a> </li> <li class=md-nav__item> <a href=../nestedscrolling/ title=NestedScrolling机制 class=md-nav__link> NestedScrolling机制 </a> </li> <li class=md-nav__item> <a href=../porterduff/ title=使用Porter-Duff合成数字图像 class=md-nav__link> 使用Porter-Duff合成数字图像 </a> </li> <li class=md-nav__item> <a href=../runtime/ title="Android Runtime" class=md-nav__link> Android Runtime </a> </li> <li class=md-nav__item> <a href=../android_alias/ title=Android马甲包的那些事儿 class=md-nav__link> Android马甲包的那些事儿 </a> </li> <li class=md-nav__item> <a href=../Android-Development-Tool/ title=Android神兵利器 class=md-nav__link> Android神兵利器 </a> </li> <li class=md-nav__item> <a href=../FileProvider/ title=FileProvider class=md-nav__link> FileProvider </a> </li> <li class=md-nav__item> <a href=../Android判断导航栏高度/ title=Android判断虚拟按键(导航栏)显示与否、高度以及获取屏幕实际高度 class=md-nav__link> Android判断虚拟按键(导航栏)显示与否、高度以及获取屏幕实际高度 </a> </li> <li class=md-nav__item> <a href=../Android图片选择器/ title=Android图片选择器 class=md-nav__link> Android图片选择器 </a> </li> <li class=md-nav__item> <a href=../Android底部导航栏框架/ title=Android原生底部导航栏 class=md-nav__link> Android原生底部导航栏 </a> </li> <li class=md-nav__item> <a href=../Android搜索栏的实现/ title=Android搜索栏的实现 class=md-nav__link> Android搜索栏的实现 </a> </li> <li class=md-nav__item> <a href=../Android暂停音乐播放器的播放/ title=Android暂停酷狗、网易云音乐等音乐播放器的播放 class=md-nav__link> Android暂停酷狗、网易云音乐等音乐播放器的播放 </a> </li> <li class=md-nav__item> <a href=../Android滑动返回实践/ title=Android滑动返回实践 class=md-nav__link> Android滑动返回实践 </a> </li> <li class=md-nav__item> <a href=../Android程序反编译/ title=MacOS下Android程序反编译 class=md-nav__link> MacOS下Android程序反编译 </a> </li> <li class=md-nav__item> <a href=../Android通讯录快速读取/ title=Android通讯录快速读取 class=md-nav__link> Android通讯录快速读取 </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-toggle md-nav__toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> App内自定义软键盘 </label> <a href=./ title=App内自定义软键盘 class="md-nav__link md-nav__link--active"> App内自定义软键盘 </a> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>目录</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#1 class=md-nav__link> 1. 按键布局 </a> </li> <li class=md-nav__item> <a href=#2-keyboardview class=md-nav__link> 2. KeyboardView </a> </li> <li class=md-nav__item> <a href=#3 class=md-nav__link> 3. 键盘辅助类 </a> </li> <li class=md-nav__item> <a href=#4 class=md-nav__link> 4. 使用准备 </a> </li> <li class=md-nav__item> <a href=#__comments class="md-nav__link md-nav__link--active"> 评论 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../腾讯X5内核入坑指南/ title="腾讯TBS X5浏览器内核入坑指南" class=md-nav__link> 腾讯TBS X5浏览器内核入坑指南 </a> </li> <li class=md-nav__item> <a href=../琐碎知识点/ title=琐碎知识点 class=md-nav__link> 琐碎知识点 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3 type=checkbox id=nav-3> <label class=md-nav__link for=nav-3> Flutter </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-3> Flutter </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../flutter/flutter_first_project_1/ title=年轻人的第一个Flutter程序(1) class=md-nav__link> 年轻人的第一个Flutter程序(1) </a> </li> <li class=md-nav__item> <a href=../../../flutter/flutter_first_project_2/ title=年轻人的第一个Flutter程序(2) class=md-nav__link> 年轻人的第一个Flutter程序(2) </a> </li> <li class=md-nav__item> <a href=../../../flutter/flutter_first_project_3/ title=年轻人的第一个Flutter程序(3) class=md-nav__link> 年轻人的第一个Flutter程序(3) </a> </li> <li class=md-nav__item> <a href=../../../flutter/flutter_first_project_4/ title=年轻人的第一个Flutter程序(4) class=md-nav__link> 年轻人的第一个Flutter程序(4) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4 type=checkbox id=nav-4> <label class=md-nav__link for=nav-4> LeetCode </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-4> LeetCode </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../leetcode/ title=算法目录 class=md-nav__link> 算法目录 </a> </li> <li class=md-nav__item> <a href=../../../leetcode/code_interviews_1/ title=数据结构、算法和数据操作 class=md-nav__link> 数据结构、算法和数据操作 </a> </li> <li class=md-nav__item> <a href=../../../leetcode/code_interviews_3/ title=高质量的代码 class=md-nav__link> 高质量的代码 </a> </li> <li class=md-nav__item> <a href=../../../leetcode/code_interviews_4/ title=解决问题的思路 class=md-nav__link> 解决问题的思路 </a> </li> <li class=md-nav__item> <a href=../../../leetcode/code_interviews_5/ title=优化时间和空间效率 class=md-nav__link> 优化时间和空间效率 </a> </li> <li class=md-nav__item> <a href=../../../leetcode/code_interviews_6/ title=面试中的各项能力 class=md-nav__link> 面试中的各项能力 </a> </li> <li class=md-nav__item> <a href=../../../leetcode/array/ title=Array class=md-nav__link> Array </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode1-10/ title=LeetCode(1-10) class=md-nav__link> LeetCode(1-10) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode11-20/ title=LeetCode(11-20) class=md-nav__link> LeetCode(11-20) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode21-30/ title=LeetCode(21-30) class=md-nav__link> LeetCode(21-30) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode31-40/ title=LeetCode(31-40) class=md-nav__link> LeetCode(31-40) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode41-50/ title=LeetCode(41-50) class=md-nav__link> LeetCode(41-50) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode51-60/ title=LeetCode(51-60) class=md-nav__link> LeetCode(51-60) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode61-70/ title=LeetCode(61-70) class=md-nav__link> LeetCode(61-70) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode71-80/ title=LeetCode(71-80) class=md-nav__link> LeetCode(71-80) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode81-90/ title=LeetCode(81-90) class=md-nav__link> LeetCode(81-90) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode91-100/ title=LeetCode(91-100) class=md-nav__link> LeetCode(91-100) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode101-110/ title=LeetCode(101-110) class=md-nav__link> LeetCode(101-110) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode111-120/ title=LeetCode(111-120) class=md-nav__link> LeetCode(111-120) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5 type=checkbox id=nav-5> <label class=md-nav__link for=nav-5> Books </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-5> Books </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-1 type=checkbox id=nav-5-1> <label class=md-nav__link for=nav-5-1> Design Pattern </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-1> Design Pattern </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../design-pattern/design-pattern/ title=设计模式概述 class=md-nav__link> 设计模式概述 </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/design-principle/ title=面向对象的六大原则 class=md-nav__link> 面向对象的六大原则 </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/singleton/ title=单例模式(Singleton) class=md-nav__link> 单例模式(Singleton) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/builder/ title=建造者模式(Builder) class=md-nav__link> 建造者模式(Builder) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/prototype/ title=原型模式(Prototype) class=md-nav__link> 原型模式(Prototype) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/factory-method/ title="工厂方法模式(Factory method)" class=md-nav__link> 工厂方法模式(Factory method) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/abstract-factory/ title="抽象工厂模式(Abstract factory)" class=md-nav__link> 抽象工厂模式(Abstract factory) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/proxy/ title=代理模式(Proxy) class=md-nav__link> 代理模式(Proxy) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/composite/ title=组合模式(Composite) class=md-nav__link> 组合模式(Composite) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/adapter/ title=适配器模式(Adapter) class=md-nav__link> 适配器模式(Adapter) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/decorator/ title=装饰模式(Decorator) class=md-nav__link> 装饰模式(Decorator) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/flyweight/ title=享元模式(Flyweight) class=md-nav__link> 享元模式(Flyweight) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/facade/ title=外观模式(Facade) class=md-nav__link> 外观模式(Facade) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/bridge/ title=桥接模式(Bridge) class=md-nav__link> 桥接模式(Bridge) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/strategy/ title=策略模式(Strategy) class=md-nav__link> 策略模式(Strategy) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/state/ title=状态模式(State) class=md-nav__link> 状态模式(State) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/chain-of-responsibility/ title="责任链模式(Chain of responsibility)" class=md-nav__link> 责任链模式(Chain of responsibility) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/interpreter/ title=解释器模式(Interpreter) class=md-nav__link> 解释器模式(Interpreter) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/command/ title=命令模式(Command) class=md-nav__link> 命令模式(Command) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/observer/ title=观察者模式(Observer) class=md-nav__link> 观察者模式(Observer) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/memento/ title=备忘录模式(Memento) class=md-nav__link> 备忘录模式(Memento) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/iterator/ title=迭代器模式(Iterator) class=md-nav__link> 迭代器模式(Iterator) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/template-method/ title="模版方法模式(Template method)" class=md-nav__link> 模版方法模式(Template method) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/visitor/ title=访问者模式(Visitor) class=md-nav__link> 访问者模式(Visitor) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/mediator/ title=中介者模式(Mediator) class=md-nav__link> 中介者模式(Mediator) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/confusing-design-pattern/ title=易混淆的设计模式 class=md-nav__link> 易混淆的设计模式 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2 type=checkbox id=nav-5-2> <label class=md-nav__link for=nav-5-2> Effective Java </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-2> Effective Java </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../effective-java/effective-java/ title="Effective Java概述" class=md-nav__link> Effective Java概述 </a> </li> <li class=md-nav__item> <a href=../../../effective-java/chapter1/ title=创建和销毁对象 class=md-nav__link> 创建和销毁对象 </a> </li> <li class=md-nav__item> <a href=../../../effective-java/chapter2/ title=对于所有对象都通用的方法 class=md-nav__link> 对于所有对象都通用的方法 </a> </li> <li class=md-nav__item> <a href=../../../effective-java/chapter3/ title=类和接口 class=md-nav__link> 类和接口 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-3 type=checkbox id=nav-5-3> <label class=md-nav__link for=nav-5-3> JVM </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-3> JVM </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../jvm/jvm-content/ title=深入理解Java虚拟机 class=md-nav__link> 深入理解Java虚拟机 </a> </li> <li class=md-nav__item> <a href=../../../jvm/java-memory-area-oom/ title=Java内存区域与内存溢出异常 class=md-nav__link> Java内存区域与内存溢出异常 </a> </li> <li class=md-nav__item> <a href=../../../jvm/java-gc/ title=垃圾收集器与内存分配策略 class=md-nav__link> 垃圾收集器与内存分配策略 </a> </li> <li class=md-nav__item> <a href=../../../jvm/class-struct/ title=类文件结构 class=md-nav__link> 类文件结构 </a> </li> <li class=md-nav__item> <a href=../../../jvm/load-class/ title=虚拟机类加载机制 class=md-nav__link> 虚拟机类加载机制 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-4 type=checkbox id=nav-5-4> <label class=md-nav__link for=nav-5-4> Java </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-4> Java </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../java/generics-java-kotlin/ title=Java&Kotlin在泛型方面的区别 class=md-nav__link> Java&Kotlin在泛型方面的区别 </a> </li> <li class=md-nav__item> <a href=../../../java/java-collections/ title=Java集合总结 class=md-nav__link> Java集合总结 </a> </li> <li class=md-nav__item> <a href=../../../java/java-foundation/ title=Java常见概念 class=md-nav__link> Java常见概念 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-5 type=checkbox id=nav-5-5> <label class=md-nav__link for=nav-5-5> Refactoring </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-5> Refactoring </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../refactoring/refactoring/ title=重构：改善既有代码的设计 class=md-nav__link> 重构：改善既有代码的设计 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>目录</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#1 class=md-nav__link> 1. 按键布局 </a> </li> <li class=md-nav__item> <a href=#2-keyboardview class=md-nav__link> 2. KeyboardView </a> </li> <li class=md-nav__item> <a href=#3 class=md-nav__link> 3. 键盘辅助类 </a> </li> <li class=md-nav__item> <a href=#4 class=md-nav__link> 4. 使用准备 </a> </li> <li class=md-nav__item> <a href=#__comments class="md-nav__link md-nav__link--active"> 评论 </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <h1>App内自定义软键盘</h1> <p>最近由于项目需要，需要自定义软键盘。直接摆Button真是low爆了，所以想试试系统关于键盘这方面的API。尝试了一下，用着还行，就是有一点点注意事项。</p> <p>键盘分为常规的数字键盘+字母键盘两部分，先上效果图：</p> <p><img alt=自定义数字键盘+字母键盘 src=/assets/images/android/inapp_custom_soft_keyboard.png></p> <p>创建App内软键盘非常简单，只需要一个或多个描述键盘如何布局的<code>Keyboard</code>以及容器<code>KeyboardView</code>，其中<code>Keyboard</code>中键盘布局靠xml进行。</p> <p>自定义的过程可以分为以下几步</p> <ol> <li>在xml中为某种类型的软键盘进行布局，供<code>Keyboard</code>创建时使用</li> <li>自定义<code>KeyboardView</code>，重写其<code>onDraw</code>方法为每个键绘制文字、Icon以及背景色；若有多种键盘类型，可为其提供切换键盘的API</li> <li>定义一个类实现<code>KeyboardView.OnKeyboardActionListener</code>接口来处理按键点击事件；并监听<code>EditText</code>的点击、触摸、焦点改变事件来弹出、隐藏自定义的<code>KeyboardView</code></li> <li>将自定义的<code>KeyboardView</code>加入布局中，开始使用</li> </ol> <p>下面一步步操作并将源码附上。</p> <h2 id=1>1. 按键布局<a class=headerlink href=#1 title="Permanent link">&para;</a></h2> <p>按键布局用<code>xml</code>实现，放在<code>res/xml</code>目录下。该资源决定了一种<code>Keyboard</code>的按键如何布局。可以根据项目需要，创建多种键盘的布局文件，然后在<code>KeyboardView</code>中进行切换。</p> <p>在上面的项目中，有两种键盘：数字键盘和字母键盘。我们这里创建了两个文件：<code>keyboard_number.xml</code>和<code>keyboard_qwerty.xml</code>。</p> <p>先上代码<code>keyboard_number.xml</code>，随后会进行分析。</p> <div class=codehilite><pre><span></span><span class=cp>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class=nt>&lt;Keyboard</span> <span class=na>xmlns:android=</span><span class=s>&quot;http://schemas.android.com/apk/res/android&quot;</span>
    <span class=na>android:verticalGap=</span><span class=s>&quot;0px&quot;</span>
    <span class=na>android:horizontalGap=</span><span class=s>&quot;0px&quot;</span>
    <span class=na>android:keyHeight=</span><span class=s>&quot;9%p&quot;</span>
    <span class=na>android:keyWidth=</span><span class=s>&quot;20%p&quot;</span><span class=nt>&gt;</span>

    <span class=nt>&lt;Row&gt;</span>
        <span class=nt>&lt;Key</span>
            <span class=na>android:codes=</span><span class=s>&quot;-1004,-1004&quot;</span>
            <span class=na>android:keyLabel=</span><span class=s>&quot;600&quot;</span> <span class=nt>/&gt;</span>
        <span class=nt>&lt;Key</span>
            <span class=na>android:codes=</span><span class=s>&quot;49&quot;</span>
            <span class=na>android:keyLabel=</span><span class=s>&quot;1&quot;</span> <span class=nt>/&gt;</span>
        <span class=nt>&lt;Key</span>
            <span class=na>android:codes=</span><span class=s>&quot;50&quot;</span>
            <span class=na>android:keyLabel=</span><span class=s>&quot;2&quot;</span> <span class=nt>/&gt;</span>
        <span class=nt>&lt;Key</span>
            <span class=na>android:codes=</span><span class=s>&quot;51&quot;</span>
            <span class=na>android:keyLabel=</span><span class=s>&quot;3&quot;</span> <span class=nt>/&gt;</span>
        <span class=nt>&lt;Key</span>
            <span class=na>android:codes=</span><span class=s>&quot;-5&quot;</span>
            <span class=na>android:isRepeatable=</span><span class=s>&quot;true&quot;</span>
            <span class=na>android:keyEdgeFlags=</span><span class=s>&quot;right&quot;</span>
            <span class=na>android:keyIcon=</span><span class=s>&quot;@drawable/kb_ic_keyboard_delete_n&quot;</span> <span class=nt>/&gt;</span>
    <span class=nt>&lt;/Row&gt;</span>

    <span class=nt>&lt;Row&gt;</span>
        <span class=nt>&lt;Key</span>
            <span class=na>android:codes=</span><span class=s>&quot;-1005,-1005&quot;</span>
            <span class=na>android:keyLabel=</span><span class=s>&quot;601&quot;</span> <span class=nt>/&gt;</span>
        <span class=nt>&lt;Key</span>
            <span class=na>android:codes=</span><span class=s>&quot;52&quot;</span>
            <span class=na>android:keyLabel=</span><span class=s>&quot;4&quot;</span> <span class=nt>/&gt;</span>
        <span class=nt>&lt;Key</span>
            <span class=na>android:codes=</span><span class=s>&quot;53&quot;</span>
            <span class=na>android:keyLabel=</span><span class=s>&quot;5&quot;</span> <span class=nt>/&gt;</span>
        <span class=nt>&lt;Key</span>
            <span class=na>android:codes=</span><span class=s>&quot;54&quot;</span>
            <span class=na>android:keyLabel=</span><span class=s>&quot;6&quot;</span> <span class=nt>/&gt;</span>
        <span class=nt>&lt;Key</span>
            <span class=na>android:codes=</span><span class=s>&quot;-1002,-1002&quot;</span>
            <span class=na>android:keyLabel=</span><span class=s>&quot;002&quot;</span> <span class=nt>/&gt;</span>
    <span class=nt>&lt;/Row&gt;</span>

    <span class=nt>&lt;Row&gt;</span>
        <span class=nt>&lt;Key</span>
            <span class=na>android:codes=</span><span class=s>&quot;-1001,-1001&quot;</span>
            <span class=na>android:keyLabel=</span><span class=s>&quot;000&quot;</span> <span class=nt>/&gt;</span>
        <span class=nt>&lt;Key</span>
            <span class=na>android:codes=</span><span class=s>&quot;55&quot;</span>
            <span class=na>android:keyLabel=</span><span class=s>&quot;7&quot;</span> <span class=nt>/&gt;</span>
        <span class=nt>&lt;Key</span>
            <span class=na>android:codes=</span><span class=s>&quot;56&quot;</span>
            <span class=na>android:keyLabel=</span><span class=s>&quot;8&quot;</span> <span class=nt>/&gt;</span>
        <span class=nt>&lt;Key</span>
            <span class=na>android:codes=</span><span class=s>&quot;57&quot;</span>
            <span class=na>android:keyLabel=</span><span class=s>&quot;9&quot;</span> <span class=nt>/&gt;</span>
        <span class=nt>&lt;Key</span>
            <span class=na>android:codes=</span><span class=s>&quot;-1003,-1003&quot;</span>
            <span class=na>android:keyLabel=</span><span class=s>&quot;300&quot;</span> <span class=nt>/&gt;</span>
    <span class=nt>&lt;/Row&gt;</span>

    <span class=nt>&lt;Row&gt;</span>
        <span class=nt>&lt;Key</span>
            <span class=na>android:codes=</span><span class=s>&quot;-2&quot;</span>
            <span class=na>android:keyLabel=</span><span class=s>&quot;ABC&quot;</span> <span class=nt>/&gt;</span>
        <span class=nt>&lt;Key</span>
            <span class=na>android:codes=</span><span class=s>&quot;46&quot;</span>
            <span class=na>android:keyLabel=</span><span class=s>&quot;.&quot;</span> <span class=nt>/&gt;</span>
        <span class=nt>&lt;Key</span>
            <span class=na>android:codes=</span><span class=s>&quot;48&quot;</span>
            <span class=na>android:keyLabel=</span><span class=s>&quot;0&quot;</span> <span class=nt>/&gt;</span>
        <span class=nt>&lt;Key</span>
            <span class=na>android:codes=</span><span class=s>&quot;-3&quot;</span>
            <span class=na>android:keyLabel=</span><span class=s>&quot;隐藏&quot;</span> <span class=nt>/&gt;</span>
        <span class=nt>&lt;Key</span>
            <span class=na>android:codes=</span><span class=s>&quot;-4&quot;</span>
            <span class=na>android:keyEdgeFlags=</span><span class=s>&quot;right&quot;</span>
            <span class=na>android:keyLabel=</span><span class=s>&quot;确认&quot;</span> <span class=nt>/&gt;</span>
    <span class=nt>&lt;/Row&gt;</span>
<span class=nt>&lt;/Keyboard&gt;</span>
</pre></div> <p>对于键盘整体来说</p> <ol> <li>所有按键之间不需要间隔，所以水平间隙和竖直间隙都设置为0</li> <li>按键每排5个，所以keyWidth为20%p</li> <li>键盘的高度固定为36%p，因此keyHeight为9%p</li> </ol> <p>对于单个按键来说，宽高都不需要单独指定，只需要指定按键表示的<code>android:codes</code>、怎么显示（显示图标<code>android:keyIcon</code>还是文字<code>android:keyLabel</code>）、按下时是否一直发送事件<code>android:isRepeatable</code>，至于<code>android:keyEdgeFlags</code>指不指定没有多大关系。 </p> <p><code>android:codes</code>会由我们自己进行处理。方面起见，可以用UNICODE码表示的就是UNICODE码，一些控制键可以使用系统预留的值，自定义按键的值建议使用负数。下面是定义在<code>Keyboard</code>中的所有控制键：</p> <div class=codehilite><pre><span></span><span class=kd>public</span> <span class=kd>static</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>KEYCODE_SHIFT</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>static</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>KEYCODE_MODE_CHANGE</span> <span class=o>=</span> <span class=o>-</span><span class=mi>2</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>static</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>KEYCODE_CANCEL</span> <span class=o>=</span> <span class=o>-</span><span class=mi>3</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>static</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>KEYCODE_DONE</span> <span class=o>=</span> <span class=o>-</span><span class=mi>4</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>static</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>KEYCODE_DELETE</span> <span class=o>=</span> <span class=o>-</span><span class=mi>5</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>static</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>KEYCODE_ALT</span> <span class=o>=</span> <span class=o>-</span><span class=mi>6</span><span class=p>;</span>
</pre></div> <p>在数字键盘中，我们使用了-2至-5，这四个值。</p> <p>另外，我们自定义的特殊按键（比如<code>600</code>），其<code>android:codes</code>是两个一样的数字。这个做是为了让<code>KeyboardView</code>绘制文字时，不把<code>600</code>进行加粗。其源码如下：</p> <div class=codehilite><pre><span></span><span class=k>if</span> <span class=p>(</span><span class=n>label</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
    <span class=c1>// For characters, use large font. For labels like &quot;Done&quot;, use small font.</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>label</span><span class=p>.</span><span class=na>length</span><span class=p>()</span> <span class=o>&gt;</span> <span class=mi>1</span> <span class=o>&amp;&amp;</span> <span class=n>key</span><span class=p>.</span><span class=na>codes</span><span class=p>.</span><span class=na>length</span> <span class=o>&lt;</span> <span class=mi>2</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>paint</span><span class=p>.</span><span class=na>setTextSize</span><span class=p>(</span><span class=n>mLabelTextSize</span><span class=p>);</span>
        <span class=n>paint</span><span class=p>.</span><span class=na>setTypeface</span><span class=p>(</span><span class=n>Typeface</span><span class=p>.</span><span class=na>DEFAULT_BOLD</span><span class=p>);</span>
    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
        <span class=n>paint</span><span class=p>.</span><span class=na>setTextSize</span><span class=p>(</span><span class=n>mKeyTextSize</span><span class=p>);</span>
        <span class=n>paint</span><span class=p>.</span><span class=na>setTypeface</span><span class=p>(</span><span class=n>Typeface</span><span class=p>.</span><span class=na>DEFAULT</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=c1>// Draw a drop shadow for the text</span>
    <span class=n>paint</span><span class=p>.</span><span class=na>setShadowLayer</span><span class=p>(</span><span class=n>mShadowRadius</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=n>mShadowColor</span><span class=p>);</span>
    <span class=c1>// Draw the text</span>
    <span class=n>canvas</span><span class=p>.</span><span class=na>drawText</span><span class=p>(</span><span class=n>label</span><span class=p>,</span>
        <span class=p>(</span><span class=n>key</span><span class=p>.</span><span class=na>width</span> <span class=o>-</span> <span class=n>padding</span><span class=p>.</span><span class=na>left</span> <span class=o>-</span> <span class=n>padding</span><span class=p>.</span><span class=na>right</span><span class=p>)</span> <span class=o>/</span> <span class=mi>2</span>
                <span class=o>+</span> <span class=n>padding</span><span class=p>.</span><span class=na>left</span><span class=p>,</span>
        <span class=p>(</span><span class=n>key</span><span class=p>.</span><span class=na>height</span> <span class=o>-</span> <span class=n>padding</span><span class=p>.</span><span class=na>top</span> <span class=o>-</span> <span class=n>padding</span><span class=p>.</span><span class=na>bottom</span><span class=p>)</span> <span class=o>/</span> <span class=mi>2</span>
                <span class=o>+</span> <span class=p>(</span><span class=n>paint</span><span class=p>.</span><span class=na>getTextSize</span><span class=p>()</span> <span class=o>-</span> <span class=n>paint</span><span class=p>.</span><span class=na>descent</span><span class=p>())</span> <span class=o>/</span> <span class=mi>2</span> <span class=o>+</span> <span class=n>padding</span><span class=p>.</span><span class=na>top</span><span class=p>,</span>
        <span class=n>paint</span><span class=p>);</span>
    <span class=c1>// Turn off drop shadow</span>
    <span class=n>paint</span><span class=p>.</span><span class=na>setShadowLayer</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
<span class=p>}</span>
</pre></div> <p>我们可以看到，如果label长度超过1且其codes长度小于1，就使用<code>mLabelTextSize</code>并进行加粗；否则使用<code>mKeyTextSize</code>，正常字体。 </p> <p>如果我们在xml中不加double的code，自定义的特殊按键就是粗体，而其他普通文字都是正常，这样看起来就很怪。当然，此处double处理了，在<code>KeyboardView.OnKeyboardActionListener</code>中也需要进行过滤处理，后面再说。</p> <p>下面是字母键盘<code>keyboard_qwerty.xml</code>，还是先上代码在分析。</p> <div class=codehilite><pre><span></span><span class=cp>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class=nt>&lt;Keyboard</span>
    <span class=na>xmlns:android=</span><span class=s>&quot;http://schemas.android.com/apk/res/android&quot;</span>
    <span class=na>android:horizontalGap=</span><span class=s>&quot;0.91%p&quot;</span>
    <span class=na>android:verticalGap=</span><span class=s>&quot;0.8%p&quot;</span>
    <span class=na>android:keyWidth=</span><span class=s>&quot;9%p&quot;</span>
    <span class=na>android:keyHeight=</span><span class=s>&quot;8%p&quot;</span><span class=nt>&gt;</span>

    <span class=nt>&lt;Row</span> <span class=na>android:keyHeight=</span><span class=s>&quot;0px&quot;</span><span class=nt>/&gt;</span>

    <span class=nt>&lt;Row&gt;</span>
        <span class=nt>&lt;Key</span> <span class=na>android:codes=</span><span class=s>&quot;81&quot;</span> <span class=na>android:keyLabel=</span><span class=s>&quot;Q&quot;</span> <span class=na>android:keyEdgeFlags=</span><span class=s>&quot;left&quot;</span> <span class=nt>/&gt;</span>
        <span class=nt>&lt;Key</span> <span class=na>android:codes=</span><span class=s>&quot;87&quot;</span> <span class=na>android:keyLabel=</span><span class=s>&quot;W&quot;</span> <span class=nt>/&gt;</span>
        <span class=nt>&lt;Key</span> <span class=na>android:codes=</span><span class=s>&quot;69&quot;</span> <span class=na>android:keyLabel=</span><span class=s>&quot;E&quot;</span> <span class=nt>/&gt;</span>
        <span class=nt>&lt;Key</span> <span class=na>android:codes=</span><span class=s>&quot;82&quot;</span> <span class=na>android:keyLabel=</span><span class=s>&quot;R&quot;</span> <span class=nt>/&gt;</span>
        <span class=nt>&lt;Key</span> <span class=na>android:codes=</span><span class=s>&quot;84&quot;</span> <span class=na>android:keyLabel=</span><span class=s>&quot;T&quot;</span> <span class=nt>/&gt;</span>
        <span class=nt>&lt;Key</span> <span class=na>android:codes=</span><span class=s>&quot;89&quot;</span> <span class=na>android:keyLabel=</span><span class=s>&quot;Y&quot;</span> <span class=nt>/&gt;</span>
        <span class=nt>&lt;Key</span> <span class=na>android:codes=</span><span class=s>&quot;85&quot;</span> <span class=na>android:keyLabel=</span><span class=s>&quot;U&quot;</span> <span class=nt>/&gt;</span>
        <span class=nt>&lt;Key</span> <span class=na>android:codes=</span><span class=s>&quot;73&quot;</span> <span class=na>android:keyLabel=</span><span class=s>&quot;I&quot;</span> <span class=nt>/&gt;</span>
        <span class=nt>&lt;Key</span> <span class=na>android:codes=</span><span class=s>&quot;79&quot;</span> <span class=na>android:keyLabel=</span><span class=s>&quot;O&quot;</span> <span class=nt>/&gt;</span>
        <span class=nt>&lt;Key</span> <span class=na>android:codes=</span><span class=s>&quot;80&quot;</span> <span class=na>android:keyLabel=</span><span class=s>&quot;P&quot;</span> <span class=na>android:keyEdgeFlags=</span><span class=s>&quot;right&quot;</span> <span class=nt>/&gt;</span>
    <span class=nt>&lt;/Row&gt;</span>

    <span class=nt>&lt;Row&gt;</span>
        <span class=nt>&lt;Key</span> <span class=na>android:codes=</span><span class=s>&quot;65&quot;</span> <span class=na>android:keyLabel=</span><span class=s>&quot;A&quot;</span> <span class=na>android:horizontalGap=</span><span class=s>&quot;5.86%p&quot;</span> <span class=na>android:keyEdgeFlags=</span><span class=s>&quot;left&quot;</span> <span class=nt>/&gt;</span>
        <span class=nt>&lt;Key</span> <span class=na>android:codes=</span><span class=s>&quot;83&quot;</span> <span class=na>android:keyLabel=</span><span class=s>&quot;S&quot;</span> <span class=nt>/&gt;</span>
        <span class=nt>&lt;Key</span> <span class=na>android:codes=</span><span class=s>&quot;68&quot;</span> <span class=na>android:keyLabel=</span><span class=s>&quot;D&quot;</span> <span class=nt>/&gt;</span>
        <span class=nt>&lt;Key</span> <span class=na>android:codes=</span><span class=s>&quot;70&quot;</span> <span class=na>android:keyLabel=</span><span class=s>&quot;F&quot;</span> <span class=nt>/&gt;</span>
        <span class=nt>&lt;Key</span> <span class=na>android:codes=</span><span class=s>&quot;71&quot;</span> <span class=na>android:keyLabel=</span><span class=s>&quot;G&quot;</span> <span class=nt>/&gt;</span>
        <span class=nt>&lt;Key</span> <span class=na>android:codes=</span><span class=s>&quot;72&quot;</span> <span class=na>android:keyLabel=</span><span class=s>&quot;H&quot;</span> <span class=nt>/&gt;</span>
        <span class=nt>&lt;Key</span> <span class=na>android:codes=</span><span class=s>&quot;74&quot;</span> <span class=na>android:keyLabel=</span><span class=s>&quot;J&quot;</span> <span class=nt>/&gt;</span>
        <span class=nt>&lt;Key</span> <span class=na>android:codes=</span><span class=s>&quot;75&quot;</span> <span class=na>android:keyLabel=</span><span class=s>&quot;K&quot;</span> <span class=nt>/&gt;</span>
        <span class=nt>&lt;Key</span> <span class=na>android:codes=</span><span class=s>&quot;76&quot;</span> <span class=na>android:keyLabel=</span><span class=s>&quot;L&quot;</span> <span class=na>android:keyEdgeFlags=</span><span class=s>&quot;right&quot;</span> <span class=nt>/&gt;</span>
    <span class=nt>&lt;/Row&gt;</span>

    <span class=nt>&lt;Row&gt;</span>
        <span class=nt>&lt;Key</span> <span class=na>android:codes=</span><span class=s>&quot;-3&quot;</span> <span class=na>android:keyIcon=</span><span class=s>&quot;@drawable/kb_ic_keyboard_arrow_n&quot;</span> <span class=na>android:keyWidth=</span><span class=s>&quot;13.95%p&quot;</span> <span class=na>android:keyEdgeFlags=</span><span class=s>&quot;left&quot;</span><span class=nt>/&gt;</span>
        <span class=nt>&lt;Key</span> <span class=na>android:codes=</span><span class=s>&quot;90&quot;</span> <span class=na>android:keyLabel=</span><span class=s>&quot;Z&quot;</span> <span class=nt>/&gt;</span>
        <span class=nt>&lt;Key</span> <span class=na>android:codes=</span><span class=s>&quot;88&quot;</span> <span class=na>android:keyLabel=</span><span class=s>&quot;X&quot;</span> <span class=nt>/&gt;</span>
        <span class=nt>&lt;Key</span> <span class=na>android:codes=</span><span class=s>&quot;67&quot;</span> <span class=na>android:keyLabel=</span><span class=s>&quot;C&quot;</span> <span class=nt>/&gt;</span>
        <span class=nt>&lt;Key</span> <span class=na>android:codes=</span><span class=s>&quot;86&quot;</span> <span class=na>android:keyLabel=</span><span class=s>&quot;V&quot;</span> <span class=nt>/&gt;</span>
        <span class=nt>&lt;Key</span> <span class=na>android:codes=</span><span class=s>&quot;66&quot;</span> <span class=na>android:keyLabel=</span><span class=s>&quot;B&quot;</span> <span class=nt>/&gt;</span>
        <span class=nt>&lt;Key</span> <span class=na>android:codes=</span><span class=s>&quot;78&quot;</span> <span class=na>android:keyLabel=</span><span class=s>&quot;N&quot;</span> <span class=nt>/&gt;</span>
        <span class=nt>&lt;Key</span> <span class=na>android:codes=</span><span class=s>&quot;77&quot;</span> <span class=na>android:keyLabel=</span><span class=s>&quot;M&quot;</span> <span class=nt>/&gt;</span>
        <span class=nt>&lt;Key</span> <span class=na>android:codes=</span><span class=s>&quot;-5&quot;</span> <span class=na>android:keyIcon=</span><span class=s>&quot;@drawable/kb_ic_keyboard_delete_n&quot;</span> <span class=na>android:keyWidth=</span><span class=s>&quot;13.95%p&quot;</span> <span class=na>android:keyEdgeFlags=</span><span class=s>&quot;right&quot;</span> <span class=na>android:isRepeatable=</span><span class=s>&quot;true&quot;</span> <span class=nt>/&gt;</span>
    <span class=nt>&lt;/Row&gt;</span>

    <span class=nt>&lt;Row&gt;</span>
        <span class=nt>&lt;Key</span> <span class=na>android:codes=</span><span class=s>&quot;-2&quot;</span> <span class=na>android:keyLabel=</span><span class=s>&quot;123&quot;</span><span class=nt>/&gt;</span>
        <span class=nt>&lt;Key</span> <span class=na>android:codes=</span><span class=s>&quot;32&quot;</span> <span class=na>android:keyLabel=</span><span class=s>&quot;&quot;</span> <span class=na>android:keyWidth=</span><span class=s>&quot;78.36%p&quot;</span> <span class=na>android:isRepeatable=</span><span class=s>&quot;true&quot;</span>  <span class=nt>/&gt;</span>
        <span class=nt>&lt;Key</span> <span class=na>android:codes=</span><span class=s>&quot;-4&quot;</span> <span class=na>android:keyLabel=</span><span class=s>&quot;D&quot;</span> <span class=na>android:keyEdgeFlags=</span><span class=s>&quot;right&quot;</span>  <span class=nt>/&gt;</span>
    <span class=nt>&lt;/Row&gt;</span>

    <span class=nt>&lt;Row</span> <span class=na>android:keyHeight=</span><span class=s>&quot;0px&quot;</span> <span class=na>android:rowEdgeFlags=</span><span class=s>&quot;bottom&quot;</span> <span class=nt>/&gt;</span>
<span class=nt>&lt;/Keyboard&gt;</span>
</pre></div> <p>对于键盘整体来说</p> <ul> <li> <p>为了使键盘高度和数字键盘一致，总间距+按键高度*4要等于36%p。而<code>android:verticalGap</code>指定的间距只会在两两<code>Row</code>之间，也就是第一行默认是置顶的，最后一行同理。所以为了让第一行、最后一行与顶部、底部之间有空隙，在键盘第一行和最后一行插入一个0高度的空行，这样就完美了。 如图所示，绿线即为0高度的空行。这样5space+4row=36%，调整一下比例，row取8%p，space取0.8%p。 <figure style="width: 80%" class=align-center> <img src=/assets/images/android/inapp_custom_soft_keyboard_qwerty_rows.png> <figcaption>字母键盘 绿线即为0高度的空行</figcaption> </figure></p> </li> <li> <p><code>android:horizontalGap</code>不像竖直方向的，此属性在最左端与第一列之间也会生效。所以11space+10col=100%p，space取10/11，col取9%p。<br> 第一行无需做任何调整，开始第二行。第二行只有9个按键，100-(10space+9col)=109/11，也就说两边多余的间隙为109/22，再加上本来就有的10/11的间隙，第二行第一个键的空隙应该为129/22=5.863636364。<br> 第三行7个标准按键，两个大按键，所以这里要计算大按键的宽度，2big+7col+10space=100 ===&gt; big=307/22=13.954545455。<br> 最后一行，两个标准按键，一个长按键，large+2col+4space=100 ===&gt; large=862/11=78.363636364</p> </li> </ul> <p>另外，需要注意，<strong>如果某个按键需要跨多行或多列，那么直接设置宽或高的值即可</strong></p> <h2 id=2-keyboardview>2. KeyboardView<a class=headerlink href=#2-keyboardview title="Permanent link">&para;</a></h2> <p>在该步骤中我们继承了<code>KeyboardView</code>并重写了其<code>onDraw</code>方法，来**实现所有的绘制逻辑**，所以其实上一步中讲到的<code>android:codes</code>进行double是可有可无的。</p> <p>由于数字键盘和字母键盘中按键的背景是两套（数字键盘没有圆角，字母键盘全部加了圆角），而<code>KeyboardView</code>没有提供修改<code>android:keyBackground</code>值的API接口，无法实现切换键盘时也随着切换<code>android:keyBackground</code>，所以只能自己绘制普通按键的背景。<br> 此时如果在自己的绘制逻辑之前调用<code>super.onDraw</code>方法，会导致看不见普通按键的文字；如果在自己的绘制逻辑之后调用，会导致自己的绘制逻辑失效。所以干脆不调用<code>super.onDraw</code>，全部自己绘制。</p> <p>此外，由于有两种键盘需要切换，所以切换逻辑也内聚到了该类中。</p> <p>直接上该部分代码：</p> <div class=codehilite><pre><span></span><span class=k>class</span> <span class=nc>RSKeyboardView</span><span class=p>(</span>
    <span class=n>context</span><span class=p>:</span> <span class=n>Context</span><span class=p>,</span>
    <span class=n>attrs</span><span class=p>:</span> <span class=n>AttributeSet</span><span class=p>?</span> <span class=p>=</span> <span class=k>null</span>
<span class=p>)</span> <span class=p>:</span> <span class=n>KeyboardView</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=n>attrs</span><span class=p>)</span>  <span class=p>{</span>

    <span class=c1>// 键盘背景色</span>
    <span class=k>private</span> <span class=k>var</span> <span class=py>mBackground</span><span class=p>:</span> <span class=n>Drawable</span> <span class=p>=</span> <span class=n>ColorDrawable</span><span class=p>(</span><span class=m>0</span><span class=n>xFF000000</span><span class=p>.</span><span class=n>toInt</span><span class=p>())</span>
    <span class=c1>// 键盘文字大小</span>
    <span class=k>private</span> <span class=k>var</span> <span class=py>mLabelTextSize</span><span class=p>:</span> <span class=n>Int</span> <span class=p>=</span> <span class=m>14</span>
    <span class=c1>// 普通按键的文字颜色</span>
    <span class=k>private</span> <span class=k>var</span> <span class=py>mKeyTextColor</span><span class=p>:</span> <span class=n>Int</span> <span class=p>=</span> <span class=m>0</span><span class=n>xFF000000</span><span class=p>.</span><span class=n>toInt</span><span class=p>()</span>
    <span class=k>private</span> <span class=k>val</span> <span class=py>mPaint</span><span class=p>:</span> <span class=n>Paint</span> <span class=k>by</span> <span class=n>lazy</span> <span class=p>{</span>
        <span class=n>Paint</span><span class=p>().</span><span class=n>apply</span> <span class=p>{</span>
            <span class=n>textAlign</span> <span class=p>=</span> <span class=n>Paint</span><span class=p>.</span><span class=n>Align</span><span class=p>.</span><span class=n>CENTER</span>
            <span class=n>isAntiAlias</span> <span class=p>=</span> <span class=k>true</span>
        <span class=p>}</span>
    <span class=p>}</span>

    <span class=c1>// 数字键盘</span>
    <span class=k>private</span> <span class=k>val</span> <span class=py>mKeyboardNumber</span><span class=p>:</span> <span class=n>Keyboard</span> <span class=k>by</span> <span class=n>lazy</span> <span class=p>{</span> <span class=n>Keyboard</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=n>R</span><span class=p>.</span><span class=n>xml</span><span class=p>.</span><span class=n>keyboard_number</span><span class=p>)</span> <span class=p>}</span>
    <span class=c1>// 字母键盘</span>
    <span class=k>private</span> <span class=k>val</span> <span class=py>mKeyboardQwerty</span><span class=p>:</span> <span class=n>Keyboard</span> <span class=k>by</span> <span class=n>lazy</span> <span class=p>{</span> <span class=n>Keyboard</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=n>R</span><span class=p>.</span><span class=n>xml</span><span class=p>.</span><span class=n>keyboard_qwerty</span><span class=p>)</span> <span class=p>}</span>
    <span class=c1>// 按键背景资源</span>
    <span class=k>private</span> <span class=k>var</span> <span class=py>mKeyBackgroundResourceTriple</span> <span class=p>=</span> <span class=n>NUMBER_KEY_BACKGROUND</span>

    <span class=c1>// 默认键盘模式</span>
    <span class=k>var</span> <span class=py>keyboardMode</span> <span class=p>=</span> <span class=n>KEYBOARD_MODE_NUMBER</span>
        <span class=k>private</span> <span class=k>set</span>

    <span class=cm>/**</span>
<span class=cm>     * 切换键盘模式</span>
<span class=cm>     */</span>
    <span class=k>fun</span> <span class=nf>toggleMode</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>keyboardMode</span> <span class=p>==</span> <span class=n>RSKeyboardView</span><span class=p>.</span><span class=n>KEYBOARD_MODE_QWERTY</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>keyboard</span> <span class=p>=</span> <span class=n>mKeyboardNumber</span>
            <span class=n>keyboardMode</span> <span class=p>=</span> <span class=n>RSKeyboardView</span><span class=p>.</span><span class=n>KEYBOARD_MODE_NUMBER</span>
            <span class=n>mKeyBackgroundResourceTriple</span> <span class=p>=</span> <span class=n>NUMBER_KEY_BACKGROUND</span>
        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
            <span class=n>keyboard</span> <span class=p>=</span> <span class=n>mKeyboardQwerty</span>
            <span class=n>keyboardMode</span> <span class=p>=</span> <span class=n>RSKeyboardView</span><span class=p>.</span><span class=n>KEYBOARD_MODE_QWERTY</span>
            <span class=n>mKeyBackgroundResourceTriple</span> <span class=p>=</span> <span class=n>QWERTY_KEY_BACKGROUND</span>
        <span class=p>}</span>
    <span class=p>}</span>

    <span class=n>init</span> <span class=p>{</span>
        <span class=c1>// 从xml中读取设置</span>
        <span class=k>val</span> <span class=py>set</span> <span class=p>=</span> <span class=n>arrayOf</span><span class=p>(</span>
            <span class=n>android</span><span class=p>.</span><span class=n>R</span><span class=p>.</span><span class=n>attr</span><span class=p>.</span><span class=n>background</span><span class=p>,</span>
            <span class=n>android</span><span class=p>.</span><span class=n>R</span><span class=p>.</span><span class=n>attr</span><span class=p>.</span><span class=n>labelTextSize</span><span class=p>,</span>
            <span class=n>android</span><span class=p>.</span><span class=n>R</span><span class=p>.</span><span class=n>attr</span><span class=p>.</span><span class=n>keyTextColor</span>
        <span class=p>).</span><span class=n>toIntArray</span><span class=p>()</span>

        <span class=k>val</span> <span class=py>a</span> <span class=p>=</span> <span class=n>context</span><span class=p>.</span><span class=n>obtainStyledAttributes</span><span class=p>(</span><span class=n>attrs</span><span class=p>,</span> <span class=k>set</span><span class=p>)</span>

        <span class=n>mBackground</span> <span class=p>=</span> <span class=n>a</span><span class=p>.</span><span class=n>getDrawable</span><span class=p>(</span><span class=m>0</span><span class=p>)</span> <span class=o>?:</span> <span class=n>mBackground</span>
        <span class=n>@SuppressLint</span><span class=p>(</span><span class=s>&quot;ResourceType&quot;</span><span class=p>)</span>
        <span class=n>mLabelTextSize</span> <span class=p>=</span> <span class=n>a</span><span class=p>.</span><span class=n>getDimensionPixelSize</span><span class=p>(</span><span class=m>1</span><span class=p>,</span> <span class=n>mLabelTextSize</span><span class=p>)</span>
        <span class=n>@SuppressLint</span><span class=p>(</span><span class=s>&quot;ResourceType&quot;</span><span class=p>)</span>
        <span class=n>mKeyTextColor</span> <span class=p>=</span> <span class=n>a</span><span class=p>.</span><span class=n>getColor</span><span class=p>(</span><span class=m>2</span><span class=p>,</span> <span class=n>mKeyTextColor</span><span class=p>)</span>

        <span class=n>a</span><span class=p>.</span><span class=n>recycle</span><span class=p>()</span>

        <span class=c1>// 设置键盘</span>
        <span class=k>this</span><span class=p>.</span><span class=n>keyboard</span> <span class=p>=</span> <span class=n>mKeyboardNumber</span>
        <span class=k>this</span><span class=p>.</span><span class=n>isEnabled</span> <span class=p>=</span> <span class=k>true</span>
        <span class=k>this</span><span class=p>.</span><span class=n>isPreviewEnabled</span> <span class=p>=</span> <span class=k>false</span>
    <span class=p>}</span>

    <span class=k>override</span> <span class=k>fun</span> <span class=nf>onDraw</span><span class=p>(</span><span class=n>canvas</span><span class=p>:</span> <span class=n>Canvas</span><span class=p>?)</span> <span class=p>{</span>
        <span class=n>canvas</span> <span class=o>?:</span> <span class=k>return</span>
        <span class=k>val</span> <span class=py>keys</span> <span class=p>=</span> <span class=n>keyboard</span><span class=o>?.</span><span class=n>keys</span> <span class=o>?:</span> <span class=k>return</span>

        <span class=k>for</span> <span class=p>(</span><span class=n>key</span> <span class=k>in</span> <span class=n>keys</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>when</span> <span class=p>(</span><span class=n>key</span><span class=p>.</span><span class=n>codes</span><span class=p>[</span><span class=m>0</span><span class=p>])</span> <span class=p>{</span>
                <span class=n>Keyboard</span><span class=p>.</span><span class=n>KEYCODE_DONE</span> <span class=p>-&gt;</span> <span class=p>{</span>
                    <span class=c1>// DONE按键</span>
                    <span class=n>drawKeyBackground</span><span class=p>(</span><span class=n>mKeyBackgroundResourceTriple</span><span class=p>.</span><span class=n>first</span><span class=p>,</span> <span class=n>canvas</span><span class=p>,</span> <span class=n>key</span><span class=p>)</span>
                    <span class=n>drawText</span><span class=p>(</span><span class=n>canvas</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>Color</span><span class=p>.</span><span class=n>WHITE</span><span class=p>)</span>
                    <span class=n>drawIcon</span><span class=p>(</span><span class=n>canvas</span><span class=p>,</span> <span class=n>key</span><span class=p>)</span>
                <span class=p>}</span>
                <span class=n>Keyboard</span><span class=p>.</span><span class=n>KEYCODE_MODE_CHANGE</span><span class=p>,</span>
                <span class=n>Keyboard</span><span class=p>.</span><span class=n>KEYCODE_DELETE</span><span class=p>,</span>
                <span class=n>Keyboard</span><span class=p>.</span><span class=n>KEYCODE_CANCEL</span> <span class=p>-&gt;</span> <span class=p>{</span>
                    <span class=c1>// 控制按键</span>
                    <span class=n>drawKeyBackground</span><span class=p>(</span><span class=n>mKeyBackgroundResourceTriple</span><span class=p>.</span><span class=n>second</span><span class=p>,</span> <span class=n>canvas</span><span class=p>,</span> <span class=n>key</span><span class=p>)</span>
                    <span class=n>drawText</span><span class=p>(</span><span class=n>canvas</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>mKeyTextColor</span><span class=p>)</span>
                    <span class=n>drawIcon</span><span class=p>(</span><span class=n>canvas</span><span class=p>,</span> <span class=n>key</span><span class=p>)</span>
                <span class=p>}</span>
                <span class=k>else</span> <span class=p>-&gt;</span> <span class=p>{</span>
                    <span class=c1>// 普通按键</span>
                    <span class=n>drawKeyBackground</span><span class=p>(</span><span class=n>mKeyBackgroundResourceTriple</span><span class=p>.</span><span class=n>third</span><span class=p>,</span> <span class=n>canvas</span><span class=p>,</span> <span class=n>key</span><span class=p>)</span>
                    <span class=n>drawText</span><span class=p>(</span><span class=n>canvas</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>mKeyTextColor</span><span class=p>)</span>
                    <span class=n>drawIcon</span><span class=p>(</span><span class=n>canvas</span><span class=p>,</span> <span class=n>key</span><span class=p>)</span>
                <span class=p>}</span>
            <span class=p>}</span>
        <span class=p>}</span>
    <span class=p>}</span>

    <span class=cm>/**</span>
<span class=cm>     * 绘制按键背景</span>
<span class=cm>     */</span>
    <span class=k>private</span> <span class=k>fun</span> <span class=nf>drawKeyBackground</span><span class=p>(</span><span class=n>@DrawableRes</span> <span class=n>drawableId</span><span class=p>:</span> <span class=n>Int</span><span class=p>,</span> <span class=n>canvas</span><span class=p>:</span> <span class=n>Canvas</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=n>Keyboard</span><span class=p>.</span><span class=n>Key</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>val</span> <span class=py>drawable</span> <span class=p>=</span> <span class=n>ContextCompat</span><span class=p>.</span><span class=n>getDrawable</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=n>drawableId</span><span class=p>)</span> <span class=o>?:</span> <span class=k>return</span>

        <span class=k>val</span> <span class=py>drawableState</span> <span class=p>=</span> <span class=n>key</span><span class=p>.</span><span class=n>currentDrawableState</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>key</span><span class=p>.</span><span class=n>codes</span><span class=p>[</span><span class=m>0</span><span class=p>]</span> <span class=p>!=</span> <span class=m>0</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>drawable</span><span class=p>.</span><span class=n>state</span> <span class=p>=</span> <span class=n>drawableState</span>
        <span class=p>}</span>

        <span class=n>key</span><span class=p>.</span><span class=n>run</span> <span class=p>{</span>
            <span class=n>drawable</span><span class=p>.</span><span class=n>setBounds</span><span class=p>(</span><span class=n>x</span> <span class=p>+</span> <span class=n>paddingStart</span><span class=p>,</span> <span class=n>y</span> <span class=p>+</span> <span class=n>paddingTop</span><span class=p>,</span> <span class=n>x</span> <span class=p>+</span> <span class=n>paddingStart</span> <span class=p>+</span> <span class=n>width</span><span class=p>,</span> <span class=n>y</span> <span class=p>+</span> <span class=n>paddingTop</span> <span class=p>+</span> <span class=n>height</span><span class=p>)</span>
        <span class=p>}</span>
        <span class=n>drawable</span><span class=p>.</span><span class=n>draw</span><span class=p>(</span><span class=n>canvas</span><span class=p>)</span>
    <span class=p>}</span>

    <span class=cm>/**</span>
<span class=cm>     * 绘制按键label</span>
<span class=cm>     */</span>
    <span class=k>private</span> <span class=k>fun</span> <span class=nf>drawText</span><span class=p>(</span><span class=n>canvas</span><span class=p>:</span> <span class=n>Canvas</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=n>Keyboard</span><span class=p>.</span><span class=n>Key</span><span class=p>,</span> <span class=n>color</span><span class=p>:</span> <span class=n>Int</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>key</span><span class=p>.</span><span class=n>label</span> <span class=o>?:</span> <span class=k>return</span>

        <span class=n>mPaint</span><span class=p>.</span><span class=n>color</span> <span class=p>=</span> <span class=n>color</span>
        <span class=n>mPaint</span><span class=p>.</span><span class=n>textSize</span> <span class=p>=</span> <span class=n>mLabelTextSize</span><span class=p>.</span><span class=n>toFloat</span><span class=p>()</span>

        <span class=n>canvas</span><span class=p>.</span><span class=n>drawText</span><span class=p>(</span>
            <span class=n>key</span><span class=p>.</span><span class=n>label</span><span class=p>.</span><span class=n>toString</span><span class=p>(),</span>
            <span class=p>(</span><span class=n>key</span><span class=p>.</span><span class=n>x</span> <span class=p>+</span> <span class=p>((</span><span class=n>key</span><span class=p>.</span><span class=n>width</span> <span class=p>-</span> <span class=n>paddingLeft</span> <span class=p>-</span> <span class=n>paddingRight</span><span class=p>)</span> <span class=p>/</span> <span class=m>2</span> <span class=p>+</span> <span class=n>paddingLeft</span><span class=p>)).</span><span class=n>toFloat</span><span class=p>(),</span>
            <span class=n>key</span><span class=p>.</span><span class=n>y</span> <span class=p>+</span> <span class=p>((</span><span class=n>key</span><span class=p>.</span><span class=n>height</span> <span class=p>-</span> <span class=n>paddingTop</span> <span class=p>-</span> <span class=n>paddingBottom</span><span class=p>)</span> <span class=p>/</span> <span class=m>2</span><span class=p>).</span><span class=n>toFloat</span><span class=p>()</span> <span class=p>+</span> <span class=p>(</span><span class=n>mPaint</span><span class=p>.</span><span class=n>textSize</span> <span class=p>-</span> <span class=n>mPaint</span><span class=p>.</span><span class=n>descent</span><span class=p>())</span> <span class=p>/</span> <span class=m>2</span> <span class=p>+</span> <span class=n>paddingTop</span><span class=p>.</span><span class=n>toFloat</span><span class=p>(),</span>
            <span class=n>mPaint</span>
        <span class=p>)</span>
    <span class=p>}</span>

    <span class=cm>/**</span>
<span class=cm>     * 绘制按键icon</span>
<span class=cm>     */</span>
    <span class=k>private</span> <span class=k>fun</span> <span class=nf>drawIcon</span><span class=p>(</span><span class=n>canvas</span><span class=p>:</span> <span class=n>Canvas</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=n>Keyboard</span><span class=p>.</span><span class=n>Key</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>key</span><span class=p>.</span><span class=n>icon</span> <span class=o>?:</span> <span class=k>return</span>

        <span class=n>key</span><span class=p>.</span><span class=n>icon</span><span class=p>.</span><span class=n>setBounds</span><span class=p>(</span>
            <span class=n>key</span><span class=p>.</span><span class=n>x</span> <span class=p>+</span> <span class=p>(</span><span class=n>key</span><span class=p>.</span><span class=n>width</span> <span class=p>-</span> <span class=n>key</span><span class=p>.</span><span class=n>icon</span><span class=p>.</span><span class=n>intrinsicWidth</span><span class=p>)</span> <span class=p>/</span> <span class=m>2</span> <span class=p>+</span> <span class=n>paddingStart</span><span class=p>,</span>
            <span class=n>key</span><span class=p>.</span><span class=n>y</span> <span class=p>+</span> <span class=p>(</span><span class=n>key</span><span class=p>.</span><span class=n>height</span> <span class=p>-</span> <span class=n>key</span><span class=p>.</span><span class=n>icon</span><span class=p>.</span><span class=n>intrinsicHeight</span><span class=p>)</span> <span class=p>/</span> <span class=m>2</span> <span class=p>+</span> <span class=n>paddingTop</span><span class=p>,</span>
            <span class=n>key</span><span class=p>.</span><span class=n>x</span> <span class=p>+</span> <span class=p>(</span><span class=n>key</span><span class=p>.</span><span class=n>width</span> <span class=p>-</span> <span class=n>key</span><span class=p>.</span><span class=n>icon</span><span class=p>.</span><span class=n>intrinsicWidth</span><span class=p>)</span> <span class=p>/</span> <span class=m>2</span> <span class=p>+</span> <span class=n>key</span><span class=p>.</span><span class=n>icon</span><span class=p>.</span><span class=n>intrinsicWidth</span> <span class=p>+</span> <span class=n>paddingStart</span><span class=p>,</span>
            <span class=n>key</span><span class=p>.</span><span class=n>y</span> <span class=p>+</span> <span class=p>(</span><span class=n>key</span><span class=p>.</span><span class=n>height</span> <span class=p>-</span> <span class=n>key</span><span class=p>.</span><span class=n>icon</span><span class=p>.</span><span class=n>intrinsicHeight</span><span class=p>)</span> <span class=p>/</span> <span class=m>2</span> <span class=p>+</span> <span class=n>key</span><span class=p>.</span><span class=n>icon</span><span class=p>.</span><span class=n>intrinsicHeight</span> <span class=p>+</span> <span class=n>paddingTop</span>
        <span class=p>)</span>
        <span class=n>key</span><span class=p>.</span><span class=n>icon</span><span class=p>.</span><span class=n>draw</span><span class=p>(</span><span class=n>canvas</span><span class=p>)</span>
    <span class=p>}</span>

    <span class=k>companion</span> <span class=k>object</span> <span class=p>{</span>
        <span class=c1>// 数字键盘模式</span>
        <span class=k>const</span> <span class=k>val</span> <span class=py>KEYBOARD_MODE_NUMBER</span> <span class=p>=</span> <span class=m>1</span>
        <span class=c1>// 字母键盘模式</span>
        <span class=k>const</span> <span class=k>val</span> <span class=py>KEYBOARD_MODE_QWERTY</span> <span class=p>=</span> <span class=m>2</span>
        <span class=c1>// 数字键盘模式模式下按键背景</span>
        <span class=k>private</span> <span class=k>val</span> <span class=py>NUMBER_KEY_BACKGROUND</span> <span class=p>=</span> <span class=n>Triple</span><span class=p>(</span>
            <span class=n>R</span><span class=p>.</span><span class=n>drawable</span><span class=p>.</span><span class=n>selector_kb_number_keyboard_done</span><span class=p>,</span>
            <span class=n>R</span><span class=p>.</span><span class=n>drawable</span><span class=p>.</span><span class=n>selector_kb_number_keyboard_action</span><span class=p>,</span>
            <span class=n>R</span><span class=p>.</span><span class=n>drawable</span><span class=p>.</span><span class=n>selector_kb_number_keyboard_normal</span>
        <span class=p>)</span>
        <span class=c1>// 字母键盘模式模式下按键背景</span>
        <span class=k>private</span> <span class=k>val</span> <span class=py>QWERTY_KEY_BACKGROUND</span> <span class=p>=</span> <span class=n>Triple</span><span class=p>(</span>
            <span class=n>R</span><span class=p>.</span><span class=n>drawable</span><span class=p>.</span><span class=n>selector_kb_qwerty_keyboard_done</span><span class=p>,</span>
            <span class=n>R</span><span class=p>.</span><span class=n>drawable</span><span class=p>.</span><span class=n>selector_kb_qwerty_keyboard_action</span><span class=p>,</span>
            <span class=n>R</span><span class=p>.</span><span class=n>drawable</span><span class=p>.</span><span class=n>selector_kb_qwerty_keyboard_normal</span>
        <span class=p>)</span>
    <span class=p>}</span>
<span class=p>}</span>
</pre></div> <p>可以看到，切换键盘逻辑非常简单，主需要把事先创建好的<code>Keyboard</code>传入<code>KeyboardView.setKeyboard</code>方法中即可。</p> <p>此外，代码中提到的按键背景资源就是一个个<code>selector</code>，例子如下：</p> <p><strong>selector_kb_number_keyboard_normal.xml</strong> <div class=codehilite><pre><span></span><span class=cp>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class=nt>&lt;selector</span>
    <span class=na>xmlns:android=</span><span class=s>&quot;http://schemas.android.com/apk/res/android&quot;</span><span class=nt>&gt;</span>
    <span class=nt>&lt;item</span> <span class=na>android:state_pressed=</span><span class=s>&quot;true&quot;</span><span class=nt>&gt;</span>
        <span class=nt>&lt;shape</span> <span class=na>android:shape=</span><span class=s>&quot;rectangle&quot;</span><span class=nt>&gt;</span>
            <span class=nt>&lt;solid</span> <span class=na>android:color=</span><span class=s>&quot;#EEEEEE&quot;</span> <span class=nt>/&gt;</span>
            <span class=nt>&lt;stroke</span> <span class=na>android:color=</span><span class=s>&quot;#dfdfdf&quot;</span>
                <span class=na>android:width=</span><span class=s>&quot;1px&quot;</span> <span class=nt>/&gt;</span>
        <span class=nt>&lt;/shape&gt;</span>
    <span class=nt>&lt;/item&gt;</span>
    <span class=nt>&lt;item&gt;</span>
        <span class=nt>&lt;shape</span> <span class=na>android:shape=</span><span class=s>&quot;rectangle&quot;</span><span class=nt>&gt;</span>
            <span class=nt>&lt;solid</span> <span class=na>android:color=</span><span class=s>&quot;#FFFFFF&quot;</span> <span class=nt>/&gt;</span>
            <span class=nt>&lt;stroke</span> <span class=na>android:color=</span><span class=s>&quot;#dfdfdf&quot;</span>
                <span class=na>android:width=</span><span class=s>&quot;1px&quot;</span> <span class=nt>/&gt;</span>
        <span class=nt>&lt;/shape&gt;</span>
    <span class=nt>&lt;/item&gt;</span>
<span class=nt>&lt;/selector&gt;</span>
</pre></div></p> <h2 id=3>3. 键盘辅助类<a class=headerlink href=#3 title="Permanent link">&para;</a></h2> <p>现在<code>KeyboardView</code>以及xml都写好了，还需要一个类实现<code>KeyboardView.OnKeyboardActionListener</code>接口来处理按键点击事件；并监听<code>EditText</code>的点击、触摸、焦点改变事件来弹出、隐藏自定义的<code>KeyboardView</code>。</p> <p>这部分代码也很简单：</p> <div class=codehilite><pre><span></span><span class=cm>/**</span>
<span class=cm> * 软键盘辅助类</span>
<span class=cm> * @param rootView 页面的根布局 会在里面findViewById(R.id.keyboard_view)</span>
<span class=cm> */</span>
<span class=k>class</span> <span class=nc>RSKeyboard</span><span class=p>(</span>
    <span class=n>rootView</span><span class=p>:</span> <span class=n>View</span>
<span class=p>)</span> <span class=p>{</span>
    <span class=cm>/**</span>
<span class=cm>     * 点击KEYCODE_CANCEL时的回调</span>
<span class=cm>     */</span>
    <span class=k>interface</span> <span class=nc>OnKeyboardCancelListener</span> <span class=p>{</span>
        <span class=k>fun</span> <span class=nf>onCancel</span><span class=p>()</span>
    <span class=p>}</span>

    <span class=cm>/**</span>
<span class=cm>     * 点击KEYCODE_DONE时的回调</span>
<span class=cm>     */</span>
    <span class=k>interface</span> <span class=nc>OnKeyboardDoneListener</span> <span class=p>{</span>
        <span class=k>fun</span> <span class=nf>onDone</span><span class=p>()</span>
    <span class=p>}</span>

    <span class=k>private</span> <span class=k>val</span> <span class=py>mKeyboardView</span><span class=p>:</span> <span class=n>RSKeyboardView</span> <span class=p>=</span> <span class=n>rootView</span><span class=p>.</span><span class=n>findViewById</span><span class=p>(</span><span class=n>R</span><span class=p>.</span><span class=n>id</span><span class=p>.</span><span class=n>keyboard_view</span><span class=p>)</span>

    <span class=c1>// 要使用自定义键盘进行输入的输入框</span>
    <span class=k>private</span> <span class=k>var</span> <span class=py>mAttachedEditText</span><span class=p>:</span> <span class=n>EditText</span><span class=p>?</span> <span class=p>=</span> <span class=k>null</span>

    <span class=c1>// 点击按键时的回调</span>
    <span class=k>private</span> <span class=k>val</span> <span class=py>mOnKeyboardActionListener</span> <span class=p>=</span>
        <span class=k>object</span> <span class=p>:</span> <span class=nc>KeyboardView</span><span class=p>.</span><span class=n>OnKeyboardActionListener</span> <span class=p>{</span>
            <span class=cm>/**</span>
<span class=cm>             * code值到文字的映射</span>
<span class=cm>             * -1001 -&gt; 000</span>
<span class=cm>             * -1002 -&gt; 002</span>
<span class=cm>             * -1003 -&gt; 300</span>
<span class=cm>             * -1004 -&gt; 600</span>
<span class=cm>             * -1005 -&gt; 601</span>
<span class=cm>             */</span>
            <span class=k>private</span> <span class=k>val</span> <span class=py>code2StringMap</span> <span class=p>=</span> <span class=n>SparseArray</span><span class=p>&lt;</span><span class=n>String</span><span class=p>&gt;(</span><span class=m>5</span><span class=p>)</span>
            <span class=k>private</span> <span class=k>val</span> <span class=py>KEY_000</span> <span class=p>=</span> <span class=s>&quot;000&quot;</span>
            <span class=k>private</span> <span class=k>val</span> <span class=py>KEY_002</span> <span class=p>=</span> <span class=s>&quot;002&quot;</span>
            <span class=k>private</span> <span class=k>val</span> <span class=py>KEY_300</span> <span class=p>=</span> <span class=s>&quot;300&quot;</span>
            <span class=k>private</span> <span class=k>val</span> <span class=py>KEY_600</span> <span class=p>=</span> <span class=s>&quot;600&quot;</span>
            <span class=k>private</span> <span class=k>val</span> <span class=py>KEY_601</span> <span class=p>=</span> <span class=s>&quot;601&quot;</span>
            <span class=k>private</span> <span class=k>val</span> <span class=py>KEY_000_CODE</span> <span class=p>=</span> <span class=p>-</span><span class=m>1001</span>
            <span class=k>private</span> <span class=k>val</span> <span class=py>KEY_002_CODE</span> <span class=p>=</span> <span class=p>-</span><span class=m>1002</span>
            <span class=k>private</span> <span class=k>val</span> <span class=py>KEY_300_CODE</span> <span class=p>=</span> <span class=p>-</span><span class=m>1003</span>
            <span class=k>private</span> <span class=k>val</span> <span class=py>KEY_600_CODE</span> <span class=p>=</span> <span class=p>-</span><span class=m>1004</span>
            <span class=k>private</span> <span class=k>val</span> <span class=py>KEY_601_CODE</span> <span class=p>=</span> <span class=p>-</span><span class=m>1005</span>

            <span class=n>init</span> <span class=p>{</span>
                <span class=n>code2StringMap</span><span class=p>[</span><span class=n>KEY_000_CODE</span><span class=p>]</span> <span class=p>=</span> <span class=n>KEY_000</span>
                <span class=n>code2StringMap</span><span class=p>[</span><span class=n>KEY_002_CODE</span><span class=p>]</span> <span class=p>=</span> <span class=n>KEY_002</span>
                <span class=n>code2StringMap</span><span class=p>[</span><span class=n>KEY_300_CODE</span><span class=p>]</span> <span class=p>=</span> <span class=n>KEY_300</span>
                <span class=n>code2StringMap</span><span class=p>[</span><span class=n>KEY_600_CODE</span><span class=p>]</span> <span class=p>=</span> <span class=n>KEY_600</span>
                <span class=n>code2StringMap</span><span class=p>[</span><span class=n>KEY_601_CODE</span><span class=p>]</span> <span class=p>=</span> <span class=n>KEY_601</span>
            <span class=p>}</span>

            <span class=k>override</span> <span class=k>fun</span> <span class=nf>swipeRight</span><span class=p>()</span> <span class=p>{}</span>
            <span class=k>override</span> <span class=k>fun</span> <span class=nf>onPress</span><span class=p>(</span><span class=n>primaryCode</span><span class=p>:</span> <span class=n>Int</span><span class=p>)</span> <span class=p>{}</span>
            <span class=k>override</span> <span class=k>fun</span> <span class=nf>onRelease</span><span class=p>(</span><span class=n>primaryCode</span><span class=p>:</span> <span class=n>Int</span><span class=p>)</span> <span class=p>{}</span>
            <span class=k>override</span> <span class=k>fun</span> <span class=nf>swipeLeft</span><span class=p>()</span> <span class=p>{}</span>
            <span class=k>override</span> <span class=k>fun</span> <span class=nf>swipeUp</span><span class=p>()</span> <span class=p>{}</span>
            <span class=k>override</span> <span class=k>fun</span> <span class=nf>swipeDown</span><span class=p>()</span> <span class=p>{}</span>
            <span class=k>override</span> <span class=k>fun</span> <span class=nf>onText</span><span class=p>(</span><span class=n>text</span><span class=p>:</span> <span class=n>CharSequence</span><span class=p>?)</span> <span class=p>{}</span>

            <span class=k>override</span> <span class=k>fun</span> <span class=nf>onKey</span><span class=p>(</span><span class=n>primaryCode</span><span class=p>:</span> <span class=n>Int</span><span class=p>,</span> <span class=n>keyCodes</span><span class=p>:</span> <span class=n>IntArray</span><span class=p>?)</span> <span class=p>{</span>
                <span class=n>mAttachedEditText</span><span class=o>?.</span><span class=n>let</span> <span class=p>{</span>
                    <span class=k>val</span> <span class=py>editable</span> <span class=p>=</span> <span class=n>it</span><span class=p>.</span><span class=n>text</span>
                    <span class=k>val</span> <span class=py>start</span> <span class=p>=</span> <span class=n>it</span><span class=p>.</span><span class=n>selectionStart</span>

                    <span class=k>when</span> <span class=p>(</span><span class=n>primaryCode</span><span class=p>)</span> <span class=p>{</span>
                        <span class=n>Keyboard</span><span class=p>.</span><span class=n>KEYCODE_DELETE</span> <span class=p>-&gt;</span> <span class=p>{</span>
                            <span class=c1>// primaryCode=-1004 keyCodes=[-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1]</span>
                            <span class=c1>// primaryCode=-5 keyCodes=[-5]</span>
                            <span class=c1>// primaryCode=-1004 keyCodes=[-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1]</span>
                            <span class=c1>// primaryCode=-5 keyCodes=[-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1]</span>
                            <span class=c1>// 连续点击多个codes的键时 会触发delete 此时keyCodes为[-5]</span>
                            <span class=k>if</span> <span class=p>(</span><span class=n>keyCodes</span><span class=o>?.</span><span class=n>size</span> <span class=p>==</span> <span class=m>1</span><span class=p>)</span> <span class=p>{</span>
                                <span class=k>return</span>
                            <span class=p>}</span>
                            <span class=k>if</span> <span class=p>(</span><span class=n>editable</span> <span class=p>!=</span> <span class=k>null</span> <span class=p>&amp;&amp;</span> <span class=n>editable</span><span class=p>.</span><span class=n>isNotEmpty</span><span class=p>()</span> <span class=p>&amp;&amp;</span> <span class=n>start</span> <span class=p>&gt;</span> <span class=m>0</span><span class=p>)</span> <span class=p>{</span>
                                <span class=n>editable</span><span class=p>.</span><span class=n>delete</span><span class=p>(</span><span class=n>start</span> <span class=p>-</span> <span class=m>1</span><span class=p>,</span> <span class=n>start</span><span class=p>)</span>
                            <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
                            <span class=p>}</span>
                        <span class=p>}</span>
                        <span class=n>Keyboard</span><span class=p>.</span><span class=n>KEYCODE_CANCEL</span> <span class=p>-&gt;</span> <span class=p>{</span>
                            <span class=n>hideKeyBoard</span><span class=p>()</span>
                            <span class=n>onKeyBoardCancelListener</span><span class=o>?.</span><span class=n>onCancel</span><span class=p>()</span>
                            <span class=n>mAttachedEditText</span><span class=o>?.</span><span class=n>performHapticFeedback</span><span class=p>(</span><span class=n>HapticFeedbackConstants</span><span class=p>.</span><span class=n>KEYBOARD_TAP</span><span class=p>)</span>
                        <span class=p>}</span>
                        <span class=n>Keyboard</span><span class=p>.</span><span class=n>KEYCODE_DONE</span> <span class=p>-&gt;</span> <span class=p>{</span>
                            <span class=n>hideKeyBoard</span><span class=p>()</span>
                            <span class=n>onKeyboardOkListener</span><span class=o>?.</span><span class=n>onDone</span><span class=p>()</span>
                            <span class=n>mAttachedEditText</span><span class=o>?.</span><span class=n>performHapticFeedback</span><span class=p>(</span><span class=n>HapticFeedbackConstants</span><span class=p>.</span><span class=n>KEYBOARD_TAP</span><span class=p>)</span>
                        <span class=p>}</span>
                        <span class=n>Keyboard</span><span class=p>.</span><span class=n>KEYCODE_MODE_CHANGE</span> <span class=p>-&gt;</span> <span class=p>{</span>
                            <span class=n>mKeyboardView</span><span class=p>.</span><span class=n>toggleMode</span><span class=p>()</span>
                            <span class=n>mAttachedEditText</span><span class=o>?.</span><span class=n>performHapticFeedback</span><span class=p>(</span><span class=n>HapticFeedbackConstants</span><span class=p>.</span><span class=n>KEYBOARD_TAP</span><span class=p>)</span>
                        <span class=p>}</span>
                        <span class=k>else</span> <span class=p>-&gt;</span> <span class=p>{</span>
                            <span class=k>if</span> <span class=p>(</span><span class=n>code2StringMap</span><span class=p>.</span><span class=n>containsKey</span><span class=p>(</span><span class=n>primaryCode</span><span class=p>))</span> <span class=p>{</span>
                                <span class=n>editable</span><span class=p>.</span><span class=n>insert</span><span class=p>(</span><span class=n>start</span><span class=p>,</span> <span class=n>code2StringMap</span><span class=p>[</span><span class=n>primaryCode</span><span class=p>])</span>
                            <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
                                <span class=n>editable</span><span class=p>.</span><span class=n>insert</span><span class=p>(</span><span class=n>start</span><span class=p>,</span> <span class=n>primaryCode</span><span class=p>.</span><span class=n>toChar</span><span class=p>().</span><span class=n>toString</span><span class=p>())</span>
                            <span class=p>}</span>
                            <span class=n>mAttachedEditText</span><span class=o>?.</span><span class=n>performHapticFeedback</span><span class=p>(</span><span class=n>HapticFeedbackConstants</span><span class=p>.</span><span class=n>KEYBOARD_TAP</span><span class=p>)</span>
                        <span class=p>}</span>
                    <span class=p>}</span>
                <span class=p>}</span>
            <span class=p>}</span>
        <span class=p>}</span>

    <span class=cm>/**</span>
<span class=cm>     * 点击KEYCODE_DONE时的回调</span>
<span class=cm>     */</span>
    <span class=k>var</span> <span class=py>onKeyboardOkListener</span><span class=p>:</span> <span class=n>OnKeyboardDoneListener</span><span class=p>?</span> <span class=p>=</span> <span class=k>null</span>
    <span class=cm>/**</span>
<span class=cm>     * 点击KEYCODE_CANCEL时的回调</span>
<span class=cm>     */</span>
    <span class=k>var</span> <span class=py>onKeyBoardCancelListener</span><span class=p>:</span> <span class=n>OnKeyboardCancelListener</span><span class=p>?</span> <span class=p>=</span> <span class=k>null</span>

    <span class=n>@SuppressLint</span><span class=p>(</span><span class=s>&quot;ClickableViewAccessibility&quot;</span><span class=p>)</span>
    <span class=k>fun</span> <span class=nf>attachTo</span><span class=p>(</span><span class=n>editText</span><span class=p>:</span> <span class=n>EditText</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>mAttachedEditText</span> <span class=p>=</span> <span class=n>editText</span>

        <span class=c1>// 设置按键回调</span>
        <span class=n>mKeyboardView</span><span class=p>.</span><span class=n>setOnKeyboardActionListener</span><span class=p>(</span><span class=n>mOnKeyboardActionListener</span><span class=p>)</span>

        <span class=c1>// 处理弹出、关闭键盘的逻辑</span>
        <span class=n>editText</span><span class=p>.</span><span class=n>setOnClickListener</span> <span class=p>{</span>
            <span class=n>showKeyBoard</span><span class=p>()</span>
        <span class=p>}</span>
        <span class=n>editText</span><span class=p>.</span><span class=n>setOnTouchListener</span> <span class=p>{</span> <span class=n>_</span><span class=p>,</span> <span class=n>_</span> <span class=p>-&gt;</span>
            <span class=n>editText</span><span class=p>.</span><span class=n>requestFocus</span><span class=p>()</span>
            <span class=n>editText</span><span class=p>.</span><span class=n>requestFocusFromTouch</span><span class=p>()</span>
            <span class=n>hideSystemSoftKeyboard</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=n>editText</span><span class=p>)</span>
            <span class=k>return</span><span class=n>@setOnTouchListener</span>  <span class=k>false</span>
        <span class=p>}</span>
        <span class=n>editText</span><span class=p>.</span><span class=n>setOnFocusChangeListener</span> <span class=p>{</span> <span class=n>_</span><span class=p>,</span> <span class=n>hasFocus</span> <span class=p>-&gt;</span>
            <span class=k>if</span> <span class=p>(!</span><span class=n>hasFocus</span><span class=p>)</span> <span class=p>{</span>
                <span class=n>hideKeyBoard</span><span class=p>()</span>
            <span class=p>}</span>
        <span class=p>}</span>
    <span class=p>}</span>

    <span class=cm>/**</span>
<span class=cm>     * 显示键盘</span>
<span class=cm>     */</span>
    <span class=k>fun</span> <span class=nf>showKeyBoard</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>mKeyboardView</span><span class=p>.</span><span class=n>visibility</span> <span class=p>!=</span> <span class=n>View</span><span class=p>.</span><span class=n>VISIBLE</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>mKeyboardView</span><span class=p>.</span><span class=n>visibility</span> <span class=p>=</span> <span class=n>View</span><span class=p>.</span><span class=n>VISIBLE</span>
        <span class=p>}</span>
    <span class=p>}</span>

    <span class=cm>/**</span>
<span class=cm>     * 隐藏键盘</span>
<span class=cm>     */</span>
    <span class=k>fun</span> <span class=nf>hideKeyBoard</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span> <span class=n>mKeyboardView</span><span class=p>.</span><span class=n>visibility</span> <span class=p>==</span> <span class=n>View</span><span class=p>.</span><span class=n>VISIBLE</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>mKeyboardView</span><span class=p>.</span><span class=n>visibility</span> <span class=p>=</span> <span class=n>View</span><span class=p>.</span><span class=n>GONE</span>
        <span class=p>}</span>
    <span class=p>}</span>

    <span class=k>companion</span> <span class=k>object</span> <span class=p>{</span>
        <span class=cm>/**</span>
<span class=cm>         * 隐藏系统键盘</span>
<span class=cm>         */</span>
        <span class=n>@SuppressLint</span><span class=p>(</span><span class=s>&quot;ObsoleteSdkInt&quot;</span><span class=p>)</span>
        <span class=k>fun</span> <span class=nf>hideSystemSoftKeyboard</span><span class=p>(</span><span class=n>context</span><span class=p>:</span> <span class=n>Context</span><span class=p>,</span> <span class=n>editText</span><span class=p>:</span> <span class=n>EditText</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>when</span> <span class=p>{</span>
                <span class=n>Build</span><span class=p>.</span><span class=n>VERSION</span><span class=p>.</span><span class=n>SDK_INT</span> <span class=p>&gt;=</span> <span class=n>Build</span><span class=p>.</span><span class=n>VERSION_CODES</span><span class=p>.</span><span class=n>LOLLIPOP</span> <span class=p>-&gt;</span> <span class=p>{</span>
                    <span class=n>editText</span><span class=p>.</span><span class=n>showSoftInputOnFocus</span> <span class=p>=</span> <span class=k>false</span>
                <span class=p>}</span>
                <span class=n>Build</span><span class=p>.</span><span class=n>VERSION</span><span class=p>.</span><span class=n>SDK_INT</span> <span class=p>&gt;=</span> <span class=n>Build</span><span class=p>.</span><span class=n>VERSION_CODES</span><span class=p>.</span><span class=n>HONEYCOMB</span> <span class=p>-&gt;</span> <span class=p>{</span>
                    <span class=k>try</span> <span class=p>{</span>
                        <span class=k>val</span> <span class=py>clazz</span> <span class=p>=</span> <span class=n>EditText</span><span class=o>::</span><span class=k>class</span><span class=p>.</span><span class=n>java</span>
                        <span class=k>val</span> <span class=py>setShowSoftInputOnFocus</span> <span class=p>=</span> <span class=n>clazz</span><span class=p>.</span><span class=n>getMethod</span><span class=p>(</span><span class=s>&quot;setShowSoftInputOnFocus&quot;</span><span class=p>,</span> <span class=n>Boolean</span><span class=o>::</span><span class=k>class</span><span class=p>.</span><span class=n>javaPrimitiveType</span><span class=p>)</span>
                        <span class=n>setShowSoftInputOnFocus</span><span class=p>.</span><span class=n>isAccessible</span> <span class=p>=</span> <span class=k>true</span>
                        <span class=n>setShowSoftInputOnFocus</span><span class=p>.</span><span class=n>invoke</span><span class=p>(</span><span class=n>editText</span><span class=p>,</span> <span class=k>false</span><span class=p>)</span>
                    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>e</span><span class=p>:</span> <span class=n>Exception</span><span class=p>)</span> <span class=p>{</span> <span class=p>}</span>
                <span class=p>}</span>
                <span class=k>else</span> <span class=p>-&gt;</span> <span class=p>{</span>
                    <span class=n>editText</span><span class=p>.</span><span class=n>inputType</span> <span class=p>=</span> <span class=n>InputType</span><span class=p>.</span><span class=n>TYPE_NULL</span>
                <span class=p>}</span>
            <span class=p>}</span>

            <span class=k>val</span> <span class=py>imm</span> <span class=p>=</span> <span class=n>context</span><span class=p>.</span><span class=n>getSystemService</span><span class=p>(</span><span class=n>Context</span><span class=p>.</span><span class=n>INPUT_METHOD_SERVICE</span><span class=p>)</span> <span class=k>as</span><span class=p>?</span> <span class=n>InputMethodManager</span> <span class=o>?:</span> <span class=k>return</span>
            <span class=n>imm</span><span class=p>.</span><span class=n>hideSoftInputFromWindow</span><span class=p>(</span><span class=n>editText</span><span class=p>.</span><span class=n>windowToken</span><span class=p>,</span> <span class=m>0</span><span class=p>)</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>
</pre></div> <p>上面这段代码只有一点需要注意一下，这点在第一节中也说到了，这就是处理double<code>android:codes</code>的问题。 </p> <p>多codes的按键，在连续快速点击时，中间会发出<code>KEYCODE_DELETE</code>事件。以<code>&lt;Key android:codes="-1004,-1004" android:keyLabel="600" /&gt;</code>为例，如果我们快速连击两次，会发出如下事件：</p> <div class=codehilite><pre><span></span>primaryCode=-1004 keyCodes=[-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1]
primaryCode=-5 keyCodes=[-5]
primaryCode=-1004 keyCodes=[-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1]
</pre></div> <p>而正常的<code>KEYCODE_DELETE</code>是这样的：</p> <div class=codehilite><pre><span></span>primaryCode=-5 keyCodes=[-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1]
</pre></div> <p>所以我们在处理<code>KEYCODE_DELETE</code>时，要过滤<code>keyCodes</code>长度为1的情况。</p> <h2 id=4>4. 使用准备<a class=headerlink href=#4 title="Permanent link">&para;</a></h2> <p>由于我们在自定义的<code>KeyboardView</code>中没有调用<code>super.onDraw</code>，所以<code>KeyboardView</code>的很多xml属性都没有必要设置。 </p> <p>可以设置的样式只有三个（见第二节的自定义<code>KeyboardView</code>源码）：</p> <ul> <li><code>android:background</code><br> 键盘背景颜色</li> <li><code>android:labelTextSize</code><br> 按键文字大小</li> <li><code>android:keyTextColor</code><br> 按键文字颜色</li> </ul> <p>所以，我们可以写一个layout等待inculde：</p> <p><strong>include_keyboard.xml</strong></p> <div class=codehilite><pre><span></span><span class=cp>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class=nt>&lt;com.redstock.android.core.keyboard.RSKeyboardView</span>
    <span class=na>xmlns:android=</span><span class=s>&quot;http://schemas.android.com/apk/res/android&quot;</span>
    <span class=na>android:id=</span><span class=s>&quot;@+id/keyboard_view&quot;</span>
    <span class=na>android:layout_width=</span><span class=s>&quot;match_parent&quot;</span>
    <span class=na>android:layout_height=</span><span class=s>&quot;wrap_content&quot;</span>
    <span class=na>android:background=</span><span class=s>&quot;#DDDDDD&quot;</span>
    <span class=na>android:labelTextSize=</span><span class=s>&quot;18sp&quot;</span>
    <span class=na>android:keyTextColor=</span><span class=s>&quot;#030303&quot;</span>
    <span class=na>android:visibility=</span><span class=s>&quot;gone&quot;</span><span class=nt>/&gt;</span>
</pre></div> <p>然后在需要软键盘的页面中include进来：</p> <div class=codehilite><pre><span></span><span class=cp>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class=nt>&lt;layout&gt;</span>
    <span class=nt>&lt;data&gt;</span>
        ...
    <span class=nt>&lt;/data&gt;</span>

    <span class=nt>&lt;androidx.constraintlayout.widget.ConstraintLayout</span>
        <span class=na>xmlns:android=</span><span class=s>&quot;http://schemas.android.com/apk/res/android&quot;</span>
        <span class=na>xmlns:tools=</span><span class=s>&quot;http://schemas.android.com/tools&quot;</span>
        <span class=na>xmlns:app=</span><span class=s>&quot;http://schemas.android.com/apk/res-auto&quot;</span>
        <span class=na>android:layout_width=</span><span class=s>&quot;match_parent&quot;</span>
        <span class=na>android:layout_height=</span><span class=s>&quot;match_parent&quot;</span>
        <span class=na>tools:background=</span><span class=s>&quot;@color/colorWindow&quot;</span><span class=nt>&gt;</span>
        ...
        <span class=nt>&lt;include</span>
            <span class=na>layout=</span><span class=s>&quot;@layout/include_keyboard&quot;</span>
            <span class=na>android:layout_width=</span><span class=s>&quot;match_parent&quot;</span>
            <span class=na>android:layout_height=</span><span class=s>&quot;wrap_content&quot;</span>
            <span class=na>app:layout_constraintStart_toStartOf=</span><span class=s>&quot;parent&quot;</span>
            <span class=na>app:layout_constraintEnd_toEndOf=</span><span class=s>&quot;parent&quot;</span>
            <span class=na>app:layout_constraintBottom_toBottomOf=</span><span class=s>&quot;parent&quot;</span> <span class=nt>/&gt;</span>

    <span class=nt>&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;</span>
<span class=nt>&lt;/layout&gt;</span>
</pre></div> <p>最后在页面代码中初始化一下即可：</p> <div class=codehilite><pre><span></span><span class=k>class</span> <span class=nc>LoginActivity</span> <span class=p>:</span> <span class=n>BaseActivity</span><span class=p>()</span> <span class=p>{</span>
    <span class=p>...</span>
    <span class=n>@Inject</span>
    <span class=k>lateinit</span> <span class=k>var</span> <span class=py>dataBinding</span><span class=p>:</span> <span class=n>ViewDataBinding</span>

    <span class=k>private</span> <span class=k>val</span> <span class=py>mRSKeyboard</span> <span class=k>by</span> <span class=n>lazy</span> <span class=p>{</span> <span class=n>RSKeyboard</span><span class=p>(</span><span class=n>dataBinding</span><span class=p>.</span><span class=n>root</span><span class=p>)</span> <span class=p>}</span>

    <span class=k>override</span> <span class=k>fun</span> <span class=nf>onCreate</span><span class=p>(</span><span class=n>savedInstanceState</span><span class=p>:</span> <span class=n>Bundle</span><span class=p>?)</span> <span class=p>{</span>
        <span class=k>super</span><span class=p>.</span><span class=n>onCreate</span><span class=p>(</span><span class=n>savedInstanceState</span><span class=p>)</span>
        <span class=p>...</span>
        <span class=n>mRSKeyboard</span><span class=p>.</span><span class=n>attachTo</span><span class=p>(</span><span class=n>etPhone</span><span class=p>)</span>
        <span class=n>mRSKeyboard</span><span class=p>.</span><span class=n>onKeyboardOkListener</span> <span class=p>=</span> <span class=k>object</span> <span class=p>:</span> <span class=nc>RSKeyboard</span><span class=p>.</span><span class=n>OnKeyboardDoneListener</span> <span class=p>{</span>
            <span class=k>override</span> <span class=k>fun</span> <span class=nf>onDone</span><span class=p>()</span> <span class=p>{</span>
                <span class=n>viewModel</span><span class=p>.</span><span class=n>toastString</span><span class=p>.</span><span class=n>value</span> <span class=p>=</span> <span class=s>&quot;DONE&quot;</span>
            <span class=p>}</span>
        <span class=p>}</span>
        <span class=n>mRSKeyboard</span><span class=p>.</span><span class=n>onKeyBoardCancelListener</span> <span class=p>=</span> <span class=k>object</span> <span class=p>:</span> <span class=nc>RSKeyboard</span><span class=p>.</span><span class=n>OnKeyboardCancelListener</span> <span class=p>{</span>
            <span class=k>override</span> <span class=k>fun</span> <span class=nf>onCancel</span><span class=p>()</span> <span class=p>{</span>
                <span class=n>viewModel</span><span class=p>.</span><span class=n>toastString</span><span class=p>.</span><span class=n>value</span> <span class=p>=</span> <span class=s>&quot;CANCEL&quot;</span>
            <span class=p>}</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>
</pre></div> <p>完工</p> <hr> <div class=md-source-date> <small> 最后更新: 2020年1月14日 </small> </div> <h2 id=__comments>评论</h2> <div id=disqus_thread></div> <script>
    var disqus_config = function () {
      this.page.url = "https://blog.yorek.xyz/about-me/android/other/soft-keyboard-in-app/";
      this.page.identifier =
        "/android/other/soft-keyboard-in-app/";
    };
    (function() {
      var d = document, s = d.createElement("script");
      s.src = "//yorekliu.disqus.com/embed.js";
      s.setAttribute("data-timestamp", +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid"> <a href=../Android通讯录快速读取/ title=Android通讯录快速读取 class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> 上一页 </span> Android通讯录快速读取 </span> </div> </a> <a href=../腾讯X5内核入坑指南/ title="腾讯TBS X5浏览器内核入坑指南" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel=next> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> 下一页 </span> 腾讯TBS X5浏览器内核入坑指南 </span> </div> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> &copy; 2020 Yorek </div> powered by <a href=https://www.mkdocs.org>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ > Material for MkDocs</a> </div> <div class=md-footer-social> <link rel=stylesheet href=../../../assets/fonts/font-awesome.css> <a href=https://github.com/YorekLiu class="md-footer-social__link fa fa-github"></a> <a href=lyytogether@gmail.com class="md-footer-social__link fa fa-email"></a> </div> </div> </div> </footer> </div> <script src=../../../assets/javascripts/application.808e90bb.js></script> <script src=../../../assets/javascripts/lunr/lunr.stemmer.support.js></script> <script src=../../../assets/javascripts/lunr/tinyseg.js></script> <script src=../../../assets/javascripts/lunr/lunr.ja.js></script> <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script> <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script> </body> </html>
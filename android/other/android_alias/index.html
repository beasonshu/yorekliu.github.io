<!--
  Copyright (c) 2016-2020 Martin Donath <martin.donath@squidfunk.com>
  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:
  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.
  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
--> <!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=description content="An Android Developer."><link href=https://blog.yorek.xyz/about-me/android/other/android_alias/ rel=canonical><meta name=author content="Yorek Liu"><meta name=lang:clipboard.copy content=复制><meta name=lang:clipboard.copied content=已复制><meta name=lang:search.language content=ja><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content=没有找到符合条件的结果><meta name=lang:search.result.one content="找到 1 个符合条件的结果"><meta name=lang:search.result.other content="# 个符合条件的结果"><meta name=lang:search.tokenizer content=[\uff0c\u3002]+><link rel="shortcut icon" href=../../../assets/images/favicon.ico><meta name=generator content="mkdocs-1.0.4, mkdocs-material-4.6.0"><title>Android马甲包的那些事儿</title><link rel=stylesheet href=../../../assets/stylesheets/application.1b62728e.css><link rel=stylesheet href=../../../assets/stylesheets/application-palette.a8b3c06d.css><meta name=theme-color content><script src=../../../assets/javascripts/modernizr.268332fc.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel=stylesheet href=../../../assets/fonts/material-icons.css><link rel=manifest href=../../../manifest.webmanifest><script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-155096376-1", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script><script async src=https://www.google-analytics.com/analytics.js></script><!-- Determine title --><!-- The image needs to have an absolute URL --><!-- Open graph meta tags --><meta property=og:type content=website><meta property=og:title content="Yorek's - Android马甲包的那些事儿"><meta property=og:description content="An Android Developer."><meta content=https://blog.yorek.xyz/about-me/android/other/android_alias/ property=og:url><meta property=og:image content=https://blog.yorek.xyz/about-meassets/images/banner.png><meta property=og:image:type content=image/png><meta property=og:image:width content=1200><meta property=og:image:height content=630><!-- Twitter meta tags --><meta name=twitter:card content=summary_large_image><meta name=twitter:site content=@squidfunk><meta name=twitter:creator content=@squidfunk><meta name=twitter:title content="Yorek's - Android马甲包的那些事儿"><meta name=twitter:description content="An Android Developer."><meta name=twitter:image content=https://blog.yorek.xyz/about-meassets/images/banner.png></head> <body dir=ltr data-md-color-primary=white data-md-color-accent=blue> <svg class=md-svg> <defs> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#1 tabindex=1 class=md-skip> 跳转至 </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=https://blog.yorek.xyz/about-me title="Yorek's" class="md-header-nav__button md-logo"> <img src=../../../assets/images/favicon.ico width=24 height=24> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> Yorek's </span> <span class=md-header-nav__topic> Android马甲包的那些事儿 </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> 键入以开始搜索 </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container> <nav class="md-tabs md-tabs--active" data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../3rd-library/3rd-library-source-code/ class=md-tabs__link> Android </a> </li> <li class=md-tabs__item> <a href=../../../flutter/flutter_first_project_1/ class=md-tabs__link> Flutter </a> </li> <li class=md-tabs__item> <a href=../../../leetcode/ class=md-tabs__link> LeetCode </a> </li> <li class=md-tabs__item> <a href=../../../design-pattern/design-pattern/ class=md-tabs__link> Books </a> </li> </ul> </div> </nav> <main class=md-main role=main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=https://blog.yorek.xyz/about-me title="Yorek's" class="md-nav__button md-logo"> <img src=../../../assets/images/favicon.ico width=48 height=48> </a> Yorek's </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. title=Home class=md-nav__link> Home </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2 type=checkbox id=nav-2 checked> <label class=md-nav__link for=nav-2> Android </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-2> Android </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-1 type=checkbox id=nav-2-1> <label class=md-nav__link for=nav-2-1> 三方库源码解析 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-1> 三方库源码解析 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../3rd-library/3rd-library-source-code/ title=Android三方库源码分析 class=md-nav__link> Android三方库源码分析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/matrix/ title="微信APM Matrix解析" class=md-nav__link> 微信APM Matrix解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/matrix-trace/ title=Matrix-TraceCanary解析 class=md-nav__link> Matrix-TraceCanary解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/matrix-io/ title=Matrix-IOCanary解析 class=md-nav__link> Matrix-IOCanary解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/matrix-resource/ title=Matrix-ResourceCanary解析 class=md-nav__link> Matrix-ResourceCanary解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/matrix-sqlitelint/ title=Matrix-SQLiteLint解析 class=md-nav__link> Matrix-SQLiteLint解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/okhttp/ title=OkHttp3源码解析 class=md-nav__link> OkHttp3源码解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/retrofit/ title=Retrofit2源码解析 class=md-nav__link> Retrofit2源码解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/rxjava&rxandroid/ title=RxJava源码解析及使用实例 class=md-nav__link> RxJava源码解析及使用实例 </a> </li> <li class=md-nav__item> <a href=../RxJava/ title=RxJava操作符大全 class=md-nav__link> RxJava操作符大全 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide1/ title="Glide v4 源码解析（一）" class=md-nav__link> Glide v4 源码解析（一） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide2/ title="Glide v4 源码解析（二）" class=md-nav__link> Glide v4 源码解析（二） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide3/ title="Glide v4 源码解析（三）" class=md-nav__link> Glide v4 源码解析（三） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide4/ title="Glide v4 源码解析（四）" class=md-nav__link> Glide v4 源码解析（四） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide5/ title="Glide v4 源码解析（五）" class=md-nav__link> Glide v4 源码解析（五） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide6/ title="Glide v4 源码解析（六）" class=md-nav__link> Glide v4 源码解析（六） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide7/ title="Glide v4 源码解析（七）" class=md-nav__link> Glide v4 源码解析（七） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/migrate-to-glide/ title=杂记：从Picasso迁移至Glide class=md-nav__link> 杂记：从Picasso迁移至Glide </a> </li> <li class=md-nav__item> <a href=../../3rd-library/eventbus/ title=EventBus源码解析 class=md-nav__link> EventBus源码解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/leakcanary/ title=LeakCanary2源码解析 class=md-nav__link> LeakCanary2源码解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/permissiondispatcher/ title=PermissionDispatcher源码解析 class=md-nav__link> PermissionDispatcher源码解析 </a> </li> <li class=md-nav__item> <a href=../constraintlayout/ title=ConstraintLayout使用大全 class=md-nav__link> ConstraintLayout使用大全 </a> </li> <li class=md-nav__item> <a href=../dagger2/ title=初学者的Dagger2教程 class=md-nav__link> 初学者的Dagger2教程 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-2 type=checkbox id=nav-2-2> <label class=md-nav__link for=nav-2-2> Android开发高手课 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-2> Android开发高手课 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../paid/master/ title=Android开发高手课 class=md-nav__link> Android开发高手课 </a> </li> <li class=md-nav__item> <a href=../../paid/master/crash_1/ title="01 | 崩溃优化（上）：关于“崩溃”那些事儿" class=md-nav__link> 01 | 崩溃优化（上）：关于“崩溃”那些事儿 </a> </li> <li class=md-nav__item> <a href=../../paid/master/crash_2/ title="02 | 崩溃优化（下）：应用崩溃了，你应该如何去分析？" class=md-nav__link> 02 | 崩溃优化（下）：应用崩溃了，你应该如何去分析？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/memory_1/ title="03 | 内存优化（上）：4GB内存时代，再谈内存优化" class=md-nav__link> 03 | 内存优化（上）：4GB内存时代，再谈内存优化 </a> </li> <li class=md-nav__item> <a href=../../paid/master/memory_2/ title="04 | 内存优化（下）：内存优化这件事，应该从哪里着手？" class=md-nav__link> 04 | 内存优化（下）：内存优化这件事，应该从哪里着手？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/stuck_1/ title="05 | 卡顿优化（上）：你要掌握的卡顿分析方法" class=md-nav__link> 05 | 卡顿优化（上）：你要掌握的卡顿分析方法 </a> </li> <li class=md-nav__item> <a href=../../paid/master/stuck_2/ title="06 | 卡顿优化（下）：如何监控应用卡顿？" class=md-nav__link> 06 | 卡顿优化（下）：如何监控应用卡顿？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/stuck_3/ title="06补充篇 | 卡顿优化：卡顿现场与卡顿分析" class=md-nav__link> 06补充篇 | 卡顿优化：卡顿现场与卡顿分析 </a> </li> <li class=md-nav__item> <a href=../../paid/master/start_1/ title="07 | 启动优化（上）：从启动过程看启动速度优化" class=md-nav__link> 07 | 启动优化（上）：从启动过程看启动速度优化 </a> </li> <li class=md-nav__item> <a href=../../paid/master/start_2/ title="08 | 启动优化（下）：优化启动速度的进阶方法" class=md-nav__link> 08 | 启动优化（下）：优化启动速度的进阶方法 </a> </li> <li class=md-nav__item> <a href=../../paid/master/io_1/ title="09 | I/O优化（上）：开发工程师必备的I/O优化知识" class=md-nav__link> 09 | I/O优化（上）：开发工程师必备的I/O优化知识 </a> </li> <li class=md-nav__item> <a href=../../paid/master/io_2/ title="10 | I/O优化（中）：不同I/O方式的使用场景是什么？" class=md-nav__link> 10 | I/O优化（中）：不同I/O方式的使用场景是什么？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/io_3/ title="11 | I/O优化（下）：如何监控线上I/O操作？" class=md-nav__link> 11 | I/O优化（下）：如何监控线上I/O操作？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/storage_1/ title="12 | 存储优化（上）：常见的数据存储方法有哪些？" class=md-nav__link> 12 | 存储优化（上）：常见的数据存储方法有哪些？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/storage_2/ title="13 | 存储优化（中）：如何优化数据存储？" class=md-nav__link> 13 | 存储优化（中）：如何优化数据存储？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/storage_3/ title="14 | 存储优化（下）：数据库SQLite的使用和优化" class=md-nav__link> 14 | 存储优化（下）：数据库SQLite的使用和优化 </a> </li> <li class=md-nav__item> <a href=../../paid/master/network_1/ title="15 | 网络优化（上）：移动开发工程师必备的网络优化知识" class=md-nav__link> 15 | 网络优化（上）：移动开发工程师必备的网络优化知识 </a> </li> <li class=md-nav__item> <a href=../../paid/master/network_2/ title="16 | 网络优化（中）：复杂多变的移动网络该如何优化？" class=md-nav__link> 16 | 网络优化（中）：复杂多变的移动网络该如何优化？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/network_3/ title="17 | 网络优化（下）：大数据下网络该如何监控？" class=md-nav__link> 17 | 网络优化（下）：大数据下网络该如何监控？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/battery_1/ title="18 | 耗电优化（上）：从电量优化的演进看耗电分析" class=md-nav__link> 18 | 耗电优化（上）：从电量优化的演进看耗电分析 </a> </li> <li class=md-nav__item> <a href=../../paid/master/battery_2/ title="19 | 耗电优化（下）：耗电的优化方法与线上监控" class=md-nav__link> 19 | 耗电优化（下）：耗电的优化方法与线上监控 </a> </li> <li class=md-nav__item> <a href=../../paid/master/ui_1/ title="20 | UI 优化（上）：UI 渲染的几个关键概念" class=md-nav__link> 20 | UI 优化（上）：UI 渲染的几个关键概念 </a> </li> <li class=md-nav__item> <a href=../../paid/master/ui_2/ title="21 | UI 优化（下）：如何优化 UI 渲染？" class=md-nav__link> 21 | UI 优化（下）：如何优化 UI 渲染？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/package_1/ title="22 | 包体积优化（上）：如何减少安装包大小？" class=md-nav__link> 22 | 包体积优化（上）：如何减少安装包大小？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/package_2/ title="23 | 包体积优化（下）：资源优化的进阶实践" class=md-nav__link> 23 | 包体积优化（下）：资源优化的进阶实践 </a> </li> <li class=md-nav__item> <a href=../../paid/master/compile/ title="26 | 关于编译，你需要了解什么？" class=md-nav__link> 26 | 关于编译，你需要了解什么？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/bytecode/ title="27 | 编译插桩的三种方法：AspectJ、ASM、ReDex" class=md-nav__link> 27 | 编译插桩的三种方法：AspectJ、ASM、ReDex </a> </li> <li class=md-nav__item> <a href=../../paid/master/native_hook/ title="35 | Native Hook 技术，天使还是魔鬼？" class=md-nav__link> 35 | Native Hook 技术，天使还是魔鬼？ </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-3 type=checkbox id=nav-2-3> <label class=md-nav__link for=nav-2-3> Framework系列 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-3> Framework系列 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../framework/Android四大组件(1)/ title=Activity class=md-nav__link> Activity </a> </li> <li class=md-nav__item> <a href=../../framework/Android四大组件(2)/ title=Service class=md-nav__link> Service </a> </li> <li class=md-nav__item> <a href=../../framework/Android四大组件(3)/ title=Broadcasts class=md-nav__link> Broadcasts </a> </li> <li class=md-nav__item> <a href=../../framework/Android四大组件(4)/ title="Content Providers与Fragment" class=md-nav__link> Content Providers与Fragment </a> </li> <li class=md-nav__item> <a href=../../framework/IPC机制/ title=IPC机制 class=md-nav__link> IPC机制 </a> </li> <li class=md-nav__item> <a href=../../framework/View的事件体系/ title=View的事件体系 class=md-nav__link> View的事件体系 </a> </li> <li class=md-nav__item> <a href=../../framework/View的绘制原理/ title=View的绘制原理 class=md-nav__link> View的绘制原理 </a> </li> <li class=md-nav__item> <a href=../../framework/RemoteViews/ title=RemoteViews class=md-nav__link> RemoteViews </a> </li> <li class=md-nav__item> <a href=../../framework/Drawable/ title=Android中的Drawable资源 class=md-nav__link> Android中的Drawable资源 </a> </li> <li class=md-nav__item> <a href=../../framework/Android动画/ title=Android动画 class=md-nav__link> Android动画 </a> </li> <li class=md-nav__item> <a href=../../framework/Window与WindowManager/ title=Window与WindowManager class=md-nav__link> Window与WindowManager </a> </li> <li class=md-nav__item> <a href=../../framework/四大组件启动过程/ title=四大组件启动过程 class=md-nav__link> 四大组件启动过程 </a> </li> <li class=md-nav__item> <a href=../../framework/Android消息机制/ title=Android消息机制 class=md-nav__link> Android消息机制 </a> </li> <li class=md-nav__item> <a href=../../framework/Android线程与线程池/ title=Android线程与线程池 class=md-nav__link> Android线程与线程池 </a> </li> <li class=md-nav__item> <a href=../../framework/Bitmap的缓存与加载/ title=Bitmap的缓存与加载 class=md-nav__link> Bitmap的缓存与加载 </a> </li> <li class=md-nav__item> <a href=../../framework/JNI与NDK/ title=JNI与NDK编程简介 class=md-nav__link> JNI与NDK编程简介 </a> </li> <li class=md-nav__item> <a href=../../framework/性能优化/ title=Android性能优化 class=md-nav__link> Android性能优化 </a> </li> <li class=md-nav__item> <a href=../../framework/binder1-mediaservice/ title=Binder深入理解——以MediaService为例 class=md-nav__link> Binder深入理解——以MediaService为例 </a> </li> <li class=md-nav__item> <a href=../../framework/binder2/ title=Binder深入理解——罗老师系列 class=md-nav__link> Binder深入理解——罗老师系列 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-4 type=checkbox id=nav-2-4> <label class=md-nav__link for=nav-2-4> 付费知识归档 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-4> 付费知识归档 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-4-1 type=checkbox id=nav-2-4-1> <label class=md-nav__link for=nav-2-4-1> 某圈问题索引 </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-2-4-1> 某圈问题索引 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../paid/zsxq/zsxq_index/ title=某圈问题索引 class=md-nav__link> 某圈问题索引 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week1-synchronized/ title=理解Java中synchronized关键词 class=md-nav__link> 理解Java中synchronized关键词 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week2-service/ title=理解Service class=md-nav__link> 理解Service </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week3-activity/ title=理解Activity的启动模式 class=md-nav__link> 理解Activity的启动模式 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week4-startActivityForResult/ title=关于startActivityForResult class=md-nav__link> 关于startActivityForResult </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week5-view/ title=关于View的知识 class=md-nav__link> 关于View的知识 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week6-gradle/ title=关于Gradle的知识 class=md-nav__link> 关于Gradle的知识 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week7-serialization/ title=关于序列化的知识 class=md-nav__link> 关于序列化的知识 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week10-classloader/ title=Android中的ClassLoader class=md-nav__link> Android中的ClassLoader </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week11-binder/ title=Binder简介 class=md-nav__link> Binder简介 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week12-retrofit-okhttp/ title=OkHttp和Retrofit的作用以及两者之间的联系 class=md-nav__link> OkHttp和Retrofit的作用以及两者之间的联系 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week14-jvm-gc/ title=JVM中垃圾回收策略 class=md-nav__link> JVM中垃圾回收策略 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week16-keep-app-alive/ title=进程保活 class=md-nav__link> 进程保活 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week17-android-components/ title=四大组件的作用以及多进程 class=md-nav__link> 四大组件的作用以及多进程 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week20-network-protocol/ title=网络协议 class=md-nav__link> 网络协议 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week21-mvc&amp;mvp&mvvm/ title=MVC、MVP和MVVM class=md-nav__link> MVC、MVP和MVVM </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week22-android-studio-build/ title="Android Studio build过程" class=md-nav__link> Android Studio build过程 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week23-load-large-bitmap/ title=大尺寸图片加载问题 class=md-nav__link> 大尺寸图片加载问题 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-5 type=checkbox id=nav-2-5 checked> <label class=md-nav__link for=nav-2-5> 日常记录 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-5> 日常记录 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../annotation/ title=注解的定义及解析 class=md-nav__link> 注解的定义及解析 </a> </li> <li class=md-nav__item> <a href=../best_throttle_in_mvvm/ title=这可能是MVVM中最优雅的按键防抖方案 class=md-nav__link> 这可能是MVVM中最优雅的按键防抖方案 </a> </li> <li class=md-nav__item> <a href=../android-jenkins/ title="Jenkins for android" class=md-nav__link> Jenkins for android </a> </li> <li class=md-nav__item> <a href=../SystemProrities/ title=普通Android程序使用SystemProrities class=md-nav__link> 普通Android程序使用SystemProrities </a> </li> <li class=md-nav__item> <a href=../recyclerview-cache/ title=ListView、RecyclerView缓存策略解析 class=md-nav__link> ListView、RecyclerView缓存策略解析 </a> </li> <li class=md-nav__item> <a href=../recyclerview-item-docoration/ title=RecyclerView高级特性——ItemDecoration class=md-nav__link> RecyclerView高级特性——ItemDecoration </a> </li> <li class=md-nav__item> <a href=../recyclerview-others/ title=RecyclerView的一些使用细节 class=md-nav__link> RecyclerView的一些使用细节 </a> </li> <li class=md-nav__item> <a href=../RecyclerView-Sort&Delete/ title=RecyclerView高级特性——拖拽排序以及滑动删除 class=md-nav__link> RecyclerView高级特性——拖拽排序以及滑动删除 </a> </li> <li class=md-nav__item> <a href=../FAB-Behavior/ title=FloatingActionButton上滑隐藏下滑显示 class=md-nav__link> FloatingActionButton上滑隐藏下滑显示 </a> </li> <li class=md-nav__item> <a href=../nestedscrolling/ title=NestedScrolling机制 class=md-nav__link> NestedScrolling机制 </a> </li> <li class=md-nav__item> <a href=../porterduff/ title=使用Porter-Duff合成数字图像 class=md-nav__link> 使用Porter-Duff合成数字图像 </a> </li> <li class=md-nav__item> <a href=../runtime/ title="Android Runtime" class=md-nav__link> Android Runtime </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-toggle md-nav__toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Android马甲包的那些事儿 </label> <a href=./ title=Android马甲包的那些事儿 class="md-nav__link md-nav__link--active"> Android马甲包的那些事儿 </a> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>目录</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#1 class=md-nav__link> 1. 原理 </a> </li> <li class=md-nav__item> <a href=#2 class=md-nav__link> 2. 具体需求 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#21-applicationid class=md-nav__link> 2.1 applicationId、版本号 </a> </li> <li class=md-nav__item> <a href=#22 class=md-nav__link> 2.2 资源文件 </a> </li> <li class=md-nav__item> <a href=#23-key class=md-nav__link> 2.3 各种key的配置 </a> </li> <li class=md-nav__item> <a href=#24 class=md-nav__link> 2.4 代码文件 </a> </li> <li class=md-nav__item> <a href=#25 class=md-nav__link> 2.5 签名配置 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#__comments class="md-nav__link md-nav__link--active"> 评论 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../Android-Development-Tool/ title=Android神兵利器 class=md-nav__link> Android神兵利器 </a> </li> <li class=md-nav__item> <a href=../FileProvider/ title=FileProvider class=md-nav__link> FileProvider </a> </li> <li class=md-nav__item> <a href=../Android判断导航栏高度/ title=Android判断虚拟按键(导航栏)显示与否、高度以及获取屏幕实际高度 class=md-nav__link> Android判断虚拟按键(导航栏)显示与否、高度以及获取屏幕实际高度 </a> </li> <li class=md-nav__item> <a href=../Android图片选择器/ title=Android图片选择器 class=md-nav__link> Android图片选择器 </a> </li> <li class=md-nav__item> <a href=../Android底部导航栏框架/ title=Android原生底部导航栏 class=md-nav__link> Android原生底部导航栏 </a> </li> <li class=md-nav__item> <a href=../Android搜索栏的实现/ title=Android搜索栏的实现 class=md-nav__link> Android搜索栏的实现 </a> </li> <li class=md-nav__item> <a href=../Android暂停音乐播放器的播放/ title=Android暂停酷狗、网易云音乐等音乐播放器的播放 class=md-nav__link> Android暂停酷狗、网易云音乐等音乐播放器的播放 </a> </li> <li class=md-nav__item> <a href=../Android滑动返回实践/ title=Android滑动返回实践 class=md-nav__link> Android滑动返回实践 </a> </li> <li class=md-nav__item> <a href=../Android程序反编译/ title=MacOS下Android程序反编译 class=md-nav__link> MacOS下Android程序反编译 </a> </li> <li class=md-nav__item> <a href=../Android通讯录快速读取/ title=Android通讯录快速读取 class=md-nav__link> Android通讯录快速读取 </a> </li> <li class=md-nav__item> <a href=../soft-keyboard-in-app/ title=App内自定义软键盘 class=md-nav__link> App内自定义软键盘 </a> </li> <li class=md-nav__item> <a href=../腾讯X5内核入坑指南/ title="腾讯TBS X5浏览器内核入坑指南" class=md-nav__link> 腾讯TBS X5浏览器内核入坑指南 </a> </li> <li class=md-nav__item> <a href=../琐碎知识点/ title=琐碎知识点 class=md-nav__link> 琐碎知识点 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3 type=checkbox id=nav-3> <label class=md-nav__link for=nav-3> Flutter </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-3> Flutter </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../flutter/flutter_first_project_1/ title=年轻人的第一个Flutter程序(1) class=md-nav__link> 年轻人的第一个Flutter程序(1) </a> </li> <li class=md-nav__item> <a href=../../../flutter/flutter_first_project_2/ title=年轻人的第一个Flutter程序(2) class=md-nav__link> 年轻人的第一个Flutter程序(2) </a> </li> <li class=md-nav__item> <a href=../../../flutter/flutter_first_project_3/ title=年轻人的第一个Flutter程序(3) class=md-nav__link> 年轻人的第一个Flutter程序(3) </a> </li> <li class=md-nav__item> <a href=../../../flutter/flutter_first_project_4/ title=年轻人的第一个Flutter程序(4) class=md-nav__link> 年轻人的第一个Flutter程序(4) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4 type=checkbox id=nav-4> <label class=md-nav__link for=nav-4> LeetCode </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-4> LeetCode </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../leetcode/ title=算法目录 class=md-nav__link> 算法目录 </a> </li> <li class=md-nav__item> <a href=../../../leetcode/code_interviews_1/ title=数据结构、算法和数据操作 class=md-nav__link> 数据结构、算法和数据操作 </a> </li> <li class=md-nav__item> <a href=../../../leetcode/code_interviews_3/ title=高质量的代码 class=md-nav__link> 高质量的代码 </a> </li> <li class=md-nav__item> <a href=../../../leetcode/code_interviews_4/ title=解决问题的思路 class=md-nav__link> 解决问题的思路 </a> </li> <li class=md-nav__item> <a href=../../../leetcode/code_interviews_5/ title=优化时间和空间效率 class=md-nav__link> 优化时间和空间效率 </a> </li> <li class=md-nav__item> <a href=../../../leetcode/code_interviews_6/ title=面试中的各项能力 class=md-nav__link> 面试中的各项能力 </a> </li> <li class=md-nav__item> <a href=../../../leetcode/array/ title=Array class=md-nav__link> Array </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode1-10/ title=LeetCode(1-10) class=md-nav__link> LeetCode(1-10) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode11-20/ title=LeetCode(11-20) class=md-nav__link> LeetCode(11-20) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode21-30/ title=LeetCode(21-30) class=md-nav__link> LeetCode(21-30) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode31-40/ title=LeetCode(31-40) class=md-nav__link> LeetCode(31-40) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode41-50/ title=LeetCode(41-50) class=md-nav__link> LeetCode(41-50) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode51-60/ title=LeetCode(51-60) class=md-nav__link> LeetCode(51-60) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode61-70/ title=LeetCode(61-70) class=md-nav__link> LeetCode(61-70) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode71-80/ title=LeetCode(71-80) class=md-nav__link> LeetCode(71-80) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode81-90/ title=LeetCode(81-90) class=md-nav__link> LeetCode(81-90) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode91-100/ title=LeetCode(91-100) class=md-nav__link> LeetCode(91-100) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode101-110/ title=LeetCode(101-110) class=md-nav__link> LeetCode(101-110) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode111-120/ title=LeetCode(111-120) class=md-nav__link> LeetCode(111-120) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5 type=checkbox id=nav-5> <label class=md-nav__link for=nav-5> Books </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-5> Books </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-1 type=checkbox id=nav-5-1> <label class=md-nav__link for=nav-5-1> Design Pattern </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-1> Design Pattern </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../design-pattern/design-pattern/ title=设计模式概述 class=md-nav__link> 设计模式概述 </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/design-principle/ title=面向对象的六大原则 class=md-nav__link> 面向对象的六大原则 </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/singleton/ title=单例模式(Singleton) class=md-nav__link> 单例模式(Singleton) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/builder/ title=建造者模式(Builder) class=md-nav__link> 建造者模式(Builder) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/prototype/ title=原型模式(Prototype) class=md-nav__link> 原型模式(Prototype) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/factory-method/ title="工厂方法模式(Factory method)" class=md-nav__link> 工厂方法模式(Factory method) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/abstract-factory/ title="抽象工厂模式(Abstract factory)" class=md-nav__link> 抽象工厂模式(Abstract factory) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/proxy/ title=代理模式(Proxy) class=md-nav__link> 代理模式(Proxy) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/composite/ title=组合模式(Composite) class=md-nav__link> 组合模式(Composite) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/adapter/ title=适配器模式(Adapter) class=md-nav__link> 适配器模式(Adapter) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/decorator/ title=装饰模式(Decorator) class=md-nav__link> 装饰模式(Decorator) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/flyweight/ title=享元模式(Flyweight) class=md-nav__link> 享元模式(Flyweight) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/facade/ title=外观模式(Facade) class=md-nav__link> 外观模式(Facade) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/bridge/ title=桥接模式(Bridge) class=md-nav__link> 桥接模式(Bridge) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/strategy/ title=策略模式(Strategy) class=md-nav__link> 策略模式(Strategy) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/state/ title=状态模式(State) class=md-nav__link> 状态模式(State) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/chain-of-responsibility/ title="责任链模式(Chain of responsibility)" class=md-nav__link> 责任链模式(Chain of responsibility) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/interpreter/ title=解释器模式(Interpreter) class=md-nav__link> 解释器模式(Interpreter) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/command/ title=命令模式(Command) class=md-nav__link> 命令模式(Command) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/observer/ title=观察者模式(Observer) class=md-nav__link> 观察者模式(Observer) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/memento/ title=备忘录模式(Memento) class=md-nav__link> 备忘录模式(Memento) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/iterator/ title=迭代器模式(Iterator) class=md-nav__link> 迭代器模式(Iterator) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/template-method/ title="模版方法模式(Template method)" class=md-nav__link> 模版方法模式(Template method) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/visitor/ title=访问者模式(Visitor) class=md-nav__link> 访问者模式(Visitor) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/mediator/ title=中介者模式(Mediator) class=md-nav__link> 中介者模式(Mediator) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/confusing-design-pattern/ title=易混淆的设计模式 class=md-nav__link> 易混淆的设计模式 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2 type=checkbox id=nav-5-2> <label class=md-nav__link for=nav-5-2> Effective Java </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-2> Effective Java </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../effective-java/effective-java/ title="Effective Java概述" class=md-nav__link> Effective Java概述 </a> </li> <li class=md-nav__item> <a href=../../../effective-java/chapter1/ title=创建和销毁对象 class=md-nav__link> 创建和销毁对象 </a> </li> <li class=md-nav__item> <a href=../../../effective-java/chapter2/ title=对于所有对象都通用的方法 class=md-nav__link> 对于所有对象都通用的方法 </a> </li> <li class=md-nav__item> <a href=../../../effective-java/chapter3/ title=类和接口 class=md-nav__link> 类和接口 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-3 type=checkbox id=nav-5-3> <label class=md-nav__link for=nav-5-3> JVM </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-3> JVM </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../jvm/jvm-content/ title=深入理解Java虚拟机 class=md-nav__link> 深入理解Java虚拟机 </a> </li> <li class=md-nav__item> <a href=../../../jvm/java-memory-area-oom/ title=Java内存区域与内存溢出异常 class=md-nav__link> Java内存区域与内存溢出异常 </a> </li> <li class=md-nav__item> <a href=../../../jvm/java-gc/ title=垃圾收集器与内存分配策略 class=md-nav__link> 垃圾收集器与内存分配策略 </a> </li> <li class=md-nav__item> <a href=../../../jvm/class-struct/ title=类文件结构 class=md-nav__link> 类文件结构 </a> </li> <li class=md-nav__item> <a href=../../../jvm/load-class/ title=虚拟机类加载机制 class=md-nav__link> 虚拟机类加载机制 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-4 type=checkbox id=nav-5-4> <label class=md-nav__link for=nav-5-4> Java </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-4> Java </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../java/generics-java-kotlin/ title=Java&Kotlin在泛型方面的区别 class=md-nav__link> Java&Kotlin在泛型方面的区别 </a> </li> <li class=md-nav__item> <a href=../../../java/java-collections/ title=Java集合总结 class=md-nav__link> Java集合总结 </a> </li> <li class=md-nav__item> <a href=../../../java/java-foundation/ title=Java常见概念 class=md-nav__link> Java常见概念 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-5 type=checkbox id=nav-5-5> <label class=md-nav__link for=nav-5-5> Refactoring </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-5> Refactoring </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../refactoring/refactoring/ title=重构：改善既有代码的设计 class=md-nav__link> 重构：改善既有代码的设计 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>目录</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#1 class=md-nav__link> 1. 原理 </a> </li> <li class=md-nav__item> <a href=#2 class=md-nav__link> 2. 具体需求 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#21-applicationid class=md-nav__link> 2.1 applicationId、版本号 </a> </li> <li class=md-nav__item> <a href=#22 class=md-nav__link> 2.2 资源文件 </a> </li> <li class=md-nav__item> <a href=#23-key class=md-nav__link> 2.3 各种key的配置 </a> </li> <li class=md-nav__item> <a href=#24 class=md-nav__link> 2.4 代码文件 </a> </li> <li class=md-nav__item> <a href=#25 class=md-nav__link> 2.5 签名配置 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#__comments class="md-nav__link md-nav__link--active"> 评论 </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <h1>Android马甲包的那些事儿</h1> <p>制作Android马甲包最简单的方式就是使用 <strong>productFlavors</strong> 机制。 </p> <p>本文就是在productFlavors机制的基础上制作的马甲包，每个马甲只需要</p> <ol> <li>在<code>build.gradle</code>文件中配置一下包名、各种key、签名文件</li> <li>配置启动页、logo、app名等资源</li> <li>配置服务器域名、微信分享回调Activity等代码</li> </ol> <p>此外，代码、资源文件等全部都天然支持差异化功能。</p> <h2 id=1>1. 原理<a class=headerlink href=#1 title="Permanent link">&para;</a></h2> <p>如下面代码所示，我们在<code>build.gradle</code>中使用productFlavors机制可以创建两个flavor——hdd以及jinyouzi，这样在Build Variant中就可以通过hddDebug、hddRelease、jinyouziDebug、jinyouziRelease来编译对应马甲的debug、release包。</p> <p><strong>注意，在此文章中hdd是基线包，jinyouzi是马甲包。</strong></p> <div class=codehilite><pre><span></span>android {
    defaultConfig {
        applicationId &quot;com.xxx.xxxxxxx.app&quot;

        flavorDimensions &quot;product&quot;
    }

    productFlavors{
        hdd {
            dimension &quot;product&quot;
        }

        jinyouzi {
            dimension &quot;product&quot;
        }
    }
}
</pre></div> <p>配置了flavor之后，我们在app/src下面可以创建与main目录同级的hdd、jinyouzi目录。这两个目录中的资源文件、代码在编译对应的flavor时可以加入编译。也就是说hdd = ['src/main', 'src/hdd']，jinyouzi = ['src/main', 'src/jinyouzi']。</p> <ul> <li> <p>对于资源文件来说，flavor下的资源会“覆盖”main下面的资源，也就是flavor的优先级高——不知道官方怎么称呼，我借用Android系统开发中的名词，称之为<code>overlay</code>机制。 </p> <blockquote> <p>其实这点与apk的编译流程有关，在<a href=https://developer.android.com/studio/build/shrink-code#merge-resources>Shrink, obfuscate, and optimize your app - Merge duplicate resources</a>中有提到：<br> Gradle merges duplicate resources in the following cascading priority order:<br> Gradle 会按以下级联优先顺序合并重复资源：<br> Dependencies → Main → Build flavor → Build type<br> 依赖项 → 主资源 → 构建flavor → 构建类型<br> For example, if a duplicate resource appears in both your main resources and a build flavor, Gradle selects the one in the build flavor. </p> <p>例如，如果某个重复资源同时出现在主资源和构建flavor中，Gradle 会选择构建flavor中的重复资源。<br> 该文章的中文翻译在<a href=/android/paid/zsxq/week22-android-studio-build/#proguard-r8>Android Studio build过程 - ProGuard &amp; R8</a>一文中有翻译。</p> </blockquote> </li> <li> <p>对于代码文件来说，如果flavor和main下有代码文件名称一样，编译时会报错。所以需要把各个flavor有差异的文件放到各个flavor下，而不是main下。 </p> </li> </ul> <p><strong>这就是马甲包的资源、代码管理的关键点。</strong> 这段关键点一头雾水没关系，后面具体配置的时候就会体会到。</p> <p><img alt=添加flavor后app的目录层次 src=/assets/images/android/android_alias_flavor_dir.png></p> <p>此外，<strong>各个flavor原本就能配置不同的applicationId、版本号、友盟统计分享等key以及签名文件等</strong>，具体代码在后面会谈到。</p> <h2 id=2>2. 具体需求<a class=headerlink href=#2 title="Permanent link">&para;</a></h2> <p>我们先下面会从以下几个方面说明实际需求需要修改的位置：</p> <ol> <li>applicationId、版本号</li> <li>资源文件</li> <li>各种key的配置</li> <li>代码文件</li> <li>签名配置</li> </ol> <h3 id=21-applicationid>2.1 applicationId、版本号<a class=headerlink href=#21-applicationid title="Permanent link">&para;</a></h3> <p>applicationId、版本号可以在flavors中直接进行配置：</p> <p><strong>build.gradle</strong> <div class=codehilite><pre><span></span>android {
    ...
    productFlavors{
        hdd {
            dimension &quot;product&quot;
            applicationId &quot;com.xxx.xxxxxxx.app&quot;
            versionCode 100080
            versionName &quot;1.0.8&quot;
        }

        jinyouzi {
            dimension &quot;product&quot;
            applicationId &quot;com.xxx.flavor.app&quot;
            versionCode 101030
            versionName &quot;1.1.3&quot;
        }
    }
}
</pre></div></p> <p>applicationId在AndroidManifest.xml中也需要使用到，这个在第2.3小节中一起介绍。</p> <h3 id=22>2.2 资源文件<a class=headerlink href=#22 title="Permanent link">&para;</a></h3> <p>利用productFlavors机制，可以为每个flavor创建不同的文件目录。<br> 各个flavor的logo、启动页、app_name等可以放到对应flavor的文件目录中。这样就达到了马甲包的UI效果——换个皮肤。 </p> <p>在文本中，由于hdd是基线，jinyouzi是基于hdd的马甲，因此只需要在jinyouzi中放置需要更改的hdd中对应文件就可以起到覆盖基线资源的效果。</p> <figure class=half> <img src=/assets/images/android/android_alias_res_dir_baseline.png> <img src=/assets/images/android/android_alias_res_dir_flavor.png> <figcaption>基线与马甲res资源目录对比</figcaption> </figure> <p>对于drawable、mipmap资源而言，文件会替换基线的文件。<br> 对于values里面的资源而言，资源不是简单粗暴的文件覆盖，而是每一项具体资源的覆盖。我们只需要在jinyouzi中新增对应的strings、color就可以了。</p> <p>比如jinyouzi中的 <strong>colors.xml</strong> <div class=codehilite><pre><span></span><span class=cp>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class=nt>&lt;resources&gt;</span>
    <span class=nt>&lt;color</span> <span class=na>name=</span><span class=s>&quot;colorPrimaryDark&quot;</span><span class=nt>&gt;</span>#F1964A<span class=nt>&lt;/color&gt;</span>
    <span class=nt>&lt;color</span> <span class=na>name=</span><span class=s>&quot;colorTextPrimary&quot;</span><span class=nt>&gt;</span>#ffffff<span class=nt>&lt;/color&gt;</span>
    <span class=nt>&lt;color</span> <span class=na>name=</span><span class=s>&quot;colorTextSecond&quot;</span><span class=nt>&gt;</span>#ffffff<span class=nt>&lt;/color&gt;</span>
    <span class=nt>&lt;color</span> <span class=na>name=</span><span class=s>&quot;colorControlNormal&quot;</span><span class=nt>&gt;</span>#FFFFFF<span class=nt>&lt;/color&gt;</span>
    <span class=nt>&lt;color</span> <span class=na>name=</span><span class=s>&quot;colorTabIndicatorLightBackground&quot;</span><span class=nt>&gt;</span>@color/fffd850a<span class=nt>&lt;/color&gt;</span>
    <span class=nt>&lt;color</span> <span class=na>name=</span><span class=s>&quot;colorTabIndicatorDarkBackground&quot;</span><span class=nt>&gt;</span>@color/white<span class=nt>&lt;/color&gt;</span>
    <span class=nt>&lt;color</span> <span class=na>name=</span><span class=s>&quot;colorTabSelected&quot;</span><span class=nt>&gt;</span>#FFFFFF<span class=nt>&lt;/color&gt;</span>
    <span class=nt>&lt;color</span> <span class=na>name=</span><span class=s>&quot;colorTabNormal&quot;</span><span class=nt>&gt;</span>#ffdddddd<span class=nt>&lt;/color&gt;</span>
<span class=nt>&lt;/resources&gt;</span>
</pre></div></p> <p>jinyouzi中的 <strong>strings.xml</strong><br> <div class=codehilite><pre><span></span><span class=cp>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class=nt>&lt;resources&gt;</span>
    <span class=nt>&lt;string</span> <span class=na>name=</span><span class=s>&quot;app_name&quot;</span><span class=nt>&gt;</span>jinyouxi<span class=nt>&lt;/string&gt;</span>

    <span class=nt>&lt;string</span> <span class=na>name=</span><span class=s>&quot;we_chat_name&quot;</span><span class=nt>&gt;</span>jinyouzi_wechat_name<span class=nt>&lt;/string&gt;</span>
    <span class=nt>&lt;string</span> <span class=na>name=</span><span class=s>&quot;we_chat_id&quot;</span> <span class=na>translatable=</span><span class=s>&quot;false&quot;</span><span class=nt>&gt;</span>jinyouzi_wechat_id<span class=nt>&lt;/string&gt;</span>
<span class=nt>&lt;/resources&gt;</span>
</pre></div></p> <div class="admonition success"> <p class=admonition-title>Success</p> <p>同一个资源id，马甲包有就用马甲包的，否则用基线的。</p> </div> <h3 id=23-key>2.3 各种key的配置<a class=headerlink href=#23-key title="Permanent link">&para;</a></h3> <p>这里的key配置包括友盟统计、微信分享等key的传统意义上的key配置，还包括AndroidManifest上的客制化配置。 </p> <p>此处的配置主要体现在<code>build.gradle</code>以及<code>Androidmanifest.xml</code>文件中。 </p> <p>先上一段配置完全的<code>build.gradle</code>文件，<em>其中私密信息使用xxx代替</em>:<br> <strong>build.gradle</strong> <div class=codehilite><pre><span></span>android {
    compileSdkVersion rootProject.ext.compileSdkVersion
    buildToolsVersion rootProject.ext.buildToolsVersion

    defaultConfig {
        applicationId &quot;com.xxx.xxxxxxx.app&quot;
        minSdkVersion rootProject.ext.minSdkVersion
        targetSdkVersion rootProject.ext.targetSdkVersion

        flavorDimensions &quot;product&quot;

        multiDexEnabled true
        testInstrumentationRunner &quot;android.support.test.runner.AndroidJUnitRunner&quot;
    }

    signingConfigs {
        hdd {
            keyAlias &#39;xxxx&#39;
            keyPassword &#39;xxxxxxx&#39;
            storeFile file(&#39;../hdd.jks&#39;)
            storePassword &#39;xxxxxxx&#39;
        }

        flavor {
            keyAlias &#39;xxxxx&#39;
            keyPassword &#39;xxxxxxx&#39;
            storeFile file(&#39;../flavor.jks&#39;)
            storePassword &#39;xxxxxxx&#39;
        }
    }

    productFlavors{
        hdd {
            dimension &quot;product&quot;
            applicationId &quot;com.xxx.xxxxxxx.app&quot;
            versionCode 100080
            versionName &quot;1.0.8&quot;
            def qq_id = 1000xxxxxx
            buildConfigField(&#39;String&#39;, &#39;BUGLY_ID&#39;, &#39;&quot;xxxxxxx&quot;&#39;)
            buildConfigField(&#39;String&#39;, &#39;UMCONFIGURE_ID&#39;, &#39;&quot;xxxxxxx&quot;&#39;)
            buildConfigField(&#39;String&#39;, &#39;QQ_SHARE_ID&#39;, &quot;\&quot;$qq_id\&quot;&quot;)
            buildConfigField(&#39;String&#39;, &#39;QQ_SHARE_SECRET&#39;, &#39;&quot;xxxxxxx&quot;&#39;)
            buildConfigField(&#39;String&#39;, &#39;WX_SHARE_ID&#39;, &#39;&quot;xxxxxxx&quot;&#39;)
            buildConfigField(&#39;String&#39;, &#39;WX_SHARE_SECRET&#39;, &#39;&quot;xxxxxxx&quot;&#39;)
            manifestPlaceholders = [
                    schema : &quot;hdd&quot;,
                    qq_id : qq_id
            ]
            signingConfig signingConfigs.hdd
        }

        jinyouzi {
            dimension &quot;product&quot;
            applicationId &quot;com.xxx.flavor.app&quot;
            versionCode 101030
            versionName &quot;1.1.3&quot;
            def qq_id = 1000xxxxxx
            buildConfigField(&#39;String&#39;, &#39;BUGLY_ID&#39;, &#39;&quot;xxxxxxx&quot;&#39;)
            buildConfigField(&#39;String&#39;, &#39;UMCONFIGURE_ID&#39;, &#39;&quot;xxxxxxx&quot;&#39;)
            buildConfigField(&#39;String&#39;, &#39;QQ_SHARE_ID&#39;, &quot;\&quot;$qq_id\&quot;&quot;)
            buildConfigField(&#39;String&#39;, &#39;QQ_SHARE_SECRET&#39;, &#39;&quot;xxxxxxx&quot;&#39;)
            buildConfigField(&#39;String&#39;, &#39;WX_SHARE_ID&#39;, &#39;&quot;xxxxxxx&quot;&#39;)
            buildConfigField(&#39;String&#39;, &#39;WX_SHARE_SECRET&#39;, &#39;&quot;xxxxxxx&quot;&#39;)
            manifestPlaceholders = [
                    schema : &quot;jinyouzi&quot;,
                    qq_id : qq_id
            ]
            signingConfig signingConfigs.flavor
        }
    }

    buildTypes {
        debug {
            zipAlignEnabled false
            shrinkResources false
            minifyEnabled false
            proguardFiles getDefaultProguardFile(&#39;proguard-android.txt&#39;), &#39;proguard-rules.pro&#39;

            signingConfig release.signingConfig
        }
        release {
            zipAlignEnabled true
            shrinkResources true
            minifyEnabled true
            proguardFiles getDefaultProguardFile(&#39;proguard-android.txt&#39;), &#39;proguard-rules.pro&#39;
        }
    }
}
</pre></div></p> <p>在上面的配置中，我们为各个flavor定义了不同的</p> <ul> <li>applicationId</li> <li>版本号</li> <li>Bugly ID</li> <li>友盟ID</li> <li>QQ分享Key</li> <li>微信分享Key</li> <li>应用scheme</li> <li>签名文件</li> </ul> <p>对于配置中的Bugly ID、友盟ID、QQ分享Key、微信分享Key等，使用了<code>buildConfigField</code>来定义，这样编译的时候会在<code>BuildConfig.java</code>文件中生成对应的配置：</p> <p><strong>BuildConfig.java</strong> <div class=codehilite><pre><span></span><span class=cm>/**</span>
<span class=cm> * Automatically generated file. DO NOT MODIFY</span>
<span class=cm> */</span>
<span class=kn>package</span> <span class=nn>com.hdd.android.app</span><span class=p>;</span>

<span class=kd>public</span> <span class=kd>final</span> <span class=kd>class</span> <span class=nc>BuildConfig</span> <span class=p>{</span>
  <span class=kd>public</span> <span class=kd>static</span> <span class=kd>final</span> <span class=kt>boolean</span> <span class=n>DEBUG</span> <span class=o>=</span> <span class=n>Boolean</span><span class=p>.</span><span class=na>parseBoolean</span><span class=p>(</span><span class=s>&quot;true&quot;</span><span class=p>);</span>
  <span class=kd>public</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>String</span> <span class=n>APPLICATION_ID</span> <span class=o>=</span> <span class=s>&quot;com.xxx.flavor.app&quot;</span><span class=p>;</span>
  <span class=kd>public</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>String</span> <span class=n>BUILD_TYPE</span> <span class=o>=</span> <span class=s>&quot;debug&quot;</span><span class=p>;</span>
  <span class=kd>public</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>String</span> <span class=n>FLAVOR</span> <span class=o>=</span> <span class=s>&quot;jinyouzi&quot;</span><span class=p>;</span>
  <span class=kd>public</span> <span class=kd>static</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>VERSION_CODE</span> <span class=o>=</span> <span class=mi>101030</span><span class=p>;</span>
  <span class=kd>public</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>String</span> <span class=n>VERSION_NAME</span> <span class=o>=</span> <span class=s>&quot;1.1.3&quot;</span><span class=p>;</span>
  <span class=c1>// Fields from product flavor: jinyouzi</span>
  <span class=kd>public</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>String</span> <span class=n>BUGLY_ID</span> <span class=o>=</span> <span class=s>&quot;xxxxxxx&quot;</span><span class=p>;</span>
  <span class=kd>public</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>String</span> <span class=n>QQ_SHARE_ID</span> <span class=o>=</span> <span class=s>&quot;xxxxxxx&quot;</span><span class=p>;</span>
  <span class=kd>public</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>String</span> <span class=n>QQ_SHARE_SECRET</span> <span class=o>=</span> <span class=s>&quot;xxxxxxx&quot;</span><span class=p>;</span>
  <span class=kd>public</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>String</span> <span class=n>UMCONFIGURE_ID</span> <span class=o>=</span> <span class=s>&quot;xxxxxxx&quot;</span><span class=p>;</span>
  <span class=kd>public</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>String</span> <span class=n>WX_SHARE_ID</span> <span class=o>=</span> <span class=s>&quot;xxxxxxx&quot;</span><span class=p>;</span>
  <span class=kd>public</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>String</span> <span class=n>WX_SHARE_SECRET</span> <span class=o>=</span> <span class=s>&quot;xxxxxxx&quot;</span><span class=p>;</span>
<span class=p>}</span>
</pre></div></p> <p>在代码中就可以这样直接使用了: </p> <p><strong>HddApplication.kt</strong> <div class=codehilite><pre><span></span><span class=k>package</span> <span class=nn>com.hdd.android.app</span>

<span class=p>...</span>

<span class=k>class</span> <span class=nc>HddApplication</span> <span class=p>:</span> <span class=n>Application</span><span class=p>()</span> <span class=p>{</span>

    <span class=n>init</span> <span class=p>{</span>
        <span class=n>PlatformConfig</span><span class=p>.</span><span class=n>setWeixin</span><span class=p>(</span><span class=n>BuildConfig</span><span class=p>.</span><span class=n>WX_SHARE_ID</span><span class=p>,</span> <span class=n>BuildConfig</span><span class=p>.</span><span class=n>WX_SHARE_SECRET</span><span class=p>)</span>
        <span class=n>PlatformConfig</span><span class=p>.</span><span class=n>setQQZone</span><span class=p>(</span><span class=n>BuildConfig</span><span class=p>.</span><span class=n>QQ_SHARE_ID</span><span class=p>,</span> <span class=n>BuildConfig</span><span class=p>.</span><span class=n>QQ_SHARE_SECRET</span><span class=p>)</span>
    <span class=p>}</span>

    <span class=k>override</span> <span class=k>fun</span> <span class=nf>attachBaseContext</span><span class=p>(</span><span class=n>base</span><span class=p>:</span> <span class=n>Context</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>super</span><span class=p>.</span><span class=n>attachBaseContext</span><span class=p>(</span><span class=n>base</span><span class=p>)</span>
        <span class=n>MultiDex</span><span class=p>.</span><span class=n>install</span><span class=p>(</span><span class=n>base</span><span class=p>)</span>
        <span class=n>Beta</span><span class=p>.</span><span class=n>installTinker</span><span class=p>()</span>
    <span class=p>}</span>

    <span class=k>override</span> <span class=k>fun</span> <span class=nf>onCreate</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>super</span><span class=p>.</span><span class=n>onCreate</span><span class=p>()</span>
        <span class=n>initConfig</span><span class=p>()</span>
    <span class=p>}</span>

    <span class=k>private</span> <span class=k>fun</span> <span class=nf>initConfig</span><span class=p>()</span> <span class=p>{</span>
        <span class=n>application</span> <span class=p>=</span> <span class=k>this</span>

        <span class=n>Bugly</span><span class=p>.</span><span class=n>init</span><span class=p>(</span><span class=k>this</span><span class=p>,</span> <span class=n>BuildConfig</span><span class=p>.</span><span class=n>BUGLY_ID</span><span class=p>,</span> <span class=n>BuildConfig</span><span class=p>.</span><span class=n>DEBUG</span><span class=p>)</span>

        <span class=c1>//友盟    参数5:Push推送业务的secret,否则传空。</span>
        <span class=n>UMConfigure</span><span class=p>.</span><span class=n>setLogEnabled</span><span class=p>(</span><span class=n>BuildConfig</span><span class=p>.</span><span class=n>DEBUG</span><span class=p>)</span>
        <span class=n>UMConfigure</span><span class=p>.</span><span class=n>init</span><span class=p>(</span>
            <span class=n>application</span><span class=p>,</span>
            <span class=n>BuildConfig</span><span class=p>.</span><span class=n>UMCONFIGURE_ID</span><span class=p>,</span>
            <span class=k>null</span><span class=p>,</span>
            <span class=n>UMConfigure</span><span class=p>.</span><span class=n>DEVICE_TYPE_PHONE</span><span class=p>,</span>
            <span class=k>null</span>
        <span class=p>)</span>
    <span class=p>}</span>

    <span class=k>companion</span> <span class=k>object</span> <span class=p>{</span>
        <span class=k>lateinit</span> <span class=k>var</span> <span class=py>application</span><span class=p>:</span> <span class=n>Application</span>
            <span class=k>private</span> <span class=k>set</span>
    <span class=p>}</span>
<span class=p>}</span>
</pre></div></p> <p>还可以通过resValue、meta-data方式来实现上面功能。<br> resValue编译时会产生对应的资源文件。<br> meta-data方式通过动态替换AndriodManifest中的meta-data，然后在程序中获取实现。</p> <p>另外因为QQ分享Key以及应用scheme需要在<code>AndroidManifest.xml</code>中配置对应的值，所以这里使用了manifestPlaceholders。 <div class=codehilite><pre><span></span>manifestPlaceholders = [
        schema : &quot;hdd&quot;,
        qq_id : qq_id
]
</pre></div> 在这配置的值可以在<code>AndroidManifest.xml</code>中直接使用。此外applicationId也天生支持在<code>AndroidManifest.xml</code>使用。</p> <p>我们看看如何在<code>AndroidManifest.xml</code>中进行相关配置：<br> <strong>AndroidManifest.xml</strong> <div class=codehilite><pre><span></span><span class=cp>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class=nt>&lt;manifest</span> <span class=na>package=</span><span class=s>&quot;com.xxx.xxxxxxx.app&quot;</span><span class=nt>&gt;</span>

    <span class=nt>&lt;application</span>
        <span class=na>android:name=</span><span class=s>&quot;.HddApplication&quot;</span><span class=err>...</span><span class=nt>&gt;</span>

        <span class=nt>&lt;activity</span>
            <span class=na>android:name=</span><span class=s>&quot;.core.splash.SplashActivity&quot;</span>
            <span class=na>android:screenOrientation=</span><span class=s>&quot;portrait&quot;</span>
            <span class=na>android:theme=</span><span class=s>&quot;@style/SplashTheme&quot;</span><span class=nt>&gt;</span>
            <span class=nt>&lt;intent-filter&gt;</span>
                <span class=nt>&lt;action</span> <span class=na>android:name=</span><span class=s>&quot;android.intent.action.MAIN&quot;</span> <span class=nt>/&gt;</span>
                <span class=nt>&lt;category</span> <span class=na>android:name=</span><span class=s>&quot;android.intent.category.LAUNCHER&quot;</span> <span class=nt>/&gt;</span>
            <span class=nt>&lt;/intent-filter&gt;</span>
            <span class=nt>&lt;intent-filter&gt;</span>
                <span class=nt>&lt;action</span> <span class=na>android:name=</span><span class=s>&quot;android.intent.action.VIEW&quot;</span><span class=nt>/&gt;</span>
                <span class=nt>&lt;category</span> <span class=na>android:name=</span><span class=s>&quot;android.intent.category.DEFAULT&quot;</span> <span class=nt>/&gt;</span>
                <span class=nt>&lt;category</span> <span class=na>android:name=</span><span class=s>&quot;android.intent.category.BROWSABLE&quot;</span> <span class=nt>/&gt;</span>
                <span class=c>&lt;!-- 配置scheme --&gt;</span>
                <span class=nt>&lt;data</span> <span class=na>android:scheme=</span><span class=s>&quot;${schema}&quot;</span> <span class=nt>/&gt;</span>
            <span class=nt>&lt;/intent-filter&gt;</span>
        <span class=nt>&lt;/activity&gt;</span>

        <span class=c>&lt;!-- 微信分享 --&gt;</span>
        <span class=nt>&lt;activity</span>
            <span class=na>android:name=</span><span class=s>&quot;${applicationId}.wxapi.WXEntryActivity&quot;</span>
            <span class=na>android:configChanges=</span><span class=s>&quot;keyboardHidden|orientation|screenSize&quot;</span>
            <span class=na>android:exported=</span><span class=s>&quot;true&quot;</span>
            <span class=na>android:theme=</span><span class=s>&quot;@android:style/Theme.Translucent.NoTitleBar&quot;</span> <span class=nt>/&gt;</span>
        <span class=c>&lt;!-- QQ分享 --&gt;</span>
        <span class=nt>&lt;activity</span>
            <span class=na>android:name=</span><span class=s>&quot;com.tencent.tauth.AuthActivity&quot;</span>
            <span class=na>android:launchMode=</span><span class=s>&quot;singleTask&quot;</span>
            <span class=na>android:noHistory=</span><span class=s>&quot;true&quot;</span> <span class=nt>&gt;</span>
            <span class=nt>&lt;intent-filter&gt;</span>
                <span class=nt>&lt;action</span> <span class=na>android:name=</span><span class=s>&quot;android.intent.action.VIEW&quot;</span> <span class=nt>/&gt;</span>

                <span class=nt>&lt;category</span> <span class=na>android:name=</span><span class=s>&quot;android.intent.category.DEFAULT&quot;</span> <span class=nt>/&gt;</span>
                <span class=nt>&lt;category</span> <span class=na>android:name=</span><span class=s>&quot;android.intent.category.BROWSABLE&quot;</span> <span class=nt>/&gt;</span>
                <span class=c>&lt;!-- 配置qq_id --&gt;</span>
                <span class=nt>&lt;data</span> <span class=na>android:scheme=</span><span class=s>&quot;tencent${qq_id}&quot;</span> <span class=nt>/&gt;</span>
            <span class=nt>&lt;/intent-filter&gt;</span>
        <span class=nt>&lt;/activity&gt;</span>

        <span class=c>&lt;!-- 配置FileProvider --&gt;</span>
        <span class=nt>&lt;provider</span>
            <span class=na>android:name=</span><span class=s>&quot;android.support.v4.content.FileProvider&quot;</span>
            <span class=na>android:authorities=</span><span class=s>&quot;${applicationId}.fileprovider&quot;</span>
            <span class=na>android:exported=</span><span class=s>&quot;false&quot;</span>
            <span class=na>android:grantUriPermissions=</span><span class=s>&quot;true&quot;</span><span class=nt>&gt;</span>
            <span class=nt>&lt;meta-data</span>
                <span class=na>android:name=</span><span class=s>&quot;android.support.FILE_PROVIDER_PATHS&quot;</span>
                <span class=na>android:resource=</span><span class=s>&quot;@xml/file_paths&quot;</span> <span class=nt>/&gt;</span>
        <span class=nt>&lt;/provider&gt;</span>

    <span class=nt>&lt;/application&gt;</span>

<span class=nt>&lt;/manifest&gt;</span>
</pre></div></p> <p>总结一下上面的<code>AndroidManifest.xml</code>代码：</p> <ul> <li>applicationId在微信分享回调页面、FileProvider两处位置要配置。 </li> <li>manifestPlaceholders中scheme配置到SplashActivity上，qq_id配置到QQ分享AuthActivity上</li> </ul> <div class="admonition danger"> <p class=admonition-title>Danger</p> <p>QQ分享配置需要注意，qq_id定义的是int类型。所以QQ_SHARE_ID配置为<code>"\"$qq_id\""</code>。且AndroidManifest中对应的scheme也将为正确的tencent1000xxxxxx。</p> </div> <p>微信分享回调Activity必须是应用实际包名目录下的wxapi子目录中的WXEntryActivity文件，任意更改目录都不会收到微信分享回调。<br> 比如在在hdd马甲下配置微信分享回调，需要在<code>com.xxx.xxxxxxx.app.wxapi</code>下创建WXEntryActivity文件。<br> jinyouzi马甲下配置，则需要在<code>com.xxx.flavor.app.wxapi</code>下创建。<br> <strong>这部分代码写到对应flavor目录下。</strong></p> <p><img alt=在flavor中配置微信分享回调 src=/assets/images/android/android_alias_flavor_wxapi.png></p> <p>当然，合理利用activity-alias能更漂亮的完成微信回调WXEntryActivity的配置，比如说：</p> <div class=codehilite><pre><span></span><span class=c>&lt;!-- 微信分享 --&gt;</span>
<span class=nt>&lt;activity</span>
    <span class=na>android:name=</span><span class=s>&quot;anydir.WXEntryActivity&quot;</span>
    <span class=na>android:configChanges=</span><span class=s>&quot;keyboardHidden|orientation|screenSize&quot;</span>
    <span class=na>android:exported=</span><span class=s>&quot;true&quot;</span>
    <span class=na>android:theme=</span><span class=s>&quot;@android:style/Theme.Translucent.NoTitleBar&quot;</span> <span class=nt>/&gt;</span>
<span class=nt>&lt;activity-alias</span>
    <span class=na>android:name=</span><span class=s>&quot;${applicationId}.wxapi.WXEntryActivity&quot;</span>
    <span class=na>android:exported=</span><span class=s>&quot;true&quot;</span>
    <span class=na>android:launchMode=</span><span class=s>&quot;singleTask&quot;</span>
    <span class=na>android:targetActivity=</span><span class=s>&quot;anydir.WXEntryActivity&quot;</span>
    <span class=na>android:taskAffinity=</span><span class=s>&quot;com.tencent.mm&quot;</span> <span class=nt>/&gt;</span>
</pre></div> <h3 id=24>2.4 代码文件<a class=headerlink href=#24 title="Permanent link">&para;</a></h3> <p>代码文件处理方式就多样了，可以通过2.2小节类似的原理，还可以使用静态工厂方法根据包名构造出不同的类。我们还是说前者吧。</p> <p>这里拿域名来距离，由于基线的域名是配置在代码中的常量。为了尽可能不修改代码，同时满足马甲包不同域名的要求，所以马甲包也是配置在代码中的，且配置文件所在的包、配置文件的类名以及其包含的public字段名、方法名都必须保持一致。</p> <p>基线域名配置:<br> app/src/<strong>hdd</strong>/java/com/xxx/xxxxxxx/app/http/HttpConfig.kt <div class=codehilite><pre><span></span><span class=k>package</span> <span class=nn>com.xxx.xxxxxxx.app.http</span>

<span class=k>import</span> <span class=nn>com.xxx.xxxxxxx.app.BuildConfig</span>

<span class=k>object</span> <span class=nc>HttpConfig</span> <span class=p>{</span>
    <span class=k>const</span> <span class=k>val</span> <span class=py>DOMAIN_SIT</span> <span class=p>=</span> <span class=s>&quot;https://xxxxxx.xxxxx.com/&quot;</span>
    <span class=k>const</span> <span class=k>val</span> <span class=py>DOMAIN_UAT</span> <span class=p>=</span> <span class=s>&quot;http://xxxxxx.test.xxxxx.com/&quot;</span>
    <span class=k>val</span> <span class=py>DOMAIN</span> <span class=p>=</span> <span class=k>if</span> <span class=p>(</span><span class=n>BuildConfig</span><span class=p>.</span><span class=n>DEBUG</span><span class=p>)</span> <span class=n>DOMAIN_UAT</span> <span class=k>else</span> <span class=n>DOMAIN_SIT</span>

    <span class=k>const</span> <span class=k>val</span> <span class=py>DOMAIN_H5_SIT</span> <span class=p>=</span> <span class=s>&quot;https://xxxxxx.xxxxxx.com/&quot;</span>
    <span class=k>const</span> <span class=k>val</span> <span class=py>DOMAIN_H5_UAT</span> <span class=p>=</span> <span class=s>&quot;http://xxxxxx.test.xxxxxx.com/&quot;</span>
    <span class=k>val</span> <span class=py>DOMAIN_H5</span> <span class=p>=</span> <span class=k>if</span> <span class=p>(</span><span class=n>BuildConfig</span><span class=p>.</span><span class=n>DEBUG</span><span class=p>)</span> <span class=n>DOMAIN_H5_UAT</span> <span class=k>else</span> <span class=n>DOMAIN_H5_SIT</span>
<span class=p>}</span>
</pre></div></p> <p>马甲包域名配置:<br> app/src/<strong>jinyouzi</strong>/java/com/xxx/xxxxxxx/app/http/HttpConfig.kt</p> <div class=codehilite><pre><span></span><span class=k>package</span> <span class=nn>com.xxx.xxxxxxx.app.http</span>

<span class=k>import</span> <span class=nn>com.xxx.xxxxxxx.app.BuildConfig</span>

<span class=k>object</span> <span class=nc>HttpConfig</span> <span class=p>{</span>
  <span class=k>const</span> <span class=k>val</span> <span class=py>DOMAIN_SIT</span> <span class=p>=</span> <span class=s>&quot;https://yyyyyy.yyyyy.com/&quot;</span>
  <span class=k>const</span> <span class=k>val</span> <span class=py>DOMAIN_UAT</span> <span class=p>=</span> <span class=s>&quot;http://yyyyyy.test.yyyyy.com/&quot;</span>
  <span class=k>val</span> <span class=py>DOMAIN</span> <span class=p>=</span> <span class=k>if</span> <span class=p>(</span><span class=n>BuildConfig</span><span class=p>.</span><span class=n>DEBUG</span><span class=p>)</span> <span class=n>DOMAIN_UAT</span> <span class=k>else</span> <span class=n>DOMAIN_SIT</span>

  <span class=k>const</span> <span class=k>val</span> <span class=py>DOMAIN_H5_SIT</span> <span class=p>=</span> <span class=s>&quot;https://yyyyyy.yyyyyy.com/&quot;</span>
  <span class=k>const</span> <span class=k>val</span> <span class=py>DOMAIN_H5_UAT</span> <span class=p>=</span> <span class=s>&quot;http://yyyyyy.test.yyyyyy.com/&quot;</span>
  <span class=k>val</span> <span class=py>DOMAIN_H5</span> <span class=p>=</span> <span class=k>if</span> <span class=p>(</span><span class=n>BuildConfig</span><span class=p>.</span><span class=n>DEBUG</span><span class=p>)</span> <span class=n>DOMAIN_H5_UAT</span> <span class=k>else</span> <span class=n>DOMAIN_H5_SIT</span>
<span class=p>}</span>
</pre></div> <p><strong>Note:</strong> 由于其他代码使用HttpConfig时会通过基线包名import，所以马甲的HttpConfig文件package以及其他可供外部代码使用的域、方法等入口需要与基线保持一致，以免编译报错。<br> 除入口外，各个马甲内部可以自由扩展，但与基线代码交互时一定要走入口，避免直接交互。</p> <h3 id=25>2.5 签名配置<a class=headerlink href=#25 title="Permanent link">&para;</a></h3> <p>其实在<a href=#23-key>2.3 各种key的配置中</a>的<code>build.gradle</code>中已经贴出了该部分代码。下面说明一下。<br> 我们知道可以给每个flavor单独配置signingConfig，但是这种配置在debug包时会用Android默认的debug签名。大部分情况OK，除了测试环境微信分享。 </p> <p>不能忍，所以我们解决一下，让各个马甲的debug、release签名保持一致。</p> <p>关键代码如下，具体可以查看最上面的<code>build.gradle</code>代码: <div class=codehilite><pre><span></span>buildTypes {
    debug {
        ...
        signingConfig release.signingConfig
    }
}
</pre></div></p> <p>将debug的签名配置显示指定为release的配置，而release的配置在各个flavor中，这样就完成了统一。</p> <hr> <div class=md-source-date> <small> 最后更新: 2020年1月14日 </small> </div> <h2 id=__comments>评论</h2> <div id=disqus_thread></div> <script>
    var disqus_config = function () {
      this.page.url = "https://blog.yorek.xyz/about-me/android/other/android_alias/";
      this.page.identifier =
        "/android/other/android_alias/";
    };
    (function() {
      var d = document, s = d.createElement("script");
      s.src = "//yorekliu.disqus.com/embed.js";
      s.setAttribute("data-timestamp", +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid"> <a href=../runtime/ title="Android Runtime" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> 上一页 </span> Android Runtime </span> </div> </a> <a href=../Android-Development-Tool/ title=Android神兵利器 class="md-flex md-footer-nav__link md-footer-nav__link--next" rel=next> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> 下一页 </span> Android神兵利器 </span> </div> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> &copy; 2020 Yorek </div> powered by <a href=https://www.mkdocs.org>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ > Material for MkDocs</a> </div> <div class=md-footer-social> <link rel=stylesheet href=../../../assets/fonts/font-awesome.css> <a href=https://github.com/YorekLiu class="md-footer-social__link fa fa-github"></a> <a href=lyytogether@gmail.com class="md-footer-social__link fa fa-email"></a> </div> </div> </div> </footer> </div> <script src=../../../assets/javascripts/application.808e90bb.js></script> <script src=../../../assets/javascripts/lunr/lunr.stemmer.support.js></script> <script src=../../../assets/javascripts/lunr/tinyseg.js></script> <script src=../../../assets/javascripts/lunr/lunr.ja.js></script> <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script> <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script> </body> </html>
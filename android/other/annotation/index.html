<!--
  Copyright (c) 2016-2020 Martin Donath <martin.donath@squidfunk.com>
  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:
  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.
  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
--> <!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=description content="An Android Developer."><link href=https://blog.yorek.xyz/about-me/android/other/annotation/ rel=canonical><meta name=author content="Yorek Liu"><meta name=lang:clipboard.copy content=复制><meta name=lang:clipboard.copied content=已复制><meta name=lang:search.language content=ja><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content=没有找到符合条件的结果><meta name=lang:search.result.one content="找到 1 个符合条件的结果"><meta name=lang:search.result.other content="# 个符合条件的结果"><meta name=lang:search.tokenizer content=[\uff0c\u3002]+><link rel="shortcut icon" href=../../../assets/images/favicon.ico><meta name=generator content="mkdocs-1.0.4, mkdocs-material-4.6.0"><title>注解的定义及解析</title><link rel=stylesheet href=../../../assets/stylesheets/application.1b62728e.css><link rel=stylesheet href=../../../assets/stylesheets/application-palette.a8b3c06d.css><meta name=theme-color content><script src=../../../assets/javascripts/modernizr.268332fc.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel=stylesheet href=../../../assets/fonts/material-icons.css><link rel=manifest href=../../../manifest.webmanifest><script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-155096376-1", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script><script async src=https://www.google-analytics.com/analytics.js></script><!-- Determine title --><!-- The image needs to have an absolute URL --><!-- Open graph meta tags --><meta property=og:type content=website><meta property=og:title content="Yorek's - 注解的定义及解析"><meta property=og:description content="An Android Developer."><meta content=https://blog.yorek.xyz/about-me/android/other/annotation/ property=og:url><meta property=og:image content=https://blog.yorek.xyz/about-meassets/images/banner.png><meta property=og:image:type content=image/png><meta property=og:image:width content=1200><meta property=og:image:height content=630><!-- Twitter meta tags --><meta name=twitter:card content=summary_large_image><meta name=twitter:site content=@squidfunk><meta name=twitter:creator content=@squidfunk><meta name=twitter:title content="Yorek's - 注解的定义及解析"><meta name=twitter:description content="An Android Developer."><meta name=twitter:image content=https://blog.yorek.xyz/about-meassets/images/banner.png></head> <body dir=ltr data-md-color-primary=white data-md-color-accent=blue> <svg class=md-svg> <defs> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#1 tabindex=1 class=md-skip> 跳转至 </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=https://blog.yorek.xyz/about-me title="Yorek's" class="md-header-nav__button md-logo"> <img src=../../../assets/images/favicon.ico width=24 height=24> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> Yorek's </span> <span class=md-header-nav__topic> 注解的定义及解析 </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> 键入以开始搜索 </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container> <nav class="md-tabs md-tabs--active" data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../3rd-library/3rd-library-source-code/ class=md-tabs__link> Android </a> </li> <li class=md-tabs__item> <a href=../../../flutter/flutter_first_project_1/ class=md-tabs__link> Flutter </a> </li> <li class=md-tabs__item> <a href=../../../leetcode/ class=md-tabs__link> LeetCode </a> </li> <li class=md-tabs__item> <a href=../../../design-pattern/design-pattern/ class=md-tabs__link> Books </a> </li> </ul> </div> </nav> <main class=md-main role=main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=https://blog.yorek.xyz/about-me title="Yorek's" class="md-nav__button md-logo"> <img src=../../../assets/images/favicon.ico width=48 height=48> </a> Yorek's </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. title=Home class=md-nav__link> Home </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2 type=checkbox id=nav-2 checked> <label class=md-nav__link for=nav-2> Android </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-2> Android </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-1 type=checkbox id=nav-2-1> <label class=md-nav__link for=nav-2-1> 三方库源码解析 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-1> 三方库源码解析 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../3rd-library/3rd-library-source-code/ title=Android三方库源码分析 class=md-nav__link> Android三方库源码分析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/matrix/ title="微信APM Matrix解析" class=md-nav__link> 微信APM Matrix解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/matrix-trace/ title=Matrix-TraceCanary解析 class=md-nav__link> Matrix-TraceCanary解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/matrix-io/ title=Matrix-IOCanary解析 class=md-nav__link> Matrix-IOCanary解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/matrix-resource/ title=Matrix-ResourceCanary解析 class=md-nav__link> Matrix-ResourceCanary解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/matrix-sqlitelint/ title=Matrix-SQLiteLint解析 class=md-nav__link> Matrix-SQLiteLint解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/okhttp/ title=OkHttp3源码解析 class=md-nav__link> OkHttp3源码解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/retrofit/ title=Retrofit2源码解析 class=md-nav__link> Retrofit2源码解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/rxjava&rxandroid/ title=RxJava源码解析及使用实例 class=md-nav__link> RxJava源码解析及使用实例 </a> </li> <li class=md-nav__item> <a href=../RxJava/ title=RxJava操作符大全 class=md-nav__link> RxJava操作符大全 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide1/ title="Glide v4 源码解析（一）" class=md-nav__link> Glide v4 源码解析（一） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide2/ title="Glide v4 源码解析（二）" class=md-nav__link> Glide v4 源码解析（二） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide3/ title="Glide v4 源码解析（三）" class=md-nav__link> Glide v4 源码解析（三） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide4/ title="Glide v4 源码解析（四）" class=md-nav__link> Glide v4 源码解析（四） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide5/ title="Glide v4 源码解析（五）" class=md-nav__link> Glide v4 源码解析（五） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide6/ title="Glide v4 源码解析（六）" class=md-nav__link> Glide v4 源码解析（六） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide7/ title="Glide v4 源码解析（七）" class=md-nav__link> Glide v4 源码解析（七） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/migrate-to-glide/ title=杂记：从Picasso迁移至Glide class=md-nav__link> 杂记：从Picasso迁移至Glide </a> </li> <li class=md-nav__item> <a href=../../3rd-library/eventbus/ title=EventBus源码解析 class=md-nav__link> EventBus源码解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/leakcanary/ title=LeakCanary2源码解析 class=md-nav__link> LeakCanary2源码解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/permissiondispatcher/ title=PermissionDispatcher源码解析 class=md-nav__link> PermissionDispatcher源码解析 </a> </li> <li class=md-nav__item> <a href=../constraintlayout/ title=ConstraintLayout使用大全 class=md-nav__link> ConstraintLayout使用大全 </a> </li> <li class=md-nav__item> <a href=../dagger2/ title=初学者的Dagger2教程 class=md-nav__link> 初学者的Dagger2教程 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-2 type=checkbox id=nav-2-2> <label class=md-nav__link for=nav-2-2> Android开发高手课 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-2> Android开发高手课 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../paid/master/ title=Android开发高手课 class=md-nav__link> Android开发高手课 </a> </li> <li class=md-nav__item> <a href=../../paid/master/crash_1/ title="01 | 崩溃优化（上）：关于“崩溃”那些事儿" class=md-nav__link> 01 | 崩溃优化（上）：关于“崩溃”那些事儿 </a> </li> <li class=md-nav__item> <a href=../../paid/master/crash_2/ title="02 | 崩溃优化（下）：应用崩溃了，你应该如何去分析？" class=md-nav__link> 02 | 崩溃优化（下）：应用崩溃了，你应该如何去分析？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/memory_1/ title="03 | 内存优化（上）：4GB内存时代，再谈内存优化" class=md-nav__link> 03 | 内存优化（上）：4GB内存时代，再谈内存优化 </a> </li> <li class=md-nav__item> <a href=../../paid/master/memory_2/ title="04 | 内存优化（下）：内存优化这件事，应该从哪里着手？" class=md-nav__link> 04 | 内存优化（下）：内存优化这件事，应该从哪里着手？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/stuck_1/ title="05 | 卡顿优化（上）：你要掌握的卡顿分析方法" class=md-nav__link> 05 | 卡顿优化（上）：你要掌握的卡顿分析方法 </a> </li> <li class=md-nav__item> <a href=../../paid/master/stuck_2/ title="06 | 卡顿优化（下）：如何监控应用卡顿？" class=md-nav__link> 06 | 卡顿优化（下）：如何监控应用卡顿？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/stuck_3/ title="06补充篇 | 卡顿优化：卡顿现场与卡顿分析" class=md-nav__link> 06补充篇 | 卡顿优化：卡顿现场与卡顿分析 </a> </li> <li class=md-nav__item> <a href=../../paid/master/start_1/ title="07 | 启动优化（上）：从启动过程看启动速度优化" class=md-nav__link> 07 | 启动优化（上）：从启动过程看启动速度优化 </a> </li> <li class=md-nav__item> <a href=../../paid/master/start_2/ title="08 | 启动优化（下）：优化启动速度的进阶方法" class=md-nav__link> 08 | 启动优化（下）：优化启动速度的进阶方法 </a> </li> <li class=md-nav__item> <a href=../../paid/master/io_1/ title="09 | I/O优化（上）：开发工程师必备的I/O优化知识" class=md-nav__link> 09 | I/O优化（上）：开发工程师必备的I/O优化知识 </a> </li> <li class=md-nav__item> <a href=../../paid/master/io_2/ title="10 | I/O优化（中）：不同I/O方式的使用场景是什么？" class=md-nav__link> 10 | I/O优化（中）：不同I/O方式的使用场景是什么？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/io_3/ title="11 | I/O优化（下）：如何监控线上I/O操作？" class=md-nav__link> 11 | I/O优化（下）：如何监控线上I/O操作？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/storage_1/ title="12 | 存储优化（上）：常见的数据存储方法有哪些？" class=md-nav__link> 12 | 存储优化（上）：常见的数据存储方法有哪些？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/storage_2/ title="13 | 存储优化（中）：如何优化数据存储？" class=md-nav__link> 13 | 存储优化（中）：如何优化数据存储？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/storage_3/ title="14 | 存储优化（下）：数据库SQLite的使用和优化" class=md-nav__link> 14 | 存储优化（下）：数据库SQLite的使用和优化 </a> </li> <li class=md-nav__item> <a href=../../paid/master/network_1/ title="15 | 网络优化（上）：移动开发工程师必备的网络优化知识" class=md-nav__link> 15 | 网络优化（上）：移动开发工程师必备的网络优化知识 </a> </li> <li class=md-nav__item> <a href=../../paid/master/network_2/ title="16 | 网络优化（中）：复杂多变的移动网络该如何优化？" class=md-nav__link> 16 | 网络优化（中）：复杂多变的移动网络该如何优化？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/network_3/ title="17 | 网络优化（下）：大数据下网络该如何监控？" class=md-nav__link> 17 | 网络优化（下）：大数据下网络该如何监控？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/battery_1/ title="18 | 耗电优化（上）：从电量优化的演进看耗电分析" class=md-nav__link> 18 | 耗电优化（上）：从电量优化的演进看耗电分析 </a> </li> <li class=md-nav__item> <a href=../../paid/master/battery_2/ title="19 | 耗电优化（下）：耗电的优化方法与线上监控" class=md-nav__link> 19 | 耗电优化（下）：耗电的优化方法与线上监控 </a> </li> <li class=md-nav__item> <a href=../../paid/master/ui_1/ title="20 | UI 优化（上）：UI 渲染的几个关键概念" class=md-nav__link> 20 | UI 优化（上）：UI 渲染的几个关键概念 </a> </li> <li class=md-nav__item> <a href=../../paid/master/ui_2/ title="21 | UI 优化（下）：如何优化 UI 渲染？" class=md-nav__link> 21 | UI 优化（下）：如何优化 UI 渲染？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/package_1/ title="22 | 包体积优化（上）：如何减少安装包大小？" class=md-nav__link> 22 | 包体积优化（上）：如何减少安装包大小？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/package_2/ title="23 | 包体积优化（下）：资源优化的进阶实践" class=md-nav__link> 23 | 包体积优化（下）：资源优化的进阶实践 </a> </li> <li class=md-nav__item> <a href=../../paid/master/compile/ title="26 | 关于编译，你需要了解什么？" class=md-nav__link> 26 | 关于编译，你需要了解什么？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/bytecode/ title="27 | 编译插桩的三种方法：AspectJ、ASM、ReDex" class=md-nav__link> 27 | 编译插桩的三种方法：AspectJ、ASM、ReDex </a> </li> <li class=md-nav__item> <a href=../../paid/master/native_hook/ title="35 | Native Hook 技术，天使还是魔鬼？" class=md-nav__link> 35 | Native Hook 技术，天使还是魔鬼？ </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-3 type=checkbox id=nav-2-3> <label class=md-nav__link for=nav-2-3> Framework系列 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-3> Framework系列 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../framework/Android四大组件(1)/ title=Activity class=md-nav__link> Activity </a> </li> <li class=md-nav__item> <a href=../../framework/Android四大组件(2)/ title=Service class=md-nav__link> Service </a> </li> <li class=md-nav__item> <a href=../../framework/Android四大组件(3)/ title=Broadcasts class=md-nav__link> Broadcasts </a> </li> <li class=md-nav__item> <a href=../../framework/Android四大组件(4)/ title="Content Providers与Fragment" class=md-nav__link> Content Providers与Fragment </a> </li> <li class=md-nav__item> <a href=../../framework/IPC机制/ title=IPC机制 class=md-nav__link> IPC机制 </a> </li> <li class=md-nav__item> <a href=../../framework/View的事件体系/ title=View的事件体系 class=md-nav__link> View的事件体系 </a> </li> <li class=md-nav__item> <a href=../../framework/View的绘制原理/ title=View的绘制原理 class=md-nav__link> View的绘制原理 </a> </li> <li class=md-nav__item> <a href=../../framework/RemoteViews/ title=RemoteViews class=md-nav__link> RemoteViews </a> </li> <li class=md-nav__item> <a href=../../framework/Drawable/ title=Android中的Drawable资源 class=md-nav__link> Android中的Drawable资源 </a> </li> <li class=md-nav__item> <a href=../../framework/Android动画/ title=Android动画 class=md-nav__link> Android动画 </a> </li> <li class=md-nav__item> <a href=../../framework/Window与WindowManager/ title=Window与WindowManager class=md-nav__link> Window与WindowManager </a> </li> <li class=md-nav__item> <a href=../../framework/四大组件启动过程/ title=四大组件启动过程 class=md-nav__link> 四大组件启动过程 </a> </li> <li class=md-nav__item> <a href=../../framework/Android消息机制/ title=Android消息机制 class=md-nav__link> Android消息机制 </a> </li> <li class=md-nav__item> <a href=../../framework/Android线程与线程池/ title=Android线程与线程池 class=md-nav__link> Android线程与线程池 </a> </li> <li class=md-nav__item> <a href=../../framework/Bitmap的缓存与加载/ title=Bitmap的缓存与加载 class=md-nav__link> Bitmap的缓存与加载 </a> </li> <li class=md-nav__item> <a href=../../framework/JNI与NDK/ title=JNI与NDK编程简介 class=md-nav__link> JNI与NDK编程简介 </a> </li> <li class=md-nav__item> <a href=../../framework/性能优化/ title=Android性能优化 class=md-nav__link> Android性能优化 </a> </li> <li class=md-nav__item> <a href=../../framework/binder1-mediaservice/ title=Binder深入理解——以MediaService为例 class=md-nav__link> Binder深入理解——以MediaService为例 </a> </li> <li class=md-nav__item> <a href=../../framework/binder2/ title=Binder深入理解——罗老师系列 class=md-nav__link> Binder深入理解——罗老师系列 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-4 type=checkbox id=nav-2-4> <label class=md-nav__link for=nav-2-4> 付费知识归档 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-4> 付费知识归档 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-4-1 type=checkbox id=nav-2-4-1> <label class=md-nav__link for=nav-2-4-1> 某圈问题索引 </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-2-4-1> 某圈问题索引 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../paid/zsxq/zsxq_index/ title=某圈问题索引 class=md-nav__link> 某圈问题索引 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week1-synchronized/ title=理解Java中synchronized关键词 class=md-nav__link> 理解Java中synchronized关键词 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week2-service/ title=理解Service class=md-nav__link> 理解Service </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week3-activity/ title=理解Activity的启动模式 class=md-nav__link> 理解Activity的启动模式 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week4-startActivityForResult/ title=关于startActivityForResult class=md-nav__link> 关于startActivityForResult </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week5-view/ title=关于View的知识 class=md-nav__link> 关于View的知识 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week6-gradle/ title=关于Gradle的知识 class=md-nav__link> 关于Gradle的知识 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week7-serialization/ title=关于序列化的知识 class=md-nav__link> 关于序列化的知识 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week10-classloader/ title=Android中的ClassLoader class=md-nav__link> Android中的ClassLoader </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week11-binder/ title=Binder简介 class=md-nav__link> Binder简介 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week12-retrofit-okhttp/ title=OkHttp和Retrofit的作用以及两者之间的联系 class=md-nav__link> OkHttp和Retrofit的作用以及两者之间的联系 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week14-jvm-gc/ title=JVM中垃圾回收策略 class=md-nav__link> JVM中垃圾回收策略 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week16-keep-app-alive/ title=进程保活 class=md-nav__link> 进程保活 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week17-android-components/ title=四大组件的作用以及多进程 class=md-nav__link> 四大组件的作用以及多进程 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week20-network-protocol/ title=网络协议 class=md-nav__link> 网络协议 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week21-mvc&amp;mvp&mvvm/ title=MVC、MVP和MVVM class=md-nav__link> MVC、MVP和MVVM </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week22-android-studio-build/ title="Android Studio build过程" class=md-nav__link> Android Studio build过程 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week23-load-large-bitmap/ title=大尺寸图片加载问题 class=md-nav__link> 大尺寸图片加载问题 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-5 type=checkbox id=nav-2-5 checked> <label class=md-nav__link for=nav-2-5> 日常记录 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-5> 日常记录 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-toggle md-nav__toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> 注解的定义及解析 </label> <a href=./ title=注解的定义及解析 class="md-nav__link md-nav__link--active"> 注解的定义及解析 </a> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>目录</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#1 class=md-nav__link> 1. 注解的定义 </a> </li> <li class=md-nav__item> <a href=#2 class=md-nav__link> 2. 注解的处理 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#21 class=md-nav__link> 2.1 运行时注解的处理 </a> </li> <li class=md-nav__item> <a href=#22 class=md-nav__link> 2.2 编译时注解的处理 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#221 class=md-nav__link> 2.2.1 自定义注解 </a> </li> <li class=md-nav__item> <a href=#222 class=md-nav__link> 2.2.2 编写注解处理器 </a> </li> <li class=md-nav__item> <a href=#223 class=md-nav__link> 2.2.3 注册注解处理器 </a> </li> <li class=md-nav__item> <a href=#224 class=md-nav__link> 2.2.4 应用注解 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#__comments class="md-nav__link md-nav__link--active"> 评论 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../best_throttle_in_mvvm/ title=这可能是MVVM中最优雅的按键防抖方案 class=md-nav__link> 这可能是MVVM中最优雅的按键防抖方案 </a> </li> <li class=md-nav__item> <a href=../android-jenkins/ title="Jenkins for android" class=md-nav__link> Jenkins for android </a> </li> <li class=md-nav__item> <a href=../SystemProrities/ title=普通Android程序使用SystemProrities class=md-nav__link> 普通Android程序使用SystemProrities </a> </li> <li class=md-nav__item> <a href=../recyclerview-cache/ title=ListView、RecyclerView缓存策略解析 class=md-nav__link> ListView、RecyclerView缓存策略解析 </a> </li> <li class=md-nav__item> <a href=../recyclerview-item-docoration/ title=RecyclerView高级特性——ItemDecoration class=md-nav__link> RecyclerView高级特性——ItemDecoration </a> </li> <li class=md-nav__item> <a href=../recyclerview-others/ title=RecyclerView的一些使用细节 class=md-nav__link> RecyclerView的一些使用细节 </a> </li> <li class=md-nav__item> <a href=../RecyclerView-Sort&Delete/ title=RecyclerView高级特性——拖拽排序以及滑动删除 class=md-nav__link> RecyclerView高级特性——拖拽排序以及滑动删除 </a> </li> <li class=md-nav__item> <a href=../FAB-Behavior/ title=FloatingActionButton上滑隐藏下滑显示 class=md-nav__link> FloatingActionButton上滑隐藏下滑显示 </a> </li> <li class=md-nav__item> <a href=../nestedscrolling/ title=NestedScrolling机制 class=md-nav__link> NestedScrolling机制 </a> </li> <li class=md-nav__item> <a href=../porterduff/ title=使用Porter-Duff合成数字图像 class=md-nav__link> 使用Porter-Duff合成数字图像 </a> </li> <li class=md-nav__item> <a href=../runtime/ title="Android Runtime" class=md-nav__link> Android Runtime </a> </li> <li class=md-nav__item> <a href=../android_alias/ title=Android马甲包的那些事儿 class=md-nav__link> Android马甲包的那些事儿 </a> </li> <li class=md-nav__item> <a href=../Android-Development-Tool/ title=Android神兵利器 class=md-nav__link> Android神兵利器 </a> </li> <li class=md-nav__item> <a href=../FileProvider/ title=FileProvider class=md-nav__link> FileProvider </a> </li> <li class=md-nav__item> <a href=../Android判断导航栏高度/ title=Android判断虚拟按键(导航栏)显示与否、高度以及获取屏幕实际高度 class=md-nav__link> Android判断虚拟按键(导航栏)显示与否、高度以及获取屏幕实际高度 </a> </li> <li class=md-nav__item> <a href=../Android图片选择器/ title=Android图片选择器 class=md-nav__link> Android图片选择器 </a> </li> <li class=md-nav__item> <a href=../Android底部导航栏框架/ title=Android原生底部导航栏 class=md-nav__link> Android原生底部导航栏 </a> </li> <li class=md-nav__item> <a href=../Android搜索栏的实现/ title=Android搜索栏的实现 class=md-nav__link> Android搜索栏的实现 </a> </li> <li class=md-nav__item> <a href=../Android暂停音乐播放器的播放/ title=Android暂停酷狗、网易云音乐等音乐播放器的播放 class=md-nav__link> Android暂停酷狗、网易云音乐等音乐播放器的播放 </a> </li> <li class=md-nav__item> <a href=../Android滑动返回实践/ title=Android滑动返回实践 class=md-nav__link> Android滑动返回实践 </a> </li> <li class=md-nav__item> <a href=../Android程序反编译/ title=MacOS下Android程序反编译 class=md-nav__link> MacOS下Android程序反编译 </a> </li> <li class=md-nav__item> <a href=../Android通讯录快速读取/ title=Android通讯录快速读取 class=md-nav__link> Android通讯录快速读取 </a> </li> <li class=md-nav__item> <a href=../soft-keyboard-in-app/ title=App内自定义软键盘 class=md-nav__link> App内自定义软键盘 </a> </li> <li class=md-nav__item> <a href=../腾讯X5内核入坑指南/ title="腾讯TBS X5浏览器内核入坑指南" class=md-nav__link> 腾讯TBS X5浏览器内核入坑指南 </a> </li> <li class=md-nav__item> <a href=../琐碎知识点/ title=琐碎知识点 class=md-nav__link> 琐碎知识点 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3 type=checkbox id=nav-3> <label class=md-nav__link for=nav-3> Flutter </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-3> Flutter </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../flutter/flutter_first_project_1/ title=年轻人的第一个Flutter程序(1) class=md-nav__link> 年轻人的第一个Flutter程序(1) </a> </li> <li class=md-nav__item> <a href=../../../flutter/flutter_first_project_2/ title=年轻人的第一个Flutter程序(2) class=md-nav__link> 年轻人的第一个Flutter程序(2) </a> </li> <li class=md-nav__item> <a href=../../../flutter/flutter_first_project_3/ title=年轻人的第一个Flutter程序(3) class=md-nav__link> 年轻人的第一个Flutter程序(3) </a> </li> <li class=md-nav__item> <a href=../../../flutter/flutter_first_project_4/ title=年轻人的第一个Flutter程序(4) class=md-nav__link> 年轻人的第一个Flutter程序(4) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4 type=checkbox id=nav-4> <label class=md-nav__link for=nav-4> LeetCode </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-4> LeetCode </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../leetcode/ title=算法目录 class=md-nav__link> 算法目录 </a> </li> <li class=md-nav__item> <a href=../../../leetcode/code_interviews_1/ title=数据结构、算法和数据操作 class=md-nav__link> 数据结构、算法和数据操作 </a> </li> <li class=md-nav__item> <a href=../../../leetcode/code_interviews_3/ title=高质量的代码 class=md-nav__link> 高质量的代码 </a> </li> <li class=md-nav__item> <a href=../../../leetcode/code_interviews_4/ title=解决问题的思路 class=md-nav__link> 解决问题的思路 </a> </li> <li class=md-nav__item> <a href=../../../leetcode/code_interviews_5/ title=优化时间和空间效率 class=md-nav__link> 优化时间和空间效率 </a> </li> <li class=md-nav__item> <a href=../../../leetcode/code_interviews_6/ title=面试中的各项能力 class=md-nav__link> 面试中的各项能力 </a> </li> <li class=md-nav__item> <a href=../../../leetcode/array/ title=Array class=md-nav__link> Array </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode1-10/ title=LeetCode(1-10) class=md-nav__link> LeetCode(1-10) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode11-20/ title=LeetCode(11-20) class=md-nav__link> LeetCode(11-20) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode21-30/ title=LeetCode(21-30) class=md-nav__link> LeetCode(21-30) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode31-40/ title=LeetCode(31-40) class=md-nav__link> LeetCode(31-40) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode41-50/ title=LeetCode(41-50) class=md-nav__link> LeetCode(41-50) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode51-60/ title=LeetCode(51-60) class=md-nav__link> LeetCode(51-60) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode61-70/ title=LeetCode(61-70) class=md-nav__link> LeetCode(61-70) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode71-80/ title=LeetCode(71-80) class=md-nav__link> LeetCode(71-80) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode81-90/ title=LeetCode(81-90) class=md-nav__link> LeetCode(81-90) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode91-100/ title=LeetCode(91-100) class=md-nav__link> LeetCode(91-100) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode101-110/ title=LeetCode(101-110) class=md-nav__link> LeetCode(101-110) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode111-120/ title=LeetCode(111-120) class=md-nav__link> LeetCode(111-120) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5 type=checkbox id=nav-5> <label class=md-nav__link for=nav-5> Books </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-5> Books </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-1 type=checkbox id=nav-5-1> <label class=md-nav__link for=nav-5-1> Design Pattern </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-1> Design Pattern </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../design-pattern/design-pattern/ title=设计模式概述 class=md-nav__link> 设计模式概述 </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/design-principle/ title=面向对象的六大原则 class=md-nav__link> 面向对象的六大原则 </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/singleton/ title=单例模式(Singleton) class=md-nav__link> 单例模式(Singleton) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/builder/ title=建造者模式(Builder) class=md-nav__link> 建造者模式(Builder) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/prototype/ title=原型模式(Prototype) class=md-nav__link> 原型模式(Prototype) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/factory-method/ title="工厂方法模式(Factory method)" class=md-nav__link> 工厂方法模式(Factory method) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/abstract-factory/ title="抽象工厂模式(Abstract factory)" class=md-nav__link> 抽象工厂模式(Abstract factory) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/proxy/ title=代理模式(Proxy) class=md-nav__link> 代理模式(Proxy) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/composite/ title=组合模式(Composite) class=md-nav__link> 组合模式(Composite) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/adapter/ title=适配器模式(Adapter) class=md-nav__link> 适配器模式(Adapter) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/decorator/ title=装饰模式(Decorator) class=md-nav__link> 装饰模式(Decorator) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/flyweight/ title=享元模式(Flyweight) class=md-nav__link> 享元模式(Flyweight) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/facade/ title=外观模式(Facade) class=md-nav__link> 外观模式(Facade) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/bridge/ title=桥接模式(Bridge) class=md-nav__link> 桥接模式(Bridge) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/strategy/ title=策略模式(Strategy) class=md-nav__link> 策略模式(Strategy) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/state/ title=状态模式(State) class=md-nav__link> 状态模式(State) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/chain-of-responsibility/ title="责任链模式(Chain of responsibility)" class=md-nav__link> 责任链模式(Chain of responsibility) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/interpreter/ title=解释器模式(Interpreter) class=md-nav__link> 解释器模式(Interpreter) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/command/ title=命令模式(Command) class=md-nav__link> 命令模式(Command) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/observer/ title=观察者模式(Observer) class=md-nav__link> 观察者模式(Observer) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/memento/ title=备忘录模式(Memento) class=md-nav__link> 备忘录模式(Memento) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/iterator/ title=迭代器模式(Iterator) class=md-nav__link> 迭代器模式(Iterator) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/template-method/ title="模版方法模式(Template method)" class=md-nav__link> 模版方法模式(Template method) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/visitor/ title=访问者模式(Visitor) class=md-nav__link> 访问者模式(Visitor) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/mediator/ title=中介者模式(Mediator) class=md-nav__link> 中介者模式(Mediator) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/confusing-design-pattern/ title=易混淆的设计模式 class=md-nav__link> 易混淆的设计模式 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2 type=checkbox id=nav-5-2> <label class=md-nav__link for=nav-5-2> Effective Java </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-2> Effective Java </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../effective-java/effective-java/ title="Effective Java概述" class=md-nav__link> Effective Java概述 </a> </li> <li class=md-nav__item> <a href=../../../effective-java/chapter1/ title=创建和销毁对象 class=md-nav__link> 创建和销毁对象 </a> </li> <li class=md-nav__item> <a href=../../../effective-java/chapter2/ title=对于所有对象都通用的方法 class=md-nav__link> 对于所有对象都通用的方法 </a> </li> <li class=md-nav__item> <a href=../../../effective-java/chapter3/ title=类和接口 class=md-nav__link> 类和接口 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-3 type=checkbox id=nav-5-3> <label class=md-nav__link for=nav-5-3> JVM </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-3> JVM </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../jvm/jvm-content/ title=深入理解Java虚拟机 class=md-nav__link> 深入理解Java虚拟机 </a> </li> <li class=md-nav__item> <a href=../../../jvm/java-memory-area-oom/ title=Java内存区域与内存溢出异常 class=md-nav__link> Java内存区域与内存溢出异常 </a> </li> <li class=md-nav__item> <a href=../../../jvm/java-gc/ title=垃圾收集器与内存分配策略 class=md-nav__link> 垃圾收集器与内存分配策略 </a> </li> <li class=md-nav__item> <a href=../../../jvm/class-struct/ title=类文件结构 class=md-nav__link> 类文件结构 </a> </li> <li class=md-nav__item> <a href=../../../jvm/load-class/ title=虚拟机类加载机制 class=md-nav__link> 虚拟机类加载机制 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-4 type=checkbox id=nav-5-4> <label class=md-nav__link for=nav-5-4> Java </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-4> Java </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../java/generics-java-kotlin/ title=Java&Kotlin在泛型方面的区别 class=md-nav__link> Java&Kotlin在泛型方面的区别 </a> </li> <li class=md-nav__item> <a href=../../../java/java-collections/ title=Java集合总结 class=md-nav__link> Java集合总结 </a> </li> <li class=md-nav__item> <a href=../../../java/java-foundation/ title=Java常见概念 class=md-nav__link> Java常见概念 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-5 type=checkbox id=nav-5-5> <label class=md-nav__link for=nav-5-5> Refactoring </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-5> Refactoring </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../refactoring/refactoring/ title=重构：改善既有代码的设计 class=md-nav__link> 重构：改善既有代码的设计 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>目录</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#1 class=md-nav__link> 1. 注解的定义 </a> </li> <li class=md-nav__item> <a href=#2 class=md-nav__link> 2. 注解的处理 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#21 class=md-nav__link> 2.1 运行时注解的处理 </a> </li> <li class=md-nav__item> <a href=#22 class=md-nav__link> 2.2 编译时注解的处理 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#221 class=md-nav__link> 2.2.1 自定义注解 </a> </li> <li class=md-nav__item> <a href=#222 class=md-nav__link> 2.2.2 编写注解处理器 </a> </li> <li class=md-nav__item> <a href=#223 class=md-nav__link> 2.2.3 注册注解处理器 </a> </li> <li class=md-nav__item> <a href=#224 class=md-nav__link> 2.2.4 应用注解 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#__comments class="md-nav__link md-nav__link--active"> 评论 </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <h1>注解的定义及解析</h1> <p>注解是代码里的特殊标记，这些标记可以在编译、类加载、运行时被读取，并执行相应的处理。本章的内容主要介绍注解的种类、如何自定义以及如何解析自定义注解。</p> <h2 id=1>1. 注解的定义<a class=headerlink href=#1 title="Permanent link">&para;</a></h2> <p>我们熟知的Retrofit就是以注解的形式提供接口的注册的，这里拿我们最常使用的<code>@GET</code>注解来进行说明：</p> <div class=codehilite><pre><span></span><span class=kn>import static</span> <span class=nn>java.lang.annotation.ElementType.METHOD</span><span class=p>;</span>
<span class=kn>import static</span> <span class=nn>java.lang.annotation.RetentionPolicy.RUNTIME</span><span class=p>;</span>

<span class=nd>@Documented</span>
<span class=nd>@Target</span><span class=p>(</span><span class=n>METHOD</span><span class=p>)</span>
<span class=nd>@Retention</span><span class=p>(</span><span class=n>RUNTIME</span><span class=p>)</span>
<span class=kd>public</span> <span class=nd>@interface</span> <span class=n>GET</span> <span class=p>{</span>
  <span class=n>String</span> <span class=nf>value</span><span class=p>()</span> <span class=k>default</span> <span class=s>&quot;&quot;</span><span class=p>;</span>
<span class=p>}</span>
</pre></div> <p>这个注解可以分为两个部分：</p> <ol> <li>第一部分就是用来注解<code>@GET</code>注解的注解，这些注解称之为元注解</li> <li>第二部分就是<code>@GET</code>注解的结构定义了</li> </ol> <p>元注解有以下几种：</p> <ul> <li><code>@Inherited</code><br> 注解可以被继承</li> <li><code>@Documented</code><br> 注解可以被JavaDoc工具记录</li> <li><code>@Repeatable</code><br> JDK 8 新增，允许一个注解在同一声明类型上多次使用</li> <li><code>@Retention</code><br> 注解的保留策略<br> 取值是一个<code>RetentionPolicy</code>枚举类型，分别表示不同级别的保留策略，而根据保留策略的不同，处理该注解的方式也不相同 </li> <li><code>SOURCE</code><br> 源码级，注解信息只会保留到源代码中，编译器会在编译时丢弃调注解信息，因此不会保留到.class文件中</li> <li><code>CLASS</code><br> 编译时注解，默认值，注解信息会一直保留到.class文件阶段，但不会保存到运行时阶段。所以，需要在编译时通过注解处理器处理。</li> <li><code>RUNTIME</code><br> 运行时注解，注解信息在class文件阶段以及运行时阶段都会保留，因此可以通过反射获取注解信息。</li> <li><code>@Target</code><br> 注解可以修饰的范围<br> 取值是一个<code>ElementType</code>枚举类型的数组，有以下枚举值可取： </li> <li><code>TYPE</code><br> 修饰类、接口（包括注解类型）、枚举类型</li> <li><code>FIELD</code><br> 修饰成员变量（包括枚举常量）</li> <li><code>METHOD</code><br> 修饰方法</li> <li><code>PARAMETER</code><br> 修饰参数</li> <li><code>CONSTRUCTOR</code><br> 修饰构造器</li> <li><code>LOCAL_VARIABLE</code><br> 修饰局部变量</li> <li><code>ANNOTATION_TYPE</code><br> 修饰注解类型</li> <li><code>PACKAGE</code><br> 修饰包</li> <li><code>TYPE_PARAMETER</code><br> Type parameter declaration，1.8新增</li> <li><code>TYPE_USE</code><br> Use of a type，1.8新增</li> </ul> <p>自定义注解类型使用<code>@interface</code>关键字，这和定义一个接口非常像。注解只有成员变量，没有方法，注解的成员变量在注解定义中以“无形参的方法”形式来声明，其“方法名”定义了该成员变量的名字，其返回值定义了该成员变量的类型。成员变量可以使用<code>default</code>关键词指定默认值。</p> <p>因此，开头的Retrofit中<code>@GET</code>注解的含义为：可以被JavaDoc工具记录的修饰方法的运行时注解，该注解接受一个参数<code>String</code>类型的<code>value</code>，默认值为<code></code>。</p> <h2 id=2>2. 注解的处理<a class=headerlink href=#2 title="Permanent link">&para;</a></h2> <p>在上面我们知道了，<code>@Retention</code>注解可以设定自定义注解的保留策略，这3个策略的生命周期长度为SOURCE＜CLASS＜RUNTIME。生命周期短的能起作用的地方，生命周期长的一定也能起作用。<br> 一般如果需要在运行时去动态获取注解信息，那只能用<code>RetentionPolicy.RUNTIME</code>；如果要在编译时进行一些预处理操作，比如生成一些辅助代码，就用<code>RetentionPolicy.CLASS</code>；如果只是做一些检查性的操作，比如<code>@Override</code>和<code>@SuppressWarnings</code>，则可选用<code>RetentionPolicy.SOURCE</code>。<br> 当设定为<code>RetentionPolicy.RUNTIME</code>时，这个注解就是运行时注解。同样地，设定为<code>RetentionPolicy.CLASS</code>，这个注解就是编译时注解。<br> 如果没有处理注解的工具，那么注解也不会有什么大的作用。对于不同的注解有不同的注解处理器。针对运行时注解会采用反射机制处理，针对编译时注解会采用注解处理器<code>AbstractProcessor</code>来处理。</p> <h3 id=21>2.1 运行时注解的处理<a class=headerlink href=#21 title="Permanent link">&para;</a></h3> <p><strong>运行时注解由于注解信息在运行时也会保留，所以一般会采用反射机制进行处理。</strong> </p> <p>还是拿开头Retrofit的<code>@GET</code>注解来进行说明，Retrofit整个工作流程的讲解可以查看<a href=/android/3rd-library/retrofit/ >Retrofit2源码解析</a>。</p> <p><code>@GET</code>注解的处理过程在Refrofit的<code>ServiceMethod.java</code>中，每一个<code>ServiceMethod</code>都对应一个网络请求的接口，在我们首次调用网络请求的时候会创建该对象。我们看看其建造者中相关代码：</p> <div class=codehilite><pre><span></span>  <span class=kd>static</span> <span class=kd>final</span> <span class=kd>class</span> <span class=nc>Builder</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>R</span><span class=o>&gt;</span> <span class=p>{</span>
    <span class=kd>final</span> <span class=n>Retrofit</span> <span class=n>retrofit</span><span class=p>;</span>
    <span class=kd>final</span> <span class=n>Method</span> <span class=n>method</span><span class=p>;</span>
    <span class=kd>final</span> <span class=n>Annotation</span><span class=o>[]</span> <span class=n>methodAnnotations</span><span class=p>;</span>
    <span class=p>...</span>

    <span class=n>Builder</span><span class=p>(</span><span class=n>Retrofit</span> <span class=n>retrofit</span><span class=p>,</span> <span class=n>Method</span> <span class=n>method</span><span class=p>)</span> <span class=p>{</span>
      <span class=k>this</span><span class=p>.</span><span class=na>retrofit</span> <span class=o>=</span> <span class=n>retrofit</span><span class=p>;</span>
      <span class=k>this</span><span class=p>.</span><span class=na>method</span> <span class=o>=</span> <span class=n>method</span><span class=p>;</span>
      <span class=k>this</span><span class=p>.</span><span class=na>methodAnnotations</span> <span class=o>=</span> <span class=n>method</span><span class=p>.</span><span class=na>getAnnotations</span><span class=p>();</span>
      <span class=p>...</span>
    <span class=p>}</span>

    <span class=kd>public</span> <span class=n>ServiceMethod</span> <span class=nf>build</span><span class=p>()</span> <span class=p>{</span>
      <span class=p>...</span>
      <span class=k>for</span> <span class=p>(</span><span class=n>Annotation</span> <span class=n>annotation</span> <span class=p>:</span> <span class=n>methodAnnotations</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>parseMethodAnnotation</span><span class=p>(</span><span class=n>annotation</span><span class=p>);</span>
      <span class=p>}</span>
      <span class=p>...</span>
    <span class=p>}</span>

    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>parseMethodAnnotation</span><span class=p>(</span><span class=n>Annotation</span> <span class=n>annotation</span><span class=p>)</span> <span class=p>{</span>
      <span class=k>if</span> <span class=p>(</span><span class=n>annotation</span> <span class=k>instanceof</span> <span class=n>DELETE</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>parseHttpMethodAndPath</span><span class=p>(</span><span class=s>&quot;DELETE&quot;</span><span class=p>,</span> <span class=p>((</span><span class=n>DELETE</span><span class=p>)</span> <span class=n>annotation</span><span class=p>).</span><span class=na>value</span><span class=p>(),</span> <span class=kc>false</span><span class=p>);</span>
      <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>annotation</span> <span class=k>instanceof</span> <span class=n>GET</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>parseHttpMethodAndPath</span><span class=p>(</span><span class=s>&quot;GET&quot;</span><span class=p>,</span> <span class=p>((</span><span class=n>GET</span><span class=p>)</span> <span class=n>annotation</span><span class=p>).</span><span class=na>value</span><span class=p>(),</span> <span class=kc>false</span><span class=p>);</span>
      <span class=p>}</span>
      <span class=p>...</span>
    <span class=p>}</span>
  <span class=p>}</span>
</pre></div> <p>这里通过<code>Method.getAnnotations()</code>反射方法获取了该方法的所有注解，然后遍历注解，找到自定义的<code>@GET</code>注解，最后调用<code>@GET</code>注解的<code>value</code>获得设置的值。</p> <h3 id=22>2.2 编译时注解的处理<a class=headerlink href=#22 title="Permanent link">&para;</a></h3> <p><strong>编译时注解由于注解信息只保存到.class文件阶段，所以一般会在编译时进行处理。处理的结果一般是生成一个辅助文件参与后续编译。</strong></p> <p>通常，设计编译时注解处理器需要以下几步</p> <ol> <li>定义注解</li> <li>编写注解处理器</li> <li>注册注解处理器</li> <li>应用注解</li> </ol> <p>在第2步中，通常需要通过注解生成辅助文件参与后续编译，所以涉及到生成辅助文件的类库。生成辅助文件的类库根据生成文件类型的不同，分为<code>com.squareup:javapoet</code>和<code>com.squareup:kotlinpoet</code>。</p> <p>由于辅助文件的生成需要耗点篇幅来写，所以本文在不生成辅助文件的前提下，介绍一下最简单的编译时注解处理器。该处理器仅仅在编译时打印出被注解的类的信息。 </p> <h4 id=221>2.2.1 自定义注解<a class=headerlink href=#221 title="Permanent link">&para;</a></h4> <p>新建一个<code>Java Library</code>的Module，命名为<code>annotations</code>。然后自定义一个注解：</p> <p><strong>RuntimePermissions.java</strong></p> <div class=codehilite><pre><span></span><span class=nd>@Retention</span><span class=p>(</span><span class=n>RetentionPolicy</span><span class=p>.</span><span class=na>CLASS</span><span class=p>)</span>
<span class=nd>@Target</span><span class=p>(</span><span class=n>ElementType</span><span class=p>.</span><span class=na>TYPE</span><span class=p>)</span>
<span class=kd>public</span> <span class=nd>@interface</span> <span class=n>RuntimePermissions</span> <span class=p>{</span>
    <span class=n>String</span><span class=o>[]</span> <span class=nf>permissions</span><span class=p>();</span>
<span class=p>}</span>
</pre></div> <h4 id=222>2.2.2 编写注解处理器<a class=headerlink href=#222 title="Permanent link">&para;</a></h4> <p>新建一个<code>Java Library</code>的Module，命名为<code>processor</code>。同时，让该模块依赖<code>annotations</code>模块：</p> <p><strong>processor/build.gradle</strong></p> <div class=codehilite><pre><span></span>implementation project(&#39;:annotations&#39;)
</pre></div> <p>接下来编写注解处理器，自定义的注解处理器需要继承<code>AbstractProcessor</code>，并实现4个方法：</p> <p><strong>PermissionProcessor.kt</strong></p> <div class=codehilite><pre><span></span><span class=kd>class</span> <span class=nc>PermissionProcessor</span> <span class=p>:</span> <span class=n>AbstractProcessor</span><span class=p>()</span> <span class=p>{</span>
    <span class=kd>private</span> <span class=n>lateinit</span> <span class=kd>var</span> <span class=n>filer</span><span class=p>:</span> <span class=n>Filer</span>
    <span class=kd>private</span> <span class=n>lateinit</span> <span class=kd>var</span> <span class=n>elementUtils</span><span class=p>:</span> <span class=n>Elements</span>
    <span class=kd>private</span> <span class=n>lateinit</span> <span class=kd>var</span> <span class=n>typeUtils</span><span class=p>:</span> <span class=n>Types</span>
    <span class=kd>private</span> <span class=n>lateinit</span> <span class=kd>var</span> <span class=n>messager</span><span class=p>:</span> <span class=n>Messager</span>

    <span class=n>override</span> <span class=n>fun</span> <span class=nf>init</span><span class=p>(</span><span class=n>processingEnv</span><span class=p>:</span> <span class=n>ProcessingEnvironment</span><span class=p>)</span> <span class=p>{</span>
        <span class=kd>super</span><span class=p>.</span><span class=na>init</span><span class=p>(</span><span class=n>processingEnv</span><span class=p>)</span>

        <span class=n>filer</span> <span class=o>=</span> <span class=n>processingEnv</span><span class=p>.</span><span class=na>filer</span>
        <span class=n>elementUtils</span> <span class=o>=</span> <span class=n>processingEnv</span><span class=p>.</span><span class=na>elementUtils</span>
        <span class=n>typeUtils</span> <span class=o>=</span> <span class=n>processingEnv</span><span class=p>.</span><span class=na>typeUtils</span>
        <span class=n>messager</span> <span class=o>=</span> <span class=n>processingEnv</span><span class=p>.</span><span class=na>messager</span>
    <span class=p>}</span>

    <span class=n>override</span> <span class=n>fun</span> <span class=nf>getSupportedAnnotationTypes</span><span class=p>():</span> <span class=n>MutableSet</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>hashSetOf</span><span class=p>(</span><span class=n>RuntimePermissions</span><span class=p>::</span><span class=n>class</span><span class=p>.</span><span class=na>java</span><span class=p>.</span><span class=na>canonicalName</span><span class=p>)</span>
    <span class=p>}</span>

    <span class=n>override</span> <span class=n>fun</span> <span class=nf>getSupportedSourceVersion</span><span class=p>():</span> <span class=n>SourceVersion</span><span class=o>?</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>SourceVersion</span><span class=p>.</span><span class=na>latestSupported</span><span class=p>()</span>
    <span class=p>}</span>

    <span class=n>override</span> <span class=n>fun</span> <span class=nf>process</span><span class=p>(</span><span class=n>annotations</span><span class=p>:</span> <span class=n>MutableSet</span><span class=o>&lt;</span><span class=n>out</span> <span class=n>TypeElement</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>roundEnv</span><span class=p>:</span> <span class=n>RoundEnvironment</span><span class=p>):</span> <span class=n>Boolean</span> <span class=p>{</span>
        <span class=n>messager</span><span class=p>.</span><span class=na>printMessage</span><span class=p>(</span><span class=n>Diagnostic</span><span class=p>.</span><span class=na>Kind</span><span class=p>.</span><span class=na>WARNING</span><span class=p>,</span> <span class=s>&quot;&gt;&gt;&gt; process begin&quot;</span><span class=p>)</span>
        <span class=n>roundEnv</span><span class=p>.</span><span class=na>getElementsAnnotatedWith</span><span class=p>(</span><span class=n>RuntimePermissions</span><span class=p>::</span><span class=n>class</span><span class=p>.</span><span class=na>java</span><span class=p>)</span>
            <span class=p>.</span><span class=na>filter</span> <span class=p>{</span> <span class=n>it</span><span class=p>.</span><span class=na>kind</span> <span class=o>==</span> <span class=n>ElementKind</span><span class=p>.</span><span class=na>CLASS</span> <span class=p>}</span>
            <span class=p>.</span><span class=na>forEach</span> <span class=p>{</span>
                <span class=n>messager</span><span class=p>.</span><span class=na>printMessage</span><span class=p>(</span>
                    <span class=n>Diagnostic</span><span class=p>.</span><span class=na>Kind</span><span class=p>.</span><span class=na>WARNING</span><span class=p>,</span>
                    <span class=s>&quot;printMessage: $it, value=${it.getAnnotation(RuntimePermissions::class.java).permissions}&quot;</span><span class=p>)</span>
            <span class=p>}</span>
        <span class=n>messager</span><span class=p>.</span><span class=na>printMessage</span><span class=p>(</span><span class=n>Diagnostic</span><span class=p>.</span><span class=na>Kind</span><span class=p>.</span><span class=na>WARNING</span><span class=p>,</span> <span class=s>&quot;&gt;&gt;&gt; process end&quot;</span><span class=p>)</span>
        <span class=k>return</span> <span class=kc>true</span>
    <span class=p>}</span>
<span class=p>}</span>
</pre></div> <p>上面的代码就是一个非常简单但完整的注解处理器了，这四个方法的作用如下：</p> <ul> <li><code>init</code><br> 初始化方法，在这里我们初始化一些工具类，比如<code>Filer</code>、<code>Elements</code>、<code>Types</code>、<code>Messager</code>等</li> <li><code>getSupportedAnnotationTypes</code><br> 指定注解处理器可以哪些注解</li> <li><code>getSupportedSourceVersion</code><br> 用来指定你使用的Java版本，通常这里返回<code>SourceVersion.latestSupported()</code></li> <li><code>process</code><br> 处理器开始处理注解的方法，在这里写扫描、评估和处理注解的代码，以及生成辅助文件。</li> </ul> <p>在Java 7 以后，也可以使用注解来代替<code>getSupportedAnnotationTypes</code>方法和<code>getSupportedSourceVersion</code>方法，如下所示：</p> <div class=codehilite><pre><span></span><span class=nd>@SupportedSourceVersion</span><span class=p>(</span><span class=n>SourceVersion</span><span class=p>.</span><span class=na>RELEASE_8</span><span class=p>)</span>
<span class=nd>@SupportedAnnotationTypes</span><span class=p>(</span><span class=s>&quot;xyz.yorek.annotations.RuntimePermissions&quot;</span><span class=p>)</span>
<span class=kd>class</span> <span class=nc>PermissionProcessor</span> <span class=p>:</span> <span class=n>AbstractProcessor</span><span class=p>()</span> <span class=p>{</span>
    <span class=kd>private</span> <span class=n>lateinit</span> <span class=kd>var</span> <span class=n>filer</span><span class=p>:</span> <span class=n>Filer</span>
    <span class=kd>private</span> <span class=n>lateinit</span> <span class=kd>var</span> <span class=n>elementUtils</span><span class=p>:</span> <span class=n>Elements</span>
    <span class=kd>private</span> <span class=n>lateinit</span> <span class=kd>var</span> <span class=n>typeUtils</span><span class=p>:</span> <span class=n>Types</span>
    <span class=kd>private</span> <span class=n>lateinit</span> <span class=kd>var</span> <span class=n>messager</span><span class=p>:</span> <span class=n>Messager</span>

    <span class=n>override</span> <span class=n>fun</span> <span class=nf>init</span><span class=p>(</span><span class=n>processingEnv</span><span class=p>:</span> <span class=n>ProcessingEnvironment</span><span class=p>)</span> <span class=p>{</span>
        <span class=kd>super</span><span class=p>.</span><span class=na>init</span><span class=p>(</span><span class=n>processingEnv</span><span class=p>)</span>

        <span class=n>filer</span> <span class=o>=</span> <span class=n>processingEnv</span><span class=p>.</span><span class=na>filer</span>
        <span class=n>elementUtils</span> <span class=o>=</span> <span class=n>processingEnv</span><span class=p>.</span><span class=na>elementUtils</span>
        <span class=n>typeUtils</span> <span class=o>=</span> <span class=n>processingEnv</span><span class=p>.</span><span class=na>typeUtils</span>
        <span class=n>messager</span> <span class=o>=</span> <span class=n>processingEnv</span><span class=p>.</span><span class=na>messager</span>
    <span class=p>}</span>

    <span class=n>override</span> <span class=n>fun</span> <span class=nf>process</span><span class=p>(</span><span class=n>annotations</span><span class=p>:</span> <span class=n>MutableSet</span><span class=o>&lt;</span><span class=n>out</span> <span class=n>TypeElement</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>roundEnv</span><span class=p>:</span> <span class=n>RoundEnvironment</span><span class=p>):</span> <span class=n>Boolean</span> <span class=p>{</span>
        <span class=p>...</span>
        <span class=k>return</span> <span class=kc>true</span>
    <span class=p>}</span>
<span class=p>}</span>
</pre></div> <p>在上面我们提到了四个工具类：<code>Filer</code>、<code>Elements</code>、<code>Types</code>、<code>Messager</code>，它们都有独特的作用：</p> <ul> <li><code>Elements</code>：一个用来处理<code>Element</code>的工具类，Element就是代表源码中的句子，可以理解为DOM树的形式。通过<code>Element.getEnclosingElement()</code>可以获得父元素，通过<code>Element.getEnclosedElements()</code>可以遍历子元素。<br> Element元素实例如下： <div class=codehilite><pre><span></span><span class=kn>package</span> <span class=nn>com.example</span><span class=p>;</span>    <span class=c1>// PackageElement</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Foo</span> <span class=p>{</span>      <span class=c1>// TypeElement</span>

    <span class=kd>private</span> <span class=kt>int</span> <span class=n>a</span><span class=p>;</span>      <span class=c1>// VariableElement</span>
    <span class=kd>private</span> <span class=n>Foo</span> <span class=n>other</span><span class=p>;</span>  <span class=c1>// VariableElement</span>

    <span class=kd>public</span> <span class=nf>Foo</span> <span class=p>()</span> <span class=p>{}</span>    <span class=c1>// ExecuteableElement</span>

    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>setA</span> <span class=p>(</span>  <span class=c1>// ExecuteableElement</span>
              <span class=kt>int</span> <span class=n>newA</span>  <span class=c1>// VariableElement</span>
    <span class=p>)</span> <span class=p>{}</span>
<span class=p>}</span>
</pre></div></li> <li><code>Types</code>：一个用来处理<code>TypeMirror</code>的工具类，可以通过<code>TypeMirror</code>获取类的相关信息；调用<code>Element.asType()</code>方法可以获得<code>TypeMirror</code></li> <li><code>Filer</code>：正如这个名字所示，使用<code>Filer</code>你可以创建辅助文件</li> <li><code>Messager</code>: 提供给注解处理器一个报告错误、警告以及提示信息的途径。它不是日志工具，而是展示给注解处理器使用者的。 </li> </ul> <blockquote> <p>消息有不同的级别。其中<code>Diagnostic.Kind.Error</code>级别最严重，输出此级别的信息会导致编译报错。</p> </blockquote> <p>回到我们的示例注解处理器中，现在我们知道了自定义处理器是干什么的了。 </p> <ol> <li>首先，该注解处理器会处理<code>RuntimePermissions</code>注解，支持最新的Java版本</li> <li>在处理注解时（<code>process</code>方法），首先会获取所有<code>RuntimePermissions</code>注解修饰的Element，这里面可能是类、方法、变量等。所以我们需要过滤掉所有不符合的Element，只留下类的Element。</li> <li>最后，调用<code>Messager</code>打印出注解修饰的类的类名以及注解的值。</li> </ol> <p>这个自定义注解器非常简单，复杂一点的就需要生成辅助文件了。根据辅助文件的格式的不同（<code>.kt</code>或<code>.java</code>），可以使用两个不同的类库<code>com.squareup:javapoet</code>和<code>com.squareup:kotlinpoet</code>。辅助文件的生成就靠上面这两个类库，具体使用可以参考GitHub主页： </p> <ul> <li><a href=https://github.com/square/javapoet/ >JavaPoet</a></li> <li><a href=https://github.com/square/kotlinpoet/ >KotlinPoet</a></li> </ul> <p>此外，博主常用的动态权限请求库<a href=https://github.com/permissions-dispatcher/PermissionsDispatcher>PermissionsDispatcher</a>中有对这两个库的使用，而且提供了同一个例子的Java和Kotlin版本，这对我们对比研究这两个库有极大的帮助，同时能顺便读读PermissionsDispatcher的源码。详情请移步<a href=/android/3rd-library/permissiondispatcher/ >PermissionDispatcher源码解析——基于注解的动态权限请求框架PermissionDispatcher源码解析</a>。</p> <h4 id=223>2.2.3 注册注解处理器<a class=headerlink href=#223 title="Permanent link">&para;</a></h4> <p>接下来我们需要在<code>processor</code>库的main目录下面，新建一个<code>resources/</code>目录，在该目录下继续创建<code>META-INF/services/</code>目录，最后在<code>META-INF/services/</code>文件夹中创建<code>javax.annotation.processing.Processor</code>文件，内容就是自定义注解处理器的全名：</p> <p><strong>META-INF/services/javax.annotation.processing.Processor</strong> </p> <div class=codehilite><pre><span></span>xyz.yorek.processor.PermissionProcessor
</pre></div> <p>这些步骤可以对应如下shell（在<code>processor</code>模块根目录下执行）：：</p> <div class=codehilite><pre><span></span>mkdir -p src/main/resources/META-INF/services/
<span class=nb>echo</span> xyz.yorek.processor.PermissionProcessor &gt; src/main/resources/META-INF/services/javax.annotation.processing.Processor
</pre></div> <p>如果嫌麻烦，可以使用Google开源的<a href=https://github.com/google/auto/tree/master/service><code>AutoService</code></a>来完成。首先在<code>processor</code>库中添加如下依赖：</p> <div class=codehilite><pre><span></span>...
apply plugin: &#39;kotlin-kapt&#39;

dependencies {
    ...
    implementation &#39;com.google.auto.service:auto-service:1.0-rc6&#39;
    kapt &quot;com.google.auto.service:auto-service:1.0-rc6&quot;
}
</pre></div> <p>在<code>PermissionProcessor</code>类上添加<code>@AutoService(Processor::class)</code>即可，这样AutoService会自动为我们生成注册文件：</p> <div class=codehilite><pre><span></span><span class=nd>@AutoService</span><span class=p>(</span><span class=n>Processor</span><span class=p>::</span><span class=n>class</span><span class=p>)</span>
<span class=kd>class</span> <span class=nc>PermissionProcessor</span> <span class=p>:</span> <span class=n>AbstractProcessor</span><span class=p>()</span> <span class=p>{</span>
    <span class=p>...</span>
<span class=p>}</span>
</pre></div> <blockquote> <p><strong>注意，在使用第三方库时，如何区分它的注解的工作原理是运行时注解与编译时注解呢？</strong><br> 我们看看需不需要添加注解处理器就知道了。添加了注解处理器的类库，一般都会生成辅助文件，所以是编译时注解。否则就是通过反射来获取注解信息了，这就是运行时注解。<br> 就像上面的AutoService，我们kapt了注解处理器，所以会为我们生成辅助文件<code>src/main/resources/META-INF/services/javax.annotation.processing.Processor</code></p> </blockquote> <h4 id=224>2.2.4 应用注解<a class=headerlink href=#224 title="Permanent link">&para;</a></h4> <p>回到<code>app</code>模块中，因为我们需要使用注解以及注解处理器，所以先配置一下<code>build.gradle</code>：</p> <p><strong>app/build.gradle</strong></p> <div class=codehilite><pre><span></span>...
apply plugin: &#39;kotlin-kapt&#39;
...
dependencies {
    ...
    implementation project(&#39;:annotations&#39;)
    kapt project(&#39;:processor&#39;)
}
</pre></div> <p>然后在<code>MainActivity.java</code>上配置一下我们的自定义注解：</p> <div class=codehilite><pre><span></span><span class=nd>@RuntimePermissions</span><span class=p>(</span><span class=n>permissions</span> <span class=o>=</span> <span class=o>[</span><span class=s>&quot;Hello&quot;</span><span class=p>,</span> <span class=s>&quot;World&quot;</span><span class=o>]</span><span class=p>)</span>
<span class=kd>class</span> <span class=nc>MainActivity</span> <span class=p>:</span> <span class=n>AppCompatActivity</span><span class=p>()</span> <span class=p>{</span>

    <span class=n>override</span> <span class=n>fun</span> <span class=nf>onCreate</span><span class=p>(</span><span class=n>savedInstanceState</span><span class=p>:</span> <span class=n>Bundle</span><span class=o>?</span><span class=p>)</span> <span class=p>{</span>
        <span class=kd>super</span><span class=p>.</span><span class=na>onCreate</span><span class=p>(</span><span class=n>savedInstanceState</span><span class=p>)</span>
        <span class=n>setContentView</span><span class=p>(</span><span class=n>R</span><span class=p>.</span><span class=na>layout</span><span class=p>.</span><span class=na>activity_main</span><span class=p>)</span>
    <span class=p>}</span>
<span class=p>}</span>
</pre></div> <p>配置完毕后，clean后make一下，就能看到在注解器中配置的信息了。如下面第47行所示：</p> <div class=codehilite><pre><span></span>Executing tasks: [:processor:assemble, :processor:testClasses, :app:assembleDebug]


&gt; Task :annotations:compileJava
warning: [options] bootstrap class path not set in conjunction with -source 1.7
1 warning

&gt; Task :processor:kaptGenerateStubsKotlin
&gt; Task :processor:kaptKotlin
&gt; Task :processor:compileKotlin
&gt; Task :processor:compileJava NO-SOURCE
&gt; Task :processor:processResources
&gt; Task :processor:classes
&gt; Task :processor:inspectClassesForKotlinIC
&gt; Task :processor:jar
&gt; Task :processor:assemble
&gt; Task :processor:kaptGenerateStubsTestKotlin NO-SOURCE

&gt; Task :processor:kaptTestKotlin
Annotation processors discovery from compile classpath is deprecated.
Set &#39;kapt.includeCompileClasspath = false&#39; to disable discovery.
Run the build with &#39;--info&#39; for more details.

&gt; Task :processor:compileTestKotlin NO-SOURCE
&gt; Task :processor:compileTestJava NO-SOURCE
&gt; Task :processor:processTestResources NO-SOURCE
&gt; Task :processor:testClasses UP-TO-DATE
&gt; Task :annotations:processResources NO-SOURCE
&gt; Task :annotations:classes
&gt; Task :annotations:jar
&gt; Task :app:preBuild UP-TO-DATE
&gt; Task :app:preDebugBuild UP-TO-DATE
&gt; Task :app:compileDebugAidl NO-SOURCE
&gt; Task :app:compileDebugRenderscript NO-SOURCE
&gt; Task :app:checkDebugManifest UP-TO-DATE
&gt; Task :app:generateDebugBuildConfig UP-TO-DATE
&gt; Task :app:mainApkListPersistenceDebug
&gt; Task :app:generateDebugResValues
&gt; Task :app:generateDebugResources
&gt; Task :app:mergeDebugResources
&gt; Task :app:createDebugCompatibleScreenManifests
&gt; Task :app:processDebugManifest
&gt; Task :app:processDebugResources
&gt; Task :app:kaptGenerateStubsDebugKotlin

&gt; Task :app:kaptDebugKotlin
w: warning: &gt;&gt;&gt; process begin
w: warning: printMessage: xyz.yorek.component.MainActivity, value=[Ljava.lang.String;@2a0c97c4
w: warning: &gt;&gt;&gt; process end
w: warning: &gt;&gt;&gt; process begin
w: warning: &gt;&gt;&gt; process end

&gt; Task :app:compileDebugKotlin
&gt; Task :app:prepareLintJar UP-TO-DATE
&gt; Task :app:generateDebugSources UP-TO-DATE
&gt; Task :app:javaPreCompileDebug
&gt; Task :app:compileDebugJavaWithJavac
&gt; Task :app:compileDebugSources
&gt; Task :app:mergeDebugShaders
&gt; Task :app:compileDebugShaders
&gt; Task :app:generateDebugAssets
&gt; Task :app:mergeDebugAssets
&gt; Task :app:checkDebugDuplicateClasses
&gt; Task :app:transformClassesWithDexBuilderForDebug
&gt; Task :app:validateSigningDebug
&gt; Task :app:mergeExtDexDebug
&gt; Task :app:mergeDexDebug
&gt; Task :app:signingConfigWriterDebug
&gt; Task :app:mergeDebugJniLibFolders
&gt; Task :app:transformNativeLibsWithMergeJniLibsForDebug
&gt; Task :app:transformNativeLibsWithStripDebugSymbolForDebug
&gt; Task :app:processDebugJavaRes NO-SOURCE
&gt; Task :app:transformResourcesWithMergeJavaResForDebug
&gt; Task :app:packageDebug
&gt; Task :app:assembleDebug

Deprecated Gradle features were used in this build, making it incompatible with Gradle 6.0.
Use &#39;--warning-mode all&#39; to show the individual deprecation warnings.
See https://docs.gradle.org/5.1.1/userguide/command_line_interface.html#sec:command_line_warnings

BUILD SUCCESSFUL in 8s
38 actionable tasks: 34 executed, 4 up-to-date
</pre></div> <p>以上就是一个最简单的编译时注解处理器的编写过程了。</p> <p>至此，注解的全方面介绍已经完毕，剩下的编译时生成辅助文件的相关代码我们会在<a href=/android/3rd-library/permissiondispatcher/ >PermissionDispatcher源码解析——基于注解的动态权限请求框架PermissionDispatcher源码解析</a>这篇文章中进行具体描述。</p> <hr> <div class=md-source-date> <small> 最后更新: 2020年1月14日 </small> </div> <h2 id=__comments>评论</h2> <div id=disqus_thread></div> <script>
    var disqus_config = function () {
      this.page.url = "https://blog.yorek.xyz/about-me/android/other/annotation/";
      this.page.identifier =
        "/android/other/annotation/";
    };
    (function() {
      var d = document, s = d.createElement("script");
      s.src = "//yorekliu.disqus.com/embed.js";
      s.setAttribute("data-timestamp", +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid"> <a href=../../paid/zsxq/week23-load-large-bitmap/ title=大尺寸图片加载问题 class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> 上一页 </span> 大尺寸图片加载问题 </span> </div> </a> <a href=../best_throttle_in_mvvm/ title=这可能是MVVM中最优雅的按键防抖方案 class="md-flex md-footer-nav__link md-footer-nav__link--next" rel=next> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> 下一页 </span> 这可能是MVVM中最优雅的按键防抖方案 </span> </div> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> &copy; 2020 Yorek </div> powered by <a href=https://www.mkdocs.org>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ > Material for MkDocs</a> </div> <div class=md-footer-social> <link rel=stylesheet href=../../../assets/fonts/font-awesome.css> <a href=https://github.com/YorekLiu class="md-footer-social__link fa fa-github"></a> <a href=lyytogether@gmail.com class="md-footer-social__link fa fa-email"></a> </div> </div> </div> </footer> </div> <script src=../../../assets/javascripts/application.808e90bb.js></script> <script src=../../../assets/javascripts/lunr/lunr.stemmer.support.js></script> <script src=../../../assets/javascripts/lunr/tinyseg.js></script> <script src=../../../assets/javascripts/lunr/lunr.ja.js></script> <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script> <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script> </body> </html>
<!--
  Copyright (c) 2016-2020 Martin Donath <martin.donath@squidfunk.com>
  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:
  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.
  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
--> <!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=description content="An Android Developer."><link href=https://blog.yorek.xyz/about-me/android/other/dagger2/ rel=canonical><meta name=author content="Yorek Liu"><meta name=lang:clipboard.copy content=复制><meta name=lang:clipboard.copied content=已复制><meta name=lang:search.language content=ja><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content=没有找到符合条件的结果><meta name=lang:search.result.one content="找到 1 个符合条件的结果"><meta name=lang:search.result.other content="# 个符合条件的结果"><meta name=lang:search.tokenizer content=[\uff0c\u3002]+><link rel="shortcut icon" href=../../../assets/images/favicon.ico><meta name=generator content="mkdocs-1.0.4, mkdocs-material-4.6.0"><title>初学者的Dagger2教程</title><link rel=stylesheet href=../../../assets/stylesheets/application.1b62728e.css><link rel=stylesheet href=../../../assets/stylesheets/application-palette.a8b3c06d.css><meta name=theme-color content><script src=../../../assets/javascripts/modernizr.268332fc.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel=stylesheet href=../../../assets/fonts/material-icons.css><link rel=manifest href=../../../manifest.webmanifest><script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-155096376-1", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script><script async src=https://www.google-analytics.com/analytics.js></script><!-- Determine title --><!-- The image needs to have an absolute URL --><!-- Open graph meta tags --><meta property=og:type content=website><meta property=og:title content="Yorek's - 初学者的Dagger2教程"><meta property=og:description content="An Android Developer."><meta content=https://blog.yorek.xyz/about-me/android/other/dagger2/ property=og:url><meta property=og:image content=https://blog.yorek.xyz/about-meassets/images/banner.png><meta property=og:image:type content=image/png><meta property=og:image:width content=1200><meta property=og:image:height content=630><!-- Twitter meta tags --><meta name=twitter:card content=summary_large_image><meta name=twitter:site content=@squidfunk><meta name=twitter:creator content=@squidfunk><meta name=twitter:title content="Yorek's - 初学者的Dagger2教程"><meta name=twitter:description content="An Android Developer."><meta name=twitter:image content=https://blog.yorek.xyz/about-meassets/images/banner.png></head> <body dir=ltr data-md-color-primary=white data-md-color-accent=blue> <svg class=md-svg> <defs> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#1 tabindex=1 class=md-skip> 跳转至 </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=https://blog.yorek.xyz/about-me title="Yorek's" class="md-header-nav__button md-logo"> <img src=../../../assets/images/favicon.ico width=24 height=24> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> Yorek's </span> <span class=md-header-nav__topic> 初学者的Dagger2教程 </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> 键入以开始搜索 </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container> <nav class="md-tabs md-tabs--active" data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../3rd-library/3rd-library-source-code/ class="md-tabs__link md-tabs__link--active"> Android </a> </li> <li class=md-tabs__item> <a href=../../../flutter/flutter_first_project_1/ class=md-tabs__link> Flutter </a> </li> <li class=md-tabs__item> <a href=../../../leetcode/ class=md-tabs__link> LeetCode </a> </li> <li class=md-tabs__item> <a href=../../../design-pattern/design-pattern/ class=md-tabs__link> Books </a> </li> </ul> </div> </nav> <main class=md-main role=main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=https://blog.yorek.xyz/about-me title="Yorek's" class="md-nav__button md-logo"> <img src=../../../assets/images/favicon.ico width=48 height=48> </a> Yorek's </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. title=Home class=md-nav__link> Home </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2 type=checkbox id=nav-2 checked> <label class=md-nav__link for=nav-2> Android </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-2> Android </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-1 type=checkbox id=nav-2-1 checked> <label class=md-nav__link for=nav-2-1> 三方库源码解析 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-1> 三方库源码解析 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../3rd-library/3rd-library-source-code/ title=Android三方库源码分析 class=md-nav__link> Android三方库源码分析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/matrix/ title="微信APM Matrix解析" class=md-nav__link> 微信APM Matrix解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/matrix-trace/ title=Matrix-TraceCanary解析 class=md-nav__link> Matrix-TraceCanary解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/matrix-io/ title=Matrix-IOCanary解析 class=md-nav__link> Matrix-IOCanary解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/matrix-resource/ title=Matrix-ResourceCanary解析 class=md-nav__link> Matrix-ResourceCanary解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/matrix-sqlitelint/ title=Matrix-SQLiteLint解析 class=md-nav__link> Matrix-SQLiteLint解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/okhttp/ title=OkHttp3源码解析 class=md-nav__link> OkHttp3源码解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/retrofit/ title=Retrofit2源码解析 class=md-nav__link> Retrofit2源码解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/rxjava&rxandroid/ title=RxJava源码解析及使用实例 class=md-nav__link> RxJava源码解析及使用实例 </a> </li> <li class=md-nav__item> <a href=../RxJava/ title=RxJava操作符大全 class=md-nav__link> RxJava操作符大全 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide1/ title="Glide v4 源码解析（一）" class=md-nav__link> Glide v4 源码解析（一） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide2/ title="Glide v4 源码解析（二）" class=md-nav__link> Glide v4 源码解析（二） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide3/ title="Glide v4 源码解析（三）" class=md-nav__link> Glide v4 源码解析（三） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide4/ title="Glide v4 源码解析（四）" class=md-nav__link> Glide v4 源码解析（四） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide5/ title="Glide v4 源码解析（五）" class=md-nav__link> Glide v4 源码解析（五） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide6/ title="Glide v4 源码解析（六）" class=md-nav__link> Glide v4 源码解析（六） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide7/ title="Glide v4 源码解析（七）" class=md-nav__link> Glide v4 源码解析（七） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/migrate-to-glide/ title=杂记：从Picasso迁移至Glide class=md-nav__link> 杂记：从Picasso迁移至Glide </a> </li> <li class=md-nav__item> <a href=../../3rd-library/eventbus/ title=EventBus源码解析 class=md-nav__link> EventBus源码解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/leakcanary/ title=LeakCanary2源码解析 class=md-nav__link> LeakCanary2源码解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/permissiondispatcher/ title=PermissionDispatcher源码解析 class=md-nav__link> PermissionDispatcher源码解析 </a> </li> <li class=md-nav__item> <a href=../constraintlayout/ title=ConstraintLayout使用大全 class=md-nav__link> ConstraintLayout使用大全 </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-toggle md-nav__toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> 初学者的Dagger2教程 </label> <a href=./ title=初学者的Dagger2教程 class="md-nav__link md-nav__link--active"> 初学者的Dagger2教程 </a> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>目录</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#1 class=md-nav__link> 1. 基本注入 </a> </li> <li class=md-nav__item> <a href=#2 class=md-nav__link> 2. 对象注入 </a> </li> <li class=md-nav__item> <a href=#3 class=md-nav__link> 3. 模型与单例 </a> </li> <li class=md-nav__item> <a href=#4 class=md-nav__link> 4. 带参注入 </a> </li> <li class=md-nav__item> <a href=#5-module class=md-nav__link> 5. 多Module注入 </a> </li> <li class=md-nav__item> <a href=#6-namedqualifier class=md-nav__link> 6. @Named、@Qualifier </a> </li> <li class=md-nav__item> <a href=#7 class=md-nav__link> 7. 官网例子 </a> </li> <li class=md-nav__item> <a href=#__comments class="md-nav__link md-nav__link--active"> 评论 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-2 type=checkbox id=nav-2-2> <label class=md-nav__link for=nav-2-2> Android开发高手课 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-2> Android开发高手课 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../paid/master/ title=Android开发高手课 class=md-nav__link> Android开发高手课 </a> </li> <li class=md-nav__item> <a href=../../paid/master/crash_1/ title="01 | 崩溃优化（上）：关于“崩溃”那些事儿" class=md-nav__link> 01 | 崩溃优化（上）：关于“崩溃”那些事儿 </a> </li> <li class=md-nav__item> <a href=../../paid/master/crash_2/ title="02 | 崩溃优化（下）：应用崩溃了，你应该如何去分析？" class=md-nav__link> 02 | 崩溃优化（下）：应用崩溃了，你应该如何去分析？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/memory_1/ title="03 | 内存优化（上）：4GB内存时代，再谈内存优化" class=md-nav__link> 03 | 内存优化（上）：4GB内存时代，再谈内存优化 </a> </li> <li class=md-nav__item> <a href=../../paid/master/memory_2/ title="04 | 内存优化（下）：内存优化这件事，应该从哪里着手？" class=md-nav__link> 04 | 内存优化（下）：内存优化这件事，应该从哪里着手？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/stuck_1/ title="05 | 卡顿优化（上）：你要掌握的卡顿分析方法" class=md-nav__link> 05 | 卡顿优化（上）：你要掌握的卡顿分析方法 </a> </li> <li class=md-nav__item> <a href=../../paid/master/stuck_2/ title="06 | 卡顿优化（下）：如何监控应用卡顿？" class=md-nav__link> 06 | 卡顿优化（下）：如何监控应用卡顿？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/stuck_3/ title="06补充篇 | 卡顿优化：卡顿现场与卡顿分析" class=md-nav__link> 06补充篇 | 卡顿优化：卡顿现场与卡顿分析 </a> </li> <li class=md-nav__item> <a href=../../paid/master/start_1/ title="07 | 启动优化（上）：从启动过程看启动速度优化" class=md-nav__link> 07 | 启动优化（上）：从启动过程看启动速度优化 </a> </li> <li class=md-nav__item> <a href=../../paid/master/start_2/ title="08 | 启动优化（下）：优化启动速度的进阶方法" class=md-nav__link> 08 | 启动优化（下）：优化启动速度的进阶方法 </a> </li> <li class=md-nav__item> <a href=../../paid/master/io_1/ title="09 | I/O优化（上）：开发工程师必备的I/O优化知识" class=md-nav__link> 09 | I/O优化（上）：开发工程师必备的I/O优化知识 </a> </li> <li class=md-nav__item> <a href=../../paid/master/io_2/ title="10 | I/O优化（中）：不同I/O方式的使用场景是什么？" class=md-nav__link> 10 | I/O优化（中）：不同I/O方式的使用场景是什么？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/io_3/ title="11 | I/O优化（下）：如何监控线上I/O操作？" class=md-nav__link> 11 | I/O优化（下）：如何监控线上I/O操作？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/storage_1/ title="12 | 存储优化（上）：常见的数据存储方法有哪些？" class=md-nav__link> 12 | 存储优化（上）：常见的数据存储方法有哪些？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/storage_2/ title="13 | 存储优化（中）：如何优化数据存储？" class=md-nav__link> 13 | 存储优化（中）：如何优化数据存储？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/storage_3/ title="14 | 存储优化（下）：数据库SQLite的使用和优化" class=md-nav__link> 14 | 存储优化（下）：数据库SQLite的使用和优化 </a> </li> <li class=md-nav__item> <a href=../../paid/master/network_1/ title="15 | 网络优化（上）：移动开发工程师必备的网络优化知识" class=md-nav__link> 15 | 网络优化（上）：移动开发工程师必备的网络优化知识 </a> </li> <li class=md-nav__item> <a href=../../paid/master/network_2/ title="16 | 网络优化（中）：复杂多变的移动网络该如何优化？" class=md-nav__link> 16 | 网络优化（中）：复杂多变的移动网络该如何优化？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/network_3/ title="17 | 网络优化（下）：大数据下网络该如何监控？" class=md-nav__link> 17 | 网络优化（下）：大数据下网络该如何监控？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/battery_1/ title="18 | 耗电优化（上）：从电量优化的演进看耗电分析" class=md-nav__link> 18 | 耗电优化（上）：从电量优化的演进看耗电分析 </a> </li> <li class=md-nav__item> <a href=../../paid/master/battery_2/ title="19 | 耗电优化（下）：耗电的优化方法与线上监控" class=md-nav__link> 19 | 耗电优化（下）：耗电的优化方法与线上监控 </a> </li> <li class=md-nav__item> <a href=../../paid/master/ui_1/ title="20 | UI 优化（上）：UI 渲染的几个关键概念" class=md-nav__link> 20 | UI 优化（上）：UI 渲染的几个关键概念 </a> </li> <li class=md-nav__item> <a href=../../paid/master/ui_2/ title="21 | UI 优化（下）：如何优化 UI 渲染？" class=md-nav__link> 21 | UI 优化（下）：如何优化 UI 渲染？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/package_1/ title="22 | 包体积优化（上）：如何减少安装包大小？" class=md-nav__link> 22 | 包体积优化（上）：如何减少安装包大小？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/package_2/ title="23 | 包体积优化（下）：资源优化的进阶实践" class=md-nav__link> 23 | 包体积优化（下）：资源优化的进阶实践 </a> </li> <li class=md-nav__item> <a href=../../paid/master/compile/ title="26 | 关于编译，你需要了解什么？" class=md-nav__link> 26 | 关于编译，你需要了解什么？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/bytecode/ title="27 | 编译插桩的三种方法：AspectJ、ASM、ReDex" class=md-nav__link> 27 | 编译插桩的三种方法：AspectJ、ASM、ReDex </a> </li> <li class=md-nav__item> <a href=../../paid/master/native_hook/ title="35 | Native Hook 技术，天使还是魔鬼？" class=md-nav__link> 35 | Native Hook 技术，天使还是魔鬼？ </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-3 type=checkbox id=nav-2-3> <label class=md-nav__link for=nav-2-3> Framework系列 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-3> Framework系列 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../framework/Android四大组件(1)/ title=Activity class=md-nav__link> Activity </a> </li> <li class=md-nav__item> <a href=../../framework/Android四大组件(2)/ title=Service class=md-nav__link> Service </a> </li> <li class=md-nav__item> <a href=../../framework/Android四大组件(3)/ title=Broadcasts class=md-nav__link> Broadcasts </a> </li> <li class=md-nav__item> <a href=../../framework/Android四大组件(4)/ title="Content Providers与Fragment" class=md-nav__link> Content Providers与Fragment </a> </li> <li class=md-nav__item> <a href=../../framework/IPC机制/ title=IPC机制 class=md-nav__link> IPC机制 </a> </li> <li class=md-nav__item> <a href=../../framework/View的事件体系/ title=View的事件体系 class=md-nav__link> View的事件体系 </a> </li> <li class=md-nav__item> <a href=../../framework/View的绘制原理/ title=View的绘制原理 class=md-nav__link> View的绘制原理 </a> </li> <li class=md-nav__item> <a href=../../framework/RemoteViews/ title=RemoteViews class=md-nav__link> RemoteViews </a> </li> <li class=md-nav__item> <a href=../../framework/Drawable/ title=Android中的Drawable资源 class=md-nav__link> Android中的Drawable资源 </a> </li> <li class=md-nav__item> <a href=../../framework/Android动画/ title=Android动画 class=md-nav__link> Android动画 </a> </li> <li class=md-nav__item> <a href=../../framework/Window与WindowManager/ title=Window与WindowManager class=md-nav__link> Window与WindowManager </a> </li> <li class=md-nav__item> <a href=../../framework/四大组件启动过程/ title=四大组件启动过程 class=md-nav__link> 四大组件启动过程 </a> </li> <li class=md-nav__item> <a href=../../framework/Android消息机制/ title=Android消息机制 class=md-nav__link> Android消息机制 </a> </li> <li class=md-nav__item> <a href=../../framework/Android线程与线程池/ title=Android线程与线程池 class=md-nav__link> Android线程与线程池 </a> </li> <li class=md-nav__item> <a href=../../framework/Bitmap的缓存与加载/ title=Bitmap的缓存与加载 class=md-nav__link> Bitmap的缓存与加载 </a> </li> <li class=md-nav__item> <a href=../../framework/JNI与NDK/ title=JNI与NDK编程简介 class=md-nav__link> JNI与NDK编程简介 </a> </li> <li class=md-nav__item> <a href=../../framework/性能优化/ title=Android性能优化 class=md-nav__link> Android性能优化 </a> </li> <li class=md-nav__item> <a href=../../framework/binder1-mediaservice/ title=Binder深入理解——以MediaService为例 class=md-nav__link> Binder深入理解——以MediaService为例 </a> </li> <li class=md-nav__item> <a href=../../framework/binder2/ title=Binder深入理解——罗老师系列 class=md-nav__link> Binder深入理解——罗老师系列 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-4 type=checkbox id=nav-2-4> <label class=md-nav__link for=nav-2-4> 付费知识归档 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-4> 付费知识归档 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-4-1 type=checkbox id=nav-2-4-1> <label class=md-nav__link for=nav-2-4-1> 某圈问题索引 </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-2-4-1> 某圈问题索引 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../paid/zsxq/zsxq_index/ title=某圈问题索引 class=md-nav__link> 某圈问题索引 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week1-synchronized/ title=理解Java中synchronized关键词 class=md-nav__link> 理解Java中synchronized关键词 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week2-service/ title=理解Service class=md-nav__link> 理解Service </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week3-activity/ title=理解Activity的启动模式 class=md-nav__link> 理解Activity的启动模式 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week4-startActivityForResult/ title=关于startActivityForResult class=md-nav__link> 关于startActivityForResult </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week5-view/ title=关于View的知识 class=md-nav__link> 关于View的知识 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week6-gradle/ title=关于Gradle的知识 class=md-nav__link> 关于Gradle的知识 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week7-serialization/ title=关于序列化的知识 class=md-nav__link> 关于序列化的知识 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week10-classloader/ title=Android中的ClassLoader class=md-nav__link> Android中的ClassLoader </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week11-binder/ title=Binder简介 class=md-nav__link> Binder简介 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week12-retrofit-okhttp/ title=OkHttp和Retrofit的作用以及两者之间的联系 class=md-nav__link> OkHttp和Retrofit的作用以及两者之间的联系 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week14-jvm-gc/ title=JVM中垃圾回收策略 class=md-nav__link> JVM中垃圾回收策略 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week16-keep-app-alive/ title=进程保活 class=md-nav__link> 进程保活 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week17-android-components/ title=四大组件的作用以及多进程 class=md-nav__link> 四大组件的作用以及多进程 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week20-network-protocol/ title=网络协议 class=md-nav__link> 网络协议 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week21-mvc&amp;mvp&mvvm/ title=MVC、MVP和MVVM class=md-nav__link> MVC、MVP和MVVM </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week22-android-studio-build/ title="Android Studio build过程" class=md-nav__link> Android Studio build过程 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week23-load-large-bitmap/ title=大尺寸图片加载问题 class=md-nav__link> 大尺寸图片加载问题 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-5 type=checkbox id=nav-2-5> <label class=md-nav__link for=nav-2-5> 日常记录 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-5> 日常记录 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../annotation/ title=注解的定义及解析 class=md-nav__link> 注解的定义及解析 </a> </li> <li class=md-nav__item> <a href=../best_throttle_in_mvvm/ title=这可能是MVVM中最优雅的按键防抖方案 class=md-nav__link> 这可能是MVVM中最优雅的按键防抖方案 </a> </li> <li class=md-nav__item> <a href=../android-jenkins/ title="Jenkins for android" class=md-nav__link> Jenkins for android </a> </li> <li class=md-nav__item> <a href=../SystemProrities/ title=普通Android程序使用SystemProrities class=md-nav__link> 普通Android程序使用SystemProrities </a> </li> <li class=md-nav__item> <a href=../recyclerview-cache/ title=ListView、RecyclerView缓存策略解析 class=md-nav__link> ListView、RecyclerView缓存策略解析 </a> </li> <li class=md-nav__item> <a href=../recyclerview-item-docoration/ title=RecyclerView高级特性——ItemDecoration class=md-nav__link> RecyclerView高级特性——ItemDecoration </a> </li> <li class=md-nav__item> <a href=../recyclerview-others/ title=RecyclerView的一些使用细节 class=md-nav__link> RecyclerView的一些使用细节 </a> </li> <li class=md-nav__item> <a href=../RecyclerView-Sort&Delete/ title=RecyclerView高级特性——拖拽排序以及滑动删除 class=md-nav__link> RecyclerView高级特性——拖拽排序以及滑动删除 </a> </li> <li class=md-nav__item> <a href=../FAB-Behavior/ title=FloatingActionButton上滑隐藏下滑显示 class=md-nav__link> FloatingActionButton上滑隐藏下滑显示 </a> </li> <li class=md-nav__item> <a href=../nestedscrolling/ title=NestedScrolling机制 class=md-nav__link> NestedScrolling机制 </a> </li> <li class=md-nav__item> <a href=../porterduff/ title=使用Porter-Duff合成数字图像 class=md-nav__link> 使用Porter-Duff合成数字图像 </a> </li> <li class=md-nav__item> <a href=../runtime/ title="Android Runtime" class=md-nav__link> Android Runtime </a> </li> <li class=md-nav__item> <a href=../android_alias/ title=Android马甲包的那些事儿 class=md-nav__link> Android马甲包的那些事儿 </a> </li> <li class=md-nav__item> <a href=../Android-Development-Tool/ title=Android神兵利器 class=md-nav__link> Android神兵利器 </a> </li> <li class=md-nav__item> <a href=../FileProvider/ title=FileProvider class=md-nav__link> FileProvider </a> </li> <li class=md-nav__item> <a href=../Android判断导航栏高度/ title=Android判断虚拟按键(导航栏)显示与否、高度以及获取屏幕实际高度 class=md-nav__link> Android判断虚拟按键(导航栏)显示与否、高度以及获取屏幕实际高度 </a> </li> <li class=md-nav__item> <a href=../Android图片选择器/ title=Android图片选择器 class=md-nav__link> Android图片选择器 </a> </li> <li class=md-nav__item> <a href=../Android底部导航栏框架/ title=Android原生底部导航栏 class=md-nav__link> Android原生底部导航栏 </a> </li> <li class=md-nav__item> <a href=../Android搜索栏的实现/ title=Android搜索栏的实现 class=md-nav__link> Android搜索栏的实现 </a> </li> <li class=md-nav__item> <a href=../Android暂停音乐播放器的播放/ title=Android暂停酷狗、网易云音乐等音乐播放器的播放 class=md-nav__link> Android暂停酷狗、网易云音乐等音乐播放器的播放 </a> </li> <li class=md-nav__item> <a href=../Android滑动返回实践/ title=Android滑动返回实践 class=md-nav__link> Android滑动返回实践 </a> </li> <li class=md-nav__item> <a href=../Android程序反编译/ title=MacOS下Android程序反编译 class=md-nav__link> MacOS下Android程序反编译 </a> </li> <li class=md-nav__item> <a href=../Android通讯录快速读取/ title=Android通讯录快速读取 class=md-nav__link> Android通讯录快速读取 </a> </li> <li class=md-nav__item> <a href=../soft-keyboard-in-app/ title=App内自定义软键盘 class=md-nav__link> App内自定义软键盘 </a> </li> <li class=md-nav__item> <a href=../腾讯X5内核入坑指南/ title="腾讯TBS X5浏览器内核入坑指南" class=md-nav__link> 腾讯TBS X5浏览器内核入坑指南 </a> </li> <li class=md-nav__item> <a href=../琐碎知识点/ title=琐碎知识点 class=md-nav__link> 琐碎知识点 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3 type=checkbox id=nav-3> <label class=md-nav__link for=nav-3> Flutter </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-3> Flutter </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../flutter/flutter_first_project_1/ title=年轻人的第一个Flutter程序(1) class=md-nav__link> 年轻人的第一个Flutter程序(1) </a> </li> <li class=md-nav__item> <a href=../../../flutter/flutter_first_project_2/ title=年轻人的第一个Flutter程序(2) class=md-nav__link> 年轻人的第一个Flutter程序(2) </a> </li> <li class=md-nav__item> <a href=../../../flutter/flutter_first_project_3/ title=年轻人的第一个Flutter程序(3) class=md-nav__link> 年轻人的第一个Flutter程序(3) </a> </li> <li class=md-nav__item> <a href=../../../flutter/flutter_first_project_4/ title=年轻人的第一个Flutter程序(4) class=md-nav__link> 年轻人的第一个Flutter程序(4) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4 type=checkbox id=nav-4> <label class=md-nav__link for=nav-4> LeetCode </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-4> LeetCode </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../leetcode/ title=算法目录 class=md-nav__link> 算法目录 </a> </li> <li class=md-nav__item> <a href=../../../leetcode/code_interviews_1/ title=数据结构、算法和数据操作 class=md-nav__link> 数据结构、算法和数据操作 </a> </li> <li class=md-nav__item> <a href=../../../leetcode/code_interviews_3/ title=高质量的代码 class=md-nav__link> 高质量的代码 </a> </li> <li class=md-nav__item> <a href=../../../leetcode/code_interviews_4/ title=解决问题的思路 class=md-nav__link> 解决问题的思路 </a> </li> <li class=md-nav__item> <a href=../../../leetcode/code_interviews_5/ title=优化时间和空间效率 class=md-nav__link> 优化时间和空间效率 </a> </li> <li class=md-nav__item> <a href=../../../leetcode/code_interviews_6/ title=面试中的各项能力 class=md-nav__link> 面试中的各项能力 </a> </li> <li class=md-nav__item> <a href=../../../leetcode/array/ title=Array class=md-nav__link> Array </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode1-10/ title=LeetCode(1-10) class=md-nav__link> LeetCode(1-10) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode11-20/ title=LeetCode(11-20) class=md-nav__link> LeetCode(11-20) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode21-30/ title=LeetCode(21-30) class=md-nav__link> LeetCode(21-30) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode31-40/ title=LeetCode(31-40) class=md-nav__link> LeetCode(31-40) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode41-50/ title=LeetCode(41-50) class=md-nav__link> LeetCode(41-50) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode51-60/ title=LeetCode(51-60) class=md-nav__link> LeetCode(51-60) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode61-70/ title=LeetCode(61-70) class=md-nav__link> LeetCode(61-70) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode71-80/ title=LeetCode(71-80) class=md-nav__link> LeetCode(71-80) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode81-90/ title=LeetCode(81-90) class=md-nav__link> LeetCode(81-90) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode91-100/ title=LeetCode(91-100) class=md-nav__link> LeetCode(91-100) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode101-110/ title=LeetCode(101-110) class=md-nav__link> LeetCode(101-110) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode111-120/ title=LeetCode(111-120) class=md-nav__link> LeetCode(111-120) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5 type=checkbox id=nav-5> <label class=md-nav__link for=nav-5> Books </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-5> Books </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-1 type=checkbox id=nav-5-1> <label class=md-nav__link for=nav-5-1> Design Pattern </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-1> Design Pattern </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../design-pattern/design-pattern/ title=设计模式概述 class=md-nav__link> 设计模式概述 </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/design-principle/ title=面向对象的六大原则 class=md-nav__link> 面向对象的六大原则 </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/singleton/ title=单例模式(Singleton) class=md-nav__link> 单例模式(Singleton) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/builder/ title=建造者模式(Builder) class=md-nav__link> 建造者模式(Builder) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/prototype/ title=原型模式(Prototype) class=md-nav__link> 原型模式(Prototype) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/factory-method/ title="工厂方法模式(Factory method)" class=md-nav__link> 工厂方法模式(Factory method) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/abstract-factory/ title="抽象工厂模式(Abstract factory)" class=md-nav__link> 抽象工厂模式(Abstract factory) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/proxy/ title=代理模式(Proxy) class=md-nav__link> 代理模式(Proxy) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/composite/ title=组合模式(Composite) class=md-nav__link> 组合模式(Composite) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/adapter/ title=适配器模式(Adapter) class=md-nav__link> 适配器模式(Adapter) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/decorator/ title=装饰模式(Decorator) class=md-nav__link> 装饰模式(Decorator) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/flyweight/ title=享元模式(Flyweight) class=md-nav__link> 享元模式(Flyweight) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/facade/ title=外观模式(Facade) class=md-nav__link> 外观模式(Facade) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/bridge/ title=桥接模式(Bridge) class=md-nav__link> 桥接模式(Bridge) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/strategy/ title=策略模式(Strategy) class=md-nav__link> 策略模式(Strategy) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/state/ title=状态模式(State) class=md-nav__link> 状态模式(State) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/chain-of-responsibility/ title="责任链模式(Chain of responsibility)" class=md-nav__link> 责任链模式(Chain of responsibility) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/interpreter/ title=解释器模式(Interpreter) class=md-nav__link> 解释器模式(Interpreter) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/command/ title=命令模式(Command) class=md-nav__link> 命令模式(Command) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/observer/ title=观察者模式(Observer) class=md-nav__link> 观察者模式(Observer) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/memento/ title=备忘录模式(Memento) class=md-nav__link> 备忘录模式(Memento) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/iterator/ title=迭代器模式(Iterator) class=md-nav__link> 迭代器模式(Iterator) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/template-method/ title="模版方法模式(Template method)" class=md-nav__link> 模版方法模式(Template method) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/visitor/ title=访问者模式(Visitor) class=md-nav__link> 访问者模式(Visitor) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/mediator/ title=中介者模式(Mediator) class=md-nav__link> 中介者模式(Mediator) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/confusing-design-pattern/ title=易混淆的设计模式 class=md-nav__link> 易混淆的设计模式 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2 type=checkbox id=nav-5-2> <label class=md-nav__link for=nav-5-2> Effective Java </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-2> Effective Java </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../effective-java/effective-java/ title="Effective Java概述" class=md-nav__link> Effective Java概述 </a> </li> <li class=md-nav__item> <a href=../../../effective-java/chapter1/ title=创建和销毁对象 class=md-nav__link> 创建和销毁对象 </a> </li> <li class=md-nav__item> <a href=../../../effective-java/chapter2/ title=对于所有对象都通用的方法 class=md-nav__link> 对于所有对象都通用的方法 </a> </li> <li class=md-nav__item> <a href=../../../effective-java/chapter3/ title=类和接口 class=md-nav__link> 类和接口 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-3 type=checkbox id=nav-5-3> <label class=md-nav__link for=nav-5-3> JVM </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-3> JVM </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../jvm/jvm-content/ title=深入理解Java虚拟机 class=md-nav__link> 深入理解Java虚拟机 </a> </li> <li class=md-nav__item> <a href=../../../jvm/java-memory-area-oom/ title=Java内存区域与内存溢出异常 class=md-nav__link> Java内存区域与内存溢出异常 </a> </li> <li class=md-nav__item> <a href=../../../jvm/java-gc/ title=垃圾收集器与内存分配策略 class=md-nav__link> 垃圾收集器与内存分配策略 </a> </li> <li class=md-nav__item> <a href=../../../jvm/class-struct/ title=类文件结构 class=md-nav__link> 类文件结构 </a> </li> <li class=md-nav__item> <a href=../../../jvm/load-class/ title=虚拟机类加载机制 class=md-nav__link> 虚拟机类加载机制 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-4 type=checkbox id=nav-5-4> <label class=md-nav__link for=nav-5-4> Java </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-4> Java </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../java/generics-java-kotlin/ title=Java&Kotlin在泛型方面的区别 class=md-nav__link> Java&Kotlin在泛型方面的区别 </a> </li> <li class=md-nav__item> <a href=../../../java/java-collections/ title=Java集合总结 class=md-nav__link> Java集合总结 </a> </li> <li class=md-nav__item> <a href=../../../java/java-foundation/ title=Java常见概念 class=md-nav__link> Java常见概念 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-5 type=checkbox id=nav-5-5> <label class=md-nav__link for=nav-5-5> Refactoring </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-5> Refactoring </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../refactoring/refactoring/ title=重构：改善既有代码的设计 class=md-nav__link> 重构：改善既有代码的设计 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>目录</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#1 class=md-nav__link> 1. 基本注入 </a> </li> <li class=md-nav__item> <a href=#2 class=md-nav__link> 2. 对象注入 </a> </li> <li class=md-nav__item> <a href=#3 class=md-nav__link> 3. 模型与单例 </a> </li> <li class=md-nav__item> <a href=#4 class=md-nav__link> 4. 带参注入 </a> </li> <li class=md-nav__item> <a href=#5-module class=md-nav__link> 5. 多Module注入 </a> </li> <li class=md-nav__item> <a href=#6-namedqualifier class=md-nav__link> 6. @Named、@Qualifier </a> </li> <li class=md-nav__item> <a href=#7 class=md-nav__link> 7. 官网例子 </a> </li> <li class=md-nav__item> <a href=#__comments class="md-nav__link md-nav__link--active"> 评论 </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <h1>初学者的Dagger2教程</h1> <p>最近新开了个项目，想搞点事情。 </p> <p>在原来的项目中，初始化并绑定ViewModel、DataBinding是靠泛型来实现的，基类声明如下：</p> <div class=codehilite><pre><span></span><span class=k>abstract</span> <span class=k>class</span> <span class=nc>BaseActivity</span><span class=p>&lt;</span><span class=n>VM</span> <span class=p>:</span> <span class=n>BaseViewModel</span><span class=p>,</span> <span class=n>B</span> <span class=p>:</span> <span class=n>ViewDataBinding</span><span class=p>&gt;</span> <span class=p>:</span> <span class=n>AppCompatActivity</span><span class=p>()</span>
</pre></div> <p>虽然用着很愉快，基类里面的ViewModel和DataBinding都是传入的类型：</p> <div class=codehilite><pre><span></span><span class=k>protected</span> <span class=k>lateinit</span> <span class=k>var</span> <span class=py>viewModel</span><span class=p>:</span> <span class=n>VM</span>
<span class=k>protected</span> <span class=k>lateinit</span> <span class=k>var</span> <span class=py>binding</span><span class=p>:</span> <span class=n>B</span>
</pre></div> <p>但是在某些类里面使用基类时，看起来令人不爽，比如：</p> <div class=codehilite><pre><span></span><span class=k>if</span> <span class=p>(</span><span class=n>activity</span> <span class=k>is</span> <span class=n>BaseActivity</span><span class=p>&lt;*,</span> <span class=p>*&gt;)</span> <span class=p>{</span>
    <span class=n>hostActivity</span> <span class=p>=</span> <span class=n>activity</span>
<span class=p>}</span>
</pre></div> <p>所以就起了想法，想用Dagger2来替换这看起来不爽的泛型。<strong>虽然替换后也不太爽，但是Dagger2有用起来了啊，这就够了。</strong></p> <p>下面正式开始Dagger2教学。 </p> <p>Dagger2就是一个依赖注入框架。使用时先添加对应依赖：</p> <div class=codehilite><pre><span></span>implementation &quot;com.google.dagger:dagger:2.21&quot;
kapt &quot;com.google.dagger:dagger-compiler:2.21&quot;
</pre></div> <p>因为项目全部使用的Kotlin，所以这里使用的是<code>kapt</code>而不是Java中的<code>annotationProcessor</code>，另外kapt需要在<code>apply plugin: 'kotlin-kapt'</code>一下。</p> <h2 id=1>1. 基本注入<a class=headerlink href=#1 title="Permanent link">&para;</a></h2> <p>首先是最简单、最基本的无参对象的注入。</p> <p>比如，我家的小狗渴了，想喝些什么。</p> <p>为了让它可以喝到Dagger味的，我们可以这样在<code>Dog</code>类的无参构造函数上加一个<code>@Inject</code>注解。 </p> <div class=codehilite><pre><span></span><span class=k>class</span> <span class=nc>Dog</span> <span class=n>@Inject</span> <span class=k>constructor</span><span class=p>()</span> <span class=p>{</span>
    <span class=k>fun</span> <span class=nf>drink</span><span class=p>()</span> <span class=p>=</span> <span class=s>&quot;drink&quot;</span>
<span class=p>}</span>
</pre></div> <p>使用的时候可以通过<code>@Inject</code>注解来完成注入。</p> <div class=codehilite><pre><span></span><span class=k>class</span> <span class=nc>DaggerActivity</span> <span class=p>:</span> <span class=n>BaseActivity</span><span class=p>()</span> <span class=p>{</span>

    <span class=n>@Inject</span>
    <span class=k>lateinit</span> <span class=k>var</span> <span class=py>dog</span><span class=p>:</span> <span class=n>Dog</span>

    <span class=p>...</span>
<span class=p>}</span>
</pre></div> <p>需要注意的是，<code>@Inject</code>只是一个注解，我们还需要一个用来对注解进行处理的处理器。这个处理器就是我们刚开始kapt的<code>com.google.dagger:dagger-compiler</code>。</p> <p>现在我们需要写一个额外的代码，告诉注解处理器如何处理该注解，这个额外的代码中，<code>@Component</code>注解是关键。</p> <p>我们可以写出下面的这种注入器：</p> <div class=codehilite><pre><span></span><span class=n>@Component</span>
<span class=k>interface</span> <span class=nc>DogComponent</span> <span class=p>{</span>
    <span class=k>fun</span> <span class=nf>createDog</span><span class=p>():</span> <span class=n>Dog</span>
<span class=p>}</span>
</pre></div> <p>该注入器提供了一个创建<code>Dog</code>的<code>createDog</code>方法。使用时如下使用：</p> <div class=codehilite><pre><span></span><span class=n>dog</span> <span class=p>=</span> <span class=n>DaggerDogComponent</span><span class=p>.</span><span class=n>builder</span><span class=p>().</span><span class=n>build</span><span class=p>().</span><span class=n>createDog</span><span class=p>()</span>
</pre></div> <p>当然，使用上面这种方法时，<code>@Inject lateinit var dog: Dog</code>中的<code>@Inject</code>是不需要的。因为这里只是使用dagger创建了对象，而没有自动完成注入功能。 </p> <p>所以，这里推荐第二种注解器的编写方式：</p> <div class=codehilite><pre><span></span><span class=n>@Component</span>
<span class=k>interface</span> <span class=nc>DogComponent</span> <span class=p>{</span>
    <span class=k>fun</span> <span class=nf>inject</span><span class=p>(</span><span class=n>activity</span><span class=p>:</span> <span class=n>DaggerActivity</span><span class=p>)</span>
<span class=p>}</span>
</pre></div> <p><strong>在</strong> <code>DaggerActivity</code> <strong>中使用时</strong> ，通过下面的代码完成自动注入：</p> <div class=codehilite><pre><span></span><span class=n>DaggerDogComponent</span><span class=p>.</span><span class=n>builder</span><span class=p>().</span><span class=n>build</span><span class=p>().</span><span class=n>inject</span><span class=p>(</span><span class=k>this</span><span class=p>)</span>
<span class=c1>// 等价于 DaggerDogComponent.create().inject(this)</span>
</pre></div> <p>自动注入了<code>Dog</code>之后，我们就能让它喝些什么了：</p> <div class=codehilite><pre><span></span><span class=n>tv</span><span class=p>.</span><span class=n>text</span> <span class=p>=</span> <span class=n>dog</span><span class=p>.</span><span class=n>drink</span><span class=p>()</span>
</pre></div> <p>我们加粗强调了 <strong>在</strong> <code>DaggerActivity</code> <strong>中使用</strong> ，这是因为Dagger是强类型的，在哪个类中使用，就只能声明inject哪个类。如果我们把上面声明中的<code>DaggerActivity</code>换成基类<code>BaseActivity</code>，编译会通过，但是一运行就会报错。另外，在<code>builder</code>时如需要设置Module，但是没有声明<code>inject</code>此类，设置Module的方法会生成为<code>@deprecated</code>类型。</p> <h2 id=2>2. 对象注入<a class=headerlink href=#2 title="Permanent link">&para;</a></h2> <p>上面一节中，我们已经命令doge喝了，但是很遗憾，没有什么东西可以让它喝。我们认识到了错误，并赶紧提供了一杯<code>Water</code>。 </p> <p>首先我们需要写一个<code>Water</code>类，由于这是被<code>Dog</code>需要的。所以，<code>Water</code>需要有一个<code>@Inject</code>的无参构造方法，然后在原来<code>Dog</code>的构造方法中直接加上<code>water</code>参数就可以了。</p> <p><code>@Component</code>部分和<code>DaggerActivity</code>中的代码无需任何改动，多么amazing。</p> <p>看看改动后的<code>Water</code>和<code>Dog</code>代码：</p> <div class=codehilite><pre><span></span><span class=kd>class</span> <span class=nc>Dog</span> <span class=nd>@Inject</span> <span class=n>constructor</span><span class=p>(</span>
    <span class=kd>private</span> <span class=n>val</span> <span class=n>water</span><span class=p>:</span> <span class=n>Water</span>
<span class=p>)</span> <span class=p>{</span>
    <span class=n>fun</span> <span class=nf>drink</span><span class=p>()</span> <span class=o>=</span> <span class=s>&quot;drink $water&quot;</span>
<span class=p>}</span>

<span class=kd>class</span> <span class=nc>Water</span> <span class=nd>@Inject</span> <span class=n>constructor</span><span class=p>()</span> <span class=p>{</span>
    <span class=n>override</span> <span class=n>fun</span> <span class=nf>toString</span><span class=p>()</span> <span class=o>=</span> <span class=s>&quot;water&quot;</span>
<span class=p>}</span>
</pre></div> <p>经过上面的改动后，我们再次运行，就可以看到<code>Dog</code>已经喝到<code>Water</code>了。</p> <p>此外，需要注意，基于上面的代码，如果我们在<code>DaggerActivity</code>中新<code>@Inject</code>一份<code>Water</code>，那么这两份<code>Water</code>并不是同一个<code>Water</code>。那么，如何得到一个Singleton的<code>Water</code>呢，可以使用<code>@Singleton</code>注解，下面一节会提到。</p> <h2 id=3>3. 模型与单例<a class=headerlink href=#3 title="Permanent link">&para;</a></h2> <p>在上面两节中，我们需要注入的对象都是自己可以改动的，如果遇到第三方源码里的对象需要注入，那么怎么办。此时，我们可以使用<code>@Module</code>注解，搭配<code>@Provides</code>注解使用。</p> <p>我们拿<code>OkHttp</code>为例，顺便说下<code>@Singleton</code>注解的使用方法。</p> <p>首先实现<code>OkHttp</code>的提供者<code>@Provides</code>，而<code>@Provides</code>必须处于<code>@Module</code>修饰的类中，我们我们可以先写出下面的代码：</p> <div class=codehilite><pre><span></span><span class=n>@Module</span>
<span class=k>class</span> <span class=nc>OkHttpModule</span> <span class=p>{</span>
    <span class=n>@Provides</span>
    <span class=k>fun</span> <span class=nf>provideOkHttp</span><span class=p>()</span> <span class=p>=</span> <span class=n>OkHttpClient</span><span class=p>()</span>
<span class=p>}</span>
</pre></div> <p>这样我们就赋予了Dagger创建<code>OkHttp</code>的能力，接下来要把这个Module添加到<code>@Component</code>中：</p> <div class=codehilite><pre><span></span><span class=n>@Component</span><span class=p>(</span><span class=n>modules</span> <span class=p>=</span> <span class=p>[</span><span class=n>OkHttpModule</span><span class=o>::</span><span class=k>class</span><span class=p>])</span>
<span class=k>interface</span> <span class=nc>OkHttpComponent</span> <span class=p>{</span>
    <span class=k>fun</span> <span class=nf>inject</span><span class=p>(</span><span class=n>activity</span><span class=p>:</span> <span class=n>DaggerActivity</span><span class=p>)</span>
<span class=p>}</span>
</pre></div> <p>编译之后就能注入到<code>DaggerActivity</code>中了：</p> <div class=codehilite><pre><span></span><span class=k>class</span> <span class=nc>DaggerActivity</span> <span class=p>:</span> <span class=n>BaseActivity</span><span class=p>()</span> <span class=p>{</span>

    <span class=n>@Inject</span>
    <span class=k>lateinit</span> <span class=k>var</span> <span class=py>okHttpClient</span><span class=p>:</span> <span class=n>OkHttpClient</span>

    <span class=k>override</span> <span class=k>fun</span> <span class=nf>onCreate</span><span class=p>(</span><span class=n>savedInstanceState</span><span class=p>:</span> <span class=n>Bundle</span><span class=p>?)</span> <span class=p>{</span>
        <span class=k>super</span><span class=p>.</span><span class=n>onCreate</span><span class=p>(</span><span class=n>savedInstanceState</span><span class=p>)</span>
        <span class=p>...</span>
        <span class=n>DaggerOkHttpComponent</span><span class=p>.</span><span class=n>create</span><span class=p>().</span><span class=n>inject</span><span class=p>(</span><span class=k>this</span><span class=p>)</span>
    <span class=p>}</span>
<span class=p>}</span>
</pre></div> <p>另外，<code>OkHttpClient</code>和<code>Retrofit</code>都要单例实现，这样更高效。所以，我们改造一下，提供单例能力，只需要在<code>@Provides</code>和对应的<code>@Component</code>上添加<code>@Singleton</code>注解就可以了：</p> <div class=codehilite><pre><span></span><span class=n>@Module</span>
<span class=k>class</span> <span class=nc>OkHttpModule</span> <span class=p>{</span>
    <span class=n>@Singleton</span>
    <span class=n>@Provides</span>
    <span class=k>fun</span> <span class=nf>provideOkHttp</span><span class=p>()</span> <span class=p>=</span> <span class=n>OkHttpClient</span><span class=p>()</span>
<span class=p>}</span>

<span class=n>@Singleton</span>
<span class=n>@Component</span><span class=p>(</span><span class=n>modules</span> <span class=p>=</span> <span class=p>[</span><span class=n>OkHttpModule</span><span class=o>::</span><span class=k>class</span><span class=p>])</span>
<span class=k>interface</span> <span class=nc>OkHttpComponent</span> <span class=p>{</span>
    <span class=k>fun</span> <span class=nf>inject</span><span class=p>(</span><span class=n>activity</span><span class=p>:</span> <span class=n>DaggerActivity</span><span class=p>)</span>
<span class=p>}</span>
</pre></div> <p>怎么验证呢，我们可以在<code>DaggerActivity</code>中直接声明两个<code>OkHttpClient</code>，然后在注释掉<code>@Singleton</code>前后，打印其的<code>toString</code>方法返回的值，观察其hashcode的16进制表示是否相同即可。</p> <p>需要注意，只对同一次<code>Inject</code>有效。如果在Application中inject一次，然后在页面中inject一次，这两次还是会生成不同的对象。</p> <h2 id=4>4. 带参注入<a class=headerlink href=#4 title="Permanent link">&para;</a></h2> <p>接着第二节，我们谈到了狗喝水。但是狗有很多啊，让哪一只喝水呢？加一个年龄参数吧。</p> <p><code>Dog</code>就变成这样了。</p> <div class=codehilite><pre><span></span><span class=k>class</span> <span class=nc>Dog</span> <span class=n>@Inject</span> <span class=k>constructor</span><span class=p>(</span>
    <span class=k>private</span> <span class=k>val</span> <span class=py>age</span><span class=p>:</span> <span class=n>Int</span><span class=p>,</span>
    <span class=k>private</span> <span class=k>val</span> <span class=py>water</span><span class=p>:</span> <span class=n>Water</span>
<span class=p>)</span> <span class=p>{</span>
    <span class=k>fun</span> <span class=nf>drink</span><span class=p>()</span> <span class=p>=</span> <span class=s>&quot;$age years old dog wanna drink $water&quot;</span>
<span class=p>}</span>
</pre></div> <p>看这里两个参数，在前面可以知道，<code>water: Water</code>是已经可以被<code>@Inject</code>了的，剩下的<code>age: Int</code>怎么办。这是一个基本类型，没有任何可以直接<code>@Inject</code>的机会。<br> <strong>既然没有</strong><code>@Inject</code><strong>的机会，那么我们就</strong><code>@Provides</code><strong>嘛。只要能满足一个注解即可。</strong></p> <p>所以，我们创建一个带需要被Provides的参数<code>age</code>的类<code>DogModule</code>，然后将该参数<code>@Provides</code>出去，供下面的<code>@Provides</code>方法创建<code>Dog</code>使用：</p> <div class=codehilite><pre><span></span><span class=n>@Module</span>
<span class=k>class</span> <span class=nc>DogModule</span><span class=p>(</span>
    <span class=k>private</span> <span class=k>val</span> <span class=py>age</span><span class=p>:</span> <span class=n>Int</span>
<span class=p>)</span> <span class=p>{</span>
    <span class=n>@Provides</span>
    <span class=k>fun</span> <span class=nf>provideAge</span><span class=p>()</span> <span class=p>=</span> <span class=n>age</span>

    <span class=n>@Provides</span>
    <span class=k>fun</span> <span class=nf>provideDog</span><span class=p>(</span><span class=n>water</span><span class=p>:</span> <span class=n>Water</span><span class=p>)</span> <span class=p>=</span> <span class=n>Dog</span><span class=p>(</span><span class=n>age</span><span class=p>,</span> <span class=n>water</span><span class=p>)</span>
<span class=p>}</span>
</pre></div> <p>同第3节，这里的Module也需要加入到Component中：</p> <div class=codehilite><pre><span></span><span class=n>@Component</span><span class=p>(</span><span class=n>modules</span> <span class=p>=</span> <span class=p>[</span><span class=n>DogModule</span><span class=o>::</span><span class=k>class</span><span class=p>])</span>
<span class=k>interface</span> <span class=nc>DogComponent</span> <span class=p>{</span>
    <span class=k>fun</span> <span class=nf>inject</span><span class=p>(</span><span class=n>activity</span><span class=p>:</span> <span class=n>DaggerActivity</span><span class=p>)</span>
<span class=p>}</span>
</pre></div> <p>调用Dagger进行注入：</p> <div class=codehilite><pre><span></span><span class=n>DaggerDogComponent</span><span class=p>.</span><span class=n>builder</span><span class=p>().</span><span class=n>dogModule</span><span class=p>(</span><span class=n>DogModule</span><span class=p>(</span><span class=m>10</span><span class=p>)).</span><span class=n>build</span><span class=p>().</span><span class=n>inject</span><span class=p>(</span><span class=k>this</span><span class=p>)</span>
</pre></div> <p>这样就将参数10传入到<code>Dog</code>中。</p> <p>在第一节说道，Dagger是强类型的。如果没有inject到，会出现<code>@deprecated</code>的提示，建议此处将<code>DogComponent</code>中<code>inject</code>参数换成<code>AppCompatActivity</code>重新编译看看<code>dogModule</code>方法的提示。</p> <h2 id=5-module>5. 多Module注入<a class=headerlink href=#5-module title="Permanent link">&para;</a></h2> <p>目前为止，我们已经有两个Module了：<code>DogModule</code>以及<code>OkHttpModule</code>。 </p> <p>如果我们想在<code>DaggerActivity</code>中顺便使用OkHttp，那么我们可以在<code>DogComponent</code>的注解参数中将<code>OkHttpModule</code>加进入，这样在<code>DaggerActivity</code>中就可以<code>@Inject lateinit var okHttpClient: OkHttpClient</code>来注入了。下面是<code>DogComponent</code>的代码。</p> <div class=codehilite><pre><span></span><span class=n>@Component</span><span class=p>(</span><span class=n>modules</span> <span class=p>=</span> <span class=p>[</span><span class=n>DogModule</span><span class=o>::</span><span class=k>class</span><span class=p>,</span> <span class=n>OkHttpModule</span><span class=o>::</span><span class=k>class</span><span class=p>])</span>
<span class=k>interface</span> <span class=nc>DogComponent</span> <span class=p>{</span>
    <span class=k>fun</span> <span class=nf>inject</span><span class=p>(</span><span class=n>activity</span><span class=p>:</span> <span class=n>DaggerActivity</span><span class=p>)</span>
<span class=p>}</span>
</pre></div> <hr> <p>又或者，我们的<code>Dog</code>也想上网<code>OkHttpClient</code>，那么我们可以满足</p> <ul> <li>首先在<code>Dog</code>中加上对应的字段，同时在构造器中也新增该字段</li> <li>在<code>DogModule.provideDog</code>的参数和实现中加入该字段</li> <li>最后，在<code>DogComponent</code>的注解参数中将<code>OkHttpModule</code>加进入</li> </ul> <p>代码如下：</p> <div class=codehilite><pre><span></span><span class=k>class</span> <span class=nc>Dog</span> <span class=n>@Inject</span> <span class=k>constructor</span><span class=p>(</span>
    <span class=k>private</span> <span class=k>val</span> <span class=py>age</span><span class=p>:</span> <span class=n>Int</span><span class=p>,</span>
    <span class=k>private</span> <span class=k>val</span> <span class=py>water</span><span class=p>:</span> <span class=n>Water</span><span class=p>,</span>
    <span class=k>private</span> <span class=k>val</span> <span class=py>okHttpClient</span><span class=p>:</span> <span class=n>OkHttpClient</span>
<span class=p>)</span> <span class=p>{</span>
    <span class=k>fun</span> <span class=nf>drink</span><span class=p>()</span> <span class=p>=</span> <span class=s>&quot;$age years old dog wanna drink $water, $okHttpClient&quot;</span>
<span class=p>}</span>

<span class=k>class</span> <span class=nc>Water</span> <span class=n>@Inject</span> <span class=k>constructor</span><span class=p>()</span> <span class=p>{</span>
    <span class=k>override</span> <span class=k>fun</span> <span class=nf>toString</span><span class=p>()</span> <span class=p>=</span> <span class=s>&quot;water&quot;</span>
<span class=p>}</span>

<span class=n>@Module</span>
<span class=k>class</span> <span class=nc>DogModule</span><span class=p>(</span>
    <span class=k>private</span> <span class=k>val</span> <span class=py>age</span><span class=p>:</span> <span class=n>Int</span>
<span class=p>)</span> <span class=p>{</span>
    <span class=n>@Provides</span>
    <span class=k>fun</span> <span class=nf>provideAge</span><span class=p>()</span> <span class=p>=</span> <span class=n>age</span>

    <span class=n>@Provides</span>
    <span class=k>fun</span> <span class=nf>provideDog</span><span class=p>(</span><span class=n>water</span><span class=p>:</span> <span class=n>Water</span><span class=p>,</span> <span class=n>okHttpClient</span><span class=p>:</span> <span class=n>OkHttpClient</span><span class=p>)</span> <span class=p>=</span> <span class=n>Dog</span><span class=p>(</span><span class=n>age</span><span class=p>,</span> <span class=n>water</span><span class=p>,</span> <span class=n>okHttpClient</span><span class=p>)</span>
<span class=p>}</span>

<span class=n>@Module</span>
<span class=k>class</span> <span class=nc>OkHttpModule</span> <span class=p>{</span>
    <span class=n>@Provides</span>
    <span class=k>fun</span> <span class=nf>provideOkHttp</span><span class=p>()</span> <span class=p>=</span> <span class=n>OkHttpClient</span><span class=p>()</span>
<span class=p>}</span>

<span class=n>@Component</span><span class=p>(</span><span class=n>modules</span> <span class=p>=</span> <span class=p>[</span><span class=n>DogModule</span><span class=o>::</span><span class=k>class</span><span class=p>,</span> <span class=n>OkHttpModule</span><span class=o>::</span><span class=k>class</span><span class=p>])</span>
<span class=k>interface</span> <span class=nc>DogComponent</span> <span class=p>{</span>
    <span class=k>fun</span> <span class=nf>inject</span><span class=p>(</span><span class=n>activity</span><span class=p>:</span> <span class=n>DaggerActivity</span><span class=p>)</span>
<span class=p>}</span>
</pre></div> <p>使用的时候如下：</p> <div class=codehilite><pre><span></span><span class=n>DaggerDogComponent</span><span class=p>.</span><span class=n>builder</span><span class=p>()</span>
            <span class=p>.</span><span class=n>dogModule</span><span class=p>(</span><span class=n>DogModule</span><span class=p>(</span><span class=m>10</span><span class=p>))</span>
            <span class=p>.</span><span class=n>okHttpModule</span><span class=p>(</span><span class=n>OkHttpModule</span><span class=p>())</span>   <span class=c1>// 此行可以省略</span>
            <span class=p>.</span><span class=n>build</span><span class=p>()</span>
            <span class=p>.</span><span class=n>inject</span><span class=p>(</span><span class=k>this</span><span class=p>)</span>
</pre></div> <h2 id=6-namedqualifier>6. <a class="magiclink magiclink-github magiclink-mention" href=https://github.com/Named title="GitHub User: Named">@Named</a>、<a class="magiclink magiclink-github magiclink-mention" href=https://github.com/Qualifier title="GitHub User: Qualifier">@Qualifier</a><a class=headerlink href=#6-namedqualifier title="Permanent link">&para;</a></h2> <p>回到第4节之后，这时候我们可以让多大的<code>Dog</code>喝<code>Water</code>了；但可能有些<code>Dog</code>刚喝了什么，现在什么都不想喝。</p> <p>这时候我们可以使用<code>@Named</code>或者<code>@Qualifier</code>注解来让客户端选择注入想要的<code>Dog</code>。</p> <p><strong>首先说说<code>@Named</code>注解如何操作。</strong></p> <p>提前小改一下<code>Dog</code>类，当构造时不传参数，就认为不喝水了：</p> <div class=codehilite><pre><span></span><span class=k>class</span> <span class=nc>Dog</span> <span class=p>{</span>
    <span class=k>constructor</span><span class=p>()</span>

    <span class=k>constructor</span><span class=p>(</span><span class=n>age</span><span class=p>:</span> <span class=n>Int</span><span class=p>,</span> <span class=n>water</span><span class=p>:</span> <span class=n>Water</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>this</span><span class=p>.</span><span class=n>age</span> <span class=p>=</span> <span class=n>age</span>
        <span class=k>this</span><span class=p>.</span><span class=n>water</span> <span class=p>=</span> <span class=n>water</span>
    <span class=p>}</span>

    <span class=k>private</span> <span class=k>var</span> <span class=py>age</span><span class=p>:</span> <span class=n>Int</span><span class=p>?</span> <span class=p>=</span> <span class=k>null</span>
    <span class=k>private</span> <span class=k>var</span> <span class=py>water</span><span class=p>:</span> <span class=n>Water</span><span class=p>?</span> <span class=p>=</span> <span class=k>null</span>

    <span class=k>fun</span> <span class=nf>drink</span><span class=p>()</span> <span class=p>=</span> <span class=k>if</span> <span class=p>(</span><span class=n>age</span> <span class=p>!=</span> <span class=k>null</span><span class=p>)</span> <span class=s>&quot;$age years old dog wanna drink $water&quot;</span> <span class=k>else</span> <span class=s>&quot;no no no i don&#39;t wanna&quot;</span>
<span class=p>}</span>
</pre></div> <p>然后在<code>DogModule</code>中提供一个不需要喝水的<code>provideDogA</code>方法；同时为了区分客户端需要的<code>Dog</code>，需要在对应提供了创建<code>Dog</code>能力的方法上加上<code>@Named</code>注解：</p> <div class=codehilite><pre><span></span><span class=n>@Module</span>
<span class=k>class</span> <span class=nc>DogModule</span><span class=p>(</span>
    <span class=k>private</span> <span class=k>val</span> <span class=py>age</span><span class=p>:</span> <span class=n>Int</span>
<span class=p>){</span>
    <span class=n>@Provides</span>
    <span class=k>fun</span> <span class=nf>provideAge</span><span class=p>()</span> <span class=p>=</span> <span class=n>age</span>

    <span class=n>@Named</span><span class=p>(</span><span class=s>&quot;a&quot;</span><span class=p>)</span>
    <span class=n>@Provides</span>
    <span class=k>fun</span> <span class=nf>provideDog</span><span class=p>(</span><span class=n>water</span><span class=p>:</span> <span class=n>Water</span><span class=p>)</span> <span class=p>=</span> <span class=n>Dog</span><span class=p>(</span><span class=n>age</span><span class=p>,</span> <span class=n>water</span><span class=p>)</span>

    <span class=n>@Named</span><span class=p>(</span><span class=s>&quot;b&quot;</span><span class=p>)</span>
    <span class=n>@Provides</span>
    <span class=k>fun</span> <span class=nf>provideDogA</span><span class=p>()</span> <span class=p>=</span> <span class=n>Dog</span><span class=p>()</span>
<span class=p>}</span>
</pre></div> <p><strong>注意</strong>：并不是所有创建<code>Dog</code>的方法都需要加上<code>@Named</code>注解，没有注解的可以匹配上没有注解的。比如，在这里可以删掉<code>@Named("b")</code>注解，注入的客户端也不加<code>@Named("b")</code>注解，这样可以匹配上。<br> 同时，需要注意，在同一个<code>@Module</code>里面不能有同样函数名的<code>@Provides</code>，即使函数签名不一样，否则会报错：<em>error: Cannot have more than one <a class="magiclink magiclink-github magiclink-mention" href=https://github.com/Provides title="GitHub User: Provides">@Provides</a> method with the same name in a single module</em>。</p> <p>最后在客户端注入就行了：</p> <div class=codehilite><pre><span></span><span class=n>@Inject</span>
<span class=n>@field</span><span class=p>:</span><span class=n>Named</span><span class=p>(</span><span class=s>&quot;a&quot;</span><span class=p>)</span>
<span class=k>lateinit</span> <span class=k>var</span> <span class=py>dog</span><span class=p>:</span> <span class=n>Dog</span>

<span class=n>@Inject</span>
<span class=n>@field</span><span class=p>:</span><span class=n>Named</span><span class=p>(</span><span class=s>&quot;b&quot;</span><span class=p>)</span>
<span class=k>lateinit</span> <span class=k>var</span> <span class=py>dogA</span><span class=p>:</span> <span class=n>Dog</span>

<span class=k>override</span> <span class=k>fun</span> <span class=nf>onCreate</span><span class=p>(</span><span class=n>savedInstanceState</span><span class=p>:</span> <span class=n>Bundle</span><span class=p>?)</span> <span class=p>{</span>
    <span class=k>super</span><span class=p>.</span><span class=n>onCreate</span><span class=p>(</span><span class=n>savedInstanceState</span><span class=p>)</span>
    <span class=p>...</span>
    <span class=n>DaggerDogComponent</span><span class=p>.</span><span class=n>builder</span><span class=p>()</span>
        <span class=p>.</span><span class=n>dogModule</span><span class=p>(</span><span class=n>DogModule</span><span class=p>(</span><span class=m>24</span><span class=p>))</span>
        <span class=p>.</span><span class=n>build</span><span class=p>()</span>
        <span class=p>.</span><span class=n>inject</span><span class=p>(</span><span class=k>this</span><span class=p>)</span>
<span class=p>}</span>
</pre></div> <p><strong>注意</strong>：在客户端注入的时候，直接加上注解<code>@Named("b")</code>是不OK的，正确的写法是<code>@field:Named("b")</code>。作者在这里卡了很久，一直在某天晚上11点想起来了……</p> <p><strong>下面接着看@Qualifier注解</strong> </p> <p><code>@Named</code>注解里面的value得是一个<code>String</code>，虽然 <strong>可以传入静态字符串常量</strong> ，但还是感觉太Kotlin，不JAVA。</p> <p>所以这里看看<code>@Qualifier</code>的用法，首先我们需要使用该注解为两种不同的<code>Dog</code>编写两个不同的注解类：</p> <div class=codehilite><pre><span></span><span class=n>@Qualifier</span>
<span class=n>@Retention</span><span class=p>(</span><span class=n>AnnotationRetention</span><span class=p>.</span><span class=n>RUNTIME</span><span class=p>)</span>
<span class=k>annotation</span> <span class=k>class</span> <span class=nc>DrinkWaterDog</span>

<span class=n>@Qualifier</span>
<span class=n>@Retention</span><span class=p>(</span><span class=n>AnnotationRetention</span><span class=p>.</span><span class=n>RUNTIME</span><span class=p>)</span>
<span class=k>annotation</span> <span class=k>class</span> <span class=nc>DrinkNothingDog</span>
</pre></div> <p>然后使用上面的注解替换掉<code>DogModule</code>以及客户端里面的<code>@Named</code>注解：</p> <div class=codehilite><pre><span></span><span class=n>@Module</span>
<span class=k>class</span> <span class=nc>DogModule</span><span class=p>(</span>
    <span class=k>private</span> <span class=k>val</span> <span class=py>age</span><span class=p>:</span> <span class=n>Int</span>
<span class=p>){</span>
    <span class=n>@Provides</span>
    <span class=k>fun</span> <span class=nf>provideAge</span><span class=p>()</span> <span class=p>=</span> <span class=n>age</span>

    <span class=n>@Provides</span>
    <span class=n>@DrinkWaterDog</span>
    <span class=k>fun</span> <span class=nf>provideDog</span><span class=p>(</span><span class=n>water</span><span class=p>:</span> <span class=n>Water</span><span class=p>)</span> <span class=p>=</span> <span class=n>Dog</span><span class=p>(</span><span class=n>age</span><span class=p>,</span> <span class=n>water</span><span class=p>)</span>

    <span class=n>@Provides</span>
    <span class=n>@DrinkNothingDog</span>
    <span class=k>fun</span> <span class=nf>provideDogA</span><span class=p>()</span> <span class=p>=</span> <span class=n>Dog</span><span class=p>()</span>
<span class=p>}</span>

<span class=c1>// 客户端</span>
<span class=k>class</span> <span class=nc>DaggerActivity</span> <span class=p>:</span> <span class=n>BaseActivity</span><span class=p>()</span> <span class=p>{</span>

    <span class=n>@Inject</span>
    <span class=n>@field</span><span class=p>:</span><span class=n>DrinkWaterDog</span>
    <span class=k>lateinit</span> <span class=k>var</span> <span class=py>dog</span><span class=p>:</span> <span class=n>Dog</span>

    <span class=n>@Inject</span>
    <span class=n>@field</span><span class=p>:</span><span class=n>DrinkNothingDog</span>
    <span class=k>lateinit</span> <span class=k>var</span> <span class=py>dogA</span><span class=p>:</span> <span class=n>Dog</span>

    <span class=n>@SuppressLint</span><span class=p>(</span><span class=s>&quot;SetTextI18n&quot;</span><span class=p>)</span>
    <span class=k>override</span> <span class=k>fun</span> <span class=nf>onCreate</span><span class=p>(</span><span class=n>savedInstanceState</span><span class=p>:</span> <span class=n>Bundle</span><span class=p>?)</span> <span class=p>{</span>
        <span class=k>super</span><span class=p>.</span><span class=n>onCreate</span><span class=p>(</span><span class=n>savedInstanceState</span><span class=p>)</span>
        <span class=p>...</span>
        <span class=n>DaggerDogComponent</span><span class=p>.</span><span class=n>builder</span><span class=p>()</span>
            <span class=p>.</span><span class=n>dogModule</span><span class=p>(</span><span class=n>DogModule</span><span class=p>(</span><span class=m>24</span><span class=p>))</span>
            <span class=p>.</span><span class=n>build</span><span class=p>()</span>
            <span class=p>.</span><span class=n>inject</span><span class=p>(</span><span class=k>this</span><span class=p>)</span>
    <span class=p>}</span>
<span class=p>}</span>
</pre></div> <h2 id=7>7. 官网例子<a class=headerlink href=#7 title="Permanent link">&para;</a></h2> <p>官网例子是一个冲咖啡的小例子，先用<code>Heater</code>加热，然后<code>Pump</code>冲，最后就得到咖啡了：</p> <div class=codehilite><pre><span></span><span class=c1>// 1--Heater</span>
<span class=k>interface</span> <span class=nc>Heater</span> <span class=p>{</span>
    <span class=k>fun</span> <span class=nf>on</span><span class=p>()</span>
    <span class=k>fun</span> <span class=nf>off</span><span class=p>()</span>
    <span class=k>fun</span> <span class=nf>isHot</span><span class=p>():</span> <span class=n>Boolean</span>
<span class=p>}</span>

<span class=k>class</span> <span class=nc>ElectricHeater</span> <span class=p>:</span> <span class=n>Heater</span> <span class=p>{</span>

    <span class=k>private</span> <span class=k>var</span> <span class=py>heating</span> <span class=p>=</span> <span class=k>false</span>

    <span class=k>override</span> <span class=k>fun</span> <span class=nf>on</span><span class=p>()</span> <span class=p>{</span>
        <span class=n>println</span><span class=p>(</span><span class=s>&quot;~ ~ ~ heating ~ ~ ~&quot;</span><span class=p>)</span>
        <span class=n>heating</span> <span class=p>=</span> <span class=k>true</span>
    <span class=p>}</span>

    <span class=k>override</span> <span class=k>fun</span> <span class=nf>off</span><span class=p>()</span> <span class=p>{</span>
        <span class=n>heating</span> <span class=p>=</span> <span class=k>false</span>
    <span class=p>}</span>

    <span class=k>override</span> <span class=k>fun</span> <span class=nf>isHot</span><span class=p>()</span> <span class=p>=</span> <span class=n>heating</span>
<span class=p>}</span>

<span class=c1>// 2--Pump</span>
<span class=k>interface</span> <span class=nc>Pump</span> <span class=p>{</span>
    <span class=k>fun</span> <span class=nf>pump</span><span class=p>()</span>
<span class=p>}</span>

<span class=k>class</span> <span class=nc>Thermosiphon</span> <span class=n>@Inject</span> <span class=k>constructor</span><span class=p>(</span>
    <span class=k>private</span> <span class=k>val</span> <span class=py>heater</span><span class=p>:</span> <span class=n>Heater</span>
<span class=p>)</span> <span class=p>:</span> <span class=n>Pump</span> <span class=p>{</span>
    <span class=k>override</span> <span class=k>fun</span> <span class=nf>pump</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>heater</span><span class=p>.</span><span class=n>isHot</span><span class=p>())</span> <span class=p>{</span>
            <span class=n>println</span><span class=p>(</span><span class=s>&quot;=&gt; =&gt; pumping =&gt; =&gt;&quot;</span><span class=p>)</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>

<span class=c1>// 3--CoffeeMaker</span>
<span class=k>class</span> <span class=nc>CoffeeMaker</span> <span class=n>@Inject</span> <span class=k>constructor</span><span class=p>(</span>
    <span class=k>private</span> <span class=k>val</span> <span class=py>heater</span><span class=p>:</span> <span class=n>Lazy</span><span class=p>&lt;</span><span class=n>Heater</span><span class=p>&gt;,</span>
    <span class=k>private</span> <span class=k>val</span> <span class=py>pump</span><span class=p>:</span> <span class=n>Pump</span>
<span class=p>)</span> <span class=p>{</span>
    <span class=k>fun</span> <span class=nf>brew</span><span class=p>()</span> <span class=p>{</span>
        <span class=n>heater</span><span class=p>.</span><span class=k>get</span><span class=p>().</span><span class=n>on</span><span class=p>()</span>
        <span class=n>pump</span><span class=p>.</span><span class=n>pump</span><span class=p>()</span>
        <span class=n>println</span><span class=p>(</span><span class=s>&quot; [_]P coffee! [_]P &quot;</span><span class=p>)</span>
        <span class=n>heater</span><span class=p>.</span><span class=k>get</span><span class=p>().</span><span class=n>off</span><span class=p>()</span>
    <span class=p>}</span>
<span class=p>}</span>

<span class=c1>// 4--Module</span>
<span class=n>@Module</span>
<span class=k>abstract</span> <span class=k>class</span> <span class=nc>PumpModule</span> <span class=p>{</span>
    <span class=n>@Binds</span>
    <span class=k>abstract</span> <span class=k>fun</span> <span class=nf>providePump</span><span class=p>(</span><span class=n>pump</span><span class=p>:</span> <span class=n>Thermosiphon</span><span class=p>):</span> <span class=n>Pump</span>
<span class=p>}</span>

<span class=n>@Module</span><span class=p>(</span><span class=n>includes</span> <span class=p>=</span> <span class=p>[</span><span class=n>PumpModule</span><span class=o>::</span><span class=k>class</span><span class=p>])</span>
<span class=k>class</span> <span class=nc>DripCoffeeModule</span> <span class=p>{</span>
    <span class=n>@Provides</span>
    <span class=n>@Singleton</span>
    <span class=k>fun</span> <span class=nf>provideHeater</span><span class=p>():</span> <span class=n>Heater</span> <span class=p>=</span> <span class=n>ElectricHeater</span><span class=p>()</span>
<span class=p>}</span>

<span class=c1>// 5--Component</span>
<span class=n>@Singleton</span>
<span class=n>@Component</span><span class=p>(</span><span class=n>modules</span> <span class=p>=</span> <span class=p>[</span><span class=n>DripCoffeeModule</span><span class=o>::</span><span class=k>class</span><span class=p>])</span>
<span class=k>interface</span> <span class=nc>CoffeeShop</span> <span class=p>{</span>
    <span class=k>fun</span> <span class=nf>maker</span><span class=p>():</span> <span class=n>CoffeeMaker</span>
<span class=p>}</span>

<span class=c1>// main</span>
<span class=k>fun</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
    <span class=k>val</span> <span class=py>coffeeShop</span> <span class=p>=</span> <span class=n>DaggerCoffeeShop</span><span class=p>.</span><span class=n>builder</span><span class=p>().</span><span class=n>build</span><span class=p>()</span>
    <span class=n>coffeeShop</span><span class=p>.</span><span class=n>maker</span><span class=p>().</span><span class=n>brew</span><span class=p>()</span>
<span class=p>}</span>
</pre></div> <p>运行结果：</p> <div class=codehilite><pre><span></span><span class=p>~</span> <span class=p>~</span> <span class=p>~</span> <span class=n>heating</span> <span class=p>~</span> <span class=p>~</span> <span class=p>~</span>
<span class=p>=&gt;</span> <span class=p>=&gt;</span> <span class=n>pumping</span> <span class=p>=&gt;</span> <span class=p>=&gt;</span>
 <span class=p>[</span><span class=n>_</span><span class=p>]</span><span class=n>P</span> <span class=n>coffee</span><span class=p>!</span> <span class=p>[</span><span class=n>_</span><span class=p>]</span><span class=n>P</span> 
</pre></div> <p>我们分析下源码的运行流程中其中还涉及到<code>@Binds</code>注解和<code>Lazy</code>接口。</p> <p>首先1、2两个部分定义了<code>Heater</code>、<code>Pump</code>接口以及其实现类；第3部分<code>CoffeeMaker</code>利用上面两个接口实现了咖啡的制作逻辑。然后看main部分，这里调用了<code>DaggerCoffeeShop</code>获得了一个<code>CoffeeMaker</code>并开始了制作。所以关键在4、5部分。我们溯源一下。 </p> <p>首先看<code>CoffeeMaker</code>，其构造器被<code>@Inject</code>修饰了，所以这里面的<code>Heater</code>和<code>Pump</code>要不其构造器也是<code>@Inject</code>的，要不就是有<code>@Module</code>为其<code>@Provides</code>或者<code>@Binds</code>了。 </p> <p>先看看<code>Pump</code>的创建过程。<br> 在第4部分的<code>PumpModule</code>中提供了<code>Pump</code>，注意这里的语法：</p> <div class=codehilite><pre><span></span><span class=n>@Binds</span> <span class=k>abstract</span> <span class=k>fun</span> <span class=nf>providePump</span><span class=p>(</span><span class=n>pump</span><span class=p>:</span> <span class=n>Thermosiphon</span><span class=p>):</span> <span class=n>Pump</span>
</pre></div> <p>该方法是抽象类中的抽象方法，不像其他Module中的<code>@Provides</code>会给出创建过程，这里啥都没干，怎么创建了<code>Pump</code>对象了呢。<br> 关键肯定是<code>@Binds</code>，这里告诉Dagger使用<code>pump: Thermosiphon</code>来创建<code>Pump</code>。所以回过头来看一下<code>Thermosiphon</code>的构造器，果然被<code>@Inject</code>修饰了。</p> <p>这里<code>Pump</code>就被创建了。接着看<code>Heater</code>的创建。<br> 先看类的定义，<code>Heater</code>以及<code>ElectricHeater</code>都没有被<code>@Inject</code>，那么肯定是在<code>@Module</code>里面。接着看<code>DripCoffeeModule</code>，这里果然<code>@Provides</code>了一个<code>Heater</code>，还是个<code>ElectricHeater</code>。<br> 另外注意一下，该Module还<code>includes</code>个<code>PumpModule</code>，这样在<code>@Component</code>中就不需要再次包含<code>PumpModule</code>了。</p> <p>现在1、2、3里面的类都组织了起来，Dagger就能愉快的工作了。总结一下第5部分这个<code>@Component</code>的流程。<br> 首先在注解中指定了modules为<code>DripCoffeeModule</code>，而<code>DripCoffeeModule</code>又include了<code>PumpModule</code>，这样Component就能组织两个Module里面的<code>Heater</code>和<code>Pump</code>了。<br> 然后客户端调用<code>Dagger</code>构建<code>CoffeeMaker</code>，这类<code>@Inject</code>了两个参数：<code>Heater</code>、<code>Pump</code>，OK，都是满足的。这样，就能愉快的制作咖啡了。</p> <p>最后看一下<code>Lazy</code>接口的用法，很简单：声明的时候使用<code>Lazy&lt;T&gt;</code>进行声明；使用时调用其<code>get</code>方法即可。</p> <hr> <div class=md-source-date> <small> 最后更新: 2020年1月14日 </small> </div> <h2 id=__comments>评论</h2> <div id=disqus_thread></div> <script>
    var disqus_config = function () {
      this.page.url = "https://blog.yorek.xyz/about-me/android/other/dagger2/";
      this.page.identifier =
        "/android/other/dagger2/";
    };
    (function() {
      var d = document, s = d.createElement("script");
      s.src = "//yorekliu.disqus.com/embed.js";
      s.setAttribute("data-timestamp", +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid"> <a href=../constraintlayout/ title=ConstraintLayout使用大全 class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> 上一页 </span> ConstraintLayout使用大全 </span> </div> </a> <a href=../../paid/master/ title=Android开发高手课 class="md-flex md-footer-nav__link md-footer-nav__link--next" rel=next> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> 下一页 </span> Android开发高手课 </span> </div> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> &copy; 2020 Yorek </div> powered by <a href=https://www.mkdocs.org>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ > Material for MkDocs</a> </div> <div class=md-footer-social> <link rel=stylesheet href=../../../assets/fonts/font-awesome.css> <a href=https://github.com/YorekLiu class="md-footer-social__link fa fa-github"></a> <a href=lyytogether@gmail.com class="md-footer-social__link fa fa-email"></a> </div> </div> </div> </footer> </div> <script src=../../../assets/javascripts/application.808e90bb.js></script> <script src=../../../assets/javascripts/lunr/lunr.stemmer.support.js></script> <script src=../../../assets/javascripts/lunr/tinyseg.js></script> <script src=../../../assets/javascripts/lunr/lunr.ja.js></script> <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script> <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script> </body> </html>
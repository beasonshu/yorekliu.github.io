<!--
  Copyright (c) 2016-2020 Martin Donath <martin.donath@squidfunk.com>
  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:
  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.
  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
--> <!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=description content="An Android Developer."><link href=https://blog.yorek.xyz/about-me/android/paid/master/stuck_3/ rel=canonical><meta name=author content="Yorek Liu"><meta name=lang:clipboard.copy content=复制><meta name=lang:clipboard.copied content=已复制><meta name=lang:search.language content=ja><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content=没有找到符合条件的结果><meta name=lang:search.result.one content="找到 1 个符合条件的结果"><meta name=lang:search.result.other content="# 个符合条件的结果"><meta name=lang:search.tokenizer content=[\uff0c\u3002]+><link rel="shortcut icon" href=../../../../assets/images/favicon.ico><meta name=generator content="mkdocs-1.0.4, mkdocs-material-4.6.0"><title>06补充篇 | 卡顿优化：卡顿现场与卡顿分析</title><link rel=stylesheet href=../../../../assets/stylesheets/application.1b62728e.css><link rel=stylesheet href=../../../../assets/stylesheets/application-palette.a8b3c06d.css><meta name=theme-color content><script src=../../../../assets/javascripts/modernizr.268332fc.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel=stylesheet href=../../../../assets/fonts/material-icons.css><link rel=manifest href=../../../../manifest.webmanifest><script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-155096376-1", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script><script async src=https://www.google-analytics.com/analytics.js></script><!-- Determine title --><!-- The image needs to have an absolute URL --><!-- Open graph meta tags --><meta property=og:type content=website><meta property=og:title content="Yorek's - 06补充篇 | 卡顿优化：卡顿现场与卡顿分析"><meta property=og:description content="An Android Developer."><meta content=https://blog.yorek.xyz/about-me/android/paid/master/stuck_3/ property=og:url><meta property=og:image content=https://blog.yorek.xyz/about-meassets/images/banner.png><meta property=og:image:type content=image/png><meta property=og:image:width content=1200><meta property=og:image:height content=630><!-- Twitter meta tags --><meta name=twitter:card content=summary_large_image><meta name=twitter:site content=@squidfunk><meta name=twitter:creator content=@squidfunk><meta name=twitter:title content="Yorek's - 06补充篇 | 卡顿优化：卡顿现场与卡顿分析"><meta name=twitter:description content="An Android Developer."><meta name=twitter:image content=https://blog.yorek.xyz/about-meassets/images/banner.png></head> <body dir=ltr data-md-color-primary=white data-md-color-accent=blue> <svg class=md-svg> <defs> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#_1 tabindex=1 class=md-skip> 跳转至 </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=https://blog.yorek.xyz/about-me title="Yorek's" class="md-header-nav__button md-logo"> <img src=../../../../assets/images/favicon.ico width=24 height=24> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> Yorek's </span> <span class=md-header-nav__topic> 06补充篇 | 卡顿优化：卡顿现场与卡顿分析 </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> 键入以开始搜索 </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container> <nav class="md-tabs md-tabs--active" data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../../3rd-library/3rd-library-source-code/ class=md-tabs__link> Android </a> </li> <li class=md-tabs__item> <a href=../../../../flutter/flutter_first_project_1/ class=md-tabs__link> Flutter </a> </li> <li class=md-tabs__item> <a href=../../../../leetcode/ class=md-tabs__link> LeetCode </a> </li> <li class=md-tabs__item> <a href=../../../../design-pattern/design-pattern/ class=md-tabs__link> Books </a> </li> </ul> </div> </nav> <main class=md-main role=main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=https://blog.yorek.xyz/about-me title="Yorek's" class="md-nav__button md-logo"> <img src=../../../../assets/images/favicon.ico width=48 height=48> </a> Yorek's </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../.. title=Home class=md-nav__link> Home </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2 type=checkbox id=nav-2 checked> <label class=md-nav__link for=nav-2> Android </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-2> Android </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-1 type=checkbox id=nav-2-1> <label class=md-nav__link for=nav-2-1> 三方库源码解析 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-1> 三方库源码解析 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../3rd-library/3rd-library-source-code/ title=Android三方库源码分析 class=md-nav__link> Android三方库源码分析 </a> </li> <li class=md-nav__item> <a href=../../../3rd-library/matrix/ title="微信APM Matrix解析" class=md-nav__link> 微信APM Matrix解析 </a> </li> <li class=md-nav__item> <a href=../../../3rd-library/matrix-trace/ title=Matrix-TraceCanary解析 class=md-nav__link> Matrix-TraceCanary解析 </a> </li> <li class=md-nav__item> <a href=../../../3rd-library/matrix-io/ title=Matrix-IOCanary解析 class=md-nav__link> Matrix-IOCanary解析 </a> </li> <li class=md-nav__item> <a href=../../../3rd-library/matrix-resource/ title=Matrix-ResourceCanary解析 class=md-nav__link> Matrix-ResourceCanary解析 </a> </li> <li class=md-nav__item> <a href=../../../3rd-library/matrix-sqlitelint/ title=Matrix-SQLiteLint解析 class=md-nav__link> Matrix-SQLiteLint解析 </a> </li> <li class=md-nav__item> <a href=../../../3rd-library/okhttp/ title=OkHttp3源码解析 class=md-nav__link> OkHttp3源码解析 </a> </li> <li class=md-nav__item> <a href=../../../3rd-library/retrofit/ title=Retrofit2源码解析 class=md-nav__link> Retrofit2源码解析 </a> </li> <li class=md-nav__item> <a href=../../../3rd-library/rxjava&rxandroid/ title=RxJava源码解析及使用实例 class=md-nav__link> RxJava源码解析及使用实例 </a> </li> <li class=md-nav__item> <a href=../../../other/RxJava/ title=RxJava操作符大全 class=md-nav__link> RxJava操作符大全 </a> </li> <li class=md-nav__item> <a href=../../../3rd-library/glide1/ title="Glide v4 源码解析（一）" class=md-nav__link> Glide v4 源码解析（一） </a> </li> <li class=md-nav__item> <a href=../../../3rd-library/glide2/ title="Glide v4 源码解析（二）" class=md-nav__link> Glide v4 源码解析（二） </a> </li> <li class=md-nav__item> <a href=../../../3rd-library/glide3/ title="Glide v4 源码解析（三）" class=md-nav__link> Glide v4 源码解析（三） </a> </li> <li class=md-nav__item> <a href=../../../3rd-library/glide4/ title="Glide v4 源码解析（四）" class=md-nav__link> Glide v4 源码解析（四） </a> </li> <li class=md-nav__item> <a href=../../../3rd-library/glide5/ title="Glide v4 源码解析（五）" class=md-nav__link> Glide v4 源码解析（五） </a> </li> <li class=md-nav__item> <a href=../../../3rd-library/glide6/ title="Glide v4 源码解析（六）" class=md-nav__link> Glide v4 源码解析（六） </a> </li> <li class=md-nav__item> <a href=../../../3rd-library/glide7/ title="Glide v4 源码解析（七）" class=md-nav__link> Glide v4 源码解析（七） </a> </li> <li class=md-nav__item> <a href=../../../3rd-library/migrate-to-glide/ title=杂记：从Picasso迁移至Glide class=md-nav__link> 杂记：从Picasso迁移至Glide </a> </li> <li class=md-nav__item> <a href=../../../3rd-library/eventbus/ title=EventBus源码解析 class=md-nav__link> EventBus源码解析 </a> </li> <li class=md-nav__item> <a href=../../../3rd-library/leakcanary/ title=LeakCanary2源码解析 class=md-nav__link> LeakCanary2源码解析 </a> </li> <li class=md-nav__item> <a href=../../../3rd-library/permissiondispatcher/ title=PermissionDispatcher源码解析 class=md-nav__link> PermissionDispatcher源码解析 </a> </li> <li class=md-nav__item> <a href=../../../other/constraintlayout/ title=ConstraintLayout使用大全 class=md-nav__link> ConstraintLayout使用大全 </a> </li> <li class=md-nav__item> <a href=../../../other/dagger2/ title=初学者的Dagger2教程 class=md-nav__link> 初学者的Dagger2教程 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-2 type=checkbox id=nav-2-2 checked> <label class=md-nav__link for=nav-2-2> Android开发高手课 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-2> Android开发高手课 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ title=Android开发高手课 class=md-nav__link> Android开发高手课 </a> </li> <li class=md-nav__item> <a href=../crash_1/ title="01 | 崩溃优化（上）：关于“崩溃”那些事儿" class=md-nav__link> 01 | 崩溃优化（上）：关于“崩溃”那些事儿 </a> </li> <li class=md-nav__item> <a href=../crash_2/ title="02 | 崩溃优化（下）：应用崩溃了，你应该如何去分析？" class=md-nav__link> 02 | 崩溃优化（下）：应用崩溃了，你应该如何去分析？ </a> </li> <li class=md-nav__item> <a href=../memory_1/ title="03 | 内存优化（上）：4GB内存时代，再谈内存优化" class=md-nav__link> 03 | 内存优化（上）：4GB内存时代，再谈内存优化 </a> </li> <li class=md-nav__item> <a href=../memory_2/ title="04 | 内存优化（下）：内存优化这件事，应该从哪里着手？" class=md-nav__link> 04 | 内存优化（下）：内存优化这件事，应该从哪里着手？ </a> </li> <li class=md-nav__item> <a href=../stuck_1/ title="05 | 卡顿优化（上）：你要掌握的卡顿分析方法" class=md-nav__link> 05 | 卡顿优化（上）：你要掌握的卡顿分析方法 </a> </li> <li class=md-nav__item> <a href=../stuck_2/ title="06 | 卡顿优化（下）：如何监控应用卡顿？" class=md-nav__link> 06 | 卡顿优化（下）：如何监控应用卡顿？ </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-toggle md-nav__toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> 06补充篇 | 卡顿优化：卡顿现场与卡顿分析 </label> <a href=./ title="06补充篇 | 卡顿优化：卡顿现场与卡顿分析" class="md-nav__link md-nav__link--active"> 06补充篇 | 卡顿优化：卡顿现场与卡顿分析 </a> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>目录</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#_1 class=md-nav__link> 卡顿现场 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-java class=md-nav__link> 1. Java 实现 </a> </li> <li class=md-nav__item> <a href=#2-sigquit class=md-nav__link> 2. SIGQUIT 信号实现 </a> </li> <li class=md-nav__item> <a href=#3-hook class=md-nav__link> 3. Hook 实现 </a> </li> <li class=md-nav__item> <a href=#4 class=md-nav__link> 4. 现场信息 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 卡顿分析 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1 class=md-nav__link> 1. 卡顿率 </a> </li> <li class=md-nav__item> <a href=#2 class=md-nav__link> 2. 卡顿树 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> 总结 </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> 课后作业 </a> </li> <li class=md-nav__item> <a href=#__comments class="md-nav__link md-nav__link--active"> 评论 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../start_1/ title="07 | 启动优化（上）：从启动过程看启动速度优化" class=md-nav__link> 07 | 启动优化（上）：从启动过程看启动速度优化 </a> </li> <li class=md-nav__item> <a href=../start_2/ title="08 | 启动优化（下）：优化启动速度的进阶方法" class=md-nav__link> 08 | 启动优化（下）：优化启动速度的进阶方法 </a> </li> <li class=md-nav__item> <a href=../io_1/ title="09 | I/O优化（上）：开发工程师必备的I/O优化知识" class=md-nav__link> 09 | I/O优化（上）：开发工程师必备的I/O优化知识 </a> </li> <li class=md-nav__item> <a href=../io_2/ title="10 | I/O优化（中）：不同I/O方式的使用场景是什么？" class=md-nav__link> 10 | I/O优化（中）：不同I/O方式的使用场景是什么？ </a> </li> <li class=md-nav__item> <a href=../io_3/ title="11 | I/O优化（下）：如何监控线上I/O操作？" class=md-nav__link> 11 | I/O优化（下）：如何监控线上I/O操作？ </a> </li> <li class=md-nav__item> <a href=../storage_1/ title="12 | 存储优化（上）：常见的数据存储方法有哪些？" class=md-nav__link> 12 | 存储优化（上）：常见的数据存储方法有哪些？ </a> </li> <li class=md-nav__item> <a href=../storage_2/ title="13 | 存储优化（中）：如何优化数据存储？" class=md-nav__link> 13 | 存储优化（中）：如何优化数据存储？ </a> </li> <li class=md-nav__item> <a href=../storage_3/ title="14 | 存储优化（下）：数据库SQLite的使用和优化" class=md-nav__link> 14 | 存储优化（下）：数据库SQLite的使用和优化 </a> </li> <li class=md-nav__item> <a href=../network_1/ title="15 | 网络优化（上）：移动开发工程师必备的网络优化知识" class=md-nav__link> 15 | 网络优化（上）：移动开发工程师必备的网络优化知识 </a> </li> <li class=md-nav__item> <a href=../network_2/ title="16 | 网络优化（中）：复杂多变的移动网络该如何优化？" class=md-nav__link> 16 | 网络优化（中）：复杂多变的移动网络该如何优化？ </a> </li> <li class=md-nav__item> <a href=../network_3/ title="17 | 网络优化（下）：大数据下网络该如何监控？" class=md-nav__link> 17 | 网络优化（下）：大数据下网络该如何监控？ </a> </li> <li class=md-nav__item> <a href=../battery_1/ title="18 | 耗电优化（上）：从电量优化的演进看耗电分析" class=md-nav__link> 18 | 耗电优化（上）：从电量优化的演进看耗电分析 </a> </li> <li class=md-nav__item> <a href=../battery_2/ title="19 | 耗电优化（下）：耗电的优化方法与线上监控" class=md-nav__link> 19 | 耗电优化（下）：耗电的优化方法与线上监控 </a> </li> <li class=md-nav__item> <a href=../ui_1/ title="20 | UI 优化（上）：UI 渲染的几个关键概念" class=md-nav__link> 20 | UI 优化（上）：UI 渲染的几个关键概念 </a> </li> <li class=md-nav__item> <a href=../ui_2/ title="21 | UI 优化（下）：如何优化 UI 渲染？" class=md-nav__link> 21 | UI 优化（下）：如何优化 UI 渲染？ </a> </li> <li class=md-nav__item> <a href=../package_1/ title="22 | 包体积优化（上）：如何减少安装包大小？" class=md-nav__link> 22 | 包体积优化（上）：如何减少安装包大小？ </a> </li> <li class=md-nav__item> <a href=../package_2/ title="23 | 包体积优化（下）：资源优化的进阶实践" class=md-nav__link> 23 | 包体积优化（下）：资源优化的进阶实践 </a> </li> <li class=md-nav__item> <a href=../compile/ title="26 | 关于编译，你需要了解什么？" class=md-nav__link> 26 | 关于编译，你需要了解什么？ </a> </li> <li class=md-nav__item> <a href=../bytecode/ title="27 | 编译插桩的三种方法：AspectJ、ASM、ReDex" class=md-nav__link> 27 | 编译插桩的三种方法：AspectJ、ASM、ReDex </a> </li> <li class=md-nav__item> <a href=../native_hook/ title="35 | Native Hook 技术，天使还是魔鬼？" class=md-nav__link> 35 | Native Hook 技术，天使还是魔鬼？ </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-3 type=checkbox id=nav-2-3> <label class=md-nav__link for=nav-2-3> Framework系列 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-3> Framework系列 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../framework/Android四大组件(1)/ title=Activity class=md-nav__link> Activity </a> </li> <li class=md-nav__item> <a href=../../../framework/Android四大组件(2)/ title=Service class=md-nav__link> Service </a> </li> <li class=md-nav__item> <a href=../../../framework/Android四大组件(3)/ title=Broadcasts class=md-nav__link> Broadcasts </a> </li> <li class=md-nav__item> <a href=../../../framework/Android四大组件(4)/ title="Content Providers与Fragment" class=md-nav__link> Content Providers与Fragment </a> </li> <li class=md-nav__item> <a href=../../../framework/IPC机制/ title=IPC机制 class=md-nav__link> IPC机制 </a> </li> <li class=md-nav__item> <a href=../../../framework/View的事件体系/ title=View的事件体系 class=md-nav__link> View的事件体系 </a> </li> <li class=md-nav__item> <a href=../../../framework/View的绘制原理/ title=View的绘制原理 class=md-nav__link> View的绘制原理 </a> </li> <li class=md-nav__item> <a href=../../../framework/RemoteViews/ title=RemoteViews class=md-nav__link> RemoteViews </a> </li> <li class=md-nav__item> <a href=../../../framework/Drawable/ title=Android中的Drawable资源 class=md-nav__link> Android中的Drawable资源 </a> </li> <li class=md-nav__item> <a href=../../../framework/Android动画/ title=Android动画 class=md-nav__link> Android动画 </a> </li> <li class=md-nav__item> <a href=../../../framework/Window与WindowManager/ title=Window与WindowManager class=md-nav__link> Window与WindowManager </a> </li> <li class=md-nav__item> <a href=../../../framework/四大组件启动过程/ title=四大组件启动过程 class=md-nav__link> 四大组件启动过程 </a> </li> <li class=md-nav__item> <a href=../../../framework/Android消息机制/ title=Android消息机制 class=md-nav__link> Android消息机制 </a> </li> <li class=md-nav__item> <a href=../../../framework/Android线程与线程池/ title=Android线程与线程池 class=md-nav__link> Android线程与线程池 </a> </li> <li class=md-nav__item> <a href=../../../framework/Bitmap的缓存与加载/ title=Bitmap的缓存与加载 class=md-nav__link> Bitmap的缓存与加载 </a> </li> <li class=md-nav__item> <a href=../../../framework/JNI与NDK/ title=JNI与NDK编程简介 class=md-nav__link> JNI与NDK编程简介 </a> </li> <li class=md-nav__item> <a href=../../../framework/性能优化/ title=Android性能优化 class=md-nav__link> Android性能优化 </a> </li> <li class=md-nav__item> <a href=../../../framework/binder1-mediaservice/ title=Binder深入理解——以MediaService为例 class=md-nav__link> Binder深入理解——以MediaService为例 </a> </li> <li class=md-nav__item> <a href=../../../framework/binder2/ title=Binder深入理解——罗老师系列 class=md-nav__link> Binder深入理解——罗老师系列 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-4 type=checkbox id=nav-2-4> <label class=md-nav__link for=nav-2-4> 付费知识归档 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-4> 付费知识归档 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-4-1 type=checkbox id=nav-2-4-1> <label class=md-nav__link for=nav-2-4-1> 某圈问题索引 </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-2-4-1> 某圈问题索引 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../zsxq/zsxq_index/ title=某圈问题索引 class=md-nav__link> 某圈问题索引 </a> </li> <li class=md-nav__item> <a href=../../zsxq/week1-synchronized/ title=理解Java中synchronized关键词 class=md-nav__link> 理解Java中synchronized关键词 </a> </li> <li class=md-nav__item> <a href=../../zsxq/week2-service/ title=理解Service class=md-nav__link> 理解Service </a> </li> <li class=md-nav__item> <a href=../../zsxq/week3-activity/ title=理解Activity的启动模式 class=md-nav__link> 理解Activity的启动模式 </a> </li> <li class=md-nav__item> <a href=../../zsxq/week4-startActivityForResult/ title=关于startActivityForResult class=md-nav__link> 关于startActivityForResult </a> </li> <li class=md-nav__item> <a href=../../zsxq/week5-view/ title=关于View的知识 class=md-nav__link> 关于View的知识 </a> </li> <li class=md-nav__item> <a href=../../zsxq/week6-gradle/ title=关于Gradle的知识 class=md-nav__link> 关于Gradle的知识 </a> </li> <li class=md-nav__item> <a href=../../zsxq/week7-serialization/ title=关于序列化的知识 class=md-nav__link> 关于序列化的知识 </a> </li> <li class=md-nav__item> <a href=../../zsxq/week10-classloader/ title=Android中的ClassLoader class=md-nav__link> Android中的ClassLoader </a> </li> <li class=md-nav__item> <a href=../../zsxq/week11-binder/ title=Binder简介 class=md-nav__link> Binder简介 </a> </li> <li class=md-nav__item> <a href=../../zsxq/week12-retrofit-okhttp/ title=OkHttp和Retrofit的作用以及两者之间的联系 class=md-nav__link> OkHttp和Retrofit的作用以及两者之间的联系 </a> </li> <li class=md-nav__item> <a href=../../zsxq/week14-jvm-gc/ title=JVM中垃圾回收策略 class=md-nav__link> JVM中垃圾回收策略 </a> </li> <li class=md-nav__item> <a href=../../zsxq/week16-keep-app-alive/ title=进程保活 class=md-nav__link> 进程保活 </a> </li> <li class=md-nav__item> <a href=../../zsxq/week17-android-components/ title=四大组件的作用以及多进程 class=md-nav__link> 四大组件的作用以及多进程 </a> </li> <li class=md-nav__item> <a href=../../zsxq/week20-network-protocol/ title=网络协议 class=md-nav__link> 网络协议 </a> </li> <li class=md-nav__item> <a href=../../zsxq/week21-mvc&amp;mvp&mvvm/ title=MVC、MVP和MVVM class=md-nav__link> MVC、MVP和MVVM </a> </li> <li class=md-nav__item> <a href=../../zsxq/week22-android-studio-build/ title="Android Studio build过程" class=md-nav__link> Android Studio build过程 </a> </li> <li class=md-nav__item> <a href=../../zsxq/week23-load-large-bitmap/ title=大尺寸图片加载问题 class=md-nav__link> 大尺寸图片加载问题 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-5 type=checkbox id=nav-2-5> <label class=md-nav__link for=nav-2-5> 日常记录 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-5> 日常记录 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../other/annotation/ title=注解的定义及解析 class=md-nav__link> 注解的定义及解析 </a> </li> <li class=md-nav__item> <a href=../../../other/best_throttle_in_mvvm/ title=这可能是MVVM中最优雅的按键防抖方案 class=md-nav__link> 这可能是MVVM中最优雅的按键防抖方案 </a> </li> <li class=md-nav__item> <a href=../../../other/android-jenkins/ title="Jenkins for android" class=md-nav__link> Jenkins for android </a> </li> <li class=md-nav__item> <a href=../../../other/SystemProrities/ title=普通Android程序使用SystemProrities class=md-nav__link> 普通Android程序使用SystemProrities </a> </li> <li class=md-nav__item> <a href=../../../other/recyclerview-cache/ title=ListView、RecyclerView缓存策略解析 class=md-nav__link> ListView、RecyclerView缓存策略解析 </a> </li> <li class=md-nav__item> <a href=../../../other/recyclerview-item-docoration/ title=RecyclerView高级特性——ItemDecoration class=md-nav__link> RecyclerView高级特性——ItemDecoration </a> </li> <li class=md-nav__item> <a href=../../../other/recyclerview-others/ title=RecyclerView的一些使用细节 class=md-nav__link> RecyclerView的一些使用细节 </a> </li> <li class=md-nav__item> <a href=../../../other/RecyclerView-Sort&Delete/ title=RecyclerView高级特性——拖拽排序以及滑动删除 class=md-nav__link> RecyclerView高级特性——拖拽排序以及滑动删除 </a> </li> <li class=md-nav__item> <a href=../../../other/FAB-Behavior/ title=FloatingActionButton上滑隐藏下滑显示 class=md-nav__link> FloatingActionButton上滑隐藏下滑显示 </a> </li> <li class=md-nav__item> <a href=../../../other/nestedscrolling/ title=NestedScrolling机制 class=md-nav__link> NestedScrolling机制 </a> </li> <li class=md-nav__item> <a href=../../../other/porterduff/ title=使用Porter-Duff合成数字图像 class=md-nav__link> 使用Porter-Duff合成数字图像 </a> </li> <li class=md-nav__item> <a href=../../../other/runtime/ title="Android Runtime" class=md-nav__link> Android Runtime </a> </li> <li class=md-nav__item> <a href=../../../other/android_alias/ title=Android马甲包的那些事儿 class=md-nav__link> Android马甲包的那些事儿 </a> </li> <li class=md-nav__item> <a href=../../../other/Android-Development-Tool/ title=Android神兵利器 class=md-nav__link> Android神兵利器 </a> </li> <li class=md-nav__item> <a href=../../../other/FileProvider/ title=FileProvider class=md-nav__link> FileProvider </a> </li> <li class=md-nav__item> <a href=../../../other/Android判断导航栏高度/ title=Android判断虚拟按键(导航栏)显示与否、高度以及获取屏幕实际高度 class=md-nav__link> Android判断虚拟按键(导航栏)显示与否、高度以及获取屏幕实际高度 </a> </li> <li class=md-nav__item> <a href=../../../other/Android图片选择器/ title=Android图片选择器 class=md-nav__link> Android图片选择器 </a> </li> <li class=md-nav__item> <a href=../../../other/Android底部导航栏框架/ title=Android原生底部导航栏 class=md-nav__link> Android原生底部导航栏 </a> </li> <li class=md-nav__item> <a href=../../../other/Android搜索栏的实现/ title=Android搜索栏的实现 class=md-nav__link> Android搜索栏的实现 </a> </li> <li class=md-nav__item> <a href=../../../other/Android暂停音乐播放器的播放/ title=Android暂停酷狗、网易云音乐等音乐播放器的播放 class=md-nav__link> Android暂停酷狗、网易云音乐等音乐播放器的播放 </a> </li> <li class=md-nav__item> <a href=../../../other/Android滑动返回实践/ title=Android滑动返回实践 class=md-nav__link> Android滑动返回实践 </a> </li> <li class=md-nav__item> <a href=../../../other/Android程序反编译/ title=MacOS下Android程序反编译 class=md-nav__link> MacOS下Android程序反编译 </a> </li> <li class=md-nav__item> <a href=../../../other/Android通讯录快速读取/ title=Android通讯录快速读取 class=md-nav__link> Android通讯录快速读取 </a> </li> <li class=md-nav__item> <a href=../../../other/soft-keyboard-in-app/ title=App内自定义软键盘 class=md-nav__link> App内自定义软键盘 </a> </li> <li class=md-nav__item> <a href=../../../other/腾讯X5内核入坑指南/ title="腾讯TBS X5浏览器内核入坑指南" class=md-nav__link> 腾讯TBS X5浏览器内核入坑指南 </a> </li> <li class=md-nav__item> <a href=../../../other/琐碎知识点/ title=琐碎知识点 class=md-nav__link> 琐碎知识点 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3 type=checkbox id=nav-3> <label class=md-nav__link for=nav-3> Flutter </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-3> Flutter </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../flutter/flutter_first_project_1/ title=年轻人的第一个Flutter程序(1) class=md-nav__link> 年轻人的第一个Flutter程序(1) </a> </li> <li class=md-nav__item> <a href=../../../../flutter/flutter_first_project_2/ title=年轻人的第一个Flutter程序(2) class=md-nav__link> 年轻人的第一个Flutter程序(2) </a> </li> <li class=md-nav__item> <a href=../../../../flutter/flutter_first_project_3/ title=年轻人的第一个Flutter程序(3) class=md-nav__link> 年轻人的第一个Flutter程序(3) </a> </li> <li class=md-nav__item> <a href=../../../../flutter/flutter_first_project_4/ title=年轻人的第一个Flutter程序(4) class=md-nav__link> 年轻人的第一个Flutter程序(4) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4 type=checkbox id=nav-4> <label class=md-nav__link for=nav-4> LeetCode </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-4> LeetCode </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../leetcode/ title=算法目录 class=md-nav__link> 算法目录 </a> </li> <li class=md-nav__item> <a href=../../../../leetcode/code_interviews_1/ title=数据结构、算法和数据操作 class=md-nav__link> 数据结构、算法和数据操作 </a> </li> <li class=md-nav__item> <a href=../../../../leetcode/code_interviews_3/ title=高质量的代码 class=md-nav__link> 高质量的代码 </a> </li> <li class=md-nav__item> <a href=../../../../leetcode/code_interviews_4/ title=解决问题的思路 class=md-nav__link> 解决问题的思路 </a> </li> <li class=md-nav__item> <a href=../../../../leetcode/code_interviews_5/ title=优化时间和空间效率 class=md-nav__link> 优化时间和空间效率 </a> </li> <li class=md-nav__item> <a href=../../../../leetcode/code_interviews_6/ title=面试中的各项能力 class=md-nav__link> 面试中的各项能力 </a> </li> <li class=md-nav__item> <a href=../../../../leetcode/array/ title=Array class=md-nav__link> Array </a> </li> <li class=md-nav__item> <a href=../../../../leetcode/leetcode1-10/ title=LeetCode(1-10) class=md-nav__link> LeetCode(1-10) </a> </li> <li class=md-nav__item> <a href=../../../../leetcode/leetcode11-20/ title=LeetCode(11-20) class=md-nav__link> LeetCode(11-20) </a> </li> <li class=md-nav__item> <a href=../../../../leetcode/leetcode21-30/ title=LeetCode(21-30) class=md-nav__link> LeetCode(21-30) </a> </li> <li class=md-nav__item> <a href=../../../../leetcode/leetcode31-40/ title=LeetCode(31-40) class=md-nav__link> LeetCode(31-40) </a> </li> <li class=md-nav__item> <a href=../../../../leetcode/leetcode41-50/ title=LeetCode(41-50) class=md-nav__link> LeetCode(41-50) </a> </li> <li class=md-nav__item> <a href=../../../../leetcode/leetcode51-60/ title=LeetCode(51-60) class=md-nav__link> LeetCode(51-60) </a> </li> <li class=md-nav__item> <a href=../../../../leetcode/leetcode61-70/ title=LeetCode(61-70) class=md-nav__link> LeetCode(61-70) </a> </li> <li class=md-nav__item> <a href=../../../../leetcode/leetcode71-80/ title=LeetCode(71-80) class=md-nav__link> LeetCode(71-80) </a> </li> <li class=md-nav__item> <a href=../../../../leetcode/leetcode81-90/ title=LeetCode(81-90) class=md-nav__link> LeetCode(81-90) </a> </li> <li class=md-nav__item> <a href=../../../../leetcode/leetcode91-100/ title=LeetCode(91-100) class=md-nav__link> LeetCode(91-100) </a> </li> <li class=md-nav__item> <a href=../../../../leetcode/leetcode101-110/ title=LeetCode(101-110) class=md-nav__link> LeetCode(101-110) </a> </li> <li class=md-nav__item> <a href=../../../../leetcode/leetcode111-120/ title=LeetCode(111-120) class=md-nav__link> LeetCode(111-120) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5 type=checkbox id=nav-5> <label class=md-nav__link for=nav-5> Books </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-5> Books </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-1 type=checkbox id=nav-5-1> <label class=md-nav__link for=nav-5-1> Design Pattern </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-1> Design Pattern </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../design-pattern/design-pattern/ title=设计模式概述 class=md-nav__link> 设计模式概述 </a> </li> <li class=md-nav__item> <a href=../../../../design-pattern/design-principle/ title=面向对象的六大原则 class=md-nav__link> 面向对象的六大原则 </a> </li> <li class=md-nav__item> <a href=../../../../design-pattern/singleton/ title=单例模式(Singleton) class=md-nav__link> 单例模式(Singleton) </a> </li> <li class=md-nav__item> <a href=../../../../design-pattern/builder/ title=建造者模式(Builder) class=md-nav__link> 建造者模式(Builder) </a> </li> <li class=md-nav__item> <a href=../../../../design-pattern/prototype/ title=原型模式(Prototype) class=md-nav__link> 原型模式(Prototype) </a> </li> <li class=md-nav__item> <a href=../../../../design-pattern/factory-method/ title="工厂方法模式(Factory method)" class=md-nav__link> 工厂方法模式(Factory method) </a> </li> <li class=md-nav__item> <a href=../../../../design-pattern/abstract-factory/ title="抽象工厂模式(Abstract factory)" class=md-nav__link> 抽象工厂模式(Abstract factory) </a> </li> <li class=md-nav__item> <a href=../../../../design-pattern/proxy/ title=代理模式(Proxy) class=md-nav__link> 代理模式(Proxy) </a> </li> <li class=md-nav__item> <a href=../../../../design-pattern/composite/ title=组合模式(Composite) class=md-nav__link> 组合模式(Composite) </a> </li> <li class=md-nav__item> <a href=../../../../design-pattern/adapter/ title=适配器模式(Adapter) class=md-nav__link> 适配器模式(Adapter) </a> </li> <li class=md-nav__item> <a href=../../../../design-pattern/decorator/ title=装饰模式(Decorator) class=md-nav__link> 装饰模式(Decorator) </a> </li> <li class=md-nav__item> <a href=../../../../design-pattern/flyweight/ title=享元模式(Flyweight) class=md-nav__link> 享元模式(Flyweight) </a> </li> <li class=md-nav__item> <a href=../../../../design-pattern/facade/ title=外观模式(Facade) class=md-nav__link> 外观模式(Facade) </a> </li> <li class=md-nav__item> <a href=../../../../design-pattern/bridge/ title=桥接模式(Bridge) class=md-nav__link> 桥接模式(Bridge) </a> </li> <li class=md-nav__item> <a href=../../../../design-pattern/strategy/ title=策略模式(Strategy) class=md-nav__link> 策略模式(Strategy) </a> </li> <li class=md-nav__item> <a href=../../../../design-pattern/state/ title=状态模式(State) class=md-nav__link> 状态模式(State) </a> </li> <li class=md-nav__item> <a href=../../../../design-pattern/chain-of-responsibility/ title="责任链模式(Chain of responsibility)" class=md-nav__link> 责任链模式(Chain of responsibility) </a> </li> <li class=md-nav__item> <a href=../../../../design-pattern/interpreter/ title=解释器模式(Interpreter) class=md-nav__link> 解释器模式(Interpreter) </a> </li> <li class=md-nav__item> <a href=../../../../design-pattern/command/ title=命令模式(Command) class=md-nav__link> 命令模式(Command) </a> </li> <li class=md-nav__item> <a href=../../../../design-pattern/observer/ title=观察者模式(Observer) class=md-nav__link> 观察者模式(Observer) </a> </li> <li class=md-nav__item> <a href=../../../../design-pattern/memento/ title=备忘录模式(Memento) class=md-nav__link> 备忘录模式(Memento) </a> </li> <li class=md-nav__item> <a href=../../../../design-pattern/iterator/ title=迭代器模式(Iterator) class=md-nav__link> 迭代器模式(Iterator) </a> </li> <li class=md-nav__item> <a href=../../../../design-pattern/template-method/ title="模版方法模式(Template method)" class=md-nav__link> 模版方法模式(Template method) </a> </li> <li class=md-nav__item> <a href=../../../../design-pattern/visitor/ title=访问者模式(Visitor) class=md-nav__link> 访问者模式(Visitor) </a> </li> <li class=md-nav__item> <a href=../../../../design-pattern/mediator/ title=中介者模式(Mediator) class=md-nav__link> 中介者模式(Mediator) </a> </li> <li class=md-nav__item> <a href=../../../../design-pattern/confusing-design-pattern/ title=易混淆的设计模式 class=md-nav__link> 易混淆的设计模式 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2 type=checkbox id=nav-5-2> <label class=md-nav__link for=nav-5-2> Effective Java </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-2> Effective Java </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../effective-java/effective-java/ title="Effective Java概述" class=md-nav__link> Effective Java概述 </a> </li> <li class=md-nav__item> <a href=../../../../effective-java/chapter1/ title=创建和销毁对象 class=md-nav__link> 创建和销毁对象 </a> </li> <li class=md-nav__item> <a href=../../../../effective-java/chapter2/ title=对于所有对象都通用的方法 class=md-nav__link> 对于所有对象都通用的方法 </a> </li> <li class=md-nav__item> <a href=../../../../effective-java/chapter3/ title=类和接口 class=md-nav__link> 类和接口 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-3 type=checkbox id=nav-5-3> <label class=md-nav__link for=nav-5-3> JVM </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-3> JVM </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../jvm/jvm-content/ title=深入理解Java虚拟机 class=md-nav__link> 深入理解Java虚拟机 </a> </li> <li class=md-nav__item> <a href=../../../../jvm/java-memory-area-oom/ title=Java内存区域与内存溢出异常 class=md-nav__link> Java内存区域与内存溢出异常 </a> </li> <li class=md-nav__item> <a href=../../../../jvm/java-gc/ title=垃圾收集器与内存分配策略 class=md-nav__link> 垃圾收集器与内存分配策略 </a> </li> <li class=md-nav__item> <a href=../../../../jvm/class-struct/ title=类文件结构 class=md-nav__link> 类文件结构 </a> </li> <li class=md-nav__item> <a href=../../../../jvm/load-class/ title=虚拟机类加载机制 class=md-nav__link> 虚拟机类加载机制 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-4 type=checkbox id=nav-5-4> <label class=md-nav__link for=nav-5-4> Java </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-4> Java </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../java/generics-java-kotlin/ title=Java&Kotlin在泛型方面的区别 class=md-nav__link> Java&Kotlin在泛型方面的区别 </a> </li> <li class=md-nav__item> <a href=../../../../java/java-collections/ title=Java集合总结 class=md-nav__link> Java集合总结 </a> </li> <li class=md-nav__item> <a href=../../../../java/java-foundation/ title=Java常见概念 class=md-nav__link> Java常见概念 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-5 type=checkbox id=nav-5-5> <label class=md-nav__link for=nav-5-5> Refactoring </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-5> Refactoring </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../refactoring/refactoring/ title=重构：改善既有代码的设计 class=md-nav__link> 重构：改善既有代码的设计 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>目录</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#_1 class=md-nav__link> 卡顿现场 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-java class=md-nav__link> 1. Java 实现 </a> </li> <li class=md-nav__item> <a href=#2-sigquit class=md-nav__link> 2. SIGQUIT 信号实现 </a> </li> <li class=md-nav__item> <a href=#3-hook class=md-nav__link> 3. Hook 实现 </a> </li> <li class=md-nav__item> <a href=#4 class=md-nav__link> 4. 现场信息 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 卡顿分析 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1 class=md-nav__link> 1. 卡顿率 </a> </li> <li class=md-nav__item> <a href=#2 class=md-nav__link> 2. 卡顿树 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> 总结 </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> 课后作业 </a> </li> <li class=md-nav__item> <a href=#__comments class="md-nav__link md-nav__link--active"> 评论 </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <h1>06补充篇 | 卡顿优化：卡顿现场与卡顿分析</h1> <p>我们使用上一期所讲的插桩或者 Profilo 的方案，可以得到卡顿过程所有运行函数的耗时。在大部分情况下，这几种方案的确非常好用，可以让我们更加明确真正的卡顿点在哪里。</p> <p>但是，你肯定还遇到过很多莫名其妙的卡顿，比如读取 1KB 的文件、读取很小的 asset 资源或者只是简单的创建一个目录。</p> <p>为什么看起来这么简单的操作也会耗费那么长的时间呢？那我们如何通过收集更加丰富的卡顿现场信息，进一步定位并排查问题呢？</p> <h2 id=_1>卡顿现场<a class=headerlink href=#_1 title="Permanent link">&para;</a></h2> <p>我先来举一个线上曾经发现的卡顿例子，下面是它的具体耗时信息。</p> <p><img alt=stuck_3_1 src=/assets/images/android/master/stuck_3_1.png></p> <p>从图上看，Activity 的 onCreate 函数耗时达到 3 秒，而其中 Lottie 动画中<a href=http://androidxref.com/9.0.0_r3/xref/frameworks/base/core/java/android/content/res/AssetManager.java#852>openNonAsset</a>函数耗时竟然将近 2 秒。尽管是读取一个 30KB 的资源文件，但是它的耗时真的会有那么长吗？</p> <p>今天我们就一起来分析这个问题吧。</p> <h3 id=1-java>1. Java 实现<a class=headerlink href=#1-java title="Permanent link">&para;</a></h3> <p>进一步分析 openNonAsset 相关源码的时候发现，AssetManager 内部有大量的 synchronized 锁。首先我怀疑还是锁的问题，接下来需要把卡顿时各个线程的状态以及堆栈收集起来做进一步分析。</p> <p><strong>步骤一：获得 Java 线程状态</strong></p> <p>通过 Thread 的 getState 方法可以获取线程状态，当时主线程果然是 BLOCKED 状态。</p> <p>什么是 BLOCKED 状态呢？当线程无法获取下面代码中的 object 对象锁的时候，线程就会进入 BLOCKED 状态。</p> <div class=codehilite><pre><span></span><span class=c1>// 线程等待获取object对象锁</span>
<span class=kd>synchronized</span> <span class=p>(</span><span class=n>object</span><span class=p>)</span>  <span class=p>{</span>
    <span class=n>dosomething</span><span class=p>();</span>
<span class=p>}</span>  
</pre></div> <p><strong>WAITING、TIME_WAITING 和 BLOCKED 都是需要特别注意的状态</strong>。很多同学可能对 BLOCKED 和 WAITING 这两种状态感到比较困惑，BLOCKED 是指线程正在等待获取锁，对应的是下面代码中的情况一；WAITING 是指线程正在等待其他线程的“唤醒动作”，对应的是代码中的情况二。</p> <div class=codehilite><pre><span></span><span class=kd>synchronized</span> <span class=p>(</span><span class=n>object</span><span class=p>)</span>  <span class=p>{</span>     <span class=c1>// 情况一：在这里卡住 --&gt; BLOCKED</span>
    <span class=n>object</span><span class=p>.</span><span class=na>wait</span><span class=p>();</span>           <span class=c1>// 情况二：在这里卡住 --&gt; WAITING</span>
<span class=p>}</span>  
</pre></div> <p>不过当一个线程进入 WAITING 状态时，它不仅会释放 CPU 资源，还会将持有的 object 锁也同时释放。对 Java 各个线程状态的定义以及转换等更多介绍，你可以参考<a href=http://developer.android.com/reference/java/lang/Thread.State>Thread.State</a>和<a href=https://juejin.im/post/5b31b510e51d4558a426f7e9>《Java 线程 Dump 分析》</a>。</p> <p><strong>步骤二：获得所有线程堆栈</strong></p> <p>接着我们在 Java 层通过 Thread.getAllStackTraces() 进一步拿所有线程的堆栈，希望知道具体是因为哪个线程导致主线程的 BLOCKED。</p> <p>需要注意的是在 Android 7.0，getAllStackTraces 是不会返回主线程的堆栈的。通过分析收集上来的卡顿日志，我们发现跟 AssetManager 相关的线程有下面这个。</p> <div class=codehilite><pre><span></span><span class=s>&quot;BackgroundHandler&quot;</span>  <span class=n>RUNNABLE</span>
  <span class=n>at</span>  <span class=n>android</span><span class=p>.</span><span class=na>content</span><span class=p>.</span><span class=na>res</span><span class=p>.</span><span class=na>AssetManager</span><span class=p>.</span><span class=na>list</span>
  <span class=n>at</span>  <span class=n>com</span><span class=p>.</span><span class=na>sample</span><span class=p>.</span><span class=na>business</span><span class=p>.</span><span class=na>init</span><span class=p>.</span><span class=na>listZipFiles</span>
</pre></div> <p>通过查看<a href=http://androidxref.com/9.0.0_r3/xref/frameworks/base/core/java/android/content/res/AssetManager.java#788>AssetManager.list</a>的确发现是使用了同一个 synchronized 锁，而 list 函数需要遍历整个目录，耗时会比较久。</p> <div class=codehilite><pre><span></span><span class=kd>public</span> <span class=n>String</span><span class=o>[]</span> <span class=nf>list</span><span class=p>(</span><span class=n>String</span> <span class=n>path</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>IOException</span> <span class=p>{</span>
  <span class=kd>synchronized</span> <span class=p>(</span><span class=k>this</span><span class=p>)</span> <span class=p>{</span>
    <span class=n>ensureValidLocked</span><span class=p>();</span>
    <span class=k>return</span> <span class=n>nativeList</span><span class=p>(</span><span class=n>mObject</span><span class=p>,</span> <span class=n>path</span><span class=p>);</span>
  <span class=p>}</span>
<span class=p>}</span>
</pre></div> <p><strong>另外一方面，“BackgroundHandler”线程属于低优先级后台线程，这也是我们前面文章提到的不良现象，也就是主线程等待低优先级的后台线程。</strong></p> <h3 id=2-sigquit>2. SIGQUIT 信号实现<a class=headerlink href=#2-sigquit title="Permanent link">&para;</a></h3> <p>Java 实现的方案看起来非常不错，也帮助我们发现了卡顿的原因。不过在我们印象中，似乎<a href=http://developer.android.com/topic/performance/vitals/anr>ANR 日志</a>的信息更加丰富，那我们能不能直接用 ANR 日志呢？</p> <p>比如下面的例子，它的信息的确非常全，所有线程的状态、CPU 时间片、优先级、堆栈和锁的信息应有尽有。其中 utm 代表 utime，HZ 代表 CPU 的时钟频率，将 utime 转换为毫秒的公式是“time * 1000/HZ”。例子中 utm=218，也就是 218*1000/100=2180 毫秒。</p> <div class=codehilite><pre><span></span><span class=c1>// 线程名称; 优先级; 线程id; 线程状态</span>
<span class=s>&quot;main&quot;</span> <span class=n>prio</span><span class=o>=</span><span class=mi>5</span> <span class=n>tid</span><span class=o>=</span><span class=mi>1</span> <span class=n>Suspended</span>
  <span class=c1>// 线程组;  线程suspend计数; 线程debug suspend计数; </span>
  <span class=o>|</span> <span class=n>group</span><span class=o>=</span><span class=s>&quot;main&quot;</span> <span class=n>sCount</span><span class=o>=</span><span class=mi>1</span> <span class=n>dsCount</span><span class=o>=</span><span class=mi>0</span> <span class=n>obj</span><span class=o>=</span><span class=mh>0x74746000</span> <span class=n>self</span><span class=o>=</span><span class=mh>0xf4827400</span>
  <span class=c1>// 线程native id; 进程优先级; 调度者优先级;</span>
  <span class=o>|</span> <span class=n>sysTid</span><span class=o>=</span><span class=mi>28661</span> <span class=n>nice</span><span class=o>=-</span><span class=mi>4</span> <span class=n>cgrp</span><span class=o>=</span><span class=k>default</span> <span class=n>sched</span><span class=o>=</span><span class=mi>0</span><span class=o>/</span><span class=mi>0</span> <span class=n>handle</span><span class=o>=</span><span class=mh>0xf72cbbec</span>
  <span class=c1>// native线程状态; 调度者状态; 用户时间utime; 系统时间stime; 调度的CPU</span>
  <span class=o>|</span> <span class=n>state</span><span class=o>=</span><span class=n>D</span> <span class=n>schedstat</span><span class=o>=</span><span class=p>(</span> <span class=mi>3137222937</span> <span class=mi>94427228</span> <span class=mi>5819</span> <span class=p>)</span> <span class=n>utm</span><span class=o>=</span><span class=mi>218</span> <span class=n>stm</span><span class=o>=</span><span class=mi>95</span> <span class=n>core</span><span class=o>=</span><span class=mi>2</span> <span class=n>HZ</span><span class=o>=</span><span class=mi>100</span>
  <span class=c1>// stack相关信息</span>
  <span class=o>|</span> <span class=n>stack</span><span class=o>=</span><span class=mh>0xff717000</span><span class=o>-</span><span class=mh>0xff719000</span> <span class=n>stackSize</span><span class=o>=</span><span class=mi>8</span><span class=n>MB</span>
</pre></div> <p><strong>疑问一：Native 线程状态</strong></p> <p>细心的你可能会发现，为什么上面的 ANR 日志中“main”线程的状态是 Suspended？想了一下，Java 线程中的 6 种状态中并不存在 Suspended 状态啊。</p> <p>事实上，Suspended 代表的是 Native 线程状态。怎么理解呢？在 Android 里面 Java 线程的运行都委托于一个 Linux 标准线程 pthread 来运行，而 Android 里运行的线程可以分成两种，一种是 Attach 到虚拟机的，一种是没有 Attach 到虚拟机的，在虚拟机管理的线程都是托管的线程，所以本质上 Java 线程的状态其实是 Native 线程的一种映射。</p> <p>不同的 Android 版本 Native 线程的状态不太一样，例如 Android 9.0 就定义了 27 种线程状态，它能更加明确地区分线程当前所处的情况。关于 Java 线程状态、Native 线程状态转换，你可以参考<a href=http://androidxref.com/9.0.0_r3/xref/art/runtime/thread_state.h#24>thread_state.h</a>和<a href=http://androidxref.com/9.0.0_r3/xref/art/runtime/native/java_lang_Thread.cc#64>Thread_nativeGetStatus</a>。</p> <p><img alt=stuck_3_2 src=/assets/images/android/master/stuck_3_2.png></p> <p><strong>我们可以看到 Native 线程状态的确更加丰富，例如将 TIMED_WAITING 拆分成 TimedWaiting 和 Sleeping 两种场景，而 WAITING 更是细化到十几种场景等，这对我们分析特定场景问题的时候会有非常大的帮助。</strong></p> <p><strong>疑问二：获得 ANR 日志</strong></p> <p>虽然 ANR 日志信息非常丰富，那问题又来了，如何拿到卡顿时的 ANR 日志呢？</p> <p>我们可以利用系统 ANR 的生成机制，具体步骤是：</p> <ul> <li>第一步：当监控到主线程卡顿时，主动向系统发送 SIGQUIT 信号。</li> <li>第二步：等待 /data/anr/traces.txt 文件生成。</li> <li>第三步：文件生成以后进行上报。</li> </ul> <p>通过 ANR 日志，我们可以直接看到主线程的锁是由“BackgroundHandler”线程持有。相比之下通过 getAllStackTraces 方法，我们只能通过一个一个线程进行猜测。</p> <div class=codehilite><pre><span></span>  <span class=c1>// 堆栈相关信息</span>
  <span class=n>at</span> <span class=n>android</span><span class=p>.</span><span class=na>content</span><span class=p>.</span><span class=na>res</span><span class=p>.</span><span class=na>AssetManager</span><span class=p>.</span><span class=na>open</span><span class=p>(</span><span class=n>AssetManager</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=mi>311</span><span class=p>)</span>
  <span class=o>-</span> <span class=n>waiting</span> <span class=n>to</span> <span class=n>lock</span> <span class=o>&lt;</span><span class=mh>0x41ddc798</span><span class=o>&gt;</span> <span class=p>(</span><span class=n>android</span><span class=p>.</span><span class=na>content</span><span class=p>.</span><span class=na>res</span><span class=p>.</span><span class=na>AssetManager</span><span class=p>)</span> <span class=n>held</span> <span class=n>by</span> <span class=n>tid</span><span class=o>=</span><span class=mi>66</span> <span class=p>(</span><span class=n>BackgroundHandler</span><span class=p>)</span>
  <span class=n>at</span> <span class=n>android</span><span class=p>.</span><span class=na>content</span><span class=p>.</span><span class=na>res</span><span class=p>.</span><span class=na>AssetManager</span><span class=p>.</span><span class=na>open</span><span class=p>(</span><span class=n>AssetManager</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=mi>289</span><span class=p>)</span>
</pre></div> <p>线程间的死锁和热锁分析是一个非常有意思的话题，很多情况分析起来也比较困难，例如我们只能拿到 Java 代码中使用的锁，而且有部分类型锁的持有并不会表现在堆栈上面。对这部分内容感兴趣，想再深入一下的同学，可以认真看一下这两篇文章：<a href=https://juejin.im/post/5b31b510e51d4558a426f7e9>《Java 线程 Dump 分析》</a>、<a href=https://cloud.tencent.com/developer/article/1064396>《手 Q Android 线程死锁监控与自动化分析实践》</a>。</p> <h3 id=3-hook>3. Hook 实现<a class=headerlink href=#3-hook title="Permanent link">&para;</a></h3> <p>用 SIGQUIT 信号量获取 ANR 日志，从而拿到所有线程的各种信息，这套方案看起来很美好。但事实上，它存在这几个问题：</p> <ul> <li><strong>可行性</strong>。正如我在崩溃分析所说的一样，很多高版本系统已经没有权限读取 /data/anr/traces.txt 文件。</li> <li><strong>性能</strong>。获取所有线程堆栈以及各种信息非常耗时，对于卡顿场景不一定合适，它可能会进一步加剧用户的卡顿。</li> </ul> <p>那有什么方法既可以拿到 ANR 日志，整个过程又不会影响用户的体验呢？</p> <p>再回想一下，在<a href=/android/paid/master/crash_1/ >崩溃分析</a>的时候我们就讲过一种获得所有线程堆栈的方法。它通过下面几个步骤实现。</p> <ul> <li>通过libart.so、dlsym调用<a href=http://androidxref.com/9.0.0_r3/xref/art/runtime/thread_list.cc#1501>ThreadList::ForEach</a>方法，拿到所有的 Native 线程对象。</li> <li>遍历线程对象列表，调用<a href=http://androidxref.com/9.0.0_r3/xref/art/runtime/thread.cc#1615>Thread::DumpState</a>方法。</li> </ul> <p>它基本模拟了系统打印 ANR 日志的流程，但是因为整个过程使用了一些黑科技，可能会造成线上崩溃。</p> <p>为了兼容性考虑，我们会通过 fork 子进程方式实现，这样即使子进程崩溃了也不会影响我们主进程的运行。<strong>这样还可以带来另外一个非常大的好处，获取所有线程堆栈这个过程可以做到完全不卡我们主进程。</strong></p> <p>但使用 fork 进程会导致进程号改变，源码中通过 /proc/self 方式获取的一些信息都会失败（<strong>错误的拿了子进程的信息，而子进程只有一个线程</strong>），例如 state、schedstat、utm、stm、core 等。不过问题也不大，这些信息可以通过指定 /proc/[父进程 id]的方式重新获取。</p> <div class=codehilite><pre><span></span><span class=s>&quot;main&quot;</span> <span class=n>prio</span><span class=o>=</span><span class=mi>7</span> <span class=n>tid</span><span class=o>=</span><span class=mi>1</span> <span class=n>Native</span>
  <span class=o>|</span> <span class=n>group</span><span class=o>=</span><span class=s>&quot;&quot;</span> <span class=n>sCount</span><span class=o>=</span><span class=mi>0</span> <span class=n>dsCount</span><span class=o>=</span><span class=mi>0</span> <span class=n>obj</span><span class=o>=</span><span class=mh>0x74e99000</span> <span class=n>self</span><span class=o>=</span><span class=mh>0xb8811080</span>
  <span class=o>|</span> <span class=n>sysTid</span><span class=o>=</span><span class=mi>23023</span> <span class=n>nice</span><span class=o>=-</span><span class=mi>4</span> <span class=n>cgrp</span><span class=o>=</span><span class=k>default</span> <span class=n>sched</span><span class=o>=</span><span class=mi>0</span><span class=o>/</span><span class=mi>0</span> <span class=n>handle</span><span class=o>=</span><span class=mh>0xb6fccbec</span>
  <span class=o>|</span> <span class=n>state</span><span class=o>=?</span> <span class=n>schedstat</span><span class=o>=</span><span class=p>(</span> <span class=mi>0</span> <span class=mi>0</span> <span class=mi>0</span> <span class=p>)</span> <span class=n>utm</span><span class=o>=</span><span class=mi>0</span> <span class=n>stm</span><span class=o>=</span><span class=mi>0</span> <span class=n>core</span><span class=o>=</span><span class=mi>0</span> <span class=n>HZ</span><span class=o>=</span><span class=mi>100</span>
  <span class=o>|</span> <span class=n>stack</span><span class=o>=</span><span class=mh>0xbe4dd000</span><span class=o>-</span><span class=mh>0xbe4df000</span> <span class=n>stackSize</span><span class=o>=</span><span class=mi>8</span><span class=n>MB</span>
  <span class=o>|</span> <span class=n>held</span> <span class=n>mutexes</span><span class=o>=</span>
</pre></div> <p><strong>总的来说，通过 Hook 方式我们实现了一套“无损”获取所有 Java 线程堆栈与详细信息的方法。为了降低上报数据量，只有主线程的 Java 线程状态是 WAITING、TIME_WAITING 或者 BLOCKED 的时候，才会进一步使用这个“大杀器”。</strong></p> <h3 id=4>4. 现场信息<a class=headerlink href=#4 title="Permanent link">&para;</a></h3> <p>现在再来看，这样一份我们自己构造的“ANR 日志”是不是已经是收集崩溃现场信息的完全体了？它似乎缺少了我们常见的头部信息，例如进程 CPU 使用率、GC 相关的信息。</p> <p>正如第 6 期文章开头所说的一样，卡顿跟崩溃一样是需要“现场信息”的。能不能进一步让卡顿的“现场信息”的比系统 ANR 日志更加丰富？我们可以进一步增加这些信息：</p> <ul> <li><strong>CPU 使用率和调度信息</strong>。参考第 5 期的课后练习，我们可以得到系统 CPU 使用率、负载、各线程的 CPU 使用率以及 I/O 调度等信息。</li> <li><strong>内存相关信息</strong>。我们可以添加系统总内存、可用内存以及应用各个进程的内存等信息。如果开启了 Debug.startAllocCounting 或者 atrace，还可以增加 GC 相关的信息。</li> <li><strong>I/O 和网络相关</strong>。我们还可以把卡顿期间所有的 I/O 和网络操作的详细信息也一并收集，这部分内容会在后面进一步展开。</li> </ul> <p>在 Android 8.0 后，Android 虚拟机终于支持了 JVM 的<a href=https://www.ibm.com/developerworks/cn/java/j-lo-jpda2/index.html>JVMTI</a>机制。Profiler 中内存采集等很多模块也切换到这个机制中实现，后面我会邀请“学习委员”鹏飞给你讲讲 JVMTI 机制与应用。使用它可以获得的信息非常丰富，包括内存申请、线程创建、类加载、GC 等，有大量的应用场景。</p> <p>最后我们还可以利用崩溃分析中的一些思路，例如添加用户操作路径等信息，这样我们可以得到一份比系统 ANR 更加丰富的卡顿日志，这对我们解决某些疑难的卡顿问题会更有帮助。</p> <h2 id=_2>卡顿分析<a class=headerlink href=#_2 title="Permanent link">&para;</a></h2> <p>在客户端捕获卡顿之后，最后数据需要上传到后台统一分析。我们可以对数据做什么样的处理？应该关注哪些指标？</p> <h3 id=1>1. 卡顿率<a class=headerlink href=#1 title="Permanent link">&para;</a></h3> <p>如果把主线程卡顿超过 3 秒定义为一个卡顿问题，类似崩溃，我们会先评估卡顿问题的影响面，也就是 UV 卡顿率。</p> <div class=codehilite><pre><span></span><span class=n>UV</span> <span class=n>卡顿率</span> <span class=o>=</span> <span class=n>发生过卡顿</span> <span class=n>UV</span> <span class=o>/</span> <span class=n>开启卡顿采集</span> <span class=n>UV</span>
</pre></div> <p>因为卡顿问题一般都是抽样上报，采样规则跟内存相似，都应该按照人来抽样。一个用户如果命中采集，那么在一天内都会持续的采集数据。</p> <p>UV 卡顿率可以评估卡顿的影响范围，但对于低端机器来说比较难去优化卡顿的问题。如果想评估卡顿的严重程度，我们可以使用 PV 卡顿率。</p> <div class=codehilite><pre><span></span><span class=n>PV</span> <span class=n>卡顿率</span> <span class=o>=</span> <span class=n>发生过卡顿</span> <span class=n>PV</span> <span class=o>/</span> <span class=n>启动采集</span> <span class=n>PV</span>
</pre></div> <p>需要注意的是，对于命中采集 PV 卡顿率的用户，每次启动都需要上报作为分母。</p> <h3 id=2>2. 卡顿树<a class=headerlink href=#2 title="Permanent link">&para;</a></h3> <p>发生卡顿时，我们会把 CPU 使用率和负载相关信息也添加到卡顿日志中。虽然采取了抽样策略，但每天的日志量还是达到十万级别。这么大的日志量，如果简单采用堆栈聚合日志，会发现有几百上千种卡顿类型，很难看出重点。</p> <p>我们能不能实现卡顿的火焰图，在一张图里就可以看到卡顿的整体信息？</p> <p>这里我非常推荐卡顿树的做法，对于超过 3 秒的卡顿，具体是 4 秒还是 10 秒，这涉及手机性能和当时的环境。我们决定抛弃具体的耗时，只按照相同堆栈出现的比例来聚合。这样我们从一棵树上面，就可以看到哪些堆栈出现的卡顿问题最多，它下面又存在的哪些分支。</p> <p><img alt=stuck_3_3 src=/assets/images/android/master/stuck_3_3.png></p> <p>我们的精力是有限的，一般会优先去解决 Top 的卡顿问题。采用卡顿树的聚合方式，可以从全盘的角度看到 Top 卡顿问题的各个分支情况，帮助我们快速找到关键的卡顿点。</p> <h2 id=_3>总结<a class=headerlink href=#_3 title="Permanent link">&para;</a></h2> <p>今天我们从一个简单的卡顿问题出发，一步一步演进出解决这个问题的三种思路。其中 Java 实现的方案是大部分同学首先想到的方案，它虽然简单稳定，不过存在信息不全、性能差等问题。</p> <p>可能很多同学认为问题可以解决就算万事大吉了，但我并不这样认为。我们应该继续敲问自己，如果再出现类似的问题，我们是否也可以采用相同的方法去解决？这个方案的代价对用户会带来多大的影响，是否还有优化的空间？</p> <p>只有这样，才会出现文中的方案二和方案三，解决方案才会一直向前演进，做得越来越好。也只有这样，我们才能在追求卓越的过程中快速进步。</p> <h2 id=_4>课后作业<a class=headerlink href=#_4 title="Permanent link">&para;</a></h2> <p>本章的<a href=http://github.com/AndroidAdvanceWithGeektime/Chapter06-plus>Sample</a>关于监控线程的创建。</p> <ul> <li><a href=https://www.jianshu.com/p/a26d11502ec8>Android 线程的创建过程</a></li> <li><a href=http://androidxref.com/9.0.0_r3/xref/art/runtime/native/java_lang_Thread.cc#43>java_lang_Thread.cc</a></li> <li><a href=http://androidxref.com/9.0.0_r3/xref/art/runtime/thread.cc>thread.cc</a></li> <li><a href=http://androidxref.com/9.0.0_r3/xref/art/runtime/Android.bp>编译脚本 Android.bp</a></li> </ul> <p>对于 PLT Hook 和 Inline Hook 的具体实现原理与差别，我在后面会详细讲到。这里我们可以把它们先隐藏掉，直接利用开源的实现即可。通过这个 Sample 我希望你可以学会通过分析源码，寻找合理的 Hook 函数与具体的 so 库。我相信当你熟悉这些方法之后，一定会惊喜地发现实现起来其实真的不难。</p> <hr> <p>hook<code>libart.so</code>里面<code>pthread_create</code>函数，在触发函数时调用Java层的方法打印出Java栈。</p> <div class=superfences-tabs> <input name=__tabs_1 type=radio id=__tab_1_0 checked=checked> <label for=__tab_1_0>MainActivity.java</label> <div class=superfences-content><div class=codehilite><pre><span></span><span class=kd>public</span> <span class=kd>class</span> <span class=nc>MainActivity</span> <span class=kd>extends</span> <span class=n>Activity</span> <span class=p>{</span>
    <span class=nd>@Override</span>
    <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>onCreate</span><span class=p>(</span><span class=n>Bundle</span> <span class=n>savedInstanceState</span><span class=p>)</span> <span class=p>{</span>
        <span class=kd>super</span><span class=p>.</span><span class=na>onCreate</span><span class=p>(</span><span class=n>savedInstanceState</span><span class=p>);</span>
        <span class=n>setContentView</span><span class=p>(</span><span class=n>R</span><span class=p>.</span><span class=na>layout</span><span class=p>.</span><span class=na>activity_main</span><span class=p>);</span>
        <span class=n>findViewById</span><span class=p>(</span><span class=n>R</span><span class=p>.</span><span class=na>id</span><span class=p>.</span><span class=na>button</span><span class=p>).</span><span class=na>setOnClickListener</span><span class=p>(</span><span class=k>new</span> <span class=n>View</span><span class=p>.</span><span class=na>OnClickListener</span><span class=p>()</span> <span class=p>{</span>
            <span class=nd>@Override</span>
            <span class=kd>public</span> <span class=kt>void</span> <span class=nf>onClick</span><span class=p>(</span><span class=n>View</span> <span class=n>v</span><span class=p>)</span> <span class=p>{</span>
                <span class=n>ThreadHook</span><span class=p>.</span><span class=na>enableThreadHook</span><span class=p>();</span>
                <span class=n>Toast</span><span class=p>.</span><span class=na>makeText</span><span class=p>(</span><span class=n>MainActivity</span><span class=p>.</span><span class=na>this</span><span class=p>,</span> <span class=s>&quot;开启成功&quot;</span><span class=p>,</span> <span class=n>Toast</span><span class=p>.</span><span class=na>LENGTH_SHORT</span><span class=p>).</span><span class=na>show</span><span class=p>();</span>
            <span class=p>}</span>
        <span class=p>});</span>

        <span class=n>findViewById</span><span class=p>(</span><span class=n>R</span><span class=p>.</span><span class=na>id</span><span class=p>.</span><span class=na>newthread</span><span class=p>).</span><span class=na>setOnClickListener</span><span class=p>(</span><span class=k>new</span> <span class=n>View</span><span class=p>.</span><span class=na>OnClickListener</span><span class=p>()</span> <span class=p>{</span>
            <span class=nd>@Override</span>
            <span class=kd>public</span> <span class=kt>void</span> <span class=nf>onClick</span><span class=p>(</span><span class=n>View</span> <span class=n>v</span><span class=p>)</span> <span class=p>{</span>

                <span class=k>new</span> <span class=n>Thread</span><span class=p>(</span><span class=k>new</span> <span class=n>Runnable</span><span class=p>()</span> <span class=p>{</span>
                    <span class=nd>@Override</span>
                    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>run</span><span class=p>()</span> <span class=p>{</span>
                        <span class=n>Log</span><span class=p>.</span><span class=na>e</span><span class=p>(</span><span class=s>&quot;HOOOOOOOOK&quot;</span><span class=p>,</span> <span class=s>&quot;thread name:&quot;</span> <span class=o>+</span> <span class=n>Thread</span><span class=p>.</span><span class=na>currentThread</span><span class=p>().</span><span class=na>getName</span><span class=p>());</span>
                        <span class=n>Log</span><span class=p>.</span><span class=na>e</span><span class=p>(</span><span class=s>&quot;HOOOOOOOOK&quot;</span><span class=p>,</span> <span class=s>&quot;thread id:&quot;</span> <span class=o>+</span> <span class=n>Thread</span><span class=p>.</span><span class=na>currentThread</span><span class=p>().</span><span class=na>getId</span><span class=p>());</span>
                        <span class=k>new</span> <span class=n>Thread</span><span class=p>(</span><span class=k>new</span> <span class=n>Runnable</span><span class=p>()</span> <span class=p>{</span>
                            <span class=nd>@Override</span>
                            <span class=kd>public</span> <span class=kt>void</span> <span class=nf>run</span><span class=p>()</span> <span class=p>{</span>
                                <span class=n>Log</span><span class=p>.</span><span class=na>e</span><span class=p>(</span><span class=s>&quot;HOOOOOOOOK&quot;</span><span class=p>,</span> <span class=s>&quot;inner thread name:&quot;</span> <span class=o>+</span> <span class=n>Thread</span><span class=p>.</span><span class=na>currentThread</span><span class=p>().</span><span class=na>getName</span><span class=p>());</span>
                                <span class=n>Log</span><span class=p>.</span><span class=na>e</span><span class=p>(</span><span class=s>&quot;HOOOOOOOOK&quot;</span><span class=p>,</span> <span class=s>&quot;inner thread id:&quot;</span> <span class=o>+</span> <span class=n>Thread</span><span class=p>.</span><span class=na>currentThread</span><span class=p>().</span><span class=na>getId</span><span class=p>());</span>

                            <span class=p>}</span>
                        <span class=p>}).</span><span class=na>start</span><span class=p>();</span>
                    <span class=p>}</span>
                <span class=p>}).</span><span class=na>start</span><span class=p>();</span>
            <span class=p>}</span>

        <span class=p>});</span>
    <span class=p>}</span>
<span class=p>}</span>
</pre></div></div> <input name=__tabs_1 type=radio id=__tab_1_1> <label for=__tab_1_1>ThreadHook.java</label> <div class=superfences-content><div class=codehilite><pre><span></span><span class=kd>public</span> <span class=kd>final</span> <span class=kd>class</span> <span class=nc>ThreadHook</span> <span class=p>{</span>
    <span class=kd>static</span> <span class=p>{</span>
        <span class=n>System</span><span class=p>.</span><span class=na>loadLibrary</span><span class=p>(</span><span class=s>&quot;threadhook&quot;</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=kd>private</span> <span class=kd>static</span> <span class=kt>boolean</span> <span class=n>sHasHook</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
    <span class=kd>private</span> <span class=kd>static</span> <span class=kt>boolean</span> <span class=n>sHookFailed</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>


    <span class=kd>public</span> <span class=kd>static</span> <span class=n>String</span> <span class=nf>getStack</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>stackTraceToString</span><span class=p>(</span><span class=k>new</span> <span class=n>Throwable</span><span class=p>().</span><span class=na>getStackTrace</span><span class=p>());</span>
    <span class=p>}</span>

    <span class=kd>private</span> <span class=kd>static</span> <span class=n>String</span> <span class=nf>stackTraceToString</span><span class=p>(</span><span class=kd>final</span> <span class=n>StackTraceElement</span><span class=o>[]</span> <span class=n>arr</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>arr</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>return</span> <span class=s>&quot;&quot;</span><span class=p>;</span>
        <span class=p>}</span>

        <span class=n>StringBuffer</span> <span class=n>sb</span> <span class=o>=</span> <span class=k>new</span> <span class=n>StringBuffer</span><span class=p>();</span>

        <span class=k>for</span> <span class=p>(</span><span class=n>StackTraceElement</span> <span class=n>stackTraceElement</span> <span class=p>:</span> <span class=n>arr</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>String</span> <span class=n>className</span> <span class=o>=</span> <span class=n>stackTraceElement</span><span class=p>.</span><span class=na>getClassName</span><span class=p>();</span>
            <span class=c1>// remove unused stacks</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>className</span><span class=p>.</span><span class=na>contains</span><span class=p>(</span><span class=s>&quot;java.lang.Thread&quot;</span><span class=p>))</span> <span class=p>{</span>
                <span class=k>continue</span><span class=p>;</span>
            <span class=p>}</span>

            <span class=n>sb</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=n>stackTraceElement</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=sc>&#39;\n&#39;</span><span class=p>);</span>
        <span class=p>}</span>
        <span class=k>return</span> <span class=n>sb</span><span class=p>.</span><span class=na>toString</span><span class=p>();</span>
    <span class=p>}</span>

    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>enableThreadHook</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>sHasHook</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>return</span><span class=p>;</span>
        <span class=p>}</span>
        <span class=n>sHasHook</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
        <span class=n>enableThreadHookNative</span><span class=p>();</span>

    <span class=p>}</span>

    <span class=kd>private</span> <span class=kd>static</span> <span class=kd>native</span> <span class=kt>void</span> <span class=nf>enableThreadHookNative</span><span class=p>();</span>
<span class=p>}</span>
</pre></div></div> <input name=__tabs_1 type=radio id=__tab_1_2> <label for=__tab_1_2>threadHook.cpp</label> <div class=superfences-content><div class=codehilite><pre><span></span><span class=cp>#include</span> <span class=cpf>&lt;jni.h&gt;</span><span class=cp></span>
<span class=cp>#include</span> <span class=cpf>&lt;string&gt;</span><span class=cp></span>

<span class=cp>#include</span> <span class=cpf>&lt;atomic&gt;</span><span class=cp></span>
<span class=cp>#include</span> <span class=cpf>&lt;dlfcn.h&gt;</span><span class=cp></span>
<span class=cp>#include</span> <span class=cpf>&lt;sys/mman.h&gt;</span><span class=cp></span>
<span class=cp>#include</span> <span class=cpf>&lt;unistd.h&gt;</span><span class=cp></span>
<span class=cp>#include</span> <span class=cpf>&lt;sstream&gt;</span><span class=cp></span>
<span class=cp>#include</span> <span class=cpf>&lt;android/log.h&gt;</span><span class=cp></span>
<span class=cp>#include</span> <span class=cpf>&lt;unordered_set&gt;</span><span class=cp></span>
<span class=cp>#include</span> <span class=cpf>&lt;fcntl.h&gt;</span><span class=cp></span>
<span class=cp>#include</span> <span class=cpf>&lt;sys/fcntl.h&gt;</span><span class=cp></span>
<span class=cp>#include</span> <span class=cpf>&lt;stdlib.h&gt;</span><span class=cp></span>
<span class=cp>#include</span> <span class=cpf>&lt;libgen.h&gt;</span><span class=cp></span>
<span class=cp>#include</span> <span class=cpf>&lt;syscall.h&gt;</span><span class=cp></span>
<span class=cp>#include</span> <span class=cpf>&quot;linker.h&quot;</span><span class=cp></span>
<span class=cp>#include</span> <span class=cpf>&quot;hooks.h&quot;</span><span class=cp></span>
<span class=cp>#include</span> <span class=cpf>&lt;pthread.h&gt;</span><span class=cp></span>

<span class=cp>#define  LOG_TAG    &quot;HOOOOOOOOK&quot;</span>
<span class=cp>#define  ALOG(...)  __android_log_print(ANDROID_LOG_ERROR,LOG_TAG,__VA_ARGS__)</span>

<span class=n>std</span><span class=o>::</span><span class=n>atomic</span><span class=o>&lt;</span><span class=kt>bool</span><span class=o>&gt;</span> <span class=n>thread_hooked</span><span class=p>;</span>

<span class=k>static</span> <span class=n>jclass</span> <span class=n>kJavaClass</span><span class=p>;</span>
<span class=k>static</span> <span class=n>jmethodID</span> <span class=n>kMethodGetStack</span><span class=p>;</span>
<span class=k>static</span> <span class=n>JavaVM</span> <span class=o>*</span><span class=n>kJvm</span><span class=p>;</span>


<span class=kt>char</span> <span class=o>*</span><span class=nf>jstringToChars</span><span class=p>(</span><span class=n>JNIEnv</span> <span class=o>*</span><span class=n>env</span><span class=p>,</span> <span class=n>jstring</span> <span class=n>jstr</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>jstr</span> <span class=o>==</span> <span class=k>nullptr</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=k>nullptr</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=n>jboolean</span> <span class=n>isCopy</span> <span class=o>=</span> <span class=n>JNI_FALSE</span><span class=p>;</span>
    <span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>str</span> <span class=o>=</span> <span class=n>env</span><span class=o>-&gt;</span><span class=n>GetStringUTFChars</span><span class=p>(</span><span class=n>jstr</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>isCopy</span><span class=p>);</span>
    <span class=kt>char</span> <span class=o>*</span><span class=n>ret</span> <span class=o>=</span> <span class=n>strdup</span><span class=p>(</span><span class=n>str</span><span class=p>);</span>
    <span class=n>env</span><span class=o>-&gt;</span><span class=n>ReleaseStringUTFChars</span><span class=p>(</span><span class=n>jstr</span><span class=p>,</span> <span class=n>str</span><span class=p>);</span>
    <span class=k>return</span> <span class=n>ret</span><span class=p>;</span>
<span class=p>}</span>

<span class=kt>void</span> <span class=nf>printJavaStack</span><span class=p>()</span> <span class=p>{</span>
    <span class=n>JNIEnv</span><span class=o>*</span> <span class=n>jniEnv</span> <span class=o>=</span> <span class=nb>NULL</span><span class=p>;</span>
    <span class=c1>// JNIEnv 是绑定线程的，所以这里要重新取</span>
    <span class=n>kJvm</span><span class=o>-&gt;</span><span class=n>GetEnv</span><span class=p>((</span><span class=kt>void</span><span class=o>**</span><span class=p>)</span><span class=o>&amp;</span><span class=n>jniEnv</span><span class=p>,</span> <span class=n>JNI_VERSION_1_6</span><span class=p>);</span>
    <span class=n>jstring</span> <span class=n>java_stack</span> <span class=o>=</span> <span class=k>static_cast</span><span class=o>&lt;</span><span class=n>jstring</span><span class=o>&gt;</span><span class=p>(</span><span class=n>jniEnv</span><span class=o>-&gt;</span><span class=n>CallStaticObjectMethod</span><span class=p>(</span><span class=n>kJavaClass</span><span class=p>,</span> <span class=n>kMethodGetStack</span><span class=p>));</span>
    <span class=k>if</span> <span class=p>(</span><span class=nb>NULL</span> <span class=o>==</span> <span class=n>java_stack</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=kt>char</span><span class=o>*</span> <span class=n>stack</span> <span class=o>=</span> <span class=n>jstringToChars</span><span class=p>(</span><span class=n>jniEnv</span><span class=p>,</span> <span class=n>java_stack</span><span class=p>);</span>
    <span class=n>ALOG</span><span class=p>(</span><span class=s>&quot;stack:%s&quot;</span><span class=p>,</span> <span class=n>stack</span><span class=p>);</span>
    <span class=n>free</span><span class=p>(</span><span class=n>stack</span><span class=p>);</span>

    <span class=n>jniEnv</span><span class=o>-&gt;</span><span class=n>DeleteLocalRef</span><span class=p>(</span><span class=n>java_stack</span><span class=p>);</span>
<span class=p>}</span>


<span class=kt>int</span> <span class=nf>pthread_create_hook</span><span class=p>(</span><span class=n>pthread_t</span><span class=o>*</span> <span class=kr>thread</span><span class=p>,</span> <span class=k>const</span> <span class=n>pthread_attr_t</span><span class=o>*</span> <span class=n>attr</span><span class=p>,</span>
                            <span class=kt>void</span><span class=o>*</span> <span class=p>(</span><span class=o>*</span><span class=n>start_routine</span><span class=p>)</span> <span class=p>(</span><span class=kt>void</span> <span class=o>*</span><span class=p>),</span> <span class=kt>void</span><span class=o>*</span> <span class=n>arg</span><span class=p>)</span> <span class=p>{</span>
    <span class=n>printJavaStack</span><span class=p>();</span>
    <span class=k>return</span> <span class=n>CALL_PREV</span><span class=p>(</span><span class=n>pthread_create_hook</span><span class=p>,</span> <span class=kr>thread</span><span class=p>,</span> <span class=n>attr</span><span class=p>,</span> <span class=o>*</span><span class=n>start_routine</span><span class=p>,</span> <span class=n>arg</span><span class=p>);</span>
<span class=p>}</span>


<span class=cm>/**</span>
<span class=cm>* plt hook libc 的 pthread_create 方法，第一个参数的含义为排除掉 libc.so</span>
<span class=cm>*/</span>
<span class=kt>void</span> <span class=nf>hookLoadedLibs</span><span class=p>()</span> <span class=p>{</span>
    <span class=n>ALOG</span><span class=p>(</span><span class=s>&quot;hook_plt_method&quot;</span><span class=p>);</span>
    <span class=n>hook_plt_method</span><span class=p>(</span><span class=s>&quot;libart.so&quot;</span><span class=p>,</span> <span class=s>&quot;pthread_create&quot;</span><span class=p>,</span> <span class=p>(</span><span class=n>hook_func</span><span class=p>)</span> <span class=o>&amp;</span><span class=n>pthread_create_hook</span><span class=p>);</span>
<span class=p>}</span>


<span class=kt>void</span> <span class=nf>enableThreadHook</span><span class=p>()</span> <span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>thread_hooked</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=n>ALOG</span><span class=p>(</span><span class=s>&quot;enableThreadHook&quot;</span><span class=p>);</span>

    <span class=n>thread_hooked</span> <span class=o>=</span> <span class=nb>true</span><span class=p>;</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>linker_initialize</span><span class=p>())</span> <span class=p>{</span>
        <span class=k>throw</span> <span class=n>std</span><span class=o>::</span><span class=n>runtime_error</span><span class=p>(</span><span class=s>&quot;Could not initialize linker library&quot;</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=n>hookLoadedLibs</span><span class=p>();</span>
<span class=p>}</span>

<span class=k>extern</span> <span class=s>&quot;C&quot;</span>
<span class=n>JNIEXPORT</span> <span class=kt>void</span> <span class=n>JNICALL</span>
<span class=n>Java_com_dodola_thread_ThreadHook_enableThreadHookNative</span><span class=p>(</span><span class=n>JNIEnv</span> <span class=o>*</span><span class=n>env</span><span class=p>,</span> <span class=n>jclass</span> <span class=n>type</span><span class=p>)</span> <span class=p>{</span>

    <span class=n>enableThreadHook</span><span class=p>();</span>
<span class=p>}</span>

<span class=k>static</span> <span class=kt>bool</span> <span class=n>InitJniEnv</span><span class=p>(</span><span class=n>JavaVM</span> <span class=o>*</span><span class=n>vm</span><span class=p>)</span> <span class=p>{</span>
    <span class=n>kJvm</span> <span class=o>=</span> <span class=n>vm</span><span class=p>;</span>
    <span class=n>JNIEnv</span><span class=o>*</span> <span class=n>env</span> <span class=o>=</span> <span class=nb>NULL</span><span class=p>;</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>kJvm</span><span class=o>-&gt;</span><span class=n>GetEnv</span><span class=p>((</span><span class=kt>void</span><span class=o>**</span><span class=p>)</span><span class=o>&amp;</span><span class=n>env</span><span class=p>,</span> <span class=n>JNI_VERSION_1_6</span><span class=p>)</span> <span class=o>!=</span> <span class=n>JNI_OK</span><span class=p>){</span>
        <span class=n>ALOG</span><span class=p>(</span><span class=s>&quot;InitJniEnv GetEnv !JNI_OK&quot;</span><span class=p>);</span>
        <span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=n>kJavaClass</span> <span class=o>=</span> <span class=k>reinterpret_cast</span><span class=o>&lt;</span><span class=n>jclass</span><span class=o>&gt;</span><span class=p>(</span><span class=n>env</span><span class=o>-&gt;</span><span class=n>NewGlobalRef</span><span class=p>(</span><span class=n>env</span><span class=o>-&gt;</span><span class=n>FindClass</span><span class=p>(</span><span class=s>&quot;com/dodola/thread/ThreadHook&quot;</span><span class=p>)));</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>kJavaClass</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>)</span>  <span class=p>{</span>
        <span class=n>ALOG</span><span class=p>(</span><span class=s>&quot;InitJniEnv kJavaClass NULL&quot;</span><span class=p>);</span>
        <span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=n>kMethodGetStack</span> <span class=o>=</span> <span class=n>env</span><span class=o>-&gt;</span><span class=n>GetStaticMethodID</span><span class=p>(</span><span class=n>kJavaClass</span><span class=p>,</span> <span class=s>&quot;getStack&quot;</span><span class=p>,</span> <span class=s>&quot;()Ljava/lang/String;&quot;</span><span class=p>);</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>kMethodGetStack</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>ALOG</span><span class=p>(</span><span class=s>&quot;InitJniEnv kMethodGetStack NULL&quot;</span><span class=p>);</span>
        <span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
<span class=p>}</span>

<span class=n>JNIEXPORT</span> <span class=n>jint</span> <span class=n>JNICALL</span> <span class=n>JNI_OnLoad</span><span class=p>(</span><span class=n>JavaVM</span> <span class=o>*</span><span class=n>vm</span><span class=p>,</span> <span class=kt>void</span> <span class=o>*</span><span class=n>reserved</span><span class=p>){</span>
    <span class=n>ALOG</span><span class=p>(</span><span class=s>&quot;JNI_OnLoad&quot;</span><span class=p>);</span>


    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>InitJniEnv</span><span class=p>(</span><span class=n>vm</span><span class=p>))</span> <span class=p>{</span>
        <span class=k>return</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=k>return</span> <span class=n>JNI_VERSION_1_6</span><span class=p>;</span>
<span class=p>}</span>
</pre></div></div> </div> <hr> <div class=md-source-date> <small> 最后更新: 2020年6月28日 </small> </div> <h2 id=__comments>评论</h2> <div id=disqus_thread></div> <script>
    var disqus_config = function () {
      this.page.url = "https://blog.yorek.xyz/about-me/android/paid/master/stuck_3/";
      this.page.identifier =
        "/android/paid/master/stuck_3/";
    };
    (function() {
      var d = document, s = d.createElement("script");
      s.src = "//yorekliu.disqus.com/embed.js";
      s.setAttribute("data-timestamp", +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid"> <a href=../stuck_2/ title="06 | 卡顿优化（下）：如何监控应用卡顿？" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> 上一页 </span> 06 | 卡顿优化（下）：如何监控应用卡顿？ </span> </div> </a> <a href=../start_1/ title="07 | 启动优化（上）：从启动过程看启动速度优化" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel=next> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> 下一页 </span> 07 | 启动优化（上）：从启动过程看启动速度优化 </span> </div> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> &copy; 2020 Yorek </div> powered by <a href=https://www.mkdocs.org>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ > Material for MkDocs</a> </div> <div class=md-footer-social> <link rel=stylesheet href=../../../../assets/fonts/font-awesome.css> <a href=https://github.com/YorekLiu class="md-footer-social__link fa fa-github"></a> <a href=lyytogether@gmail.com class="md-footer-social__link fa fa-email"></a> </div> </div> </div> </footer> </div> <script src=../../../../assets/javascripts/application.808e90bb.js></script> <script src=../../../../assets/javascripts/lunr/lunr.stemmer.support.js></script> <script src=../../../../assets/javascripts/lunr/tinyseg.js></script> <script src=../../../../assets/javascripts/lunr/lunr.ja.js></script> <script>app.initialize({version:"1.0.4",url:{base:"../../../.."}})</script> <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script> </body> </html>
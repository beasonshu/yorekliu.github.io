<!--
  Copyright (c) 2016-2020 Martin Donath <martin.donath@squidfunk.com>
  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:
  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.
  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
--> <!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=description content="An Android Developer."><link href=https://blog.yorek.xyz/about-me/android/paid/zsxq/week10-classloader/ rel=canonical><meta name=author content="Yorek Liu"><meta name=lang:clipboard.copy content=复制><meta name=lang:clipboard.copied content=已复制><meta name=lang:search.language content=ja><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content=没有找到符合条件的结果><meta name=lang:search.result.one content="找到 1 个符合条件的结果"><meta name=lang:search.result.other content="# 个符合条件的结果"><meta name=lang:search.tokenizer content=[\uff0c\u3002]+><link rel="shortcut icon" href=../../../../assets/images/favicon.ico><meta name=generator content="mkdocs-1.0.4, mkdocs-material-4.6.0"><title>Android中的ClassLoader</title><link rel=stylesheet href=../../../../assets/stylesheets/application.1b62728e.css><link rel=stylesheet href=../../../../assets/stylesheets/application-palette.a8b3c06d.css><meta name=theme-color content><script src=../../../../assets/javascripts/modernizr.268332fc.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel=stylesheet href=../../../../assets/fonts/material-icons.css><link rel=manifest href=../../../../manifest.webmanifest><script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-155096376-1", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script><script async src=https://www.google-analytics.com/analytics.js></script><!-- Determine title --><!-- The image needs to have an absolute URL --><!-- Open graph meta tags --><meta property=og:type content=website><meta property=og:title content="Yorek's - Android中的ClassLoader"><meta property=og:description content="An Android Developer."><meta content=https://blog.yorek.xyz/about-me/android/paid/zsxq/week10-classloader/ property=og:url><meta property=og:image content=https://blog.yorek.xyz/about-meassets/images/banner.png><meta property=og:image:type content=image/png><meta property=og:image:width content=1200><meta property=og:image:height content=630><!-- Twitter meta tags --><meta name=twitter:card content=summary_large_image><meta name=twitter:site content=@squidfunk><meta name=twitter:creator content=@squidfunk><meta name=twitter:title content="Yorek's - Android中的ClassLoader"><meta name=twitter:description content="An Android Developer."><meta name=twitter:image content=https://blog.yorek.xyz/about-meassets/images/banner.png></head> <body dir=ltr data-md-color-primary=white data-md-color-accent=blue> <svg class=md-svg> <defs> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#question tabindex=1 class=md-skip> 跳转至 </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=https://blog.yorek.xyz/about-me title="Yorek's" class="md-header-nav__button md-logo"> <img src=../../../../assets/images/favicon.ico width=24 height=24> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> Yorek's </span> <span class=md-header-nav__topic> Android中的ClassLoader </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> 键入以开始搜索 </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container> <nav class="md-tabs md-tabs--active" data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../../3rd-library/3rd-library-source-code/ class=md-tabs__link> Android </a> </li> <li class=md-tabs__item> <a href=../../../../flutter/flutter_first_project_1/ class=md-tabs__link> Flutter </a> </li> <li class=md-tabs__item> <a href=../../../../leetcode/ class=md-tabs__link> LeetCode </a> </li> <li class=md-tabs__item> <a href=../../../../design-pattern/design-pattern/ class=md-tabs__link> Books </a> </li> </ul> </div> </nav> <main class=md-main role=main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=https://blog.yorek.xyz/about-me title="Yorek's" class="md-nav__button md-logo"> <img src=../../../../assets/images/favicon.ico width=48 height=48> </a> Yorek's </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../.. title=Home class=md-nav__link> Home </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2 type=checkbox id=nav-2 checked> <label class=md-nav__link for=nav-2> Android </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-2> Android </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-1 type=checkbox id=nav-2-1> <label class=md-nav__link for=nav-2-1> 三方库源码解析 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-1> 三方库源码解析 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../3rd-library/3rd-library-source-code/ title=Android三方库源码分析 class=md-nav__link> Android三方库源码分析 </a> </li> <li class=md-nav__item> <a href=../../../3rd-library/matrix/ title="微信APM Matrix解析" class=md-nav__link> 微信APM Matrix解析 </a> </li> <li class=md-nav__item> <a href=../../../3rd-library/matrix-trace/ title=Matrix-TraceCanary解析 class=md-nav__link> Matrix-TraceCanary解析 </a> </li> <li class=md-nav__item> <a href=../../../3rd-library/matrix-io/ title=Matrix-IOCanary解析 class=md-nav__link> Matrix-IOCanary解析 </a> </li> <li class=md-nav__item> <a href=../../../3rd-library/matrix-resource/ title=Matrix-ResourceCanary解析 class=md-nav__link> Matrix-ResourceCanary解析 </a> </li> <li class=md-nav__item> <a href=../../../3rd-library/matrix-sqlitelint/ title=Matrix-SQLiteLint解析 class=md-nav__link> Matrix-SQLiteLint解析 </a> </li> <li class=md-nav__item> <a href=../../../3rd-library/okhttp/ title=OkHttp3源码解析 class=md-nav__link> OkHttp3源码解析 </a> </li> <li class=md-nav__item> <a href=../../../3rd-library/retrofit/ title=Retrofit2源码解析 class=md-nav__link> Retrofit2源码解析 </a> </li> <li class=md-nav__item> <a href=../../../3rd-library/rxjava&rxandroid/ title=RxJava源码解析及使用实例 class=md-nav__link> RxJava源码解析及使用实例 </a> </li> <li class=md-nav__item> <a href=../../../other/RxJava/ title=RxJava操作符大全 class=md-nav__link> RxJava操作符大全 </a> </li> <li class=md-nav__item> <a href=../../../3rd-library/glide1/ title="Glide v4 源码解析（一）" class=md-nav__link> Glide v4 源码解析（一） </a> </li> <li class=md-nav__item> <a href=../../../3rd-library/glide2/ title="Glide v4 源码解析（二）" class=md-nav__link> Glide v4 源码解析（二） </a> </li> <li class=md-nav__item> <a href=../../../3rd-library/glide3/ title="Glide v4 源码解析（三）" class=md-nav__link> Glide v4 源码解析（三） </a> </li> <li class=md-nav__item> <a href=../../../3rd-library/glide4/ title="Glide v4 源码解析（四）" class=md-nav__link> Glide v4 源码解析（四） </a> </li> <li class=md-nav__item> <a href=../../../3rd-library/glide5/ title="Glide v4 源码解析（五）" class=md-nav__link> Glide v4 源码解析（五） </a> </li> <li class=md-nav__item> <a href=../../../3rd-library/glide6/ title="Glide v4 源码解析（六）" class=md-nav__link> Glide v4 源码解析（六） </a> </li> <li class=md-nav__item> <a href=../../../3rd-library/glide7/ title="Glide v4 源码解析（七）" class=md-nav__link> Glide v4 源码解析（七） </a> </li> <li class=md-nav__item> <a href=../../../3rd-library/migrate-to-glide/ title=杂记：从Picasso迁移至Glide class=md-nav__link> 杂记：从Picasso迁移至Glide </a> </li> <li class=md-nav__item> <a href=../../../3rd-library/eventbus/ title=EventBus源码解析 class=md-nav__link> EventBus源码解析 </a> </li> <li class=md-nav__item> <a href=../../../3rd-library/leakcanary/ title=LeakCanary2源码解析 class=md-nav__link> LeakCanary2源码解析 </a> </li> <li class=md-nav__item> <a href=../../../3rd-library/permissiondispatcher/ title=PermissionDispatcher源码解析 class=md-nav__link> PermissionDispatcher源码解析 </a> </li> <li class=md-nav__item> <a href=../../../other/constraintlayout/ title=ConstraintLayout使用大全 class=md-nav__link> ConstraintLayout使用大全 </a> </li> <li class=md-nav__item> <a href=../../../other/dagger2/ title=初学者的Dagger2教程 class=md-nav__link> 初学者的Dagger2教程 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-2 type=checkbox id=nav-2-2> <label class=md-nav__link for=nav-2-2> Android开发高手课 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-2> Android开发高手课 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../master/ title=Android开发高手课 class=md-nav__link> Android开发高手课 </a> </li> <li class=md-nav__item> <a href=../../master/crash_1/ title="01 | 崩溃优化（上）：关于“崩溃”那些事儿" class=md-nav__link> 01 | 崩溃优化（上）：关于“崩溃”那些事儿 </a> </li> <li class=md-nav__item> <a href=../../master/crash_2/ title="02 | 崩溃优化（下）：应用崩溃了，你应该如何去分析？" class=md-nav__link> 02 | 崩溃优化（下）：应用崩溃了，你应该如何去分析？ </a> </li> <li class=md-nav__item> <a href=../../master/memory_1/ title="03 | 内存优化（上）：4GB内存时代，再谈内存优化" class=md-nav__link> 03 | 内存优化（上）：4GB内存时代，再谈内存优化 </a> </li> <li class=md-nav__item> <a href=../../master/memory_2/ title="04 | 内存优化（下）：内存优化这件事，应该从哪里着手？" class=md-nav__link> 04 | 内存优化（下）：内存优化这件事，应该从哪里着手？ </a> </li> <li class=md-nav__item> <a href=../../master/stuck_1/ title="05 | 卡顿优化（上）：你要掌握的卡顿分析方法" class=md-nav__link> 05 | 卡顿优化（上）：你要掌握的卡顿分析方法 </a> </li> <li class=md-nav__item> <a href=../../master/stuck_2/ title="06 | 卡顿优化（下）：如何监控应用卡顿？" class=md-nav__link> 06 | 卡顿优化（下）：如何监控应用卡顿？ </a> </li> <li class=md-nav__item> <a href=../../master/stuck_3/ title="06补充篇 | 卡顿优化：卡顿现场与卡顿分析" class=md-nav__link> 06补充篇 | 卡顿优化：卡顿现场与卡顿分析 </a> </li> <li class=md-nav__item> <a href=../../master/start_1/ title="07 | 启动优化（上）：从启动过程看启动速度优化" class=md-nav__link> 07 | 启动优化（上）：从启动过程看启动速度优化 </a> </li> <li class=md-nav__item> <a href=../../master/start_2/ title="08 | 启动优化（下）：优化启动速度的进阶方法" class=md-nav__link> 08 | 启动优化（下）：优化启动速度的进阶方法 </a> </li> <li class=md-nav__item> <a href=../../master/io_1/ title="09 | I/O优化（上）：开发工程师必备的I/O优化知识" class=md-nav__link> 09 | I/O优化（上）：开发工程师必备的I/O优化知识 </a> </li> <li class=md-nav__item> <a href=../../master/io_2/ title="10 | I/O优化（中）：不同I/O方式的使用场景是什么？" class=md-nav__link> 10 | I/O优化（中）：不同I/O方式的使用场景是什么？ </a> </li> <li class=md-nav__item> <a href=../../master/io_3/ title="11 | I/O优化（下）：如何监控线上I/O操作？" class=md-nav__link> 11 | I/O优化（下）：如何监控线上I/O操作？ </a> </li> <li class=md-nav__item> <a href=../../master/storage_1/ title="12 | 存储优化（上）：常见的数据存储方法有哪些？" class=md-nav__link> 12 | 存储优化（上）：常见的数据存储方法有哪些？ </a> </li> <li class=md-nav__item> <a href=../../master/storage_2/ title="13 | 存储优化（中）：如何优化数据存储？" class=md-nav__link> 13 | 存储优化（中）：如何优化数据存储？ </a> </li> <li class=md-nav__item> <a href=../../master/storage_3/ title="14 | 存储优化（下）：数据库SQLite的使用和优化" class=md-nav__link> 14 | 存储优化（下）：数据库SQLite的使用和优化 </a> </li> <li class=md-nav__item> <a href=../../master/network_1/ title="15 | 网络优化（上）：移动开发工程师必备的网络优化知识" class=md-nav__link> 15 | 网络优化（上）：移动开发工程师必备的网络优化知识 </a> </li> <li class=md-nav__item> <a href=../../master/network_2/ title="16 | 网络优化（中）：复杂多变的移动网络该如何优化？" class=md-nav__link> 16 | 网络优化（中）：复杂多变的移动网络该如何优化？ </a> </li> <li class=md-nav__item> <a href=../../master/network_3/ title="17 | 网络优化（下）：大数据下网络该如何监控？" class=md-nav__link> 17 | 网络优化（下）：大数据下网络该如何监控？ </a> </li> <li class=md-nav__item> <a href=../../master/battery_1/ title="18 | 耗电优化（上）：从电量优化的演进看耗电分析" class=md-nav__link> 18 | 耗电优化（上）：从电量优化的演进看耗电分析 </a> </li> <li class=md-nav__item> <a href=../../master/battery_2/ title="19 | 耗电优化（下）：耗电的优化方法与线上监控" class=md-nav__link> 19 | 耗电优化（下）：耗电的优化方法与线上监控 </a> </li> <li class=md-nav__item> <a href=../../master/ui_1/ title="20 | UI 优化（上）：UI 渲染的几个关键概念" class=md-nav__link> 20 | UI 优化（上）：UI 渲染的几个关键概念 </a> </li> <li class=md-nav__item> <a href=../../master/ui_2/ title="21 | UI 优化（下）：如何优化 UI 渲染？" class=md-nav__link> 21 | UI 优化（下）：如何优化 UI 渲染？ </a> </li> <li class=md-nav__item> <a href=../../master/package_1/ title="22 | 包体积优化（上）：如何减少安装包大小？" class=md-nav__link> 22 | 包体积优化（上）：如何减少安装包大小？ </a> </li> <li class=md-nav__item> <a href=../../master/package_2/ title="23 | 包体积优化（下）：资源优化的进阶实践" class=md-nav__link> 23 | 包体积优化（下）：资源优化的进阶实践 </a> </li> <li class=md-nav__item> <a href=../../master/compile/ title="26 | 关于编译，你需要了解什么？" class=md-nav__link> 26 | 关于编译，你需要了解什么？ </a> </li> <li class=md-nav__item> <a href=../../master/bytecode/ title="27 | 编译插桩的三种方法：AspectJ、ASM、ReDex" class=md-nav__link> 27 | 编译插桩的三种方法：AspectJ、ASM、ReDex </a> </li> <li class=md-nav__item> <a href=../../master/native_hook/ title="35 | Native Hook 技术，天使还是魔鬼？" class=md-nav__link> 35 | Native Hook 技术，天使还是魔鬼？ </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-3 type=checkbox id=nav-2-3> <label class=md-nav__link for=nav-2-3> Framework系列 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-3> Framework系列 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../framework/Android四大组件(1)/ title=Activity class=md-nav__link> Activity </a> </li> <li class=md-nav__item> <a href=../../../framework/Android四大组件(2)/ title=Service class=md-nav__link> Service </a> </li> <li class=md-nav__item> <a href=../../../framework/Android四大组件(3)/ title=Broadcasts class=md-nav__link> Broadcasts </a> </li> <li class=md-nav__item> <a href=../../../framework/Android四大组件(4)/ title="Content Providers与Fragment" class=md-nav__link> Content Providers与Fragment </a> </li> <li class=md-nav__item> <a href=../../../framework/IPC机制/ title=IPC机制 class=md-nav__link> IPC机制 </a> </li> <li class=md-nav__item> <a href=../../../framework/View的事件体系/ title=View的事件体系 class=md-nav__link> View的事件体系 </a> </li> <li class=md-nav__item> <a href=../../../framework/View的绘制原理/ title=View的绘制原理 class=md-nav__link> View的绘制原理 </a> </li> <li class=md-nav__item> <a href=../../../framework/RemoteViews/ title=RemoteViews class=md-nav__link> RemoteViews </a> </li> <li class=md-nav__item> <a href=../../../framework/Drawable/ title=Android中的Drawable资源 class=md-nav__link> Android中的Drawable资源 </a> </li> <li class=md-nav__item> <a href=../../../framework/Android动画/ title=Android动画 class=md-nav__link> Android动画 </a> </li> <li class=md-nav__item> <a href=../../../framework/Window与WindowManager/ title=Window与WindowManager class=md-nav__link> Window与WindowManager </a> </li> <li class=md-nav__item> <a href=../../../framework/四大组件启动过程/ title=四大组件启动过程 class=md-nav__link> 四大组件启动过程 </a> </li> <li class=md-nav__item> <a href=../../../framework/Android消息机制/ title=Android消息机制 class=md-nav__link> Android消息机制 </a> </li> <li class=md-nav__item> <a href=../../../framework/Android线程与线程池/ title=Android线程与线程池 class=md-nav__link> Android线程与线程池 </a> </li> <li class=md-nav__item> <a href=../../../framework/Bitmap的缓存与加载/ title=Bitmap的缓存与加载 class=md-nav__link> Bitmap的缓存与加载 </a> </li> <li class=md-nav__item> <a href=../../../framework/JNI与NDK/ title=JNI与NDK编程简介 class=md-nav__link> JNI与NDK编程简介 </a> </li> <li class=md-nav__item> <a href=../../../framework/性能优化/ title=Android性能优化 class=md-nav__link> Android性能优化 </a> </li> <li class=md-nav__item> <a href=../../../framework/binder1-mediaservice/ title=Binder深入理解——以MediaService为例 class=md-nav__link> Binder深入理解——以MediaService为例 </a> </li> <li class=md-nav__item> <a href=../../../framework/binder2/ title=Binder深入理解——罗老师系列 class=md-nav__link> Binder深入理解——罗老师系列 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-4 type=checkbox id=nav-2-4 checked> <label class=md-nav__link for=nav-2-4> 付费知识归档 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-4> 付费知识归档 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-4-1 type=checkbox id=nav-2-4-1 checked> <label class=md-nav__link for=nav-2-4-1> 某圈问题索引 </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-2-4-1> 某圈问题索引 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../zsxq_index/ title=某圈问题索引 class=md-nav__link> 某圈问题索引 </a> </li> <li class=md-nav__item> <a href=../week1-synchronized/ title=理解Java中synchronized关键词 class=md-nav__link> 理解Java中synchronized关键词 </a> </li> <li class=md-nav__item> <a href=../week2-service/ title=理解Service class=md-nav__link> 理解Service </a> </li> <li class=md-nav__item> <a href=../week3-activity/ title=理解Activity的启动模式 class=md-nav__link> 理解Activity的启动模式 </a> </li> <li class=md-nav__item> <a href=../week4-startActivityForResult/ title=关于startActivityForResult class=md-nav__link> 关于startActivityForResult </a> </li> <li class=md-nav__item> <a href=../week5-view/ title=关于View的知识 class=md-nav__link> 关于View的知识 </a> </li> <li class=md-nav__item> <a href=../week6-gradle/ title=关于Gradle的知识 class=md-nav__link> 关于Gradle的知识 </a> </li> <li class=md-nav__item> <a href=../week7-serialization/ title=关于序列化的知识 class=md-nav__link> 关于序列化的知识 </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-toggle md-nav__toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Android中的ClassLoader </label> <a href=./ title=Android中的ClassLoader class="md-nav__link md-nav__link--active"> Android中的ClassLoader </a> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>目录</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#question class=md-nav__link> Question </a> </li> <li class=md-nav__item> <a href=#answer class=md-nav__link> Answer </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-androidclassloader class=md-nav__link> 1. Android中有哪几种ClassLoader？它们的作用和区别是什么？ </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#11-bootclassloader class=md-nav__link> 1.1 BootClassLoader </a> </li> <li class=md-nav__item> <a href=#12-urlclassloader class=md-nav__link> 1.2 URLClassLoader </a> </li> <li class=md-nav__item> <a href=#13-basedexclassloader class=md-nav__link> 1.3 BaseDexClassLoader </a> </li> <li class=md-nav__item> <a href=#14-dexclassloader class=md-nav__link> 1.4 DexClassLoader </a> </li> <li class=md-nav__item> <a href=#15-pathclassloader class=md-nav__link> 1.5 PathClassLoader </a> </li> <li class=md-nav__item> <a href=#16-inmemorydexclassloader class=md-nav__link> 1.6 InMemoryDexClassLoader </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2-classloader class=md-nav__link> 2. 简述ClassLoader的双亲委托模型 </a> </li> <li class=md-nav__item> <a href=#3 class=md-nav__link> 3. 简述双亲委托模型在热修复领域的应用 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#__comments class="md-nav__link md-nav__link--active"> 评论 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../week11-binder/ title=Binder简介 class=md-nav__link> Binder简介 </a> </li> <li class=md-nav__item> <a href=../week12-retrofit-okhttp/ title=OkHttp和Retrofit的作用以及两者之间的联系 class=md-nav__link> OkHttp和Retrofit的作用以及两者之间的联系 </a> </li> <li class=md-nav__item> <a href=../week14-jvm-gc/ title=JVM中垃圾回收策略 class=md-nav__link> JVM中垃圾回收策略 </a> </li> <li class=md-nav__item> <a href=../week16-keep-app-alive/ title=进程保活 class=md-nav__link> 进程保活 </a> </li> <li class=md-nav__item> <a href=../week17-android-components/ title=四大组件的作用以及多进程 class=md-nav__link> 四大组件的作用以及多进程 </a> </li> <li class=md-nav__item> <a href=../week20-network-protocol/ title=网络协议 class=md-nav__link> 网络协议 </a> </li> <li class=md-nav__item> <a href=../week21-mvc&amp;mvp&mvvm/ title=MVC、MVP和MVVM class=md-nav__link> MVC、MVP和MVVM </a> </li> <li class=md-nav__item> <a href=../week22-android-studio-build/ title="Android Studio build过程" class=md-nav__link> Android Studio build过程 </a> </li> <li class=md-nav__item> <a href=../week23-load-large-bitmap/ title=大尺寸图片加载问题 class=md-nav__link> 大尺寸图片加载问题 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-5 type=checkbox id=nav-2-5> <label class=md-nav__link for=nav-2-5> 日常记录 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-5> 日常记录 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../other/annotation/ title=注解的定义及解析 class=md-nav__link> 注解的定义及解析 </a> </li> <li class=md-nav__item> <a href=../../../other/best_throttle_in_mvvm/ title=这可能是MVVM中最优雅的按键防抖方案 class=md-nav__link> 这可能是MVVM中最优雅的按键防抖方案 </a> </li> <li class=md-nav__item> <a href=../../../other/android-jenkins/ title="Jenkins for android" class=md-nav__link> Jenkins for android </a> </li> <li class=md-nav__item> <a href=../../../other/SystemProrities/ title=普通Android程序使用SystemProrities class=md-nav__link> 普通Android程序使用SystemProrities </a> </li> <li class=md-nav__item> <a href=../../../other/recyclerview-cache/ title=ListView、RecyclerView缓存策略解析 class=md-nav__link> ListView、RecyclerView缓存策略解析 </a> </li> <li class=md-nav__item> <a href=../../../other/recyclerview-item-docoration/ title=RecyclerView高级特性——ItemDecoration class=md-nav__link> RecyclerView高级特性——ItemDecoration </a> </li> <li class=md-nav__item> <a href=../../../other/recyclerview-others/ title=RecyclerView的一些使用细节 class=md-nav__link> RecyclerView的一些使用细节 </a> </li> <li class=md-nav__item> <a href=../../../other/RecyclerView-Sort&Delete/ title=RecyclerView高级特性——拖拽排序以及滑动删除 class=md-nav__link> RecyclerView高级特性——拖拽排序以及滑动删除 </a> </li> <li class=md-nav__item> <a href=../../../other/FAB-Behavior/ title=FloatingActionButton上滑隐藏下滑显示 class=md-nav__link> FloatingActionButton上滑隐藏下滑显示 </a> </li> <li class=md-nav__item> <a href=../../../other/nestedscrolling/ title=NestedScrolling机制 class=md-nav__link> NestedScrolling机制 </a> </li> <li class=md-nav__item> <a href=../../../other/porterduff/ title=使用Porter-Duff合成数字图像 class=md-nav__link> 使用Porter-Duff合成数字图像 </a> </li> <li class=md-nav__item> <a href=../../../other/runtime/ title="Android Runtime" class=md-nav__link> Android Runtime </a> </li> <li class=md-nav__item> <a href=../../../other/android_alias/ title=Android马甲包的那些事儿 class=md-nav__link> Android马甲包的那些事儿 </a> </li> <li class=md-nav__item> <a href=../../../other/Android-Development-Tool/ title=Android神兵利器 class=md-nav__link> Android神兵利器 </a> </li> <li class=md-nav__item> <a href=../../../other/FileProvider/ title=FileProvider class=md-nav__link> FileProvider </a> </li> <li class=md-nav__item> <a href=../../../other/Android判断导航栏高度/ title=Android判断虚拟按键(导航栏)显示与否、高度以及获取屏幕实际高度 class=md-nav__link> Android判断虚拟按键(导航栏)显示与否、高度以及获取屏幕实际高度 </a> </li> <li class=md-nav__item> <a href=../../../other/Android图片选择器/ title=Android图片选择器 class=md-nav__link> Android图片选择器 </a> </li> <li class=md-nav__item> <a href=../../../other/Android底部导航栏框架/ title=Android原生底部导航栏 class=md-nav__link> Android原生底部导航栏 </a> </li> <li class=md-nav__item> <a href=../../../other/Android搜索栏的实现/ title=Android搜索栏的实现 class=md-nav__link> Android搜索栏的实现 </a> </li> <li class=md-nav__item> <a href=../../../other/Android暂停音乐播放器的播放/ title=Android暂停酷狗、网易云音乐等音乐播放器的播放 class=md-nav__link> Android暂停酷狗、网易云音乐等音乐播放器的播放 </a> </li> <li class=md-nav__item> <a href=../../../other/Android滑动返回实践/ title=Android滑动返回实践 class=md-nav__link> Android滑动返回实践 </a> </li> <li class=md-nav__item> <a href=../../../other/Android程序反编译/ title=MacOS下Android程序反编译 class=md-nav__link> MacOS下Android程序反编译 </a> </li> <li class=md-nav__item> <a href=../../../other/Android通讯录快速读取/ title=Android通讯录快速读取 class=md-nav__link> Android通讯录快速读取 </a> </li> <li class=md-nav__item> <a href=../../../other/soft-keyboard-in-app/ title=App内自定义软键盘 class=md-nav__link> App内自定义软键盘 </a> </li> <li class=md-nav__item> <a href=../../../other/腾讯X5内核入坑指南/ title="腾讯TBS X5浏览器内核入坑指南" class=md-nav__link> 腾讯TBS X5浏览器内核入坑指南 </a> </li> <li class=md-nav__item> <a href=../../../other/琐碎知识点/ title=琐碎知识点 class=md-nav__link> 琐碎知识点 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3 type=checkbox id=nav-3> <label class=md-nav__link for=nav-3> Flutter </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-3> Flutter </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../flutter/flutter_first_project_1/ title=年轻人的第一个Flutter程序(1) class=md-nav__link> 年轻人的第一个Flutter程序(1) </a> </li> <li class=md-nav__item> <a href=../../../../flutter/flutter_first_project_2/ title=年轻人的第一个Flutter程序(2) class=md-nav__link> 年轻人的第一个Flutter程序(2) </a> </li> <li class=md-nav__item> <a href=../../../../flutter/flutter_first_project_3/ title=年轻人的第一个Flutter程序(3) class=md-nav__link> 年轻人的第一个Flutter程序(3) </a> </li> <li class=md-nav__item> <a href=../../../../flutter/flutter_first_project_4/ title=年轻人的第一个Flutter程序(4) class=md-nav__link> 年轻人的第一个Flutter程序(4) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4 type=checkbox id=nav-4> <label class=md-nav__link for=nav-4> LeetCode </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-4> LeetCode </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../leetcode/ title=算法目录 class=md-nav__link> 算法目录 </a> </li> <li class=md-nav__item> <a href=../../../../leetcode/code_interviews_1/ title=数据结构、算法和数据操作 class=md-nav__link> 数据结构、算法和数据操作 </a> </li> <li class=md-nav__item> <a href=../../../../leetcode/code_interviews_3/ title=高质量的代码 class=md-nav__link> 高质量的代码 </a> </li> <li class=md-nav__item> <a href=../../../../leetcode/code_interviews_4/ title=解决问题的思路 class=md-nav__link> 解决问题的思路 </a> </li> <li class=md-nav__item> <a href=../../../../leetcode/code_interviews_5/ title=优化时间和空间效率 class=md-nav__link> 优化时间和空间效率 </a> </li> <li class=md-nav__item> <a href=../../../../leetcode/code_interviews_6/ title=面试中的各项能力 class=md-nav__link> 面试中的各项能力 </a> </li> <li class=md-nav__item> <a href=../../../../leetcode/array/ title=Array class=md-nav__link> Array </a> </li> <li class=md-nav__item> <a href=../../../../leetcode/leetcode1-10/ title=LeetCode(1-10) class=md-nav__link> LeetCode(1-10) </a> </li> <li class=md-nav__item> <a href=../../../../leetcode/leetcode11-20/ title=LeetCode(11-20) class=md-nav__link> LeetCode(11-20) </a> </li> <li class=md-nav__item> <a href=../../../../leetcode/leetcode21-30/ title=LeetCode(21-30) class=md-nav__link> LeetCode(21-30) </a> </li> <li class=md-nav__item> <a href=../../../../leetcode/leetcode31-40/ title=LeetCode(31-40) class=md-nav__link> LeetCode(31-40) </a> </li> <li class=md-nav__item> <a href=../../../../leetcode/leetcode41-50/ title=LeetCode(41-50) class=md-nav__link> LeetCode(41-50) </a> </li> <li class=md-nav__item> <a href=../../../../leetcode/leetcode51-60/ title=LeetCode(51-60) class=md-nav__link> LeetCode(51-60) </a> </li> <li class=md-nav__item> <a href=../../../../leetcode/leetcode61-70/ title=LeetCode(61-70) class=md-nav__link> LeetCode(61-70) </a> </li> <li class=md-nav__item> <a href=../../../../leetcode/leetcode71-80/ title=LeetCode(71-80) class=md-nav__link> LeetCode(71-80) </a> </li> <li class=md-nav__item> <a href=../../../../leetcode/leetcode81-90/ title=LeetCode(81-90) class=md-nav__link> LeetCode(81-90) </a> </li> <li class=md-nav__item> <a href=../../../../leetcode/leetcode91-100/ title=LeetCode(91-100) class=md-nav__link> LeetCode(91-100) </a> </li> <li class=md-nav__item> <a href=../../../../leetcode/leetcode101-110/ title=LeetCode(101-110) class=md-nav__link> LeetCode(101-110) </a> </li> <li class=md-nav__item> <a href=../../../../leetcode/leetcode111-120/ title=LeetCode(111-120) class=md-nav__link> LeetCode(111-120) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5 type=checkbox id=nav-5> <label class=md-nav__link for=nav-5> Books </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-5> Books </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-1 type=checkbox id=nav-5-1> <label class=md-nav__link for=nav-5-1> Design Pattern </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-1> Design Pattern </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../design-pattern/design-pattern/ title=设计模式概述 class=md-nav__link> 设计模式概述 </a> </li> <li class=md-nav__item> <a href=../../../../design-pattern/design-principle/ title=面向对象的六大原则 class=md-nav__link> 面向对象的六大原则 </a> </li> <li class=md-nav__item> <a href=../../../../design-pattern/singleton/ title=单例模式(Singleton) class=md-nav__link> 单例模式(Singleton) </a> </li> <li class=md-nav__item> <a href=../../../../design-pattern/builder/ title=建造者模式(Builder) class=md-nav__link> 建造者模式(Builder) </a> </li> <li class=md-nav__item> <a href=../../../../design-pattern/prototype/ title=原型模式(Prototype) class=md-nav__link> 原型模式(Prototype) </a> </li> <li class=md-nav__item> <a href=../../../../design-pattern/factory-method/ title="工厂方法模式(Factory method)" class=md-nav__link> 工厂方法模式(Factory method) </a> </li> <li class=md-nav__item> <a href=../../../../design-pattern/abstract-factory/ title="抽象工厂模式(Abstract factory)" class=md-nav__link> 抽象工厂模式(Abstract factory) </a> </li> <li class=md-nav__item> <a href=../../../../design-pattern/proxy/ title=代理模式(Proxy) class=md-nav__link> 代理模式(Proxy) </a> </li> <li class=md-nav__item> <a href=../../../../design-pattern/composite/ title=组合模式(Composite) class=md-nav__link> 组合模式(Composite) </a> </li> <li class=md-nav__item> <a href=../../../../design-pattern/adapter/ title=适配器模式(Adapter) class=md-nav__link> 适配器模式(Adapter) </a> </li> <li class=md-nav__item> <a href=../../../../design-pattern/decorator/ title=装饰模式(Decorator) class=md-nav__link> 装饰模式(Decorator) </a> </li> <li class=md-nav__item> <a href=../../../../design-pattern/flyweight/ title=享元模式(Flyweight) class=md-nav__link> 享元模式(Flyweight) </a> </li> <li class=md-nav__item> <a href=../../../../design-pattern/facade/ title=外观模式(Facade) class=md-nav__link> 外观模式(Facade) </a> </li> <li class=md-nav__item> <a href=../../../../design-pattern/bridge/ title=桥接模式(Bridge) class=md-nav__link> 桥接模式(Bridge) </a> </li> <li class=md-nav__item> <a href=../../../../design-pattern/strategy/ title=策略模式(Strategy) class=md-nav__link> 策略模式(Strategy) </a> </li> <li class=md-nav__item> <a href=../../../../design-pattern/state/ title=状态模式(State) class=md-nav__link> 状态模式(State) </a> </li> <li class=md-nav__item> <a href=../../../../design-pattern/chain-of-responsibility/ title="责任链模式(Chain of responsibility)" class=md-nav__link> 责任链模式(Chain of responsibility) </a> </li> <li class=md-nav__item> <a href=../../../../design-pattern/interpreter/ title=解释器模式(Interpreter) class=md-nav__link> 解释器模式(Interpreter) </a> </li> <li class=md-nav__item> <a href=../../../../design-pattern/command/ title=命令模式(Command) class=md-nav__link> 命令模式(Command) </a> </li> <li class=md-nav__item> <a href=../../../../design-pattern/observer/ title=观察者模式(Observer) class=md-nav__link> 观察者模式(Observer) </a> </li> <li class=md-nav__item> <a href=../../../../design-pattern/memento/ title=备忘录模式(Memento) class=md-nav__link> 备忘录模式(Memento) </a> </li> <li class=md-nav__item> <a href=../../../../design-pattern/iterator/ title=迭代器模式(Iterator) class=md-nav__link> 迭代器模式(Iterator) </a> </li> <li class=md-nav__item> <a href=../../../../design-pattern/template-method/ title="模版方法模式(Template method)" class=md-nav__link> 模版方法模式(Template method) </a> </li> <li class=md-nav__item> <a href=../../../../design-pattern/visitor/ title=访问者模式(Visitor) class=md-nav__link> 访问者模式(Visitor) </a> </li> <li class=md-nav__item> <a href=../../../../design-pattern/mediator/ title=中介者模式(Mediator) class=md-nav__link> 中介者模式(Mediator) </a> </li> <li class=md-nav__item> <a href=../../../../design-pattern/confusing-design-pattern/ title=易混淆的设计模式 class=md-nav__link> 易混淆的设计模式 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2 type=checkbox id=nav-5-2> <label class=md-nav__link for=nav-5-2> Effective Java </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-2> Effective Java </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../effective-java/effective-java/ title="Effective Java概述" class=md-nav__link> Effective Java概述 </a> </li> <li class=md-nav__item> <a href=../../../../effective-java/chapter1/ title=创建和销毁对象 class=md-nav__link> 创建和销毁对象 </a> </li> <li class=md-nav__item> <a href=../../../../effective-java/chapter2/ title=对于所有对象都通用的方法 class=md-nav__link> 对于所有对象都通用的方法 </a> </li> <li class=md-nav__item> <a href=../../../../effective-java/chapter3/ title=类和接口 class=md-nav__link> 类和接口 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-3 type=checkbox id=nav-5-3> <label class=md-nav__link for=nav-5-3> JVM </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-3> JVM </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../jvm/jvm-content/ title=深入理解Java虚拟机 class=md-nav__link> 深入理解Java虚拟机 </a> </li> <li class=md-nav__item> <a href=../../../../jvm/java-memory-area-oom/ title=Java内存区域与内存溢出异常 class=md-nav__link> Java内存区域与内存溢出异常 </a> </li> <li class=md-nav__item> <a href=../../../../jvm/java-gc/ title=垃圾收集器与内存分配策略 class=md-nav__link> 垃圾收集器与内存分配策略 </a> </li> <li class=md-nav__item> <a href=../../../../jvm/class-struct/ title=类文件结构 class=md-nav__link> 类文件结构 </a> </li> <li class=md-nav__item> <a href=../../../../jvm/load-class/ title=虚拟机类加载机制 class=md-nav__link> 虚拟机类加载机制 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-4 type=checkbox id=nav-5-4> <label class=md-nav__link for=nav-5-4> Java </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-4> Java </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../java/generics-java-kotlin/ title=Java&Kotlin在泛型方面的区别 class=md-nav__link> Java&Kotlin在泛型方面的区别 </a> </li> <li class=md-nav__item> <a href=../../../../java/java-collections/ title=Java集合总结 class=md-nav__link> Java集合总结 </a> </li> <li class=md-nav__item> <a href=../../../../java/java-foundation/ title=Java常见概念 class=md-nav__link> Java常见概念 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-5 type=checkbox id=nav-5-5> <label class=md-nav__link for=nav-5-5> Refactoring </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-5> Refactoring </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../refactoring/refactoring/ title=重构：改善既有代码的设计 class=md-nav__link> 重构：改善既有代码的设计 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>目录</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#question class=md-nav__link> Question </a> </li> <li class=md-nav__item> <a href=#answer class=md-nav__link> Answer </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-androidclassloader class=md-nav__link> 1. Android中有哪几种ClassLoader？它们的作用和区别是什么？ </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#11-bootclassloader class=md-nav__link> 1.1 BootClassLoader </a> </li> <li class=md-nav__item> <a href=#12-urlclassloader class=md-nav__link> 1.2 URLClassLoader </a> </li> <li class=md-nav__item> <a href=#13-basedexclassloader class=md-nav__link> 1.3 BaseDexClassLoader </a> </li> <li class=md-nav__item> <a href=#14-dexclassloader class=md-nav__link> 1.4 DexClassLoader </a> </li> <li class=md-nav__item> <a href=#15-pathclassloader class=md-nav__link> 1.5 PathClassLoader </a> </li> <li class=md-nav__item> <a href=#16-inmemorydexclassloader class=md-nav__link> 1.6 InMemoryDexClassLoader </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2-classloader class=md-nav__link> 2. 简述ClassLoader的双亲委托模型 </a> </li> <li class=md-nav__item> <a href=#3 class=md-nav__link> 3. 简述双亲委托模型在热修复领域的应用 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#__comments class="md-nav__link md-nav__link--active"> 评论 </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <h1>Android中的ClassLoader</h1> <p>本文若无特殊说明，其源码版本为6.0.0_r5</p> <h2 id=question>Question<a class=headerlink href=#question title="Permanent link">&para;</a></h2> <p>话题：Android中的ClassLoader<br> 1、Android中有哪几种ClassLoader？它们的作用和区别是什么？<br> 2、简述ClassLoader的双亲委托模型<br> 3、简述双亲委托模型在热修复领域的应用 </p> <h2 id=answer>Answer<a class=headerlink href=#answer title="Permanent link">&para;</a></h2> <h3 id=1-androidclassloader>1. Android中有哪几种ClassLoader？它们的作用和区别是什么？<a class=headerlink href=#1-androidclassloader title="Permanent link">&para;</a></h3> <p>Android中有以下几种ClassLoader</p> <ul> <li>BootClassLoader</li> <li>URLClassLoader</li> <li>BaseDexClassLoader</li> <li>DexClassLoader</li> <li>PathClassLoader</li> <li>InMemoryDexClassLoader</li> </ul> <p>它们之间的关系可用下图表示<br> <img alt=classloader src=/assets/images/android/classloader.png></p> <h4 id=11-bootclassloader>1.1 BootClassLoader<a class=headerlink href=#11-bootclassloader title="Permanent link">&para;</a></h4> <p>BootClassLoader是ClassLoader的内部类。该类继承至ClassLoader，且构造器调用了<code>super(null)</code>。这表明 <strong>BootClassLoader是双亲委托机制中最顶层的ClassLoader</strong> 了。<br> 且注意到BootClassLoader访问修饰符是包级的，我们无法使用。</p> <p><strong><a href=http://androidxref.com/6.0.0_r5/xref/libcore/libart/src/main/java/java/lang/ClassLoader.java>ClassLoader.java</a></strong> <div class=codehilite><pre><span></span><span class=kd>public</span> <span class=kd>abstract</span> <span class=kd>class</span> <span class=nc>ClassLoader</span> <span class=p>{</span>

    <span class=kd>static</span> <span class=kd>private</span> <span class=kd>class</span> <span class=nc>SystemClassLoader</span> <span class=p>{</span>
        <span class=kd>public</span> <span class=kd>static</span> <span class=n>ClassLoader</span> <span class=n>loader</span> <span class=o>=</span> <span class=n>ClassLoader</span><span class=p>.</span><span class=na>createSystemClassLoader</span><span class=p>();</span>
    <span class=p>}</span>

    <span class=kd>private</span> <span class=kd>static</span> <span class=n>ClassLoader</span> <span class=nf>createSystemClassLoader</span><span class=p>()</span> <span class=p>{</span>
        <span class=n>String</span> <span class=n>classPath</span> <span class=o>=</span> <span class=n>System</span><span class=p>.</span><span class=na>getProperty</span><span class=p>(</span><span class=s>&quot;java.class.path&quot;</span><span class=p>,</span> <span class=s>&quot;.&quot;</span><span class=p>);</span>

        <span class=k>return</span> <span class=k>new</span> <span class=n>PathClassLoader</span><span class=p>(</span><span class=n>classPath</span><span class=p>,</span> <span class=n>BootClassLoader</span><span class=p>.</span><span class=na>getInstance</span><span class=p>());</span>
    <span class=p>}</span>

    <span class=kd>protected</span> <span class=nf>ClassLoader</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>this</span><span class=p>(</span><span class=n>getSystemClassLoader</span><span class=p>(),</span> <span class=kc>false</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=kd>protected</span> <span class=nf>ClassLoader</span><span class=p>(</span><span class=n>ClassLoader</span> <span class=n>parentLoader</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>this</span><span class=p>(</span><span class=n>parentLoader</span><span class=p>,</span> <span class=kc>false</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=n>ClassLoader</span><span class=p>(</span><span class=n>ClassLoader</span> <span class=n>parentLoader</span><span class=p>,</span> <span class=kt>boolean</span> <span class=n>nullAllowed</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>parentLoader</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=n>nullAllowed</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>throw</span> <span class=k>new</span> <span class=n>NullPointerException</span><span class=p>(</span><span class=s>&quot;parentLoader == null &amp;&amp; !nullAllowed&quot;</span><span class=p>);</span>
        <span class=p>}</span>
        <span class=n>parent</span> <span class=o>=</span> <span class=n>parentLoader</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>}</span>


<span class=kd>class</span> <span class=nc>BootClassLoader</span> <span class=kd>extends</span> <span class=n>ClassLoader</span> <span class=p>{</span>

    <span class=kd>private</span> <span class=kd>static</span> <span class=n>BootClassLoader</span> <span class=n>instance</span><span class=p>;</span>

    <span class=nd>@FindBugsSuppressWarnings</span><span class=p>(</span><span class=s>&quot;DP_CREATE_CLASSLOADER_INSIDE_DO_PRIVILEGED&quot;</span><span class=p>)</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kd>synchronized</span> <span class=n>BootClassLoader</span> <span class=nf>getInstance</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>instance</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>instance</span> <span class=o>=</span> <span class=k>new</span> <span class=n>BootClassLoader</span><span class=p>();</span>
        <span class=p>}</span>

        <span class=k>return</span> <span class=n>instance</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=kd>public</span> <span class=nf>BootClassLoader</span><span class=p>()</span> <span class=p>{</span>
        <span class=kd>super</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</pre></div></p> <h4 id=12-urlclassloader>1.2 URLClassLoader<a class=headerlink href=#12-urlclassloader title="Permanent link">&para;</a></h4> <p>URLClassLoader是通过URL加载资源的ClassLoader，其继承至SecureClassLoader，而SecureClassLoader继承至ClassLoader。<br> SecureClassLoader基于ClassLoader提供了权限机制。 </p> <p>URLClassLoader只能用于加载jar文件，由于dalvik不能直接识别jar，所以在Android中无法使用这个加载器。我们看一下相关代码。</p> <p><strong><a href=http://androidxref.com/6.0.0_r5/xref/libcore/luni/src/main/java/java/security/SecureClassLoader.java>SecureClassLoader.java</a></strong> <div class=codehilite><pre><span></span><span class=cm>/**</span>
<span class=cm> * {@code SecureClassLoader} represents a {@code ClassLoader} which associates</span>
<span class=cm> * the classes it loads with a code source and provide mechanisms to allow the</span>
<span class=cm> * relevant permissions to be retrieved.</span>
<span class=cm> */</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>SecureClassLoader</span> <span class=kd>extends</span> <span class=n>ClassLoader</span> <span class=p>{</span>

    <span class=kd>protected</span> <span class=nf>SecureClassLoader</span><span class=p>()</span> <span class=p>{</span>
    <span class=p>}</span>

    <span class=kd>protected</span> <span class=nf>SecureClassLoader</span><span class=p>(</span><span class=n>ClassLoader</span> <span class=n>parent</span><span class=p>)</span> <span class=p>{</span>
        <span class=kd>super</span><span class=p>(</span><span class=n>parent</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</pre></div></p> <p><strong><a href=http://androidxref.com/6.0.0_r5/xref/libcore/luni/src/main/java/java/net/URLClassLoader.java>URLClassLoader.java</a></strong> <div class=codehilite><pre><span></span><span class=cm>/**</span>
<span class=cm> * This class loader is responsible for loading classes and resources from a</span>
<span class=cm> * list of URLs which can refer to either directories or JAR files. Classes</span>
<span class=cm> * loaded by this {@code URLClassLoader} are granted permission to access the</span>
<span class=cm> * URLs contained in the URL search list.</span>
<span class=cm> */</span>
<span class=nd>@FindBugsSuppressWarnings</span><span class=p>({</span> <span class=s>&quot;DMI_COLLECTION_OF_URLS&quot;</span><span class=p>,</span> <span class=s>&quot;DP_CREATE_CLASSLOADER_INSIDE_DO_PRIVILEGED&quot;</span> <span class=p>})</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>URLClassLoader</span> <span class=kd>extends</span> <span class=n>SecureClassLoader</span> <span class=p>{</span>

    <span class=kd>public</span> <span class=nf>URLClassLoader</span><span class=p>(</span><span class=n>URL</span><span class=o>[]</span> <span class=n>urls</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>this</span><span class=p>(</span><span class=n>urls</span><span class=p>,</span> <span class=n>ClassLoader</span><span class=p>.</span><span class=na>getSystemClassLoader</span><span class=p>(),</span> <span class=kc>null</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=kd>public</span> <span class=nf>URLClassLoader</span><span class=p>(</span><span class=n>URL</span><span class=o>[]</span> <span class=n>urls</span><span class=p>,</span> <span class=n>ClassLoader</span> <span class=n>parent</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>this</span><span class=p>(</span><span class=n>urls</span><span class=p>,</span> <span class=n>parent</span><span class=p>,</span> <span class=kc>null</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=kd>public</span> <span class=kd>static</span> <span class=n>URLClassLoader</span> <span class=nf>newInstance</span><span class=p>(</span><span class=kd>final</span> <span class=n>URL</span><span class=o>[]</span> <span class=n>urls</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=k>new</span> <span class=n>URLClassLoader</span><span class=p>(</span><span class=n>urls</span><span class=p>,</span> <span class=n>ClassLoader</span><span class=p>.</span><span class=na>getSystemClassLoader</span><span class=p>());</span>
    <span class=p>}</span>

    <span class=kd>public</span> <span class=kd>static</span> <span class=n>URLClassLoader</span> <span class=nf>newInstance</span><span class=p>(</span><span class=kd>final</span> <span class=n>URL</span><span class=o>[]</span> <span class=n>urls</span><span class=p>,</span> <span class=kd>final</span> <span class=n>ClassLoader</span> <span class=n>parentCl</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=k>new</span> <span class=n>URLClassLoader</span><span class=p>(</span><span class=n>urls</span><span class=p>,</span> <span class=n>parentCl</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=cm>/**</span>
<span class=cm>     * Constructs a new {@code URLClassLoader} instance. The newly created</span>
<span class=cm>     * instance will have the specified {@code ClassLoader} as its parent and</span>
<span class=cm>     * use the specified factory to create stream handlers. URLs that end with</span>
<span class=cm>     * &quot;/&quot; are assumed to be directories, otherwise they are assumed to be JAR</span>
<span class=cm>     * files.</span>
<span class=cm>     *</span>
<span class=cm>     * @param searchUrls</span>
<span class=cm>     *            the list of URLs where a specific class or file could be</span>
<span class=cm>     *            found.</span>
<span class=cm>     * @param parent</span>
<span class=cm>     *            the {@code ClassLoader} to assign as this loader&#39;s parent.</span>
<span class=cm>     * @param factory</span>
<span class=cm>     *            the factory that will be used to create protocol-specific</span>
<span class=cm>     *            stream handlers.</span>
<span class=cm>     */</span>
    <span class=kd>public</span> <span class=nf>URLClassLoader</span><span class=p>(</span><span class=n>URL</span><span class=o>[]</span> <span class=n>searchUrls</span><span class=p>,</span> <span class=n>ClassLoader</span> <span class=n>parent</span><span class=p>,</span> <span class=n>URLStreamHandlerFactory</span> <span class=n>factory</span><span class=p>)</span> <span class=p>{</span>
        <span class=kd>super</span><span class=p>(</span><span class=n>parent</span><span class=p>);</span>
        <span class=k>this</span><span class=p>.</span><span class=na>factory</span> <span class=o>=</span> <span class=n>factory</span><span class=p>;</span>
        <span class=kt>int</span> <span class=n>nbUrls</span> <span class=o>=</span> <span class=n>searchUrls</span><span class=p>.</span><span class=na>length</span><span class=p>;</span>
        <span class=n>originalUrls</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;</span><span class=n>URL</span><span class=o>&gt;</span><span class=p>(</span><span class=n>nbUrls</span><span class=p>);</span>
        <span class=n>handlerList</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;</span><span class=n>URLHandler</span><span class=o>&gt;</span><span class=p>(</span><span class=n>nbUrls</span><span class=p>);</span>
        <span class=n>searchList</span> <span class=o>=</span> <span class=n>Collections</span><span class=p>.</span><span class=na>synchronizedList</span><span class=p>(</span><span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;</span><span class=n>URL</span><span class=o>&gt;</span><span class=p>(</span><span class=n>nbUrls</span><span class=p>));</span>
        <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>nbUrls</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>originalUrls</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>searchUrls</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>);</span>
            <span class=k>try</span> <span class=p>{</span>
                <span class=n>searchList</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>createSearchURL</span><span class=p>(</span><span class=n>searchUrls</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>));</span>
            <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>MalformedURLException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
            <span class=p>}</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>
</pre></div></p> <h4 id=13-basedexclassloader>1.3 BaseDexClassLoader<a class=headerlink href=#13-basedexclassloader title="Permanent link">&para;</a></h4> <p>BaseDexClassLoader继承至ClassLoader，用于加载apk/jar/dex中的资源。在该类中，由一个DexPathList对象维护dex文件的路径。 </p> <p><strong><a href=http://androidxref.com/6.0.0_r5/xref/libcore/dalvik/src/main/java/dalvik/system/BaseDexClassLoader.java>BaseDexClassLoader.java</a></strong> <div class=codehilite><pre><span></span><span class=kd>public</span> <span class=kd>class</span> <span class=nc>BaseDexClassLoader</span> <span class=kd>extends</span> <span class=n>ClassLoader</span> <span class=p>{</span>

    <span class=kd>private</span> <span class=kd>final</span> <span class=n>DexPathList</span> <span class=n>pathList</span><span class=p>;</span>

    <span class=cm>/**</span>
<span class=cm>     * Constructs an instance.</span>
<span class=cm>     *</span>
<span class=cm>     * @param dexPath the list of jar/apk files containing classes and</span>
<span class=cm>     * resources, delimited by {@code File.pathSeparator}, which</span>
<span class=cm>     * defaults to {@code &quot;:&quot;} on Android</span>
<span class=cm>     * @param optimizedDirectory directory where optimized dex files</span>
<span class=cm>     * should be written; may be {@code null}</span>
<span class=cm>     * @param libraryPath the list of directories containing native</span>
<span class=cm>     * libraries, delimited by {@code File.pathSeparator}; may be</span>
<span class=cm>     * {@code null}</span>
<span class=cm>     * @param parent the parent class loader</span>
<span class=cm>     */</span>
    <span class=kd>public</span> <span class=nf>BaseDexClassLoader</span><span class=p>(</span><span class=n>String</span> <span class=n>dexPath</span><span class=p>,</span> <span class=n>File</span> <span class=n>optimizedDirectory</span><span class=p>,</span>
            <span class=n>String</span> <span class=n>libraryPath</span><span class=p>,</span> <span class=n>ClassLoader</span> <span class=n>parent</span><span class=p>)</span> <span class=p>{</span>
        <span class=kd>super</span><span class=p>(</span><span class=n>parent</span><span class=p>);</span>
        <span class=k>this</span><span class=p>.</span><span class=na>pathList</span> <span class=o>=</span> <span class=k>new</span> <span class=n>DexPathList</span><span class=p>(</span><span class=k>this</span><span class=p>,</span> <span class=n>dexPath</span><span class=p>,</span> <span class=n>libraryPath</span><span class=p>,</span> <span class=n>optimizedDirectory</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</pre></div></p> <p>BaseDexClassLoader的构造器有四个参数</p> <ul> <li>dexPath<br> 包含classes和资源的apk/jar/zip/dex路径集合，在Android上一般用":"分割。<strong>可以从SD卡进行加载</strong> </li> <li>optimizedDirectory<br> odex后存放的目录，这个路径必须是一个内部存储路径，一般情况下使用当前应用程序的私有路径：/data/data/{Package Name}/</li> <li>libraryPath<br> native库存放的路径集合，用文件分隔符分割</li> <li>parent<br> 父ClassLoader，一般为当前执行类的ClassLoader，例如在Android中以context.getClassLoader()作为父ClassLoader</li> </ul> <h4 id=14-dexclassloader>1.4 DexClassLoader<a class=headerlink href=#14-dexclassloader title="Permanent link">&para;</a></h4> <p>先看DexClassLoader的源码。</p> <p><strong><a href=http://androidxref.com/6.0.0_r5/xref/libcore/dalvik/src/main/java/dalvik/system/DexClassLoader.java>DexClassLoader.java</a></strong><br> <div class=codehilite><pre><span></span><span class=kd>public</span> <span class=kd>class</span> <span class=nc>DexClassLoader</span> <span class=kd>extends</span> <span class=n>BaseDexClassLoader</span> <span class=p>{</span>

    <span class=kd>public</span> <span class=nf>DexClassLoader</span><span class=p>(</span><span class=n>String</span> <span class=n>dexPath</span><span class=p>,</span> <span class=n>String</span> <span class=n>optimizedDirectory</span><span class=p>,</span>
            <span class=n>String</span> <span class=n>libraryPath</span><span class=p>,</span> <span class=n>ClassLoader</span> <span class=n>parent</span><span class=p>)</span> <span class=p>{</span>
        <span class=kd>super</span><span class=p>(</span><span class=n>dexPath</span><span class=p>,</span> <span class=k>new</span> <span class=n>File</span><span class=p>(</span><span class=n>optimizedDirectory</span><span class=p>),</span> <span class=n>libraryPath</span><span class=p>,</span> <span class=n>parent</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</pre></div></p> <p>DexClassLoader源码就是简单的继承了BaseDexClassLoader。在构造器中将optimizedDirectory的类型由String转变成了File。 </p> <p>在URLClassLoader中提到 <strong>dalvik不能直接识别jar</strong> ，而在BaseDexClassLoader支持jar文件的原因是BaseDexClassLoader里面DexPathList.dexElements维持着Element数组，Element有一个DexFile，DexFile支持对apk/jar/zip的处理。<br> <strong>一般都是用DexClassLoader作为动态加载的加载器</strong>。</p> <p>可以参考<a href=http://androidxref.com/6.0.0_r5/xref/libcore/dalvik/src/main/java/dalvik/system/DexFile.java>DexFile.java</a>的部分注释 <div class=codehilite><pre><span></span><span class=cm>/**</span>
<span class=cm> * Manipulates DEX files. The class is similar in principle to</span>
<span class=cm> * {@link java.util.zip.ZipFile}. It is used primarily by class loaders.</span>
<span class=cm> * &lt;p&gt;</span>
<span class=cm> * Note we don&#39;t directly open and read the DEX file here. They&#39;re memory-mapped</span>
<span class=cm> * read-only by the VM.</span>
<span class=cm> */</span>
<span class=kd>public</span> <span class=kd>final</span> <span class=kd>class</span> <span class=nc>DexFile</span> <span class=p>{</span>
    <span class=kd>private</span> <span class=n>Object</span> <span class=n>mCookie</span><span class=p>;</span>
    <span class=kd>private</span> <span class=kd>final</span> <span class=n>String</span> <span class=n>mFileName</span><span class=p>;</span>
    <span class=kd>private</span> <span class=kd>final</span> <span class=n>CloseGuard</span> <span class=n>guard</span> <span class=o>=</span> <span class=n>CloseGuard</span><span class=p>.</span><span class=na>get</span><span class=p>();</span>

    <span class=cm>/**</span>
<span class=cm>     * Opens a DEX file from a given File object. This will usually be a ZIP/JAR</span>
<span class=cm>     * file with a &quot;classes.dex&quot; inside.</span>
<span class=cm>     *</span>
<span class=cm>     * The VM will generate the name of the corresponding file in</span>
<span class=cm>     * /data/dalvik-cache and open it, possibly creating or updating</span>
<span class=cm>     * it first if system permissions allow.  Don&#39;t pass in the name of</span>
<span class=cm>     * a file in /data/dalvik-cache, as the named file is expected to be</span>
<span class=cm>     * in its original (pre-dexopt) state.</span>
<span class=cm>     *</span>
<span class=cm>     * @param file</span>
<span class=cm>     *            the File object referencing the actual DEX file</span>
<span class=cm>     *</span>
<span class=cm>     * @throws IOException</span>
<span class=cm>     *             if an I/O error occurs, such as the file not being found or</span>
<span class=cm>     *             access rights missing for opening it</span>
<span class=cm>     */</span>
    <span class=kd>public</span> <span class=nf>DexFile</span><span class=p>(</span><span class=n>File</span> <span class=n>file</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>IOException</span> <span class=p>{</span>
        <span class=k>this</span><span class=p>(</span><span class=n>file</span><span class=p>.</span><span class=na>getPath</span><span class=p>());</span>
    <span class=p>}</span>

    <span class=cm>/**</span>
<span class=cm>     * Opens a DEX file from a given filename. This will usually be a ZIP/JAR</span>
<span class=cm>     * file with a &quot;classes.dex&quot; inside.</span>
<span class=cm>     *</span>
<span class=cm>     * The VM will generate the name of the corresponding file in</span>
<span class=cm>     * /data/dalvik-cache and open it, possibly creating or updating</span>
<span class=cm>     * it first if system permissions allow.  Don&#39;t pass in the name of</span>
<span class=cm>     * a file in /data/dalvik-cache, as the named file is expected to be</span>
<span class=cm>     * in its original (pre-dexopt) state.</span>
<span class=cm>     *</span>
<span class=cm>     * @param fileName</span>
<span class=cm>     *            the filename of the DEX file</span>
<span class=cm>     *</span>
<span class=cm>     * @throws IOException</span>
<span class=cm>     *             if an I/O error occurs, such as the file not being found or</span>
<span class=cm>     *             access rights missing for opening it</span>
<span class=cm>     */</span>
    <span class=kd>public</span> <span class=nf>DexFile</span><span class=p>(</span><span class=n>String</span> <span class=n>fileName</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>IOException</span> <span class=p>{</span>
        <span class=n>mCookie</span> <span class=o>=</span> <span class=n>openDexFile</span><span class=p>(</span><span class=n>fileName</span><span class=p>,</span> <span class=kc>null</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
        <span class=n>mFileName</span> <span class=o>=</span> <span class=n>fileName</span><span class=p>;</span>
        <span class=n>guard</span><span class=p>.</span><span class=na>open</span><span class=p>(</span><span class=s>&quot;close&quot;</span><span class=p>);</span>
        <span class=c1>//System.out.println(&quot;DEX FILE cookie is &quot; + mCookie + &quot; fileName=&quot; + fileName);</span>
    <span class=p>}</span>

    <span class=cm>/**</span>
<span class=cm>     * Opens a DEX file from a given filename, using a specified file</span>
<span class=cm>     * to hold the optimized data.</span>
<span class=cm>     *</span>
<span class=cm>     * @param sourceName</span>
<span class=cm>     *  Jar or APK file with &quot;classes.dex&quot;.</span>
<span class=cm>     * @param outputName</span>
<span class=cm>     *  File that will hold the optimized form of the DEX data.</span>
<span class=cm>     * @param flags</span>
<span class=cm>     *  Enable optional features.</span>
<span class=cm>     */</span>
    <span class=kd>private</span> <span class=nf>DexFile</span><span class=p>(</span><span class=n>String</span> <span class=n>sourceName</span><span class=p>,</span> <span class=n>String</span> <span class=n>outputName</span><span class=p>,</span> <span class=kt>int</span> <span class=n>flags</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>IOException</span> <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>outputName</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>try</span> <span class=p>{</span>
                <span class=n>String</span> <span class=n>parent</span> <span class=o>=</span> <span class=k>new</span> <span class=n>File</span><span class=p>(</span><span class=n>outputName</span><span class=p>).</span><span class=na>getParent</span><span class=p>();</span>
                <span class=k>if</span> <span class=p>(</span><span class=n>Libcore</span><span class=p>.</span><span class=na>os</span><span class=p>.</span><span class=na>getuid</span><span class=p>()</span> <span class=o>!=</span> <span class=n>Libcore</span><span class=p>.</span><span class=na>os</span><span class=p>.</span><span class=na>stat</span><span class=p>(</span><span class=n>parent</span><span class=p>).</span><span class=na>st_uid</span><span class=p>)</span> <span class=p>{</span>
                    <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalArgumentException</span><span class=p>(</span><span class=s>&quot;Optimized data directory &quot;</span> <span class=o>+</span> <span class=n>parent</span>
                            <span class=o>+</span> <span class=s>&quot; is not owned by the current user. Shared storage cannot protect&quot;</span>
                            <span class=o>+</span> <span class=s>&quot; your application from code injection attacks.&quot;</span><span class=p>);</span>
                <span class=p>}</span>
            <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>ErrnoException</span> <span class=n>ignored</span><span class=p>)</span> <span class=p>{</span>
                <span class=c1>// assume we&#39;ll fail with a more contextual error later</span>
            <span class=p>}</span>
        <span class=p>}</span>

        <span class=n>mCookie</span> <span class=o>=</span> <span class=n>openDexFile</span><span class=p>(</span><span class=n>sourceName</span><span class=p>,</span> <span class=n>outputName</span><span class=p>,</span> <span class=n>flags</span><span class=p>);</span>
        <span class=n>mFileName</span> <span class=o>=</span> <span class=n>sourceName</span><span class=p>;</span>
        <span class=n>guard</span><span class=p>.</span><span class=na>open</span><span class=p>(</span><span class=s>&quot;close&quot;</span><span class=p>);</span>
        <span class=c1>//System.out.println(&quot;DEX FILE cookie is &quot; + mCookie + &quot; sourceName=&quot; + sourceName + &quot; outputName=&quot; + outputName);</span>
    <span class=p>}</span>

    <span class=cm>/**</span>
<span class=cm>     * Open a DEX file, specifying the file in which the optimized DEX</span>
<span class=cm>     * data should be written.  If the optimized form exists and appears</span>
<span class=cm>     * to be current, it will be used; if not, the VM will attempt to</span>
<span class=cm>     * regenerate it.</span>
<span class=cm>     *</span>
<span class=cm>     * This is intended for use by applications that wish to download</span>
<span class=cm>     * and execute DEX files outside the usual application installation</span>
<span class=cm>     * mechanism.  This function should not be called directly by an</span>
<span class=cm>     * application; instead, use a class loader such as</span>
<span class=cm>     * dalvik.system.DexClassLoader.</span>
<span class=cm>     *</span>
<span class=cm>     * @param sourcePathName</span>
<span class=cm>     *  Jar or APK file with &quot;classes.dex&quot;.  (May expand this to include</span>
<span class=cm>     *  &quot;raw DEX&quot; in the future.)</span>
<span class=cm>     * @param outputPathName</span>
<span class=cm>     *  File that will hold the optimized form of the DEX data.</span>
<span class=cm>     * @param flags</span>
<span class=cm>     *  Enable optional features.  (Currently none defined.)</span>
<span class=cm>     * @return</span>
<span class=cm>     *  A new or previously-opened DexFile.</span>
<span class=cm>     * @throws IOException</span>
<span class=cm>     *  If unable to open the source or output file.</span>
<span class=cm>     */</span>
    <span class=kd>static</span> <span class=kd>public</span> <span class=n>DexFile</span> <span class=nf>loadDex</span><span class=p>(</span><span class=n>String</span> <span class=n>sourcePathName</span><span class=p>,</span> <span class=n>String</span> <span class=n>outputPathName</span><span class=p>,</span>
        <span class=kt>int</span> <span class=n>flags</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>IOException</span> <span class=p>{</span>

        <span class=cm>/*</span>
<span class=cm>         * TODO: we may want to cache previously-opened DexFile objects.</span>
<span class=cm>         * The cache would be synchronized with close().  This would help</span>
<span class=cm>         * us avoid mapping the same DEX more than once when an app</span>
<span class=cm>         * decided to open it multiple times.  In practice this may not</span>
<span class=cm>         * be a real issue.</span>
<span class=cm>         */</span>
        <span class=k>return</span> <span class=k>new</span> <span class=n>DexFile</span><span class=p>(</span><span class=n>sourcePathName</span><span class=p>,</span> <span class=n>outputPathName</span><span class=p>,</span> <span class=n>flags</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</pre></div></p> <h4 id=15-pathclassloader>1.5 PathClassLoader<a class=headerlink href=#15-pathclassloader title="Permanent link">&para;</a></h4> <p>PathClassLoader继承至BaseDexClassLoader，且optimizedDirectory=null。在BaseDexClassLoader中由于optimizedDirectory=null，在创建DexFile时会直接<code>new DexFile(file)</code>，从而导致会在<code>/data/dalvik-cache</code>中生成对应的优化文件，具体可以参考<a href=#14-dexclassloader>DexClassLoader小节</a>的<code>DexFile</code>源码注释。</p> <p><strong><a href=http://androidxref.com/6.0.0_r5/xref/libcore/dalvik/src/main/java/dalvik/system/PathClassLoader.java>PathClassLoader.java</a></strong> <div class=codehilite><pre><span></span><span class=cm>/**</span>
<span class=cm> * Provides a simple {@link ClassLoader} implementation that operates on a list</span>
<span class=cm> * of files and directories in the local file system, but does not attempt to</span>
<span class=cm> * load classes from the network. Android uses this class for its system class</span>
<span class=cm> * loader and for its application class loader(s).</span>
<span class=cm> */</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>PathClassLoader</span> <span class=kd>extends</span> <span class=n>BaseDexClassLoader</span> <span class=p>{</span>
    <span class=cm>/**</span>
<span class=cm>     * Creates a {@code PathClassLoader} that operates on a given list of files</span>
<span class=cm>     * and directories. This method is equivalent to calling</span>
<span class=cm>     * {@link #PathClassLoader(String, String, ClassLoader)} with a</span>
<span class=cm>     * {@code null} value for the second argument (see description there).</span>
<span class=cm>     *</span>
<span class=cm>     * @param dexPath the list of jar/apk files containing classes and</span>
<span class=cm>     * resources, delimited by {@code File.pathSeparator}, which</span>
<span class=cm>     * defaults to {@code &quot;:&quot;} on Android</span>
<span class=cm>     * @param parent the parent class loader</span>
<span class=cm>     */</span>
    <span class=kd>public</span> <span class=nf>PathClassLoader</span><span class=p>(</span><span class=n>String</span> <span class=n>dexPath</span><span class=p>,</span> <span class=n>ClassLoader</span> <span class=n>parent</span><span class=p>)</span> <span class=p>{</span>
        <span class=kd>super</span><span class=p>(</span><span class=n>dexPath</span><span class=p>,</span> <span class=kc>null</span><span class=p>,</span> <span class=kc>null</span><span class=p>,</span> <span class=n>parent</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=cm>/**</span>
<span class=cm>     * Creates a {@code PathClassLoader} that operates on two given</span>
<span class=cm>     * lists of files and directories. The entries of the first list</span>
<span class=cm>     * should be one of the following:</span>
<span class=cm>     *</span>
<span class=cm>     * &lt;ul&gt;</span>
<span class=cm>     * &lt;li&gt;JAR/ZIP/APK files, possibly containing a &quot;classes.dex&quot; file as</span>
<span class=cm>     * well as arbitrary resources.</span>
<span class=cm>     * &lt;li&gt;Raw &quot;.dex&quot; files (not inside a zip file).</span>
<span class=cm>     * &lt;/ul&gt;</span>
<span class=cm>     *</span>
<span class=cm>     * The entries of the second list should be directories containing</span>
<span class=cm>     * native library files.</span>
<span class=cm>     *</span>
<span class=cm>     * @param dexPath the list of jar/apk files containing classes and</span>
<span class=cm>     * resources, delimited by {@code File.pathSeparator}, which</span>
<span class=cm>     * defaults to {@code &quot;:&quot;} on Android</span>
<span class=cm>     * @param libraryPath the list of directories containing native</span>
<span class=cm>     * libraries, delimited by {@code File.pathSeparator}; may be</span>
<span class=cm>     * {@code null}</span>
<span class=cm>     * @param parent the parent class loader</span>
<span class=cm>     */</span>
    <span class=kd>public</span> <span class=nf>PathClassLoader</span><span class=p>(</span><span class=n>String</span> <span class=n>dexPath</span><span class=p>,</span> <span class=n>String</span> <span class=n>libraryPath</span><span class=p>,</span>
            <span class=n>ClassLoader</span> <span class=n>parent</span><span class=p>)</span> <span class=p>{</span>
        <span class=kd>super</span><span class=p>(</span><span class=n>dexPath</span><span class=p>,</span> <span class=kc>null</span><span class=p>,</span> <span class=n>libraryPath</span><span class=p>,</span> <span class=n>parent</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</pre></div></p> <p>PathClassLoader在dalvik虚拟机上只能加载已安装apk的dex，而在art虚拟机上可以加载未安装的apk的dex。注意到类注释中的 <em>Android uses this class for its system classloader and for its application class loader(s)</em> ，因此不建议开发者使用。 </p> <h4 id=16-inmemorydexclassloader>1.6 InMemoryDexClassLoader<a class=headerlink href=#16-inmemorydexclassloader title="Permanent link">&para;</a></h4> <p>InMemoryDexClassLoader是Android 8.0, Level 26上新增的类加载器。其继承至BaseDexClassLoader，并将dexBuffers交给BaseDexClassLoader中的DexPathList处理。</p> <p><strong><a href=http://androidxref.com/8.0.0_r4/xref/libcore/dalvik/src/main/java/dalvik/system/InMemoryDexClassLoader.java>InMemoryDexClassLoader.java</a></strong><br> <div class=codehilite><pre><span></span><span class=cm>/**</span>
<span class=cm> * A {@link ClassLoader} implementation that loads classes from a</span>
<span class=cm> * buffer containing a DEX file. This can be used to execute code that</span>
<span class=cm> * has not been written to the local file system.</span>
<span class=cm> */</span>
<span class=kd>public</span> <span class=kd>final</span> <span class=kd>class</span> <span class=nc>InMemoryDexClassLoader</span> <span class=kd>extends</span> <span class=n>BaseDexClassLoader</span> <span class=p>{</span>
    <span class=cm>/**</span>
<span class=cm>     * Create an in-memory DEX class loader with the given dex buffers.</span>
<span class=cm>     *</span>
<span class=cm>     * @param dexBuffers array of buffers containing DEX files between</span>
<span class=cm>     *                       &lt;tt&gt;buffer.position()&lt;/tt&gt; and &lt;tt&gt;buffer.limit()&lt;/tt&gt;.</span>
<span class=cm>     * @param parent the parent class loader for delegation.</span>
<span class=cm>     * @hide</span>
<span class=cm>     */</span>
    <span class=kd>public</span> <span class=nf>InMemoryDexClassLoader</span><span class=p>(</span><span class=n>ByteBuffer</span><span class=o>[]</span> <span class=n>dexBuffers</span><span class=p>,</span> <span class=n>ClassLoader</span> <span class=n>parent</span><span class=p>)</span> <span class=p>{</span>
        <span class=kd>super</span><span class=p>(</span><span class=n>dexBuffers</span><span class=p>,</span> <span class=n>parent</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=cm>/**</span>
<span class=cm>     * Creates a new in-memory DEX class loader.</span>
<span class=cm>     *</span>
<span class=cm>     * @param dexBuffer buffer containing DEX file contents between</span>
<span class=cm>     *                       &lt;tt&gt;buffer.position()&lt;/tt&gt; and &lt;tt&gt;buffer.limit()&lt;/tt&gt;.</span>
<span class=cm>     * @param parent the parent class loader for delegation.</span>
<span class=cm>     */</span>
    <span class=kd>public</span> <span class=nf>InMemoryDexClassLoader</span><span class=p>(</span><span class=n>ByteBuffer</span> <span class=n>dexBuffer</span><span class=p>,</span> <span class=n>ClassLoader</span> <span class=n>parent</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>this</span><span class=p>(</span><span class=k>new</span> <span class=n>ByteBuffer</span><span class=o>[]</span> <span class=p>{</span> <span class=n>dexBuffer</span> <span class=p>},</span> <span class=n>parent</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</pre></div></p> <h3 id=2-classloader>2. 简述ClassLoader的双亲委托模型<a class=headerlink href=#2-classloader title="Permanent link">&para;</a></h3> <p>ClassLoader的双亲委托模型具体体现在<a href=http://androidxref.com/6.0.0_r5/xref/libcore/libart/src/main/java/java/lang/ClassLoader.java#498>ClassLoader#loadClass</a>方法中：</p> <div class=codehilite><pre><span></span><span class=cm>/**</span>
<span class=cm> * Loads the class with the specified name, optionally linking it after</span>
<span class=cm> * loading. The following steps are performed:</span>
<span class=cm> * &lt;ol&gt;</span>
<span class=cm> * &lt;li&gt; Call {@link #findLoadedClass(String)} to determine if the requested</span>
<span class=cm> * class has already been loaded.&lt;/li&gt;</span>
<span class=cm> * &lt;li&gt;If the class has not yet been loaded: Invoke this method on the</span>
<span class=cm> * parent class loader.&lt;/li&gt;</span>
<span class=cm> * &lt;li&gt;If the class has still not been loaded: Call</span>
<span class=cm> * {@link #findClass(String)} to find the class.&lt;/li&gt;</span>
<span class=cm> * &lt;/ol&gt;</span>
<span class=cm> * &lt;p&gt;</span>
<span class=cm> * &lt;strong&gt;Note:&lt;/strong&gt; In the Android reference implementation, the</span>
<span class=cm> * {@code resolve} parameter is ignored; classes are never linked.</span>
<span class=cm> * &lt;/p&gt;</span>
<span class=cm> *</span>
<span class=cm> * @return the {@code Class} object.</span>
<span class=cm> * @param className</span>
<span class=cm> *            the name of the class to look for.</span>
<span class=cm> * @param resolve</span>
<span class=cm> *            Indicates if the class should be resolved after loading. This</span>
<span class=cm> *            parameter is ignored on the Android reference implementation;</span>
<span class=cm> *            classes are not resolved.</span>
<span class=cm> * @throws ClassNotFoundException</span>
<span class=cm> *             if the class can not be found.</span>
<span class=cm> */</span>
<span class=kd>protected</span> <span class=n>Class</span><span class=o>&lt;?&gt;</span> <span class=n>loadClass</span><span class=p>(</span><span class=n>String</span> <span class=n>className</span><span class=p>,</span> <span class=kt>boolean</span> <span class=n>resolve</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>ClassNotFoundException</span> <span class=p>{</span>
    <span class=n>Class</span><span class=o>&lt;?&gt;</span> <span class=n>clazz</span> <span class=o>=</span> <span class=n>findLoadedClass</span><span class=p>(</span><span class=n>className</span><span class=p>);</span>

    <span class=k>if</span> <span class=p>(</span><span class=n>clazz</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>ClassNotFoundException</span> <span class=n>suppressed</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
        <span class=k>try</span> <span class=p>{</span>
            <span class=n>clazz</span> <span class=o>=</span> <span class=n>parent</span><span class=p>.</span><span class=na>loadClass</span><span class=p>(</span><span class=n>className</span><span class=p>,</span> <span class=kc>false</span><span class=p>);</span>
        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>ClassNotFoundException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>suppressed</span> <span class=o>=</span> <span class=n>e</span><span class=p>;</span>
        <span class=p>}</span>

        <span class=k>if</span> <span class=p>(</span><span class=n>clazz</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>try</span> <span class=p>{</span>
                <span class=n>clazz</span> <span class=o>=</span> <span class=n>findClass</span><span class=p>(</span><span class=n>className</span><span class=p>);</span>
            <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>ClassNotFoundException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
                <span class=n>e</span><span class=p>.</span><span class=na>addSuppressed</span><span class=p>(</span><span class=n>suppressed</span><span class=p>);</span>
                <span class=k>throw</span> <span class=n>e</span><span class=p>;</span>
            <span class=p>}</span>
        <span class=p>}</span>
    <span class=p>}</span>

    <span class=k>return</span> <span class=n>clazz</span><span class=p>;</span>
<span class=p>}</span>
</pre></div> <p>具体过程在方法注释中很清楚：</p> <ol> <li>调用<code>findLoadedClass(String)</code>看看该类是否已经加载过了</li> <li>如果还没有加载，调用<code>parent.loadClass()</code>方法</li> <li>如果该类仍然没有被加载，调用自身<code>findClass(String)</code>进行加载</li> </ol> <div class="admonition success"> <p class=admonition-title>Success</p> <p>使用双亲委托模式的好处<br> 1.可以避免重复加载<br> 2.考虑安全因素，可以避免恶意程序使用自定义的String来动态替代java api中定义的类型。</p> </div> <h3 id=3>3. 简述双亲委托模型在热修复领域的应用<a class=headerlink href=#3 title="Permanent link">&para;</a></h3> <p>双亲委托模型在热修复领域的应用主要体现在<code>BaseDexClassLoader#findClass</code>方法中。</p> <p>在上面一节中我们知道如果某个class从来没有加载过，那么会调用自身的<code>findClass</code>方法进行加载。<br> 而在<code>BaseDexClassLoader#findClass</code>中，会调用<code>pathList.findClass(name, suppressedExceptions)</code>进行处理。下面是两个方法的源码。</p> <p><strong><a href=http://androidxref.com/6.0.0_r5/xref/libcore/dalvik/src/main/java/dalvik/system/BaseDexClassLoader.java#52>BaseDexClassLoader#findClass</a></strong> <div class=codehilite><pre><span></span><span class=nd>@Override</span>
<span class=kd>protected</span> <span class=n>Class</span><span class=o>&lt;?&gt;</span> <span class=n>findClass</span><span class=p>(</span><span class=n>String</span> <span class=n>name</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>ClassNotFoundException</span> <span class=p>{</span>
    <span class=n>List</span><span class=o>&lt;</span><span class=n>Throwable</span><span class=o>&gt;</span> <span class=n>suppressedExceptions</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;</span><span class=n>Throwable</span><span class=o>&gt;</span><span class=p>();</span>
    <span class=n>Class</span> <span class=n>c</span> <span class=o>=</span> <span class=n>pathList</span><span class=p>.</span><span class=na>findClass</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>suppressedExceptions</span><span class=p>);</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>c</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>ClassNotFoundException</span> <span class=n>cnfe</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ClassNotFoundException</span><span class=p>(</span><span class=s>&quot;Didn&#39;t find class \&quot;&quot;</span> <span class=o>+</span> <span class=n>name</span> <span class=o>+</span> <span class=s>&quot;\&quot; on path: &quot;</span> <span class=o>+</span> <span class=n>pathList</span><span class=p>);</span>
        <span class=k>for</span> <span class=p>(</span><span class=n>Throwable</span> <span class=n>t</span> <span class=p>:</span> <span class=n>suppressedExceptions</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>cnfe</span><span class=p>.</span><span class=na>addSuppressed</span><span class=p>(</span><span class=n>t</span><span class=p>);</span>
        <span class=p>}</span>
        <span class=k>throw</span> <span class=n>cnfe</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=k>return</span> <span class=n>c</span><span class=p>;</span>
<span class=p>}</span>
</pre></div></p> <p><strong><a href=http://androidxref.com/6.0.0_r5/xref/libcore/dalvik/src/main/java/dalvik/system/DexPathList.java#333>DexPathList#findClass</a></strong> <div class=codehilite><pre><span></span><span class=cm>/**</span>
<span class=cm> * Finds the named class in one of the dex files pointed at by</span>
<span class=cm> * this instance. This will find the one in the earliest listed</span>
<span class=cm> * path element. If the class is found but has not yet been</span>
<span class=cm> * defined, then this method will define it in the defining</span>
<span class=cm> * context that this instance was constructed with.</span>
<span class=cm> *</span>
<span class=cm> * @param name of class to find</span>
<span class=cm> * @param suppressed exceptions encountered whilst finding the class</span>
<span class=cm> * @return the named class or {@code null} if the class is not</span>
<span class=cm> * found in any of the dex files</span>
<span class=cm> */</span>
<span class=kd>public</span> <span class=n>Class</span> <span class=nf>findClass</span><span class=p>(</span><span class=n>String</span> <span class=n>name</span><span class=p>,</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>Throwable</span><span class=o>&gt;</span> <span class=n>suppressed</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>for</span> <span class=p>(</span><span class=n>Element</span> <span class=n>element</span> <span class=p>:</span> <span class=n>dexElements</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>DexFile</span> <span class=n>dex</span> <span class=o>=</span> <span class=n>element</span><span class=p>.</span><span class=na>dexFile</span><span class=p>;</span>

        <span class=k>if</span> <span class=p>(</span><span class=n>dex</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>Class</span> <span class=n>clazz</span> <span class=o>=</span> <span class=n>dex</span><span class=p>.</span><span class=na>loadClassBinaryName</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>definingContext</span><span class=p>,</span> <span class=n>suppressed</span><span class=p>);</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>clazz</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
                <span class=k>return</span> <span class=n>clazz</span><span class=p>;</span>
            <span class=p>}</span>
        <span class=p>}</span>
    <span class=p>}</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>dexElementsSuppressedExceptions</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>suppressed</span><span class=p>.</span><span class=na>addAll</span><span class=p>(</span><span class=n>Arrays</span><span class=p>.</span><span class=na>asList</span><span class=p>(</span><span class=n>dexElementsSuppressedExceptions</span><span class=p>));</span>
    <span class=p>}</span>
    <span class=k>return</span> <span class=kc>null</span><span class=p>;</span>
<span class=p>}</span>
</pre></div></p> <p><code>DexPathList#findClass</code>在查找指定类时，会按顺序遍历dexElements数组，只要找到就会立刻返回。而且由于双亲委托模型的存在，不会重复加载同一个class。<br> 因此，<strong>只要我们先加载修复好bug的class文件，那么就不会加载有bug的class了。</strong></p> <hr> <div class=md-source-date> <small> 最后更新: 2020年1月14日 </small> </div> <h2 id=__comments>评论</h2> <div id=disqus_thread></div> <script>
    var disqus_config = function () {
      this.page.url = "https://blog.yorek.xyz/about-me/android/paid/zsxq/week10-classloader/";
      this.page.identifier =
        "/android/paid/zsxq/week10-classloader/";
    };
    (function() {
      var d = document, s = d.createElement("script");
      s.src = "//yorekliu.disqus.com/embed.js";
      s.setAttribute("data-timestamp", +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid"> <a href=../week7-serialization/ title=关于序列化的知识 class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> 上一页 </span> 关于序列化的知识 </span> </div> </a> <a href=../week11-binder/ title=Binder简介 class="md-flex md-footer-nav__link md-footer-nav__link--next" rel=next> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> 下一页 </span> Binder简介 </span> </div> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> &copy; 2020 Yorek </div> powered by <a href=https://www.mkdocs.org>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ > Material for MkDocs</a> </div> <div class=md-footer-social> <link rel=stylesheet href=../../../../assets/fonts/font-awesome.css> <a href=https://github.com/YorekLiu class="md-footer-social__link fa fa-github"></a> <a href=lyytogether@gmail.com class="md-footer-social__link fa fa-email"></a> </div> </div> </div> </footer> </div> <script src=../../../../assets/javascripts/application.808e90bb.js></script> <script src=../../../../assets/javascripts/lunr/lunr.stemmer.support.js></script> <script src=../../../../assets/javascripts/lunr/tinyseg.js></script> <script src=../../../../assets/javascripts/lunr/lunr.ja.js></script> <script>app.initialize({version:"1.0.4",url:{base:"../../../.."}})</script> <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script> </body> </html>